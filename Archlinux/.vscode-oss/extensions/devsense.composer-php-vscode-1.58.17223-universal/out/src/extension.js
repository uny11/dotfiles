var Zb=Object.create;var Ga=Object.defineProperty;var eI=Object.getOwnPropertyDescriptor;var tI=Object.getOwnPropertyNames;var rI=Object.getPrototypeOf,nI=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),iI=(t,e)=>{for(var r in e)Ga(t,r,{get:e[r],enumerable:!0})},Vd=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of tI(e))!nI.call(t,i)&&i!==r&&Ga(t,i,{get:()=>e[i],enumerable:!(n=eI(e,i))||n.enumerable});return t};var lr=(t,e,r)=>(r=t!=null?Zb(rI(t)):{},Vd(e||!t||!t.__esModule?Ga(r,"default",{value:t,enumerable:!0}):r,t)),sI=t=>Vd(Ga({},"__esModule",{value:!0}),t);var b=(t,e,r)=>new Promise((n,i)=>{var s=c=>{try{o(r.next(c))}catch(u){i(u)}},a=c=>{try{o(r.throw(c))}catch(u){i(u)}},o=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,a);o((r=r.apply(t,e)).next())});var ou=d(Gd=>{var Bd=require("url"),aI=require("child_process").spawn,Xn=require("fs");Gd.XMLHttpRequest=function(){"use strict";var t=this,e=require("http"),r=require("https"),n,i,s={},a=!1,o={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},c={},u={},l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],p=["TRACE","TRACK","CONNECT"],f=!1,h=!1,v={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null,this.withCredentials=!1;var C=function(m){return a||m&&l.indexOf(m.toLowerCase())===-1},I=function(m){return m&&p.indexOf(m)===-1};this.open=function(m,x,V,B,ne){if(this.abort(),h=!1,!I(m))throw new Error("SecurityError: Request method not allowed");s={method:m,url:x.toString(),async:typeof V!="boolean"?!0:V,user:B||null,password:ne||null},w(this.OPENED)},this.setDisableHeaderCheck=function(m){a=m},this.setRequestHeader=function(m,x){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!C(m)){console.warn('Refused to set unsafe header "'+m+'"');return}if(f)throw new Error("INVALID_STATE_ERR: send flag is true");m=u[m.toLowerCase()]||m,u[m.toLowerCase()]=m,c[m]=c[m]?c[m]+", "+x:x},this.getResponseHeader=function(m){return typeof m=="string"&&this.readyState>this.OPENED&&i&&i.headers&&i.headers[m.toLowerCase()]&&!h?i.headers[m.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||h)return"";var m="";for(var x in i.headers)x!=="set-cookie"&&x!=="set-cookie2"&&(m+=x+": "+i.headers[x]+`\r
`);return m.substr(0,m.length-2)},this.getRequestHeader=function(m){return typeof m=="string"&&u[m.toLowerCase()]?c[u[m.toLowerCase()]]:""},this.send=function(m){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(f)throw new Error("INVALID_STATE_ERR: send has already been called");var x=!1,V=!1,B=Bd.parse(s.url),ne;switch(B.protocol){case"https:":x=!0;case"http:":ne=B.hostname;break;case"file:":V=!0;break;case void 0:case null:case"":ne="localhost";break;default:throw new Error("Protocol not supported.")}if(V){if(s.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(s.async)Xn.readFile(B.pathname,"utf8",function(Wt,qt){Wt?t.handleError(Wt):(t.status=200,t.responseText=qt,w(t.DONE))});else try{this.responseText=Xn.readFileSync(B.pathname,"utf8"),this.status=200,w(t.DONE)}catch(Wt){this.handleError(Wt)}return}var Be=B.port||(x?443:80),Et=B.pathname+(B.search?B.search:"");for(var Ze in o)u[Ze.toLowerCase()]||(c[Ze]=o[Ze]);if(c.Host=ne,x&&Be===443||Be===80||(c.Host+=":"+B.port),s.user){typeof s.password>"u"&&(s.password="");var zn=new Buffer(s.user+":"+s.password);c.Authorization="Basic "+zn.toString("base64")}s.method==="GET"||s.method==="HEAD"?m=null:m?(c["Content-Length"]=Buffer.isBuffer(m)?m.length:Buffer.byteLength(m),c["Content-Type"]||(c["Content-Type"]="text/plain;charset=UTF-8")):s.method==="POST"&&(c["Content-Length"]=0);var or={host:ne,port:Be,path:Et,method:s.method,headers:c,agent:!1,withCredentials:t.withCredentials};if(h=!1,s.async){var cr=x?r.request:e.request;f=!0,t.dispatchEvent("readystatechange");var Kr=function Wt(qt){if(i=qt,i.statusCode===301||i.statusCode===302||i.statusCode===303||i.statusCode===307){s.url=i.headers.location;var Qn=Bd.parse(s.url);ne=Qn.hostname;var Ot={hostname:Qn.hostname,port:Qn.port,path:Qn.path,method:i.statusCode===303?"GET":s.method,headers:c,withCredentials:t.withCredentials};n=cr(Ot,Wt).on("error",ur),n.end();return}i.setEncoding("utf8"),w(t.HEADERS_RECEIVED),t.status=i.statusCode,i.on("data",function(we){we&&(t.responseText+=we),f&&w(t.LOADING)}),i.on("end",function(){f&&(w(t.DONE),f=!1)}),i.on("error",function(we){t.handleError(we)})},ur=function(qt){t.handleError(qt)};n=cr(or,Kr).on("error",ur),m&&n.write(m),n.end(),t.dispatchEvent("loadstart")}else{var Yr=".node-xmlhttprequest-content-"+process.pid,Jr=".node-xmlhttprequest-sync-"+process.pid;Xn.writeFileSync(Jr,"","utf8");for(var tu="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(x?"s":"")+".request;var options = "+JSON.stringify(or)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+Yr+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText}}), 'utf8');fs.unlinkSync('"+Jr+"');});response.on('error', function(error) {fs.writeFileSync('"+Yr+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+Jr+"');});}).on('error', function(error) {fs.writeFileSync('"+Yr+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+Jr+"');});"+(m?"req.write('"+JSON.stringify(m).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",ru=aI(process.argv[0],["-e",tu]);Xn.existsSync(Jr););var Zr=JSON.parse(Xn.readFileSync(Yr,"utf8"));ru.stdin.end(),Xn.unlinkSync(Yr),Zr.err?t.handleError(Zr.err):(i=Zr.data,t.status=Zr.data.statusCode,t.responseText=Zr.data.text,w(t.DONE))}},this.handleError=function(m){this.status=0,this.statusText=m,this.responseText=m.stack,h=!0,w(this.DONE),this.dispatchEvent("error")},this.abort=function(){n&&(n.abort(),n=null),c=o,this.status=0,this.responseText="",this.responseXML="",h=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||f)&&this.readyState!==this.DONE&&(f=!1,w(this.DONE)),this.readyState=this.UNSENT,this.dispatchEvent("abort")},this.addEventListener=function(m,x){m in v||(v[m]=[]),v[m].push(x)},this.removeEventListener=function(m,x){m in v&&(v[m]=v[m].filter(function(V){return V!==x}))},this.dispatchEvent=function(m){if(typeof t["on"+m]=="function"&&t["on"+m](),m in v)for(var x=0,V=v[m].length;x<V;x++)v[m][x].call(t)};var w=function(m){(m==t.LOADING||t.readyState!==m)&&(t.readyState=m,(s.async||t.readyState<t.OPENED||t.readyState===t.DONE)&&t.dispatchEvent("readystatechange"),t.readyState===t.DONE&&!h&&(t.dispatchEvent("load"),t.dispatchEvent("loadend")))}}});var qe=d((W1,Jd)=>{"use strict";var pI=function(){function t(){}return t.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.enableDebug&&console.info(t.TAG+e,r)},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.disableWarnings||console.warn(t.TAG+e,r)},t.enableDebug=!1,t.disableWarnings=!1,t.disableErrors=!1,t.TAG="ApplicationInsights:",t}();Jd.exports=pI});var Qa=d(Nr=>{"use strict";var Zd=Nr&&Nr.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Nr,"__esModule",{value:!0});var tn=rn(),fI=require("events"),dI;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(dI=Nr.SpanKind||(Nr.SpanKind={}));var eh=function(){function t(){}return t.prototype.active=function(){var e=this,r=tn.CorrelationContextManager.getCurrentContext();return Zd({},r,{getValue:function(n){return e._activeSymbol?n===e._activeSymbol?r:!1:(e._activeSymbol=n,r)},setValue:function(){}})},t.prototype.with=function(e,r){var n=e.parentSpanId,i=e.name,s=t._spanToContext(e,n,i);return tn.CorrelationContextManager.runWithContext(s,r)()},t.prototype.bind=function(e){return typeof e=="function"?tn.CorrelationContextManager.wrapCallback(e):(e instanceof fI.EventEmitter&&tn.CorrelationContextManager.wrapEmitter(e),e)},t.prototype.enable=function(){return tn.CorrelationContextManager.enable(),this},t.prototype.disable=function(){return tn.CorrelationContextManager.disable(),this},t._spanToContext=function(e,r,n){var i=r?"|"+e.context().traceId+"."+r+".":e.context().traceId,s=Zd({},e.context(),{traceFlags:e.context().traceFlags.toString()}),a=tn.CorrelationContextManager.spanToContextObject(s,i,n);return a},t}();Nr.OpenTelemetryScopeManagerWrapper=eh;Nr.AsyncScopeManager=new eh});var no=d((R,gh)=>{R=gh.exports=j;var J;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?J=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:J=function(){};R.SEMVER_SPEC_VERSION="2.0.0";var ss=256,Wa=Number.MAX_SAFE_INTEGER||9007199254740991,pu=16,hI=ss-6,as=R.re=[],ie=R.safeRe=[],y=R.src=[],H=0,gu="[a-zA-Z0-9-]",fu=[["\\s",1],["\\d",ss],[gu,hI]];function eo(t){for(var e=0;e<fu.length;e++){var r=fu[e][0],n=fu[e][1];t=t.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return t}var Jn=H++;y[Jn]="0|[1-9]\\d*";var Zn=H++;y[Zn]="\\d+";var mu=H++;y[mu]="\\d*[a-zA-Z-]"+gu+"*";var rh=H++;y[rh]="("+y[Jn]+")\\.("+y[Jn]+")\\.("+y[Jn]+")";var nh=H++;y[nh]="("+y[Zn]+")\\.("+y[Zn]+")\\.("+y[Zn]+")";var du=H++;y[du]="(?:"+y[Jn]+"|"+y[mu]+")";var hu=H++;y[hu]="(?:"+y[Zn]+"|"+y[mu]+")";var yu=H++;y[yu]="(?:-("+y[du]+"(?:\\."+y[du]+")*))";var _u=H++;y[_u]="(?:-?("+y[hu]+"(?:\\."+y[hu]+")*))";var vu=H++;y[vu]=gu+"+";var cs=H++;y[cs]="(?:\\+("+y[vu]+"(?:\\."+y[vu]+")*))";var Cu=H++,ih="v?"+y[rh]+y[yu]+"?"+y[cs]+"?";y[Cu]="^"+ih+"$";var Eu="[v=\\s]*"+y[nh]+y[_u]+"?"+y[cs]+"?",Tu=H++;y[Tu]="^"+Eu+"$";var ii=H++;y[ii]="((?:<|>)?=?)";var Xa=H++;y[Xa]=y[Zn]+"|x|X|\\*";var Ka=H++;y[Ka]=y[Jn]+"|x|X|\\*";var nn=H++;y[nn]="[v=\\s]*("+y[Ka]+")(?:\\.("+y[Ka]+")(?:\\.("+y[Ka]+")(?:"+y[yu]+")?"+y[cs]+"?)?)?";var ti=H++;y[ti]="[v=\\s]*("+y[Xa]+")(?:\\.("+y[Xa]+")(?:\\.("+y[Xa]+")(?:"+y[_u]+")?"+y[cs]+"?)?)?";var sh=H++;y[sh]="^"+y[ii]+"\\s*"+y[nn]+"$";var ah=H++;y[ah]="^"+y[ii]+"\\s*"+y[ti]+"$";var oh=H++;y[oh]="(?:^|[^\\d])(\\d{1,"+pu+"})(?:\\.(\\d{1,"+pu+"}))?(?:\\.(\\d{1,"+pu+"}))?(?:$|[^\\d])";var to=H++;y[to]="(?:~>?)";var ri=H++;y[ri]="(\\s*)"+y[to]+"\\s+";as[ri]=new RegExp(y[ri],"g");ie[ri]=new RegExp(eo(y[ri]),"g");var vI="$1~",ch=H++;y[ch]="^"+y[to]+y[nn]+"$";var uh=H++;y[uh]="^"+y[to]+y[ti]+"$";var ro=H++;y[ro]="(?:\\^)";var ni=H++;y[ni]="(\\s*)"+y[ro]+"\\s+";as[ni]=new RegExp(y[ni],"g");ie[ni]=new RegExp(eo(y[ni]),"g");var gI="$1^",lh=H++;y[lh]="^"+y[ro]+y[nn]+"$";var ph=H++;y[ph]="^"+y[ro]+y[ti]+"$";var bu=H++;y[bu]="^"+y[ii]+"\\s*("+Eu+")$|^$";var Iu=H++;y[Iu]="^"+y[ii]+"\\s*("+ih+")$|^$";var sn=H++;y[sn]="(\\s*)"+y[ii]+"\\s*("+Eu+"|"+y[nn]+")";as[sn]=new RegExp(y[sn],"g");ie[sn]=new RegExp(eo(y[sn]),"g");var mI="$1$2$3",fh=H++;y[fh]="^\\s*("+y[nn]+")\\s+-\\s+("+y[nn]+")\\s*$";var dh=H++;y[dh]="^\\s*("+y[ti]+")\\s+-\\s+("+y[ti]+")\\s*$";var hh=H++;y[hh]="(<|>)?=?\\s*\\*";for(Yt=0;Yt<H;Yt++)J(Yt,y[Yt]),as[Yt]||(as[Yt]=new RegExp(y[Yt]),ie[Yt]=new RegExp(eo(y[Yt])));var Yt;R.parse=an;function an(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof j)return t;if(typeof t!="string"||t.length>ss)return null;var r=e.loose?ie[Tu]:ie[Cu];if(!r.test(t))return null;try{return new j(t,e)}catch{return null}}R.valid=yI;function yI(t,e){var r=an(t,e);return r?r.version:null}R.clean=_I;function _I(t,e){var r=an(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}R.SemVer=j;function j(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof j){if(t.loose===e.loose)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>ss)throw new TypeError("version is longer than "+ss+" characters");if(!(this instanceof j))return new j(t,e);J("SemVer",t,e),this.options=e,this.loose=!!e.loose;var r=t.trim().match(e.loose?ie[Tu]:ie[Cu]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Wa||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Wa||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Wa||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<Wa)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}j.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};j.prototype.toString=function(){return this.version};j.prototype.compare=function(t){return J("SemVer.compare",this.version,this.options,t),t instanceof j||(t=new j(t,this.options)),this.compareMain(t)||this.comparePre(t)};j.prototype.compareMain=function(t){return t instanceof j||(t=new j(t,this.options)),ei(this.major,t.major)||ei(this.minor,t.minor)||ei(this.patch,t.patch)};j.prototype.comparePre=function(t){if(t instanceof j||(t=new j(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],n=t.prerelease[e];if(J("prerelease compare",e,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return ei(r,n)}while(++e)};j.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this};R.inc=CI;function CI(t,e,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new j(t,r).inc(e,n).version}catch{return null}}R.diff=EI;function EI(t,e){if(wu(t,e))return null;var r=an(t),n=an(e),i="";if(r.prerelease.length||n.prerelease.length){i="pre";var s="prerelease"}for(var a in r)if((a==="major"||a==="minor"||a==="patch")&&r[a]!==n[a])return i+a;return s}R.compareIdentifiers=ei;var th=/^[0-9]+$/;function ei(t,e){var r=th.test(t),n=th.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1}R.rcompareIdentifiers=TI;function TI(t,e){return ei(e,t)}R.major=bI;function bI(t,e){return new j(t,e).major}R.minor=II;function II(t,e){return new j(t,e).minor}R.patch=wI;function wI(t,e){return new j(t,e).patch}R.compare=pr;function pr(t,e,r){return new j(t,r).compare(new j(e,r))}R.compareLoose=xI;function xI(t,e){return pr(t,e,!0)}R.rcompare=SI;function SI(t,e,r){return pr(e,t,r)}R.sort=AI;function AI(t,e){return t.sort(function(r,n){return R.compare(r,n,e)})}R.rsort=PI;function PI(t,e){return t.sort(function(r,n){return R.rcompare(r,n,e)})}R.gt=os;function os(t,e,r){return pr(t,e,r)>0}R.lt=Ya;function Ya(t,e,r){return pr(t,e,r)<0}R.eq=wu;function wu(t,e,r){return pr(t,e,r)===0}R.neq=vh;function vh(t,e,r){return pr(t,e,r)!==0}R.gte=xu;function xu(t,e,r){return pr(t,e,r)>=0}R.lte=Su;function Su(t,e,r){return pr(t,e,r)<=0}R.cmp=Ja;function Ja(t,e,r,n){switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return wu(t,r,n);case"!=":return vh(t,r,n);case">":return os(t,r,n);case">=":return xu(t,r,n);case"<":return Ya(t,r,n);case"<=":return Su(t,r,n);default:throw new TypeError("Invalid operator: "+e)}}R.Comparator=Tt;function Tt(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Tt){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof Tt))return new Tt(t,e);t=t.trim().split(/\s+/).join(" "),J("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===us?this.value="":this.value=this.operator+this.semver.version,J("comp",this)}var us={};Tt.prototype.parse=function(t){var e=this.options.loose?ie[bu]:ie[Iu],r=t.match(e);if(!r)throw new TypeError("Invalid comparator: "+t);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new j(r[2],this.options.loose):this.semver=us};Tt.prototype.toString=function(){return this.value};Tt.prototype.test=function(t){return J("Comparator.test",t,this.options.loose),this.semver===us?!0:(typeof t=="string"&&(t=new j(t,this.options)),Ja(t,this.operator,this.semver,this.options))};Tt.prototype.intersects=function(t,e){if(!(t instanceof Tt))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var r;if(this.operator==="")return r=new pe(t.value,e),Za(this.value,r,e);if(t.operator==="")return r=new pe(this.value,e),Za(t.semver,r,e);var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),o=Ja(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),c=Ja(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||i||s&&a||o||c};R.Range=pe;function pe(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof pe)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new pe(t.raw,e);if(t instanceof Tt)return new pe(t.value,e);if(!(this instanceof pe))return new pe(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}pe.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range};pe.prototype.toString=function(){return this.range};pe.prototype.parseRange=function(t){var e=this.options.loose,r=e?ie[dh]:ie[fh];t=t.replace(r,FI),J("hyphen replace",t),t=t.replace(ie[sn],mI),J("comparator trim",t,ie[sn]),t=t.replace(ie[ri],vI),t=t.replace(ie[ni],gI);var n=e?ie[bu]:ie[Iu],i=t.split(" ").map(function(s){return DI(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(s){return!!s.match(n)})),i=i.map(function(s){return new Tt(s,this.options)},this),i};pe.prototype.intersects=function(t,e){if(!(t instanceof pe))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return t.set.some(function(i){return i.every(function(s){return n.intersects(s,e)})})})})};R.toComparators=kI;function kI(t,e){return new pe(t,e).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function DI(t,e){return J("comp",t,e),t=OI(t,e),J("caret",t),t=RI(t,e),J("tildes",t),t=LI(t,e),J("xrange",t),t=HI(t,e),J("stars",t),t}function et(t){return!t||t.toLowerCase()==="x"||t==="*"}function RI(t,e){return t.trim().split(/\s+/).map(function(r){return qI(r,e)}).join(" ")}function qI(t,e){var r=e.loose?ie[uh]:ie[ch];return t.replace(r,function(n,i,s,a,o){J("tilde",t,n,i,s,a,o);var c;return et(i)?c="":et(s)?c=">="+i+".0.0 <"+(+i+1)+".0.0":et(a)?c=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":o?(J("replaceTilde pr",o),c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0"):c=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0",J("tilde return",c),c})}function OI(t,e){return t.trim().split(/\s+/).map(function(r){return NI(r,e)}).join(" ")}function NI(t,e){J("caret",t,e);var r=e.loose?ie[ph]:ie[lh];return t.replace(r,function(n,i,s,a,o){J("caret",t,n,i,s,a,o);var c;return et(i)?c="":et(s)?c=">="+i+".0.0 <"+(+i+1)+".0.0":et(a)?i==="0"?c=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+".0 <"+(+i+1)+".0.0":o?(J("replaceCaret pr",o),i==="0"?s==="0"?c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+s+"."+(+a+1):c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+"."+a+"-"+o+" <"+(+i+1)+".0.0"):(J("no pr"),i==="0"?s==="0"?c=">="+i+"."+s+"."+a+" <"+i+"."+s+"."+(+a+1):c=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+"."+a+" <"+(+i+1)+".0.0"),J("caret return",c),c})}function LI(t,e){return J("replaceXRanges",t,e),t.split(/\s+/).map(function(r){return MI(r,e)}).join(" ")}function MI(t,e){t=t.trim();var r=e.loose?ie[ah]:ie[sh];return t.replace(r,function(n,i,s,a,o,c){J("xRange",t,n,i,s,a,o,c);var u=et(s),l=u||et(a),p=l||et(o),f=p;return i==="="&&f&&(i=""),u?i===">"||i==="<"?n="<0.0.0":n="*":i&&f?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),n=i+s+"."+a+"."+o):l?n=">="+s+".0.0 <"+(+s+1)+".0.0":p&&(n=">="+s+"."+a+".0 <"+s+"."+(+a+1)+".0"),J("xRange return",n),n})}function HI(t,e){return J("replaceStars",t,e),t.trim().replace(ie[hh],"")}function FI(t,e,r,n,i,s,a,o,c,u,l,p,f){return et(r)?e="":et(n)?e=">="+r+".0.0":et(i)?e=">="+r+"."+n+".0":e=">="+e,et(c)?o="":et(u)?o="<"+(+c+1)+".0.0":et(l)?o="<"+c+"."+(+u+1)+".0":p?o="<="+c+"."+u+"."+l+"-"+p:o="<="+o,(e+" "+o).trim()}pe.prototype.test=function(t){if(!t)return!1;typeof t=="string"&&(t=new j(t,this.options));for(var e=0;e<this.set.length;e++)if(jI(this.set[e],t,this.options))return!0;return!1};function jI(t,e,r){for(var n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(n=0;n<t.length;n++)if(J(t[n].semver),t[n].semver!==us&&t[n].semver.prerelease.length>0){var i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}R.satisfies=Za;function Za(t,e,r){try{e=new pe(e,r)}catch{return!1}return e.test(t)}R.maxSatisfying=UI;function UI(t,e,r){var n=null,i=null;try{var s=new pe(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new j(n,r))}),n}R.minSatisfying=$I;function $I(t,e,r){var n=null,i=null;try{var s=new pe(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new j(n,r))}),n}R.minVersion=VI;function VI(t,e){t=new pe(t,e);var r=new j("0.0.0");if(t.test(r)||(r=new j("0.0.0-0"),t.test(r)))return r;r=null;for(var n=0;n<t.set.length;++n){var i=t.set[n];i.forEach(function(s){var a=new j(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!r||os(r,a))&&(r=a);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&t.test(r)?r:null}R.validRange=BI;function BI(t,e){try{return new pe(t,e).range||"*"}catch{return null}}R.ltr=GI;function GI(t,e,r){return Au(t,e,"<",r)}R.gtr=zI;function zI(t,e,r){return Au(t,e,">",r)}R.outside=Au;function Au(t,e,r,n){t=new j(t,n),e=new pe(e,n);var i,s,a,o,c;switch(r){case">":i=os,s=Su,a=Ya,o=">",c=">=";break;case"<":i=Ya,s=xu,a=os,o="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Za(t,e,n))return!1;for(var u=0;u<e.set.length;++u){var l=e.set[u],p=null,f=null;if(l.forEach(function(h){h.semver===us&&(h=new Tt(">=0.0.0")),p=p||h,f=f||h,i(h.semver,p.semver,n)?p=h:a(h.semver,f.semver,n)&&(f=h)}),p.operator===o||p.operator===c||(!f.operator||f.operator===o)&&s(t,f.semver))return!1;if(f.operator===c&&a(t,f.semver))return!1}return!0}R.prerelease=QI;function QI(t,e){var r=an(t,e);return r&&r.prerelease.length?r.prerelease:null}R.intersects=WI;function WI(t,e,r){return t=new pe(t,r),e=new pe(e,r),t.intersects(e)}R.coerce=XI;function XI(t){if(t instanceof j)return t;if(typeof t!="string")return null;var e=t.match(ie[oh]);return e==null?null:an(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var ku=d(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});var KI=require("path"),YI=no(),yh=require("module"),JI=Object.keys(process.binding("natives")),mh=yh.prototype.require;function ZI(t){var e={};return function(n){var i=mh.apply(this,arguments);if(t[n]){var s=yh._resolveFilename(n,this);if(e.hasOwnProperty(s))return e[s];var a=void 0;if(JI.indexOf(n)<0)try{a=mh.call(this,KI.join(n,"package.json")).version}catch{return i}else a=process.version.substring(1);var o=a.indexOf("-");o>=0&&(a=a.substring(0,o));for(var c=i,u=0,l=t[n];u<l.length;u++){var p=l[u];YI.satisfies(a,p.versionSpecifier)&&(c=p.patch(c,s))}return e[s]=c}return i}}Pu.makePatchingRequire=ZI});var _h=d((Y1,ew)=>{ew.exports={name:"diagnostic-channel",version:"0.3.1",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"tslint -c tslint.json -p tsconfig.json",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^5.3.0"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"^7.0.12",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"^2.2.1"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}});var _e=d(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});var tw=ku(),rw=ku();io.makePatchingRequire=rw.makePatchingRequire;var Ch=function(t){return!0},nw=function(){function t(){this.version=_h().version,this.subscribers={},this.contextPreservationFunction=function(e){return e},this.knownPatches={},this.currentlyPublishing=!1}return t.prototype.shouldPublish=function(e){var r=this.subscribers[e];return r?r.some(function(n){var i=n.filter;return!i||i(!1)}):!1},t.prototype.publish=function(e,r){if(!this.currentlyPublishing){var n=this.subscribers[e];if(n){var i={timestamp:Date.now(),data:r};this.currentlyPublishing=!0,n.forEach(function(s){var a=s.listener,o=s.filter;try{o&&o(!0)&&a(i)}catch{}}),this.currentlyPublishing=!1}}},t.prototype.subscribe=function(e,r,n){n===void 0&&(n=Ch),this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push({listener:r,filter:n})},t.prototype.unsubscribe=function(e,r,n){n===void 0&&(n=Ch);var i=this.subscribers[e];if(i){for(var s=0;s<i.length;++s)if(i[s].listener===r&&i[s].filter===n)return i.splice(s,1),!0}return!1},t.prototype.reset=function(){var e=this;this.subscribers={},this.contextPreservationFunction=function(r){return r},Object.getOwnPropertyNames(this.knownPatches).forEach(function(r){return delete e.knownPatches[r]})},t.prototype.bindToContext=function(e){return this.contextPreservationFunction(e)},t.prototype.addContextPreservation=function(e){var r=this.contextPreservationFunction;this.contextPreservationFunction=function(n){return e(r(n))}},t.prototype.registerMonkeyPatch=function(e,r){this.knownPatches[e]||(this.knownPatches[e]=[]),this.knownPatches[e].push(r)},t.prototype.getPatchesObject=function(){return this.knownPatches},t}();global.diagnosticsSource||(global.diagnosticsSource=new nw,Eh=require("module"),Eh.prototype.require=tw.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var Eh;io.channel=global.diagnosticsSource});var bh=d(fr=>{"use strict";var iw=fr&&fr.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(fr,"__esModule",{value:!0});var so=_e();fr.AzureMonitorSymbol="Azure_Monitor_Tracer";var Th=!1,sw=function(t){if(Th)return t;try{var e=require("@opentelemetry/tracing"),r=require("@opentelemetry/api"),n=so.channel.spanContextPropagator?{contextManager:so.channel.spanContextPropagator}:void 0;new e.BasicTracerProvider().register(n);var i=r.trace.getTracer("applicationinsights tracer"),s=i.startSpan;i.startSpan=function(a,o){if(!o||!o.parent){var c=r.getSpan(r.context.active());c&&c.operation&&c.operation.traceparent&&(o=iw({},o,{parent:{traceId:c.operation.traceparent.traceId,spanId:c.operation.traceparent.spanId,traceFlags:1}}))}var u=s.call(this,a,o),l=u.end;return u.end=function(){var p=l.apply(this,arguments);return so.channel.publish("azure-coretracing",u),p},u},r.getSpan(r.context.active()),i[fr.AzureMonitorSymbol]=!0,t.setTracer(i),Th=!0}catch{}return t};fr.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:sw};function aw(){so.channel.registerMonkeyPatch("@azure/core-tracing",fr.azureCoreTracing)}fr.enable=aw});var wh=d(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});var Ih=_e(),ow=function(t){var e=t.prototype._emit;return t.prototype._emit=function(r,n){var i=e.apply(this,arguments);if(!n){var s=i;s||(s=e.call(this,r,!0)),Ih.channel.publish("bunyan",{level:r.level,result:s})}return i},t};ls.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:ow};function cw(){Ih.channel.registerMonkeyPatch("bunyan",ls.bunyan)}ls.enable=cw});var Sh=d(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});var Du=_e(),xh=require("stream"),uw=function(t){var e=new xh.Writable,r=new xh.Writable;e.write=function(u){if(!u)return!0;var l=u.toString();return Du.channel.publish("console",{message:l}),!0},r.write=function(u){if(!u)return!0;var l=u.toString();return Du.channel.publish("console",{message:l,stderr:!0}),!0};for(var n=new t.Console(e,r),i=["log","info","warn","error","dir","time","timeEnd","trace","assert"],s=function(u){var l=t[u];l&&(t[u]=function(){if(n[u])try{n[u].apply(n,arguments)}catch{}return l.apply(t,arguments)})},a=0,o=i;a<o.length;a++){var c=o[a];s(c)}return t};ps.console={versionSpecifier:">= 4.0.0",patch:uw};function lw(){Du.channel.registerMonkeyPatch("console",ps.console),require("console")}ps.enable=lw});var Ah=d(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});var Ru=_e(),pw=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.pool.write;this.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=Ru.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=Ru.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t};fs.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:pw};function fw(){Ru.channel.registerMonkeyPatch("mongodb-core",fs.mongoCore)}fs.enable=fw});var kh=d(Nt=>{"use strict";var Ph=Nt&&Nt.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Nt,"__esModule",{value:!0});var Ge=_e(),dw=function(t){var e=t.instrument({operationIdGenerator:{next:function(){return Ge.channel.bindToContext(function(n){return n()})}}}),r={};return e.on("started",function(n){r[n.requestId]||(r[n.requestId]=Ph({},n,{time:new Date}))}),e.on("succeeded",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}):Ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}),e.on("failed",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}):Ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}),t},hw=function(t){var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=Ge.channel.bindToContext(function(s){return s()}),r[i.requestId]=Ph({},i,{time:new Date}))}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t},vw=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=Ge.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=Ge.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t},gw=function(t){vw(t);var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=Ge.channel.bindToContext(function(s){return s()}),r[i.requestId]=i)}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t};Nt.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:dw};Nt.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:hw};Nt.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:gw};function mw(){Ge.channel.registerMonkeyPatch("mongodb",Nt.mongo2),Ge.channel.registerMonkeyPatch("mongodb",Nt.mongo3),Ge.channel.registerMonkeyPatch("mongodb",Nt.mongo330)}Nt.enable=mw});var Rh=d(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});var ao=_e(),Dh=require("path"),yw=function(t,e){var r=function(c,u){return function(l,p){var f=c[l];f&&(c[l]=function(){for(var v=arguments.length-1,C=arguments.length-1;C>=0;--C)if(typeof arguments[C]=="function"){v=C;break}else if(typeof arguments[C]<"u")break;var I=arguments[v],w={result:null,startTime:null,startDate:null};typeof I=="function"&&(p?(w.startTime=process.hrtime(),w.startDate=new Date,arguments[v]=ao.channel.bindToContext(p(w,I))):arguments[v]=ao.channel.bindToContext(I));var m=f.apply(this,arguments);return w.result=m,m})}},n=function(c,u){return r(c.prototype,u+".prototype")},i=["connect","changeUser","ping","statistics","end"],s=require(Dh.dirname(e)+"/lib/Connection");i.forEach(function(c){return n(s,"Connection")(c)}),r(s,"Connection")("createQuery",function(c,u){return function(l){var p=process.hrtime(c.startTime),f=p[0]*1e3+p[1]/1e6|0;ao.channel.publish("mysql",{query:c.result,callbackArgs:arguments,err:l,duration:f,time:c.startDate}),u.apply(this,arguments)}});var a=["_enqueueCallback"],o=require(Dh.dirname(e)+"/lib/Pool");return a.forEach(function(c){return n(o,"Pool")(c)}),t};ds.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:yw};function _w(){ao.channel.registerMonkeyPatch("mysql",ds.mysql)}ds.enable=_w});var Oh=d(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});var qh=_e();function Cw(t){var e=t.prototype.connect;return t.prototype.connect=function(n){return n&&(arguments[0]=qh.channel.bindToContext(n)),e.apply(this,arguments)},t}hs.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:Cw};function Ew(){qh.channel.registerMonkeyPatch("pg-pool",hs.postgresPool1)}hs.enable=Ew});var Lh=d(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});var si=_e(),Nh=require("events");function Tw(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var c={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},u=process.hrtime(),l;function p(f){f&&f[n]&&(f=f[n]);var h=si.channel.bindToContext(function(v,C){var I=process.hrtime(u);if(c.result=C&&{rowCount:C.rowCount,command:C.command},c.error=v,c.duration=Math.ceil(I[0]*1e3+I[1]/1e6),si.channel.publish("postgres",c),v){if(f)return f.apply(this,arguments);l&&l instanceof Nh.EventEmitter&&l.emit("error",v)}else f&&f.apply(this,arguments)});try{return Object.defineProperty(h,n,{value:f}),h}catch{return f}}try{typeof s=="string"?a instanceof Array?(c.query.preparable={text:s,args:a},o=p(o)):(c.query.text=s,o?o=p(o):a=p(a)):(typeof s.name=="string"?c.query.plan=s.name:s.values instanceof Array?c.query.preparable={text:s.text,args:s.values}:c.query.text=s.text,o?o=p(o):a?a=p(a):s.callback=p(s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,l=r.apply(this,arguments),l},t}function bw(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var c=this,u=!!o,l={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},p=process.hrtime(),f;function h(v){v&&v[n]&&(v=v[n]);var C=si.channel.bindToContext(function(I,w){var m=process.hrtime(p);if(l.result=w&&{rowCount:w.rowCount,command:w.command},l.error=I,l.duration=Math.ceil(m[0]*1e3+m[1]/1e6),si.channel.publish("postgres",l),I){if(v)return v.apply(this,arguments);f&&f instanceof Nh.EventEmitter&&f.emit("error",I)}else v&&v.apply(this,arguments)});try{return Object.defineProperty(C,n,{value:v}),C}catch{return v}}try{typeof s=="string"?a instanceof Array?(l.query.preparable={text:s,args:a},u=typeof o=="function",o=u?h(o):o):(l.query.text=s,o?(u=typeof o=="function",o=u?h(o):o):(u=typeof a=="function",a=u?h(a):a)):(typeof s.name=="string"?l.query.plan=s.name:s.values instanceof Array?l.query.preparable={text:s.text,args:s.values}:l.query.text=s.text,o?(u=typeof o=="function",o=h(o)):a?(u=typeof a=="function",a=u?h(a):a):(u=typeof s.callback=="function",s.callback=u?h(s.callback):s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,f=r.apply(this,arguments),u?f:f.then(function(v){return h()(void 0,v),new c._Promise(function(C,I){C(v)})}).catch(function(v){return h()(v,void 0),new c._Promise(function(C,I){I(v)})})},t}on.postgres6={versionSpecifier:"6.*",patch:Tw};on.postgres7={versionSpecifier:">=7.* <=8.*",patch:bw};function Iw(){si.channel.registerMonkeyPatch("pg",on.postgres6),si.channel.registerMonkeyPatch("pg",on.postgres7)}on.enable=Iw});var Mh=d(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var qu=_e(),ww=function(t){var e=t.RedisClient.prototype.internal_send_command;return t.RedisClient.prototype.internal_send_command=function(r){if(r){var n=r.callback;if(!n||!n.pubsubBound){var i=this.address,s=process.hrtime(),a=new Date;r.callback=qu.channel.bindToContext(function(o,c){var u=process.hrtime(s),l=u[0]*1e3+u[1]/1e6|0;qu.channel.publish("redis",{duration:l,address:i,commandObj:r,err:o,result:c,time:a}),typeof n=="function"&&n.apply(this,arguments)}),r.callback.pubsubBound=!0}}return e.call(this,r)},t};vs.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:ww};function xw(){qu.channel.registerMonkeyPatch("redis",vs.redis)}vs.enable=xw});var Hh=d(cn=>{"use strict";var Sw=cn&&cn.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(cn,"__esModule",{value:!0});var Ou=_e(),Aw=function(t){var e=t.Connection.prototype.makeRequest;return t.Connection.prototype.makeRequest=function(){function n(s){var a=process.hrtime(),o={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return Ou.channel.bindToContext(function(c,u,l){var p=process.hrtime(a);o=Sw({},o,{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!c&&{rowCount:u,rows:l},query:{text:this.parametersByName.statement.value},error:c,duration:Math.ceil(p[0]*1e3+p[1]/1e6)}),Ou.channel.publish("tedious",o),s.call(this,c,u,l)})}var i=arguments[0];arguments[0].callback=n(i.callback),e.apply(this,arguments)},t};cn.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:Aw};function Pw(){Ou.channel.registerMonkeyPatch("tedious",cn.tedious)}cn.enable=Pw});var Fh=d(Lt=>{"use strict";var kw=Lt&&Lt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dw=Lt&&Lt.__rest||function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]]);return r};Object.defineProperty(Lt,"__esModule",{value:!0});var oo=_e(),Rw=function(t){var e=t.Logger.prototype.log,r,n=function(i,s,a){var o;return r===t.config.npm.levels?o="npm":r===t.config.syslog.levels?o="syslog":o="unknown",oo.channel.publish("winston",{level:i,message:s,meta:a,levelKind:o}),s};return t.Logger.prototype.log=function(){return r=this.levels,!this.filters||this.filters.length===0?this.filters=[n]:this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter(function(s){return s!==n}),this.filters.push(n)),e.apply(this,arguments)},t},qw=function(t){var e=function(a,o){var c;return a.config.npm.levels[o]!=null?c="npm":a.config.syslog.levels[o]!=null?c="syslog":c="unknown",c},r=function(a){kw(o,a);function o(c,u){var l=a.call(this,u)||this;return l.winston=c,l}return o.prototype.log=function(c,u){var l=c.message,p=c.level,f=c.meta,h=Dw(c,["message","level","meta"]);p=typeof Symbol.for=="function"?c[Symbol.for("level")]:p,l=c instanceof Error?c:l;var v=e(this.winston,p);f=f||{};for(var C in h)h.hasOwnProperty(C)&&(f[C]=h[C]);oo.channel.publish("winston",{message:l,level:p,levelKind:v,meta:f}),u()},o}(t.Transport);function n(){var a=arguments[0].levels||t.config.npm.levels,o;for(var c in a)a.hasOwnProperty(c)&&(o=o===void 0||a[c]>a[o]?c:o);this.add(new r(t,{level:o}))}var i=t.createLogger;t.createLogger=function(){var o=arguments[0].levels||t.config.npm.levels,c;for(var u in o)o.hasOwnProperty(u)&&(c=c===void 0||o[u]>o[c]?u:c);var l=i.apply(this,arguments);l.add(new r(t,{level:c}));var p=l.configure;return l.configure=function(){p.apply(this,arguments),n.apply(this,arguments)},l};var s=t.configure;return t.configure=function(){s.apply(this,arguments),n.apply(this,arguments)},t.add(new r(t)),t};Lt.winston3={versionSpecifier:"3.x",patch:qw};Lt.winston2={versionSpecifier:"2.x",patch:Rw};function Ow(){oo.channel.registerMonkeyPatch("winston",Lt.winston2),oo.channel.registerMonkeyPatch("winston",Lt.winston3)}Lt.enable=Ow});var Yh=d(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});var jh=bh();ct.azuresdk=jh;var Uh=wh();ct.bunyan=Uh;var $h=Sh();ct.console=$h;var Vh=Ah();ct.mongodbCore=Vh;var Bh=kh();ct.mongodb=Bh;var Gh=Rh();ct.mysql=Gh;var zh=Oh();ct.pgPool=zh;var Qh=Lh();ct.pg=Qh;var Wh=Mh();ct.redis=Wh;var Xh=Hh();ct.tedious=Xh;var Kh=Fh();ct.winston=Kh;function Nw(){Uh.enable(),$h.enable(),Vh.enable(),Bh.enable(),Gh.enable(),Qh.enable(),zh.enable(),Wh.enable(),Kh.enable(),jh.enable(),Xh.enable()}ct.enable=Nw});var lo=d(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});var Lw=Qa(),Nu=qe();ai.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var Lu="DiagnosticChannel";if(ai.IsInitialized){Mt=Yh(),Jh=process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"",co=Jh.split(","),Mu={bunyan:Mt.bunyan,console:Mt.console,mongodb:Mt.mongodb,mongodbCore:Mt.mongodbCore,mysql:Mt.mysql,redis:Mt.redis,pg:Mt.pg,pgPool:Mt.pgPool,winston:Mt.winston,azuresdk:Mt.azuresdk};for(uo in Mu)co.indexOf(uo)===-1&&(Mu[uo].enable(),Nu.info(Lu,"Subscribed to "+uo+" events"));co.length>0&&Nu.info(Lu,"Some modules will not be patched",co)}else Nu.info(Lu,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var Mt,Jh,co,Mu,uo;function Mw(t){if(!!ai.IsInitialized){var e=_e();e.channel.addContextPreservation(t),e.channel.spanContextPropagator=Lw.AsyncScopeManager}}ai.registerContextPreservation=Mw});var oi=d((fL,Zh)=>{"use strict";Zh.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}});var gt=d((ju,tv)=>{"use strict";var Hu=ju&&ju.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Hw=require("http"),ev=require("https"),Fu=require("url"),po=require("constants"),gs=qe(),ci=oi(),Fw=function(){function t(){}return t.getCookie=function(e,r){var n="";if(e&&e.length&&typeof r=="string")for(var i=e+"=",s=r.split(";"),a=0;a<s.length;a++){var r=s[a];if(r=t.trim(r),r&&r.indexOf(i)===0){n=r.substring(i.length,s[a].length);break}}return n},t.trim=function(e){return typeof e=="string"?e.replace(/^\s+|\s+$/g,""):""},t.int32ArrayToBase64=function(e){var r=function(o,c){return String.fromCharCode(o>>c&255)},n=function(o){return r(o,24)+r(o,16)+r(o,8)+r(o,0)},i=e.map(n).join(""),s=Buffer.from?Buffer.from(i,"binary"):new Buffer(i,"binary"),a=s.toString("base64");return a.substr(0,a.indexOf("="))},t.random32=function(){return 4294967296*Math.random()|0},t.randomu32=function(){return t.random32()+2147483648},t.w3cTraceId=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n,i=0;i<4;i++)n=t.random32(),r+=e[n&15]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var s=e[8+Math.random()*4|0];return r.substr(0,8)+r.substr(9,4)+"4"+r.substr(13,3)+s+r.substr(16,3)+r.substr(19,12)},t.w3cSpanId=function(){return t.w3cTraceId().substring(16)},t.isValidW3CId=function(e){return e.length===32&&e!=="00000000000000000000000000000000"},t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},t.isError=function(e){return e instanceof Error},t.isPrimitive=function(e){var r=typeof e;return r==="string"||r==="number"||r==="boolean"},t.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},t.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var r=(e/1e3%60).toFixed(7).replace(/0{0,4}$/,""),n=""+Math.floor(e/(1e3*60))%60,i=""+Math.floor(e/(1e3*60*60))%24,s=Math.floor(e/(1e3*60*60*24));r=r.indexOf(".")<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i;var a=s>0?s+".":"";return a+i+":"+n+":"+r},t.extractError=function(e){var r=e;return{message:e.message,code:r.code||r.id||""}},t.extractObject=function(e){return e instanceof Error?t.extractError(e):typeof e.toJSON=="function"?e.toJSON():e},t.validateStringMap=function(e){if(typeof e!="object"){gs.info("Invalid properties dropped from payload");return}var r={};for(var n in e){var i="",s=e[n],a=typeof s;if(t.isPrimitive(s))i=s.toString();else if(s===null||a==="undefined")i="";else if(a==="function"){gs.info("key: "+n+" was function; will not serialize");continue}else{var o=t.isArray(s)?s:t.extractObject(s);try{t.isPrimitive(o)?i=o:i=JSON.stringify(o)}catch(c){i=s.constructor.name.toString()+" (Error: "+c.message+")",gs.info("key: "+n+", could not be serialized")}}r[n]=i.substring(0,t.MAX_PROPERTY_LENGTH)}return r},t.canIncludeCorrelationHeader=function(e,r){var n=e&&e.config&&e.config.correlationHeaderExcludedDomains;if(!n||n.length==0||!r)return!0;for(var i=0;i<n.length;i++){var s=new RegExp(n[i].replace(/\./g,".").replace(/\*/g,".*"));if(s.test(Fu.parse(r).hostname))return!1}return!0},t.getCorrelationContextTarget=function(e,r){var n=e.headers&&e.headers[ci.requestContextHeader];if(n)for(var i=n.split(","),s=0;s<i.length;++s){var a=i[s].split("=");if(a.length==2&&a[0]==r)return a[1]}},t.makeRequest=function(e,r,n,i){r&&r.indexOf("//")===0&&(r="https:"+r);var s=Fu.parse(r),a=Hu({},n,{host:s.hostname,port:s.port,path:s.pathname}),o=void 0;if(s.protocol==="https:"&&(o=e.proxyHttpsUrl||void 0),s.protocol==="http:"&&(o=e.proxyHttpUrl||void 0),o){o.indexOf("//")===0&&(o="http:"+o);var c=Fu.parse(o);c.protocol==="https:"?(gs.info("Proxies that use HTTPS are not supported"),o=void 0):a=Hu({},a,{host:c.hostname,port:c.port||"80",path:r,headers:Hu({},a.headers,{Host:s.hostname})})}var u=s.protocol==="https:"&&!o;return u&&e.httpsAgent!==void 0?a.agent=e.httpsAgent:!u&&e.httpAgent!==void 0?a.agent=e.httpAgent:u&&(a.agent=t.tlsRestrictedAgent),u?ev.request(a,i):Hw.request(a,i)},t.safeIncludeCorrelationHeader=function(e,r,n){var i;if(typeof n=="string")i=n;else if(n instanceof Array)i=n.join(",");else if(n&&typeof n.toString=="function")try{i=n.toString()}catch(s){gs.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",s,n)}i?t.addCorrelationIdHeaderFromString(e,r,i):r.setHeader(ci.requestContextHeader,ci.requestContextSourceKey+"="+e.config.correlationId)},t.addCorrelationIdHeaderFromString=function(e,r,n){var i=n.split(","),s=ci.requestContextSourceKey+"=",a=i.some(function(o){return o.substring(0,s.length)===s});a||r.setHeader(ci.requestContextHeader,n+","+ci.requestContextSourceKey+"="+e.config.correlationId)},t.MAX_PROPERTY_LENGTH=8192,t.tlsRestrictedAgent=new ev.Agent({secureOptions:po.SSL_OP_NO_SSLv2|po.SSL_OP_NO_SSLv3|po.SSL_OP_NO_TLSv1|po.SSL_OP_NO_TLSv1_1}),t}();tv.exports=Fw});var un=d((dL,rv)=>{"use strict";var fo=gt(),Uu=qe(),jw=function(){function t(){}return t.queryCorrelationId=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId";if(t.completedLookups.hasOwnProperty(n)){r(t.completedLookups[n]);return}else if(t.pendingLookups[n]){t.pendingLookups[n].push(r);return}t.pendingLookups[n]=[r];var i=function(){if(!!t.pendingLookups[n]){var s={method:"GET",disableAppInsightsAutoCollection:!0};Uu.info(t.TAG,s);var a=fo.makeRequest(e,n,s,function(o){if(o.statusCode===200){var c="";o.setEncoding("utf-8"),o.on("data",function(u){c+=u}),o.on("end",function(){Uu.info(t.TAG,c);var u=t.correlationIdPrefix+c;t.completedLookups[n]=u,t.pendingLookups[n]&&t.pendingLookups[n].forEach(function(l){return l(u)}),delete t.pendingLookups[n]})}else o.statusCode>=400&&o.statusCode<500?(t.completedLookups[n]=void 0,delete t.pendingLookups[n]):setTimeout(i,e.correlationIdRetryIntervalMs)});a&&(a.on("error",function(o){Uu.warn(t.TAG,o)}),a.end())}};setTimeout(i,0)},t.cancelCorrelationIdQuery=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId",i=t.pendingLookups[n];i&&(t.pendingLookups[n]=i.filter(function(s){return s!=r}),t.pendingLookups[n].length==0&&delete t.pendingLookups[n])},t.generateRequestId=function(e){if(e){e=e[0]=="|"?e:"|"+e,e[e.length-1]!=="."&&(e+=".");var r=(t.currentRootId++).toString(16);return t.appendSuffix(e,r,"_")}else return t.generateRootId()},t.getRootId=function(e){var r=e.indexOf(".");r<0&&(r=e.length);var n=e[0]==="|"?1:0;return e.substring(n,r)},t.generateRootId=function(){return"|"+fo.w3cTraceId()+"."},t.appendSuffix=function(e,r,n){if(e.length+r.length<t.requestIdMaxLength)return e+r+n;var i=t.requestIdMaxLength-9;if(e.length>i)for(;i>1;--i){var s=e[i-1];if(s==="."||s==="_")break}if(i<=1)return t.generateRootId();for(r=fo.randomu32().toString(16);r.length<8;)r="0"+r;return e.substring(0,i)+r+"#"},t.TAG="CorrelationIdManager",t.correlationIdPrefix="cid-v1:",t.w3cEnabled=!0,t.pendingLookups={},t.completedLookups={},t.requestIdMaxLength=1024,t.currentRootId=fo.randomu32(),t}();rv.exports=jw});var ms=d((hL,nv)=>{"use strict";var He=gt(),Uw=un(),$w=function(){function t(e,r){if(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.version=t.DEFAULT_VERSION,e&&typeof e=="string")if(e.split(",").length>1)this.traceId=He.w3cTraceId(),this.spanId=He.w3cTraceId().substr(0,16);else{var n=e.trim().split("-"),i=n.length;i>=4?(this.version=n[0],this.traceId=n[1],this.spanId=n[2],this.traceFlag=n[3]):(this.traceId=He.w3cTraceId(),this.spanId=He.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=t.DEFAULT_VERSION,this.traceId=He.w3cTraceId()),this.version==="00"&&i!==4&&(this.traceId=He.w3cTraceId(),this.spanId=He.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=t.DEFAULT_VERSION,this.traceId=He.w3cTraceId(),this.spanId=He.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=t.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.traceId=He.w3cTraceId()),t.isValidTraceId(this.traceId)||(this.traceId=He.w3cTraceId()),t.isValidSpanId(this.spanId)||(this.spanId=He.w3cTraceId().substr(0,16),this.traceId=He.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(r){this.parentId=r.slice();var s=Uw.getRootId(r);t.isValidTraceId(s)||(this.legacyRootId=s,s=He.w3cTraceId()),r.indexOf("|")!==-1&&(r=r.substring(1+r.substring(0,r.length-1).lastIndexOf("."),r.length-1)),this.traceId=s,this.spanId=r}else this.traceId=He.w3cTraceId(),this.spanId=He.w3cTraceId().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},t.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},t.prototype.updateSpanId=function(){this.spanId=He.w3cTraceId().substr(0,16)},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}();nv.exports=$w});var $u=d((vL,iv)=>{"use strict";var Vw=function(){function t(e){this.fieldmap=[],e&&(this.fieldmap=this.parseHeader(e))}return t.prototype.toString=function(){var e=this.fieldmap;return!e||e.length==0?null:e.join(", ")},t.validateKeyChars=function(e){var r=e.split("@");if(r.length==2){var n=r[0].trim(),i=r[1].trim(),s=Boolean(n.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),a=Boolean(i.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return s&&a}else if(r.length==1)return Boolean(e.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/));return!1},t.prototype.parseHeader=function(e){var r=[],n={},i=e.split(",");if(i.length>32)return null;for(var s=0,a=i;s<a.length;s++){var o=a[s],c=o.trim();if(c.length!==0){var u=c.split("=");if(u.length!==2||!t.validateKeyChars(u[0])||n[u[0]])return null;n[u[0]]=!0,r.push(c)}}return r},t.strict=!0,t}();iv.exports=Vw});var dr=d((gL,sv)=>{"use strict";var Bw=function(){function t(){}return t}();sv.exports=Bw});var ov=d((Vu,av)=>{"use strict";var Gw=Vu&&Vu.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),zw=dr(),Qw=function(t){Gw(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(zw);av.exports=Qw});var Bu=d((mL,cv)=>{"use strict";var Ww=function(){function t(){}return t}();cv.exports=Ww});var lv=d((yL,uv)=>{"use strict";var Xw=function(){function t(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return t}();uv.exports=Xw});var fv=d((Gu,pv)=>{"use strict";var Kw=Gu&&Gu.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yw=Bu(),Jw=function(t){Kw(e,t);function e(){return t.call(this)||this}return e}(Yw);pv.exports=Jw});var Qu=d((_L,dv)=>{"use strict";var zu;(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(zu||(zu={}));dv.exports=zu});var vv=d((CL,hv)=>{"use strict";var Zw=Qu(),ex=function(){function t(){this.kind=Zw.Measurement}return t}();hv.exports=ex});var mv=d((EL,gv)=>{"use strict";var tx=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}();gv.exports=tx});var Xu=d((Wu,yv)=>{"use strict";var rx=Wu&&Wu.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),nx=dr(),ix=function(t){rx(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(nx);yv.exports=ix});var Cv=d((Ku,_v)=>{"use strict";var sx=Ku&&Ku.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ax=dr(),ox=function(t){sx(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.exceptions=[],r.properties={},r.measurements={},r}return e}(ax);_v.exports=ox});var Tv=d((TL,Ev)=>{"use strict";var cx=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}();Ev.exports=cx});var Iv=d((Yu,bv)=>{"use strict";var ux=Yu&&Yu.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),lx=dr(),px=function(t){ux(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r}return e}(lx);bv.exports=px});var xv=d((Ju,wv)=>{"use strict";var fx=Ju&&Ju.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),dx=dr(),hx=function(t){fx(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.metrics=[],r.properties={},r}return e}(dx);wv.exports=hx});var Av=d((Zu,Sv)=>{"use strict";var vx=Zu&&Zu.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),gx=Xu(),mx=function(t){vx(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(gx);Sv.exports=mx});var kv=d((el,Pv)=>{"use strict";var yx=el&&el.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),_x=dr(),Cx=function(t){yx(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.success=!0,r.properties={},r.measurements={},r}return e}(_x);Pv.exports=Cx});var Rv=d((tl,Dv)=>{"use strict";var Ex=tl&&tl.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tx=dr(),bx=function(t){Ex(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(Tx);Dv.exports=bx});var Ov=d((bL,qv)=>{"use strict";var rl;(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(rl||(rl={}));qv.exports=rl});var Lv=d((IL,Nv)=>{"use strict";var Ix=function(){function t(){}return t}();Nv.exports=Ix});var nl=d(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.AvailabilityData=ov();xe.Base=Bu();xe.ContextTagKeys=lv();xe.Data=fv();xe.DataPoint=vv();xe.DataPointType=Qu();xe.Domain=dr();xe.Envelope=mv();xe.EventData=Xu();xe.ExceptionData=Cv();xe.ExceptionDetails=Tv();xe.MessageData=Iv();xe.MetricData=xv();xe.PageViewData=Av();xe.RemoteDependencyData=kv();xe.RequestData=Rv();xe.SeverityLevel=Ov();xe.StackFrame=Lv()});var Mv=d(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});var ln=nl(),wx=function(){function t(){}return t.TYPE_HTTP="Http",t.TYPE_AI="Http (tracked component)",t}();ho.RemoteDependencyDataConstants=wx;function xx(t){return"properties"in t||t instanceof ln.EventData||t instanceof ln.ExceptionData||t instanceof ln.MessageData||t instanceof ln.MetricData||t instanceof ln.PageViewData||t instanceof ln.RemoteDependencyData||t instanceof ln.RequestData}ho.domainSupportsProperties=xx});var Hv=d(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});function Sx(t){switch(t){case Fe.Event:return"EventData";case Fe.Exception:return"ExceptionData";case Fe.Trace:return"MessageData";case Fe.Metric:return"MetricData";case Fe.Request:return"RequestData";case Fe.Dependency:return"RemoteDependencyData";case Fe.Availability:return"AvailabilityData";case Fe.PageView:return"PageViewData"}}pn.telemetryTypeToBaseType=Sx;function Ax(t){switch(t){case"EventData":return Fe.Event;case"ExceptionData":return Fe.Exception;case"MessageData":return Fe.Trace;case"MetricData":return Fe.Metric;case"RequestData":return Fe.Request;case"RemoteDependencyData":return Fe.Dependency;case"AvailabilityData":return Fe.Availability;case"PageViewData":return Fe.PageView}}pn.baseTypeToTelemetryType=Ax;pn.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var Fe;(function(t){t[t.Event=0]="Event",t[t.Exception=1]="Exception",t[t.Trace=2]="Trace",t[t.Metric=3]="Metric",t[t.Request=4]="Request",t[t.Dependency=5]="Dependency",t[t.Availability=6]="Availability",t[t.PageView=7]="PageView"})(Fe=pn.TelemetryType||(pn.TelemetryType={}))});var Fv=d(vo=>{"use strict";function Px(t){for(var e in t)vo.hasOwnProperty(e)||(vo[e]=t[e])}Object.defineProperty(vo,"__esModule",{value:!0});Px(Hv())});var ut=d(go=>{"use strict";function il(t){for(var e in t)go.hasOwnProperty(e)||(go[e]=t[e])}Object.defineProperty(go,"__esModule",{value:!0});il(Mv());il(nl());il(Fv())});var sl=d((kL,jv)=>{"use strict";var kx=function(){function t(){}return t.prototype.getUrl=function(){return this.url},t.prototype.RequestParser=function(){this.startTime=+new Date},t.prototype._setStatus=function(e,r){var n=+new Date;this.duration=n-this.startTime,this.statusCode=e;var i=this.properties||{};if(r){if(typeof r=="string")i.error=r;else if(r instanceof Error)i.error=r.message;else if(typeof r=="object")for(var s in r)i[s]=r[s]&&r[s].toString&&r[s].toString()}this.properties=i},t.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},t}();jv.exports=kx});var cl=d((ol,$v)=>{"use strict";var Dx=ol&&ol.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),mo=require("url"),Rx=ut(),Uv=gt(),fn=oi(),qx=sl(),Lr=un(),Ox=$u(),al=ms(),Nx=function(t){Dx(e,t);function e(r,n){var i=t.call(this)||this;return r&&(i.method=r.method,i.url=i._getAbsoluteUrl(r),i.startTime=+new Date,i.socketRemoteAddress=r.socket&&r.socket.remoteAddress,i.parseHeaders(r,n),r.connection&&(i.connectionRemoteAddress=r.connection.remoteAddress,i.legacySocketRemoteAddress=r.connection.socket&&r.connection.socket.remoteAddress)),i}return e.prototype.onError=function(r,n){this._setStatus(void 0,r),n&&(this.duration=n)},e.prototype.onResponse=function(r,n){this._setStatus(r.statusCode,void 0),n&&(this.duration=n)},e.prototype.getRequestTelemetry=function(r){var n={id:this.requestId,name:this.method+" "+mo.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(r&&r.time?n.time=r.time:this.startTime&&(n.time=new Date(this.startTime)),r){for(var i in r)n[i]||(n[i]=r[i]);if(r.properties)for(var i in r.properties)n.properties[i]=r.properties[i]}return n},e.prototype.getRequestTags=function(r){var n={};for(var i in r)n[i]=r[i];return n[e.keys.locationIp]=r[e.keys.locationIp]||this._getIp(),n[e.keys.sessionId]=r[e.keys.sessionId]||this._getId("ai_session"),n[e.keys.userId]=r[e.keys.userId]||this._getId("ai_user"),n[e.keys.userAuthUserId]=r[e.keys.userAuthUserId]||this._getId("ai_authUser"),n[e.keys.operationName]=this.getOperationName(r),n[e.keys.operationParentId]=this.getOperationParentId(r),n[e.keys.operationId]=this.getOperationId(r),n},e.prototype.getOperationId=function(r){return r[e.keys.operationId]||this.operationId},e.prototype.getOperationParentId=function(r){return r[e.keys.operationParentId]||this.parentId||this.getOperationId(r)},e.prototype.getOperationName=function(r){return r[e.keys.operationName]||this.method+" "+mo.parse(this.url).pathname},e.prototype.getRequestId=function(){return this.requestId},e.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},e.prototype.getTraceparent=function(){return this.traceparent},e.prototype.getTracestate=function(){return this.tracestate},e.prototype.getLegacyRootId=function(){return this.legacyRootId},e.prototype._getAbsoluteUrl=function(r){if(!r.headers)return r.url;var n=r.connection?r.connection.encrypted:null,i=mo.parse(r.url),s=i.pathname,a=i.search,o=mo.format({protocol:n?"https":"http",host:r.headers.host,pathname:s,search:a});return o},e.prototype._getIp=function(){var r=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(s){var a=r.exec(s);if(a)return a[0]},i=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!i&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(i="127.0.0.1"),i},e.prototype._getId=function(r){var n=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"",i=e.parseId(Uv.getCookie(r,n));return i},e.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},e.prototype.parseHeaders=function(r,n){if(this.rawHeaders=r.headers||r.rawHeaders,this.userAgent=r.headers&&r.headers["user-agent"],this.sourceCorrelationId=Uv.getCorrelationContextTarget(r,fn.requestContextSourceKey),r.headers){var i=r.headers[fn.traceStateHeader],s=r.headers[fn.traceparentHeader],a=r.headers[fn.requestIdHeader],o=r.headers[fn.parentIdHeader],c=r.headers[fn.rootIdHeader];this.correlationContextHeader=r.headers[fn.correlationContextHeader],Lr.w3cEnabled&&(s||i)?(this.traceparent=new al(s),this.tracestate=s&&i&&new Ox(i),this.setBackCompatFromThisTraceContext()):a?Lr.w3cEnabled?(this.traceparent=new al(null,a),this.setBackCompatFromThisTraceContext()):(this.parentId=a,this.requestId=Lr.generateRequestId(this.parentId),this.operationId=Lr.getRootId(this.requestId)):Lr.w3cEnabled?(this.traceparent=new al,this.traceparent.parentId=o,this.traceparent.legacyRootId=c||o,this.setBackCompatFromThisTraceContext()):(this.parentId=o,this.requestId=Lr.generateRequestId(c||this.parentId),this.correlationContextHeader=null,this.operationId=Lr.getRootId(this.requestId)),n&&(this.requestId=n,this.operationId=Lr.getRootId(this.requestId))}},e.parseId=function(r){var n=r.split("|");return n.length>0?n[0]:""},e.keys=new Rx.ContextTagKeys,e}(qx);$v.exports=Nx});var yo=d((DL,Gv)=>{"use strict";function ul(t){return typeof t=="function"}var tt=console.error.bind(console);function ys(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function _s(t){t&&t.logger&&(ul(t.logger)?tt=t.logger:tt("new logger isn't a function, not replacing"))}function Vv(t,e,r){if(!t||!t[e]){tt("no original function "+e+" to wrap");return}if(!r){tt("no wrapper function"),tt(new Error().stack);return}if(!ul(t[e])||!ul(r)){tt("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return ys(i,"__original",n),ys(i,"__unwrap",function(){t[e]===i&&ys(t,e,n)}),ys(i,"__wrapped",!0),ys(t,e,i),i}function Lx(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{tt("must provide one or more modules to patch"),tt(new Error().stack);return}if(!(e&&Array.isArray(e))){tt("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){Vv(n,i,r)})})}function Bv(t,e){if(!t||!t[e]){tt("no function to unwrap."),tt(new Error().stack);return}if(!t[e].__unwrap)tt("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function Mx(t,e){if(t)Array.isArray(t)||(t=[t]);else{tt("must provide one or more modules to patch"),tt(new Error().stack);return}if(!(e&&Array.isArray(e))){tt("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Bv(r,n)})})}_s.wrap=Vv;_s.massWrap=Lx;_s.unwrap=Bv;_s.massUnwrap=Mx;Gv.exports=_s});var Eo=d((RL,Xv)=>{"use strict";var Qv=yo(),ui=Qv.wrap,_o=Qv.unwrap,hr="wrap@before";function Co(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Hx(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[hr];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function Wv(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function Fx(t,e,r){var n=Wv(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&Hx(t,i)}function zv(t,e){if(!!t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}Xv.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(c,u){var l=Wv(this,c).slice();try{var p=a.call(this,c,u);return Fx(this,c,l),p}finally{this.on.__wrapped||ui(this,"on",i),this.addListener.__wrapped||ui(this,"addListener",i)}}}function s(a){return function(c){if(!this._events||!this._events[c])return a.apply(this,arguments);var u=this._events[c];function l(p){return function(){this._events[c]=u;try{return p.apply(this,arguments)}finally{u=this._events[c],this._events[c]=zv(u,n)}}}ui(this,"removeListener",l);try{return this._events[c]=zv(u,n),a.apply(this,arguments)}finally{_o(this,"removeListener"),this._events[c]=u}}}e[hr]?typeof e[hr]=="function"?Co(e,hr,[e[hr],r]):Array.isArray(e[hr])&&e[hr].push(r):Co(e,hr,r),e.__wrapped||(ui(e,"addListener",i),ui(e,"on",i),ui(e,"emit",s),Co(e,"__unwrap",function(){_o(e,"addListener"),_o(e,"on"),_o(e,"emit"),delete e[hr],delete e.__wrapped}),Co(e,"__wrapped",!0))}});var Zv=d((qL,Jv)=>{"use strict";var W=require("util"),vr=require("assert"),jx=Eo(),oe=require("async_hooks"),Cs="cls@contexts",Es="error@context",fe=process.env.DEBUG_CLS_HOOKED,Q=-1;Jv.exports={getNamespace:Kv,createNamespace:Ux,destroyNamespace:Yv,reset:$x,ERROR_SYMBOL:Es};function bt(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}bt.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,fe){let n=" ".repeat(this._indent<0?0:this._indent);ue(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+Q+" active:"+W.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};bt.prototype.get=function(e){if(!this.active){if(fe){let r=oe.currentId(),n=oe.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);ue(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${Q} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(fe){let r=oe.executionAsyncId(),n=oe.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);ue(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+Q+" active:"+W.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),ue(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${Q} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${W.inspect(this.active)}`)}return this.active[e]};bt.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=Q,fe){let r=oe.executionAsyncId(),n=oe.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);ue(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${Q} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${W.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};bt.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(fe){let n=oe.triggerAsyncId(),i=oe.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ue(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${Q} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${W.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[Es]=r),n}finally{if(fe){let n=oe.triggerAsyncId(),i=oe.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ue(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${Q} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${W.inspect(r)}`)}this.exit(r)}};bt.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};bt.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return fe&&ue("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+Q+" len:"+this._set.length+" "+W.inspect(r)),n.then(i=>(fe&&ue("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+Q+" len:"+this._set.length+" "+W.inspect(r)),this.exit(r),i)).catch(i=>{throw i[Es]=r,fe&&ue("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+Q+" len:"+this._set.length+" "+W.inspect(r)),this.exit(r),i})};bt.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[Es]=r),s}finally{n.exit(r)}}};bt.prototype.enter=function(e){if(vr.ok(e,"context must be provided for entering"),fe){let r=oe.executionAsyncId(),n=oe.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);ue(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${Q} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${W.inspect(e)}`)}this._set.push(this.active),this.active=e};bt.prototype.exit=function(e){if(vr.ok(e,"context must be provided for exiting"),fe){let n=oe.executionAsyncId(),i=oe.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ue(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${Q} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${W.inspect(e)}`)}if(this.active===e){vr.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(fe&&ue("??ERROR?? context exiting but not entered - ignoring: "+W.inspect(e)),vr.ok(r>=0,`context not currently entered; can't exit. 
`+W.inspect(this)+`
`+W.inspect(e))):(vr.ok(r,"can't remove top context"),this._set.splice(r,1))};bt.prototype.bindEmitter=function(e){vr.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[Cs]||(a[Cs]=Object.create(null)),a[Cs][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[Cs]))return a;let o=a,c=a[Cs];return Object.keys(c).forEach(function(u){let l=c[u];o=l.namespace.bind(o,l.context)}),o}jx(e,i,s)};bt.prototype.fromException=function(e){return e[Es]};function Kv(t){return process.namespaces[t]}function Ux(t){vr.ok(t,"namespace must be given a name."),fe&&ue(`NS-CREATING NAMESPACE (${t})`);let e=new bt(t);return e.id=Q,oe.createHook({init(n,i,s,a){if(Q=oe.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),fe){let o=" ".repeat(e._indent<0?0:e._indent);ue(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(Q===0){let o=oe.triggerAsyncId(),c=e._contexts.get(o);if(c){if(e._contexts.set(n,c),fe){let u=" ".repeat(e._indent<0?0:e._indent);ue(`${u}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${Q} triggerId:${o} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(fe){let u=" ".repeat(e._indent<0?0:e._indent);ue(`${u}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${Q} triggerId:${o} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(fe&&i==="PROMISE"){ue(W.inspect(a,{showHidden:!0}));let o=a.parentId,c=" ".repeat(e._indent<0?0:e._indent);ue(`${c}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){Q=oe.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(Q),i){if(fe){let s=oe.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);ue(`${a}BEFORE (${t}) asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${W.inspect(i)}`),e._indent+=2}e.enter(i)}else if(fe){let s=oe.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);ue(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${W.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){Q=oe.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(Q),i){if(fe){let s=oe.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);ue(`${a}AFTER (${t}) asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${W.inspect(i)}`)}e.exit(i)}else if(fe){let s=oe.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);ue(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${Q} triggerId:${s} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${W.inspect(i)}`)}},destroy(n){if(Q=oe.executionAsyncId(),fe){let i=oe.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);ue(`${s}DESTROY (${t}) currentUid:${Q} asyncId:${n} triggerId:${i} active:${W.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${W.inspect(e._contexts.get(Q))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Yv(t){let e=Kv(t);vr.ok(e,`can't delete nonexistent namespace! "`+t+'"'),vr.ok(e.id,"don't assign to process.namespaces directly! "+W.inspect(e)),process.namespaces[t]=null}function $x(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Yv(t)}),process.namespaces=Object.create(null)}process.namespaces={};function ue(...t){fe&&process._rawDebug(`${W.format(...t)}`)}});var tg=d((OL,eg)=>{"use strict";function Vx(){}eg.exports=function(){let e=this._hooks,r=this._state,n=process.nextTick;process.nextTick=function(){if(!r.enabled)return n.apply(process,arguments);let i=new Array(arguments.length);for(let c=0;c<arguments.length;c++)i[c]=arguments[c];let s=i[0];if(typeof s!="function")throw new TypeError("callback is not a function");let a=new Vx,o=--r.counter;return e.init.call(a,o,0,null,null),i[0]=function(){e.pre.call(a,o);let c=!0;try{s.apply(this,arguments),c=!1}finally{c&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){e.post.call(a,o,!0),e.destroy.call(null,o)})}e.post.call(a,o,!1),e.destroy.call(null,o)},n.apply(process,i)}}});var ng=d((NL,rg)=>{"use strict";function Bx(){}rg.exports=function(){let e=this._hooks,r=this._state,n=global.Promise,i=n.prototype.then;n.prototype.then=c;function s(u,l,p,f){return typeof u!="function"?f?a(p):o(p):function(){e.pre.call(l,p);try{return u.apply(this,arguments)}finally{e.post.call(l,p,!1),e.destroy.call(null,p)}}}function a(u){return function(p){return e.destroy.call(null,u),p}}function o(u){return function(p){throw e.destroy.call(null,u),p}}function c(u,l){if(!r.enabled)return i.call(this,u,l);let p=new Bx,f=--r.counter;return e.init.call(p,f,0,null,null),i.call(this,s(u,p,f,!0),s(l,p,f,!1))}}});var sg=d((LL,ig)=>{"use strict";var mt=require("timers");function Gx(){}function zx(){}function Qx(){}var Wx=new Map,Xx=new Map,Kx=new Map,ll=null,pl=!1;ig.exports=function(){fl(this._hooks,this._state,"setTimeout","clearTimeout",Gx,Wx,!0),fl(this._hooks,this._state,"setInterval","clearInterval",zx,Xx,!1),fl(this._hooks,this._state,"setImmediate","clearImmediate",Qx,Kx,!0),global.setTimeout=mt.setTimeout,global.setInterval=mt.setInterval,global.setImmediate=mt.setImmediate,global.clearTimeout=mt.clearTimeout,global.clearInterval=mt.clearInterval,global.clearImmediate=mt.clearImmediate};function fl(t,e,r,n,i,s,a){let o=mt[r],c=mt[n];mt[r]=function(){if(!e.enabled)return o.apply(mt,arguments);let u=new Array(arguments.length);for(let v=0;v<arguments.length;v++)u[v]=arguments[v];let l=u[0];if(typeof l!="function")throw new TypeError('"callback" argument must be a function');let p=new i,f=--e.counter,h;return t.init.call(p,f,0,null,null),u[0]=function(){ll=h,t.pre.call(p,f);let v=!0;try{l.apply(this,arguments),v=!1}finally{v&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){t.post.call(p,f,!0),s.delete(h),t.destroy.call(null,f)})}t.post.call(p,f,!1),ll=null,(a||pl)&&(pl=!1,s.delete(h),t.destroy.call(null,f))},h=o.apply(mt,u),s.set(h,f),h},mt[n]=function(u){if(ll===u&&u!==null)pl=!0;else if(s.has(u)){let l=s.get(u);s.delete(u),t.destroy.call(null,l)}c.apply(mt,arguments)}}});var dl=d((ML,Yx)=>{Yx.exports={name:"async-hook-jl",description:"Inspect the life of handle objects in node",version:"1.7.6",author:"Andreas Madsen <amwebdk@gmail.com>",main:"./index.js",scripts:{test:"node ./test/runner.js && eslint ."},repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},keywords:["async","async hooks","inspect","async wrap"],license:"MIT",dependencies:{"stack-chain":"^1.3.7"},devDependencies:{async:"1.5.x","cli-color":"1.1.x",eslint:"^3.4.0",endpoint:"0.4.x"},engines:{node:"^4.7 || >=6.9 || >=7.3"}}});var cg=d((HL,og)=>{"use strict";var bs=process.binding("async_wrap"),Jx=bs.Providers.TIMERWRAP,ag={nextTick:tg(),promise:ng(),timers:sg()},Ts=new Set;function Zx(){this.enabled=!1,this.counter=0}function hl(){let t=this.initFns=[],e=this.preFns=[],r=this.postFns=[],n=this.destroyFns=[];this.init=function(i,s,a,o){if(s===Jx){Ts.add(i);return}for(let c of t)c(i,this,s,a,o)},this.pre=function(i){if(!Ts.has(i))for(let s of e)s(i,this)},this.post=function(i,s){if(!Ts.has(i))for(let a of r)a(i,this,s)},this.destroy=function(i){if(Ts.has(i)){Ts.delete(i);return}for(let s of n)s(i)}}hl.prototype.add=function(t){t.init&&this.initFns.push(t.init),t.pre&&this.preFns.push(t.pre),t.post&&this.postFns.push(t.post),t.destroy&&this.destroyFns.push(t.destroy)};function To(t,e){let r=t.indexOf(e);r!==-1&&t.splice(r,1)}hl.prototype.remove=function(t){t.init&&To(this.initFns,t.init),t.pre&&To(this.preFns,t.pre),t.post&&To(this.postFns,t.post),t.destroy&&To(this.destroyFns,t.destroy)};function Is(){this._state=new Zx,this._hooks=new hl,this.version=dl().version,this.providers=bs.Providers;for(let t of Object.keys(ag))ag[t].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),bs.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}og.exports=Is;Is.prototype.addHooks=function(t){this._hooks.add(t)};Is.prototype.removeHooks=function(t){this._hooks.remove(t)};Is.prototype.enable=function(){this._state.enabled=!0,bs.enable()};Is.prototype.disable=function(){this._state.enabled=!1,bs.disable()}});var vl=d((FL,eS)=>{eS.exports={name:"stack-chain",description:"API for combining call site modifiers",version:"1.3.7",author:"Andreas Madsen <amwebdk@gmail.com>",scripts:{test:"tap ./test/simple"},repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},keywords:["stack","chain","trace","call site","concat","format"],devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},license:"MIT"}});var lg=d((jL,ug)=>{function tS(t){try{return Error.prototype.toString.call(t)}catch(e){try{return"<error: "+e+">"}catch{return"<error>"}}}ug.exports=function(e,r){var n=[];n.push(tS(e));for(var i=0;i<r.length;i++){var s=r[i],a;try{a=s.toString()}catch(o){try{a="<error: "+o+">"}catch{a="<error>"}}n.push("    at "+a)}return n.join(`
`)}});var hg=d((UL,dg)=>{var bo=lg();function fg(){this.extend=new ws,this.filter=new ws,this.format=new xs,this.version=vl().version}var ml=!1;fg.prototype.callSite=function t(e){e||(e={}),ml=!0;var r={};Error.captureStackTrace(r,t);var n=r.stack;return ml=!1,n=n.slice(e.slice||0),e.extend&&(n=this.extend._modify(r,n)),e.filter&&(n=this.filter._modify(r,n)),n};var Mr=new fg;function ws(){this._modifiers=[]}ws.prototype._modify=function(t,e){for(var r=0,n=this._modifiers.length;r<n;r++)e=this._modifiers[r](t,e);return e};ws.prototype.attach=function(t){this._modifiers.push(t)};ws.prototype.deattach=function(t){var e=this._modifiers.indexOf(t);return e===-1?!1:(this._modifiers.splice(e,1),!0)};function xs(){this._formater=bo,this._previous=void 0}xs.prototype.replace=function(t){t?this._formater=t:this.restore()};xs.prototype.restore=function(){this._formater=bo,this._previous=void 0};xs.prototype._backup=function(){this._previous=this._formater};xs.prototype._roolback=function(){this._previous===bo?this.replace(void 0):this.replace(this._previous),this._previous=void 0};Error.prepareStackTrace&&Mr.format.replace(Error.prepareStackTrace);var gl=!1;function pg(t,e){if(ml)return e;if(gl)return bo(t,e);var r=e.concat();r=Mr.extend._modify(t,r),r=Mr.filter._modify(t,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(t)&&Object.getOwnPropertyDescriptor(t,"callSite")===void 0&&(t.callSite={original:e,mutated:r}),gl=!0;var n=Mr.format._formater(t,r);return gl=!1,n}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return pg},set:function(t){t===pg?Mr.format._roolback():(Mr.format._backup(),Mr.format.replace(t))}});function rS(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:rS,set:function(t){Object.defineProperty(this,"callSite",{value:t,writable:!0,configurable:!0})},configurable:!0});dg.exports=Mr});var _l=d(($L,yl)=>{if(global._stackChain)if(global._stackChain.version===vl().version)yl.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else yl.exports=global._stackChain=hg()});var vg=d((VL,Cl)=>{"use strict";var nS=cg();if(global._asyncHook)if(global._asyncHook.version===dl().version)Cl.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else _l().filter.attach(function(e,r){return r.filter(function(n){let i=n.getFileName();return!(i&&i.slice(0,__dirname.length)===__dirname)})}),Cl.exports=global._asyncHook=new nS});var Eg=d((BL,Cg)=>{"use strict";var Ee=require("util"),gr=require("assert"),iS=Eo(),li=vg(),Ss="cls@contexts",As="error@context",mg=[];for(let t in li.providers)mg[li.providers[t]]=t;var me=process.env.DEBUG_CLS_HOOKED,Se=-1;Cg.exports={getNamespace:yg,createNamespace:sS,destroyNamespace:_g,reset:aS,ERROR_SYMBOL:As};function It(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map}It.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return me&&Ce("    SETTING KEY:"+e+"="+r+" in ns:"+this.name+" uid:"+Se+" active:"+Ee.inspect(this.active,!0)),this.active[e]=r,r};It.prototype.get=function(e){if(!this.active){me&&Ce("    GETTING KEY:"+e+"=undefined "+this.name+" uid:"+Se+" active:"+Ee.inspect(this.active,!0));return}return me&&Ce("    GETTING KEY:"+e+"="+this.active[e]+" "+this.name+" uid:"+Se+" active:"+Ee.inspect(this.active,!0)),this.active[e]};It.prototype.createContext=function(){me&&Ce("   CREATING Context: "+this.name+" uid:"+Se+" len:"+this._set.length+"  active:"+Ee.inspect(this.active,!0,2,!0));let e=Object.create(this.active?this.active:Object.prototype);return e._ns_name=this.name,e.id=Se,me&&Ce("   CREATED Context: "+this.name+" uid:"+Se+" len:"+this._set.length+"  context:"+Ee.inspect(e,!0,2,!0)),e};It.prototype.run=function(e){let r=this.createContext();this.enter(r);try{return me&&Ce(" BEFORE RUN: "+this.name+" uid:"+Se+" len:"+this._set.length+" "+Ee.inspect(r)),e(r),r}catch(n){throw n&&(n[As]=r),n}finally{me&&Ce(" AFTER RUN: "+this.name+" uid:"+Se+" len:"+this._set.length+" "+Ee.inspect(r)),this.exit(r)}};It.prototype.runAndReturn=function(e){var r;return this.run(function(n){r=e(n)}),r};It.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return me&&Ce(" BEFORE runPromise: "+this.name+" uid:"+Se+" len:"+this._set.length+" "+Ee.inspect(r)),n.then(i=>(me&&Ce(" AFTER runPromise: "+this.name+" uid:"+Se+" len:"+this._set.length+" "+Ee.inspect(r)),this.exit(r),i)).catch(i=>{throw i[As]=r,me&&Ce(" AFTER runPromise: "+this.name+" uid:"+Se+" len:"+this._set.length+" "+Ee.inspect(r)),this.exit(r),i})};It.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[As]=r),s}finally{n.exit(r)}}};It.prototype.enter=function(e){gr.ok(e,"context must be provided for entering"),me&&Ce("  ENTER "+this.name+" uid:"+Se+" len:"+this._set.length+" context: "+Ee.inspect(e)),this._set.push(this.active),this.active=e};It.prototype.exit=function(e){if(gr.ok(e,"context must be provided for exiting"),me&&Ce("  EXIT "+this.name+" uid:"+Se+" len:"+this._set.length+" context: "+Ee.inspect(e)),this.active===e){gr.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(me&&Ce("??ERROR?? context exiting but not entered - ignoring: "+Ee.inspect(e)),gr.ok(r>=0,`context not currently entered; can't exit. 
`+Ee.inspect(this)+`
`+Ee.inspect(e))):(gr.ok(r,"can't remove top context"),this._set.splice(r,1))};It.prototype.bindEmitter=function(e){gr.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[Ss]||(a[Ss]=Object.create(null)),a[Ss][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[Ss]))return a;let o=a,c=a[Ss];return Object.keys(c).forEach(function(u){let l=c[u];o=l.namespace.bind(o,l.context)}),o}iS(e,i,s)};It.prototype.fromException=function(e){return e[As]};function yg(t){return process.namespaces[t]}function sS(t){gr.ok(t,"namespace must be given a name."),me&&Ce("CREATING NAMESPACE "+t);let e=new It(t);return e.id=Se,li.addHooks({init(r,n,i,s,a){Se=r,s?(e._contexts.set(r,e._contexts.get(s)),me&&Ce("PARENTID: "+t+" uid:"+r+" parent:"+s+" provider:"+i)):e._contexts.set(Se,e.active),me&&Ce("INIT "+t+" uid:"+r+" parent:"+s+" provider:"+mg[i]+" active:"+Ee.inspect(e.active,!0))},pre(r,n){Se=r;let i=e._contexts.get(r);i?(me&&Ce(" PRE "+t+" uid:"+r+" handle:"+Io(n)+" context:"+Ee.inspect(i)),e.enter(i)):me&&Ce(" PRE MISSING CONTEXT "+t+" uid:"+r+" handle:"+Io(n))},post(r,n){Se=r;let i=e._contexts.get(r);i?(me&&Ce(" POST "+t+" uid:"+r+" handle:"+Io(n)+" context:"+Ee.inspect(i)),e.exit(i)):me&&Ce(" POST MISSING CONTEXT "+t+" uid:"+r+" handle:"+Io(n))},destroy(r){Se=r,me&&Ce("DESTROY "+t+" uid:"+r+" context:"+Ee.inspect(e._contexts.get(Se))+" active:"+Ee.inspect(e.active,!0)),e._contexts.delete(r)}}),process.namespaces[t]=e,e}function _g(t){let e=yg(t);gr.ok(e,`can't delete nonexistent namespace! "`+t+'"'),gr.ok(e.id,"don't assign to process.namespaces directly! "+Ee.inspect(e)),process.namespaces[t]=null}function aS(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){_g(t)}),process.namespaces=Object.create(null)}process.namespaces={};li._state&&!li._state.enabled&&li.enable();function Ce(t){process.env.DEBUG&&process._rawDebug(t)}function Io(t){if(!t)return t;if(typeof t=="function")return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(t.constructor&&t.constructor.name)return t.constructor.name}if(me){El=_l();for(gg in El.filter._modifiers)El.filter.deattach(gg)}var El,gg});var Tg=d((GL,Tl)=>{"use strict";var oS=no();process&&oS.gte(process.versions.node,"8.0.0")?Tl.exports=Zv():Tl.exports=Eg()});var wg=d((zL,Ig)=>{var cS=yo().wrap,Il=1<<0,wl=1<<1,xl=1<<2,xo=1<<3,te=[],uS=0,ze=!1,Hr=[],pi,Sl;function Al(t,e){var r=t.length,n=e.length,i=[];if(r===0&&n===0)return i;for(var s=0;s<r;s++)i[s]=t[s];if(n===0)return i;for(var a=0;a<n;a++){var o=!0;for(s=0;s<r;s++)if(t[s].uid===e[a].uid){o=!1;break}o&&i.push(e[a])}return i}process._fatalException?(wo=!1,pi=function(e){var r=te.length;if(wo||r===0)return!1;var n=!1;wo=!0;for(var i=0;i<r;++i){var s=te[i];if((s.flags&xo)!==0){var a=fi&&fi[s.uid];n=s.error(a,e)||n}}return wo=!1,Hr.length>0&&(te=Hr.pop()),fi=void 0,n&&!ze},Sl=function(e,r,n){var i=[];ze=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&Il)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return ze=!1,function(){fi=i,Hr.push(te),te=Al(r,te),ze=!0;for(var c=0;c<n;++c)(r[c].flags&wl)>0&&r[c].before(this,i[r[c].uid]);ze=!1;var u=e.apply(this,arguments);for(ze=!0,c=0;c<n;++c)(r[c].flags&xl)>0&&r[c].after(this,i[r[c].uid]);return ze=!1,te=Hr.pop(),fi=void 0,u}},cS(process,"_fatalException",function(t){return function(r){return pi(r)||t(r)}})):(bl=!1,pi=function(e){if(bl)throw e;for(var r=!1,n=te.length,i=0;i<n;++i){var s=te[i];(s.flags&xo)!==0&&(r=s.error(null,e)||r)}if(!r&&ze)throw e},Sl=function(e,r,n){var i=[];ze=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&Il)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return ze=!1,function(){var c=!1,u=!1;Hr.push(te),te=Al(r,te),ze=!0;for(var l=0;l<n;++l)(r[l].flags&wl)>0&&r[l].before(this,i[r[l].uid]);ze=!1;var p;try{p=e.apply(this,arguments)}catch(f){c=!0;for(var l=0;l<n;++l)if((te[l].flags&xo)!=0)try{u=te[l].error(i[r[l].uid],f)||u}catch(v){throw bl=!0,v}if(!u)throw process.removeListener("uncaughtException",pi),process._originalNextTick(function(){process.addListener("uncaughtException",pi)}),f}finally{if(!c||u){for(ze=!0,l=0;l<n;++l)(r[l].flags&xl)>0&&r[l].after(this,i[r[l].uid]);ze=!1}te=Hr.pop()}return p}},process.addListener("uncaughtException",pi));var wo,fi,bl;function lS(t,e,r){ze=!0;for(var n=0;n<r;++n){var i=e[n];i.create&&i.create(i.data)}return ze=!1,function(){Hr.push(te),te=Al(e,te);var s=t.apply(this,arguments);return te=Hr.pop(),s}}function pS(t){var e=te.length;if(e===0)return t;for(var r=te.slice(),n=0;n<e;++n)if(r[n].flags>0)return Sl(t,r,e);return lS(t,r,e)}function Jt(t,e){typeof t.create=="function"&&(this.create=t.create,this.flags|=Il),typeof t.before=="function"&&(this.before=t.before,this.flags|=wl),typeof t.after=="function"&&(this.after=t.after,this.flags|=xl),typeof t.error=="function"&&(this.error=t.error,this.flags|=xo),this.uid=++uS,this.data=e===void 0?null:e}Jt.prototype.create=void 0;Jt.prototype.before=void 0;Jt.prototype.after=void 0;Jt.prototype.error=void 0;Jt.prototype.data=void 0;Jt.prototype.uid=0;Jt.prototype.flags=0;function bg(t,e){if(typeof t!="object"||!t)throw new TypeError("callbacks argument must be an object");return t instanceof Jt?t:new Jt(t,e)}function fS(t,e){var r;t instanceof Jt?r=t:r=bg(t,e);for(var n=!1,i=0;i<te.length;i++)if(r===te[i]){n=!0;break}return n||te.push(r),r}function dS(t){for(var e=0;e<te.length;e++)if(t===te[e]){te.splice(e,1);break}}process.createAsyncListener=bg;process.addAsyncListener=fS;process.removeAsyncListener=dS;Ig.exports=pS});var Sg=d((WL,xg)=>{"use strict";xg.exports=(t,e)=>class extends t{constructor(n){var i,s;super(o);var a=this;try{n.apply(i,s)}catch(c){s[1](c)}return a;function o(c,u){i=this,s=[l,p];function l(f){return e(a,!1),c(f)}function p(f){return e(a,!1),u(f)}}}}});var Og=d(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var Dg=yo(),Ao=no(),lt=Dg.wrap,Fr=Dg.massWrap,de=wg(),hS=require("util"),vS=Ao.gte(process.version,"6.0.0"),Dl=Ao.gte(process.version,"7.0.0"),gS=Ao.gte(process.version,"8.0.0"),mS=Ao.gte(process.version,"11.0.0"),Zt=require("net");Dl&&!Zt._normalizeArgs?Zt._normalizeArgs=function(t){if(t.length===0)return[{},null];var e=t[0],r={};typeof e=="object"&&e!==null?r=e:TS(e)?r.path=e:(r.port=e,t.length>1&&typeof t[1]=="string"&&(r.host=t[1]));var n=t[t.length-1];return typeof n!="function"?[r,null]:[r,n]}:!Dl&&!Zt._normalizeConnectArgs&&(Zt._normalizeConnectArgs=function(t){var e={};function r(i){return(i=Number(i))>=0?i:!1}typeof t[0]=="object"&&t[0]!==null?e=t[0]:typeof t[0]=="string"&&r(t[0])===!1?e.path=t[0]:(e.port=t[0],typeof t[1]=="string"&&(e.host=t[1]));var n=t[t.length-1];return typeof n=="function"?[e,n]:[e]});"_setUpListenHandle"in Zt.Server.prototype?lt(Zt.Server.prototype,"_setUpListenHandle",Ag):lt(Zt.Server.prototype,"_listen2",Ag);function Ag(t){return function(){this.on("connection",function(e){e._handle&&(e._handle.onread=de(e._handle.onread))});try{return t.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=de(this._handle.onconnection))}}}function Rg(t){if(t&&t._handle){var e=t._handle;e._originalOnread||(e._originalOnread=e.onread),e.onread=de(e._originalOnread)}}lt(Zt.Socket.prototype,"connect",function(t){return function(){var e;gS&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?e=arguments[0]:e=Dl?Zt._normalizeArgs(arguments):Zt._normalizeConnectArgs(arguments),e[1]&&(e[1]=de(e[1]));var r=t.apply(this,e);return Rg(this),r}});var yS=require("http");lt(yS.Agent.prototype,"addRequest",function(t){return function(e){var r=e.onSocket;return e.onSocket=de(function(n){return Rg(n),r.apply(this,arguments)}),t.apply(this,arguments)}});var Pl=require("child_process");function Pg(t){Array.isArray(t.stdio)&&t.stdio.forEach(function(e){e&&e._handle&&(e._handle.onread=de(e._handle.onread),lt(e._handle,"close",Po))}),t._handle&&(t._handle.onexit=de(t._handle.onexit))}Pl.ChildProcess?lt(Pl.ChildProcess.prototype,"spawn",function(t){return function(){var e=t.apply(this,arguments);return Pg(this),e}}):Fr(Pl,["execFile","fork","spawn"],function(t){return function(){var e=t.apply(this,arguments);return Pg(e),e}});process._fatalException||(process._originalNextTick=process.nextTick);var Ol=[];process._nextDomainTick&&Ol.push("_nextDomainTick");process._tickDomainCallback&&Ol.push("_tickDomainCallback");Fr(process,Ol,er);lt(process,"nextTick",Po);var Nl=["setTimeout","setInterval"];global.setImmediate&&Nl.push("setImmediate");var qg=require("timers"),_S=global.setTimeout===qg.setTimeout;Fr(qg,Nl,Po);_S&&Fr(global,Nl,Po);var Rl=require("dns");Fr(Rl,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],er);Rl.resolveNaptr&&lt(Rl,"resolveNaptr",er);var hn=require("fs");Fr(hn,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],er);hn.lchown&&lt(hn,"lchown",er);hn.lchmod&&lt(hn,"lchmod",er);hn.ftruncate&&lt(hn,"ftruncate",er);var Ps;try{Ps=require("zlib")}catch{}Ps&&Ps.Deflate&&Ps.Deflate.prototype&&(dn=Object.getPrototypeOf(Ps.Deflate.prototype),dn._transform?lt(dn,"_transform",er):dn.write&&dn.flush&&dn.end&&Fr(dn,["write","flush","end"],er));var dn,ql;try{ql=require("crypto")}catch{}ql&&(kl=["pbkdf2","randomBytes"],mS||kl.push("pseudoRandomBytes"),Fr(ql,kl,er));var kl,So=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";So&&(kg=process.addAsyncListener({create:function(){So=!1}}),global.Promise.resolve(!0).then(function(){So=!1}),process.removeAsyncListener(kg));var kg;So&&CS();function CS(){var t=global.Promise;function e(a){if(!(this instanceof e))return t(a);if(typeof a!="function")return new t(a);var o,c,u=new t(l);u.__proto__=e.prototype;try{a.apply(o,c)}catch(p){c[1](p)}return u;function l(p,f){o=this,c=[h,v];function h(C){return n(u,!1),p(C)}function v(C){return n(u,!1),f(C)}}}if(hS.inherits(e,t),lt(t.prototype,"then",s),t.prototype.chain&&lt(t.prototype,"chain",s),vS)global.Promise=Sg()(t,n);else{var r=["all","race","reject","resolve","accept","defer"];r.forEach(function(a){typeof t[a]=="function"&&(e[a]=t[a])}),global.Promise=e}function n(a,o){(!a.__asl_wrapper||o)&&(a.__asl_wrapper=de(i))}function i(a,o,c,u){var l;try{return l=o.call(a,c),{returnVal:l,error:!1}}catch(p){return{errorVal:p,error:!0}}finally{l instanceof t?u.__asl_wrapper=function(){var f=l.__asl_wrapper||i;return f.apply(this,arguments)}:n(u,!0)}}function s(a){return function(){var c=this,u=a.apply(c,Array.prototype.map.call(arguments,l));return u.__asl_wrapper=function(f,h,v,C){return c.__asl_wrapper?(c.__asl_wrapper(f,function(){},null,u),u.__asl_wrapper(f,h,v,C)):i(f,h,v,C)},u;function l(p){return typeof p!="function"?p:de(function(f){var h=(c.__asl_wrapper||i)(this,p,f,u);if(h.error)throw h.errorVal;return h.returnVal})}}}}function er(t){var e=function(){var r,n=arguments.length-1;if(typeof arguments[n]=="function"){r=Array(arguments.length);for(var i=0;i<arguments.length-1;i++)r[i]=arguments[i];r[n]=de(arguments[n])}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof n=="function"&&(n=de(n)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof i=="function"&&(i=de(i)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof s=="function"&&(s=de(s)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof a=="function"&&(a=de(a)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof o=="function"&&(o=de(o)),t.call(this,r,n,i,s,a,o))};default:return e}}function Po(t){var e=function(){var r;if(typeof arguments[0]=="function"){r=Array(arguments.length),r[0]=de(arguments[0]);for(var n=1;n<arguments.length;n++)r[n]=arguments[n]}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof r=="function"&&(r=de(r)),t.call(this,r,n,i,s,a,o))};default:return e}}function ES(t){return(t=Number(t))>=0?t:!1}function TS(t){return typeof t=="string"&&ES(t)===!1}});var Fg=d((YL,Hg)=>{"use strict";var mr=require("assert"),bS=Eo(),ks="cls@contexts",Ll="error@context";process.addAsyncListener||Og();function Ht(t){this.name=t,this.active=null,this._set=[],this.id=null}Ht.prototype.set=function(t,e){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[t]=e,e};Ht.prototype.get=function(t){if(!!this.active)return this.active[t]};Ht.prototype.createContext=function(){return Object.create(this.active)};Ht.prototype.run=function(t){var e=this.createContext();this.enter(e);try{return t(e),e}catch(r){throw r&&(r[Ll]=e),r}finally{this.exit(e)}};Ht.prototype.runAndReturn=function(t){var e;return this.run(function(r){e=t(r)}),e};Ht.prototype.bind=function(t,e){e||(this.active?e=this.active:e=this.createContext());var r=this;return function(){r.enter(e);try{return t.apply(this,arguments)}catch(n){throw n&&(n[Ll]=e),n}finally{r.exit(e)}}};Ht.prototype.enter=function(t){mr.ok(t,"context must be provided for entering"),this._set.push(this.active),this.active=t};Ht.prototype.exit=function(t){if(mr.ok(t,"context must be provided for exiting"),this.active===t){mr.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var e=this._set.lastIndexOf(t);mr.ok(e>=0,"context not currently entered; can't exit"),mr.ok(e,"can't remove top context"),this._set.splice(e,1)};Ht.prototype.bindEmitter=function(t){mr.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");var e=this,r="context@"+this.name;function n(s){!s||(s[ks]||(s[ks]=Object.create(null)),s[ks][r]={namespace:e,context:e.active})}function i(s){if(!(s&&s[ks]))return s;var a=s,o=s[ks];return Object.keys(o).forEach(function(c){var u=o[c];a=u.namespace.bind(a,u.context)}),a}bS(t,n,i)};Ht.prototype.fromException=function(t){return t[Ll]};function Ng(t){return process.namespaces[t]}function IS(t){mr.ok(t,"namespace must be given a name!");var e=new Ht(t);return e.id=process.addAsyncListener({create:function(){return e.active},before:function(r,n){n&&e.enter(n)},after:function(r,n){n&&e.exit(n)},error:function(r){r&&e.exit(r)}}),process.namespaces[t]=e,e}function Lg(t){var e=Ng(t);mr.ok(e,"can't delete nonexistent namespace!"),mr.ok(e.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(e.id),process.namespaces[t]=null}function Mg(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Lg(t)}),process.namespaces=Object.create(null)}process.namespaces||Mg();Hg.exports={getNamespace:Ng,createNamespace:IS,destroyNamespace:Lg,reset:Mg}});var rn=d(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});var Ug=qe(),wS=lo(),Ds=ms(),Ml=$u(),jg=cl(),xS=function(){function t(){}return t.getCurrentContext=function(){if(!t.enabled)return null;var e=t.session.get(t.CONTEXT_NAME);return e===void 0?null:e},t.generateContextObject=function(e,r,n,i,s,a){return r=r||e,this.enabled?{operation:{name:n,id:e,parentId:r,traceparent:s,tracestate:a},customProperties:new SS(i)}:null},t.spanToContextObject=function(e,r,n){var i=new Ds;return i.traceId=e.traceId,i.spanId=e.spanId,i.traceFlag=e.traceFlags||Ds.DEFAULT_TRACE_FLAG,i.parentId=r,t.generateContextObject(i.traceId,i.parentId,n,null,i)},t.runWithContext=function(e,r){if(t.enabled)return t.session.bind(r,(n={},n[t.CONTEXT_NAME]=e,n))();return r();var n},t.wrapEmitter=function(e){t.enabled&&t.session.bindEmitter(e)},t.wrapCallback=function(e,r){if(t.enabled)return t.session.bind(e,r?(n={},n[t.CONTEXT_NAME]=r,n):void 0);return e;var n},t.enable=function(e){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}t.hasEverEnabled||(this.forceClsHooked=e,this.hasEverEnabled=!0,typeof this.cls>"u"&&(t.forceClsHooked===!0||t.forceClsHooked===void 0&&t.shouldUseClsHooked()?this.cls=Tg():this.cls=Fg()),t.session=this.cls.createNamespace("AI-CLS-Session"),wS.registerContextPreservation(function(r){return t.session.bind(r)})),this.enabled=!0}},t.startOperation=function(e,r){var n=e&&e.traceContext||null,i=e&&e.traceId?e:null,s=e&&e.headers;if(i){var a=new Ds("00-"+i.traceId+"-"+i.spanId+"-01"),o=new Ml(i.tracestate),c=t.generateContextObject(i.traceId,"|"+i.traceId+"."+i.spanId+".",typeof r=="string"?r:"",void 0,a,o);return c}if(n){var a=new Ds(n.traceparent),o=new Ml(n.tracestate),u=typeof r=="object"?new jg(r):null,c=t.generateContextObject(a.traceId,a.parentId,typeof r=="string"?r:u.getOperationName({}),u&&u.getCorrelationContextHeader()||void 0,a,o);return c}if(s){var a=new Ds(s.traceparent),o=new Ml(s.tracestate),u=new jg(e),c=t.generateContextObject(a.traceId,a.parentId,u.getOperationName({}),u.getCorrelationContextHeader(),a,o);return c}return Ug.warn("startOperation was called with invalid arguments",arguments),null},t.disable=function(){this.enabled=!1},t.reset=function(){t.hasEverEnabled&&(t.session=null,t.session=this.cls.createNamespace("AI-CLS-Session"))},t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>3||parseInt(e[0])>2&&parseInt(e[1])>2},t.shouldUseClsHooked=function(){var e=process.versions.node.split(".");return parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=2},t.canUseClsHooked=function(){var e=process.versions.node.split("."),r=parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=0,n=parseInt(e[0])<8||parseInt(e[0])<=8&&parseInt(e[1])<2,i=parseInt(e[0])>4||parseInt(e[0])>=4&&parseInt(e[1])>=7;return!(r&&n)&&i},t.enabled=!1,t.hasEverEnabled=!1,t.forceClsHooked=void 0,t.CONTEXT_NAME="ApplicationInsights-Context",t}();Hl.CorrelationContextManager=xS;var SS=function(){function t(e){this.props=[],this.addHeaderData(e)}return t.prototype.addHeaderData=function(e){var r=e?e.split(", "):[];this.props=r.map(function(n){var i=n.split("=");return{key:i[0],value:i[1]}}).concat(this.props)},t.prototype.serializeToHeader=function(){return this.props.map(function(e){return e.key+"="+e.value}).join(", ")},t.prototype.getProperty=function(e){for(var r=0;r<this.props.length;++r){var n=this.props[r];if(n.key===e)return n.value}},t.prototype.setProperty=function(e,r){if(t.bannedCharacters.test(e)||t.bannedCharacters.test(r)){Ug.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+e+" and value: "+r);return}for(var n=0;n<this.props.length;++n){var i=this.props[n];if(i.key===e){i.value=r;return}}this.props.push({key:e,value:r})},t.bannedCharacters=/[,=]/,t}()});var Vg=d(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});var $g=ut(),Fl=_e(),vn=[],jl=function(t){var e=t.data.message;vn.forEach(function(r){e instanceof Error?r.trackException({exception:e}):(e.lastIndexOf(`
`)==e.length-1&&(e=e.substring(0,e.length-1)),r.trackTrace({message:e,severity:t.data.stderr?$g.SeverityLevel.Warning:$g.SeverityLevel.Information}))})};function AS(t,e){t?(vn.length===0&&Fl.channel.subscribe("console",jl),vn.push(e)):(vn=vn.filter(function(r){return r!=e}),vn.length===0&&Fl.channel.unsubscribe("console",jl))}ko.enable=AS;function PS(){Fl.channel.unsubscribe("console",jl),vn=[]}ko.dispose=PS});var Bg=d(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});var di=ut(),Ul=_e(),gn=[],kS={10:di.SeverityLevel.Verbose,20:di.SeverityLevel.Verbose,30:di.SeverityLevel.Information,40:di.SeverityLevel.Warning,50:di.SeverityLevel.Error,60:di.SeverityLevel.Critical},$l=function(t){var e=t.data.result;gn.forEach(function(r){var n=kS[t.data.level];e instanceof Error?r.trackException({exception:e}):r.trackTrace({message:e,severity:n})})};function DS(t,e){t?(gn.length===0&&Ul.channel.subscribe("bunyan",$l),gn.push(e)):(gn=gn.filter(function(r){return r!=e}),gn.length===0&&Ul.channel.unsubscribe("bunyan",$l))}Do.enable=DS;function RS(){Ul.channel.unsubscribe("bunyan",$l),gn=[]}Do.dispose=RS});var Gg=d(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});var je=ut(),Vl=_e(),mn=[],qS={syslog:function(t){var e={emerg:je.SeverityLevel.Critical,alert:je.SeverityLevel.Critical,crit:je.SeverityLevel.Critical,error:je.SeverityLevel.Error,warning:je.SeverityLevel.Warning,notice:je.SeverityLevel.Information,info:je.SeverityLevel.Information,debug:je.SeverityLevel.Verbose};return e[t]===void 0?je.SeverityLevel.Information:e[t]},npm:function(t){var e={error:je.SeverityLevel.Error,warn:je.SeverityLevel.Warning,info:je.SeverityLevel.Information,verbose:je.SeverityLevel.Verbose,debug:je.SeverityLevel.Verbose,silly:je.SeverityLevel.Verbose};return e[t]===void 0?je.SeverityLevel.Information:e[t]},unknown:function(t){return je.SeverityLevel.Information}},Bl=function(t){var e=t.data.message;mn.forEach(function(r){if(e instanceof Error)r.trackException({exception:e,properties:t.data.meta});else{var n=qS[t.data.levelKind](t.data.level);r.trackTrace({message:e,severity:n,properties:t.data.meta})}})};function OS(t,e){t?(mn.length===0&&Vl.channel.subscribe("winston",Bl),mn.push(e)):(mn=mn.filter(function(r){return r!=e}),mn.length===0&&Vl.channel.unsubscribe("winston",Bl))}Ro.enable=OS;function NS(){Vl.channel.unsubscribe("winston",Bl),mn=[]}Ro.dispose=NS});var Qg=d((rM,zg)=>{"use strict";var LS=lo(),MS=function(){function t(e){if(t.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=e,t.INSTANCE=this}return t.prototype.enable=function(e,r){LS.IsInitialized&&(Vg().enable(e&&r,this._client),Bg().enable(e,this._client),Gg().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1,!1)},t._methodNames=["debug","info","log","warn","error"],t}();zg.exports=MS});var Xg=d((nM,Wg)=>{"use strict";var HS=function(){function t(e){if(t.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e;var r=process.versions.node.split(".");t._canUseUncaughtExceptionMonitor=parseInt(r[0])>13||parseInt(r[0])===13&&parseInt(r[1])>=7}return t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.enable=function(e){var r=this;if(e){this._isInitialized=!0;var n=this;if(!this._exceptionListenerHandle){var i=function(s,a,o){o===void 0&&(o=new Error(t._FALLBACK_ERROR_MESSAGE)),r._client.trackException({exception:o}),r._client.flush({isAppCrashing:!0}),s&&a&&process.listeners(a).length===1&&(console.error(o),process.exit(1))};t._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=i.bind(this,!0,t.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(t._canUseUncaughtExceptionMonitor?process.removeListener(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.INSTANCE=null,t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",t.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",t.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",t._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",t._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",t._canUseUncaughtExceptionMonitor=!1,t}();Wg.exports=HS});var jr=d(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com";G.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com";G.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var Qe;(function(t){t.COMMITTED_BYTES="\\Memory\\Committed Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",t.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",t.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",t.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",t.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",t.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",t.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(Qe=G.QuickPulseCounter||(G.QuickPulseCounter={}));var qo;(function(t){t.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",t.AVAILABLE_BYTES="\\Memory\\Available Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",t.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",t.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(qo=G.PerformanceCounter||(G.PerformanceCounter={}));G.PerformanceToQuickPulseCounter=(Ft={},Ft[qo.PROCESSOR_TIME]=Qe.PROCESSOR_TIME,Ft[qo.REQUEST_RATE]=Qe.REQUEST_RATE,Ft[qo.REQUEST_DURATION]=Qe.REQUEST_DURATION,Ft[Qe.COMMITTED_BYTES]=Qe.COMMITTED_BYTES,Ft[Qe.REQUEST_FAILURE_RATE]=Qe.REQUEST_FAILURE_RATE,Ft[Qe.DEPENDENCY_RATE]=Qe.DEPENDENCY_RATE,Ft[Qe.DEPENDENCY_FAILURE_RATE]=Qe.DEPENDENCY_FAILURE_RATE,Ft[Qe.DEPENDENCY_DURATION]=Qe.DEPENDENCY_DURATION,Ft[Qe.EXCEPTION_RATE]=Qe.EXCEPTION_RATE,Ft);G.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"};G.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"};G.TelemetryTypeStringToQuickPulseType={EventData:G.QuickPulseType.Event,ExceptionData:G.QuickPulseType.Exception,MessageData:G.QuickPulseType.Trace,MetricData:G.QuickPulseType.Metric,RequestData:G.QuickPulseType.Request,RemoteDependencyData:G.QuickPulseType.Dependency,AvailabilityData:G.QuickPulseType.Availability,PageViewData:G.QuickPulseType.PageView};G.TelemetryTypeStringToQuickPulseDocumentType={EventData:G.QuickPulseDocumentType.Event,ExceptionData:G.QuickPulseDocumentType.Exception,MessageData:G.QuickPulseDocumentType.Trace,MetricData:G.QuickPulseDocumentType.Metric,RequestData:G.QuickPulseDocumentType.Request,RemoteDependencyData:G.QuickPulseDocumentType.Dependency,AvailabilityData:G.QuickPulseDocumentType.Availability,PageViewData:G.QuickPulseDocumentType.PageView};G.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"};G.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"};G.HeartBeatMetricName="HeartBeat";var Ft});var No=d((sM,Kg)=>{"use strict";var Oo=require("os"),wt=jr(),FS=function(){function t(e,r,n){r===void 0&&(r=6e4),n===void 0&&(n=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e,this._collectionInterval=r,this._enableLiveMetricsCounters=n}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._lastCpus=Oo.cpus(),this._lastRequests={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:t._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},t.countRequest=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalRequestExecutionTime+=n,r===!1&&t._totalFailedRequestCount++,t._totalRequestCount++}},t.countException=function(){t._totalExceptionCount++},t.countDependency=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalDependencyExecutionTime+=n,r===!1&&t._totalFailedDependencyCount++,t._totalDependencyCount++}},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},t.prototype._trackCpu=function(){var e=Oo.cpus();if(e&&e.length&&this._lastCpus&&e.length===this._lastCpus.length){for(var r=0,n=0,i=0,s=0,a=0,o=0;!!e&&o<e.length;o++){var c=e[o],u=this._lastCpus[o],l="% cpu("+o+") ",p=c.model,f=c.speed,h=c.times,v=u.times,C=h.user-v.user||0;r+=C;var I=h.sys-v.sys||0;n+=I;var w=h.nice-v.nice||0;i+=w;var m=h.idle-v.idle||0;s+=m;var x=h.irq-v.irq||0;a+=x}var V=void 0;if(typeof process.cpuUsage=="function"){var B=process.cpuUsage(),ne=process.hrtime(),Be=B.user-this._lastAppCpuUsage.user+(B.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime<"u"&&this._lastHrtime.length===2){var Et=(ne[0]-this._lastHrtime[0])*1e6+(ne[1]-this._lastHrtime[1])/1e3||0;V=100*Be/(Et*e.length)}this._lastAppCpuUsage=B,this._lastHrtime=ne}var Ze=r+n+i+s+a||1;this._client.trackMetric({name:wt.PerformanceCounter.PROCESSOR_TIME,value:(Ze-s)/Ze*100}),this._client.trackMetric({name:wt.PerformanceCounter.PROCESS_TIME,value:V||r/Ze*100})}this._lastCpus=e},t.prototype._trackMemory=function(){var e=Oo.freemem(),r=process.memoryUsage().rss,n=Oo.totalmem()-e;this._client.trackMetric({name:wt.PerformanceCounter.PRIVATE_BYTES,value:r}),this._client.trackMetric({name:wt.PerformanceCounter.AVAILABLE_BYTES,value:e}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:wt.QuickPulseCounter.COMMITTED_BYTES,value:n})},t.prototype._trackNetwork=function(){var e=this._lastRequests,r={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},n=r.totalRequestCount-e.totalRequestCount||0,i=r.totalFailedRequestCount-e.totalFailedRequestCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/n||0;if(this._lastIntervalRequestExecutionTime=t._intervalRequestExecutionTime,s>0){var c=n/a,u=i/a;this._client.trackMetric({name:wt.PerformanceCounter.REQUEST_RATE,value:c}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:wt.PerformanceCounter.REQUEST_DURATION,value:o}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:wt.QuickPulseCounter.REQUEST_FAILURE_RATE,value:u})}this._lastRequests=r},t.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastDependencies,r={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},n=r.totalDependencyCount-e.totalDependencyCount||0,i=r.totalFailedDependencyCount-e.totalFailedDependencyCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/n||0;if(this._lastIntervalDependencyExecutionTime=t._intervalDependencyExecutionTime,s>0){var c=n/a,u=i/a;this._client.trackMetric({name:wt.QuickPulseCounter.DEPENDENCY_RATE,value:c}),this._client.trackMetric({name:wt.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:u}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:wt.QuickPulseCounter.DEPENDENCY_DURATION,value:o})}this._lastDependencies=r}},t.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastExceptions,r={totalExceptionCount:t._totalExceptionCount,time:+new Date},n=r.totalExceptionCount-e.totalExceptionCount||0,i=r.time-e.time,s=i/1e3;if(i>0){var a=n/s;this._client.trackMetric({name:wt.QuickPulseCounter.EXCEPTION_RATE,value:a})}this._lastExceptions=r}},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t._totalRequestCount=0,t._totalFailedRequestCount=0,t._lastRequestExecutionTime=0,t._totalDependencyCount=0,t._totalFailedDependencyCount=0,t._lastDependencyExecutionTime=0,t._totalExceptionCount=0,t._intervalDependencyExecutionTime=0,t._intervalRequestExecutionTime=0,t}();Kg.exports=FS});var Rs=d((aM,em)=>{"use strict";var yr=require("os"),Yg=require("fs"),Jg=require("path"),jS=ut(),Zg=qe(),US=function(){function t(e){this.keys=new jS.ContextTagKeys,this.tags={},this._loadApplicationContext(e),this._loadDeviceContext(),this._loadInternalContext()}return t.prototype._loadApplicationContext=function(e){if(e=e||Jg.resolve(__dirname,"../../../../package.json"),!t.appVersion[e]){t.appVersion[e]="unknown";try{var r=JSON.parse(Yg.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.appVersion[e]=r.version)}catch(n){Zg.info("unable to read app version: ",n)}}this.tags[this.keys.applicationVersion]=t.appVersion[e]},t.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=yr&&yr.hostname(),this.tags[this.keys.deviceOSVersion]=yr&&yr.type()+" "+yr.release(),this.tags[this.keys.cloudRole]=t.DefaultRoleName,this.tags["ai.device.osArchitecture"]=yr&&yr.arch(),this.tags["ai.device.osPlatform"]=yr&&yr.platform()},t.prototype._loadInternalContext=function(){var e=Jg.resolve(__dirname,"../../package.json");if(!t.sdkVersion){t.sdkVersion="unknown";try{var r=JSON.parse(Yg.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.sdkVersion=r.version)}catch(n){Zg.info("unable to read app version: ",n)}}this.tags[this.keys.internalSdkVersion]="node:"+t.sdkVersion},t.DefaultRoleName="Web",t.appVersion={},t.sdkVersion=null,t}();em.exports=US});var rm=d((zl,tm)=>{"use strict";var $S=zl&&zl.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),jt=require("url"),Gl=ut(),VS=gt(),BS=oi(),GS=sl(),zS=un(),QS=function(t){$S(e,t);function e(r,n){var i=t.call(this)||this;return n&&n.method&&r&&(i.method=n.method,i.url=e._getUrlFromRequestOptions(r,n),i.startTime=+new Date),i}return e.prototype.onError=function(r){this._setStatus(void 0,r)},e.prototype.onResponse=function(r){this._setStatus(r.statusCode,void 0),this.correlationId=VS.getCorrelationContextTarget(r,BS.requestContextTargetKey)},e.prototype.getDependencyTelemetry=function(r,n){var i=jt.parse(this.url);i.search=void 0,i.hash=void 0;var s=this.method.toUpperCase()+" "+i.pathname,a=Gl.RemoteDependencyDataConstants.TYPE_HTTP,o=i.hostname;i.port&&(o+=":"+i.port),this.correlationId?(a=Gl.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==zS.correlationIdPrefix&&(o+=" | "+this.correlationId)):a=Gl.RemoteDependencyDataConstants.TYPE_HTTP;var c={id:n,name:s,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:a,target:o};if(r&&r.time?c.time=r.time:this.startTime&&(c.time=new Date(this.startTime)),r){for(var u in r)c[u]||(c[u]=r[u]);if(r.properties)for(var u in r.properties)c.properties[u]=r.properties[u]}return c},e._getUrlFromRequestOptions=function(r,n){if(typeof r=="string")if(r.indexOf("http://")===0||r.indexOf("https://")===0)r=jt.parse(r);else{var i=jt.parse(r);i.host==="443"?r=jt.parse("https://"+r):r=jt.parse("http://"+r)}else{if(r&&typeof jt.URL=="function"&&r instanceof jt.URL)return jt.format(r);var s=r;r={},s&&Object.keys(s).forEach(function(c){r[c]=s[c]})}if(r.path){var a=jt.parse(r.path);r.pathname=a.pathname,r.search=a.search}if(r.host&&r.port){var o=jt.parse("http://"+r.host);!o.port&&r.port&&(r.hostname=r.host,delete r.host)}return r.protocol=r.protocol||n.agent&&n.agent.protocol||n.protocol||void 0,r.hostname=r.hostname||"localhost",jt.format(r)},e}(GS);tm.exports=QS});var im=d(qs=>{"use strict";var nm=qs&&qs.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(qs,"__esModule",{value:!0});var WS=Qa(),pt=jr();function Ql(t){var e=nm({},t);return Object.keys(pt.SpanAttribute).forEach(function(r){delete e[r]}),e}function XS(t){var e="|"+t.context().traceId+"."+t.context().spanId+".",r=Math.round(t._duration[0]*1e3+t._duration[1]/1e6),n=t.attributes["peer.address"]?t.attributes["peer.address"].toString():"",i=t.attributes.component?t.attributes.component.toString():"",s=i.toUpperCase()===pt.DependencyTypeName.Http||!!t.attributes[pt.SpanAttribute.HttpUrl],a=i.toLowerCase()===pt.DependencyTypeName.Grpc;if(s){var o=t.attributes[pt.SpanAttribute.HttpMethod]||"GET",c=new URL(t.attributes[pt.SpanAttribute.HttpUrl].toString()),u=t.attributes[pt.SpanAttribute.HttpHost]||c.host,l=t.attributes[pt.SpanAttribute.HttpPort]||c.port||null,p=c.pathname||"/",f=o+" "+p,h=pt.DependencyTypeName.Http,v=l?(u+":"+l).toString():u.toString(),C=c.toString(),I=t.attributes[pt.SpanAttribute.HttpStatusCode]||t.status.code||0,w=I<400;return{id:e,name:f,dependencyTypeName:h,target:v,data:C,success:w,duration:r,url:C,resultCode:String(I),properties:Ql(t.attributes)}}else if(a){var o=t.attributes[pt.SpanAttribute.GrpcMethod]||"rpc",m=t.attributes[pt.SpanAttribute.GrpcService],x=m?o+" "+m:t.name;return{id:e,duration:r,name:x,target:m.toString(),data:m.toString()||x,url:m.toString()||x,dependencyTypeName:pt.DependencyTypeName.Grpc,resultCode:String(t.status.code||0),success:t.status.code===0,properties:Ql(t.attributes)}}else{var V=t.name,B=t.links&&t.links.map(function(ne){return{operation_Id:ne.context.traceId,id:ne.context.spanId}});return{id:e,duration:r,name:V,target:n,data:n||V,url:n||V,dependencyTypeName:t.kind===WS.SpanKind.INTERNAL?pt.DependencyTypeName.InProc:i||t.name,resultCode:String(t.status.code||0),success:t.status.code===0,properties:nm({},Ql(t.attributes),{"_MS.links":B||void 0})}}}qs.spanToTelemetryContract=XS});var am=d(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});var sm=_e(),KS=ms(),YS=im(),Lo=Qa(),hi=[];vi.subscriber=function(t){var e=t.data,r=YS.spanToTelemetryContract(e),n=e.context(),i=new KS;i.traceId=n.traceId,i.spanId=n.spanId,i.traceFlag=n.traceFlags.toString(),i.parentId=e.parentSpanId?"|"+n.traceId+"."+e.parentSpanId+".":null,Lo.AsyncScopeManager.with(e,function(){hi.forEach(function(s){e.kind===Lo.SpanKind.SERVER?s.trackRequest(r):(e.kind===Lo.SpanKind.CLIENT||e.kind===Lo.SpanKind.INTERNAL)&&s.trackDependency(r)})})};function JS(t,e){t?(hi.length===0&&sm.channel.subscribe("azure-coretracing",vi.subscriber),hi.push(e)):(hi=hi.filter(function(r){return r!=e}),hi.length===0&&sm.channel.unsubscribe("azure-coretracing",vi.subscriber))}vi.enable=JS});var cm=d(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});var om=_e(),gi=[];mi.subscriber=function(t){t.data.event.commandName!=="ismaster"&&gi.forEach(function(e){var r=t.data.startedData&&t.data.startedData.databaseName||"Unknown database";e.trackDependency({target:r,data:t.data.event.commandName,name:t.data.event.commandName,duration:t.data.event.duration,success:t.data.succeeded,resultCode:t.data.succeeded?"0":"1",time:t.data.startedData.time,dependencyTypeName:"mongodb"})})};function ZS(t,e){t?(gi.length===0&&om.channel.subscribe("mongodb",mi.subscriber),gi.push(e)):(gi=gi.filter(function(r){return r!=e}),gi.length===0&&om.channel.unsubscribe("mongodb",mi.subscriber))}mi.enable=ZS});var lm=d(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});var um=_e(),yi=[];_i.subscriber=function(t){yi.forEach(function(e){var r=t.data.query||{},n=r.sql||"Unknown query",i=!t.data.err,s=r._connection||{},a=s.config||{},o=a.socketPath?a.socketPath:(a.host||"localhost")+":"+a.port;e.trackDependency({target:o,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"mysql"})})};function eA(t,e){t?(yi.length===0&&um.channel.subscribe("mysql",_i.subscriber),yi.push(e)):(yi=yi.filter(function(r){return r!=e}),yi.length===0&&um.channel.unsubscribe("mysql",_i.subscriber))}_i.enable=eA});var fm=d(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});var pm=_e(),Ci=[];Ei.subscriber=function(t){Ci.forEach(function(e){t.data.commandObj.command!=="info"&&e.trackDependency({target:t.data.address,name:t.data.commandObj.command,data:t.data.commandObj.command,duration:t.data.duration,success:!t.data.err,resultCode:t.data.err?"1":"0",time:t.data.time,dependencyTypeName:"redis"})})};function tA(t,e){t?(Ci.length===0&&pm.channel.subscribe("redis",Ei.subscriber),Ci.push(e)):(Ci=Ci.filter(function(r){return r!=e}),Ci.length===0&&pm.channel.unsubscribe("redis",Ei.subscriber))}Ei.enable=tA});var hm=d(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});var dm=_e(),Ti=[];bi.subscriber=function(t){Ti.forEach(function(e){var r=t.data.query,n=r.preparable&&r.preparable.text||r.plan||r.text||"unknown query",i=!t.data.error,s=t.data.database.host+":"+t.data.database.port;e.trackDependency({target:s,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"postgres"})})};function rA(t,e){t?(Ti.length===0&&dm.channel.subscribe("postgres",bi.subscriber),Ti.push(e)):(Ti=Ti.filter(function(r){return r!=e}),Ti.length===0&&dm.channel.unsubscribe("postgres",bi.subscriber))}bi.enable=rA});var wi=d((dM,ym)=>{"use strict";var yn=require("http"),Ii=require("https"),Wl=qe(),vm=gt(),Ur=oi(),nA=rm(),gm=rn(),mm=un(),Xl=ms(),iA=lo(),sA=function(){function t(e){if(t.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,this._isEnabled&&!this._isInitialized&&this._initialize(),iA.IsInitialized&&(am().enable(!0,this._client),cm().enable(e,this._client),lm().enable(e,this._client),fm().enable(e,this._client),hm().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=yn.get,n=yn.request,i=Ii.request,s=function(a,o){var c=!o[t.disableCollectionRequestOption]&&!a[t.alreadyAutoCollectedFlag];o.headers&&o.headers["user-agent"]&&o.headers["user-agent"].toString().indexOf("azsdk-js")!==-1&&(c=!1),a[t.alreadyAutoCollectedFlag]=!0,a&&o&&c&&(gm.CorrelationContextManager.wrapEmitter(a),t.trackRequest(e._client,{options:o,request:a}))};yn.request=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=n.call.apply(n,[yn,a].concat(o));return s(u,a),u},Ii.request=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=i.call.apply(i,[Ii,a].concat(o));return s(u,a),u},yn.get=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=(l=yn.request).call.apply(l,[yn,a].concat(o));return u.end(),u;var l},Ii.get=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=(l=Ii.request).call.apply(l,[Ii,a].concat(o));return u.end(),u;var l}},t.trackRequest=function(e,r){if(!r.options||!r.request||!e){Wl.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!r.options,!r.request,!e);return}var n=new nA(r.options,r.request),i=gm.CorrelationContextManager.getCurrentContext(),s,a;if(i&&i.operation&&i.operation.traceparent&&Xl.isValidTraceId(i.operation.traceparent.traceId))i.operation.traceparent.updateSpanId(),s=i.operation.traceparent.getBackCompatRequestId();else if(mm.w3cEnabled){var o=new Xl;a=o.toString(),s=o.getBackCompatRequestId()}else s=i&&i.operation&&i.operation.parentId+t.requestNumber+++".";if(vm.canIncludeCorrelationHeader(e,n.getUrl())&&r.request.getHeader&&r.request.setHeader&&e.config&&e.config.correlationId){var c=r.request.getHeader(Ur.requestContextHeader);try{vm.safeIncludeCorrelationHeader(e,r.request,c)}catch(p){Wl.warn("Request-Context header could not be set. Correlation of requests may be lost",p)}if(i&&i.operation)try{if(r.request.setHeader(Ur.requestIdHeader,s),e.config.ignoreLegacyHeaders||(r.request.setHeader(Ur.parentIdHeader,i.operation.id),r.request.setHeader(Ur.rootIdHeader,s)),a||i.operation.traceparent)r.request.setHeader(Ur.traceparentHeader,a||i.operation.traceparent.toString());else if(mm.w3cEnabled){var o=new Xl().toString();r.request.setHeader(Ur.traceparentHeader,o)}if(i.operation.tracestate){var u=i.operation.tracestate.toString();u&&r.request.setHeader(Ur.traceStateHeader,u)}var l=i.customProperties.serializeToHeader();l&&r.request.setHeader(Ur.correlationContextHeader,l)}catch(p){Wl.warn("Correlation headers could not be set. Correlation of requests may be lost.",p)}}r.request.on&&(r.request.on("response",function(p){n.onResponse(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects["http.ClientResponse"]=p,e.trackDependency(f)}),r.request.on("error",function(p){n.onError(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects.Error=p,e.trackDependency(f)}))},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.disableCollectionRequestOption="disableAppInsightsAutoCollection",t.requestNumber=1,t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();ym.exports=sA});var Em=d((hM,Cm)=>{"use strict";var aA=require("os"),_m=jr(),oA=gt(),cA=Rs(),uA=wi(),lA="http://169.254.169.254/metadata/instance/compute",pA="api-version=2017-12-01",fA="format=json",dA="ENETUNREACH",hA=function(){function t(e){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._handle=setInterval(function(){return n.trackHeartBeat(r,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackHeartBeat=function(e,r){var n=this,i=!1,s={},a=cA.sdkVersion;s.sdk=a,s.osType=aA.type(),process.env.WEBSITE_SITE_NAME?(s.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",s.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",s.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?s.azfunction_appId=process.env.WEBSITE_HOSTNAME:e&&(this._isVM===void 0?(i=!0,this._getAzureComputeMetadata(e,function(){n._isVM&&Object.keys(n._vmData).length>0&&(s.azInst_vmId=n._vmData.vmId||"",s.azInst_subscriptionId=n._vmData.subscriptionId||"",s.azInst_osType=n._vmData.osType||"",n._azInst_vmId=n._vmData.vmId||"",n._azInst_subscriptionId=n._vmData.subscriptionId||"",n._azInst_osType=n._vmData.osType||""),n._client.trackMetric({name:_m.HeartBeatMetricName,value:0,properties:s}),r()})):this._isVM&&(s.azInst_vmId=this._azInst_vmId,s.azInst_subscriptionId=this._azInst_subscriptionId,s.azInst_osType=this._azInst_osType)),i||(this._client.trackMetric({name:_m.HeartBeatMetricName,value:0,properties:s}),r())},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.prototype._getAzureComputeMetadata=function(e,r){var n=this,i=lA+"?"+pA+"&"+fA,s=(o={method:"GET"},o[uA.disableCollectionRequestOption]=!0,o.headers={Metadata:"True"},o),a=oA.makeRequest(e,i,s,function(c){if(c.statusCode===200){n._isVM=!0;var u="";c.on("data",function(l){u+=l}),c.on("end",function(){n._vmData=n._isJSON(u)?JSON.parse(u):{},r()})}else r()});a&&(a.on("error",function(c){c&&c.message&&c.message.indexOf(dA)>-1&&(n._isVM=!1),r()}),a.end());var o},t.prototype._isJSON=function(e){try{return JSON.parse(e)&&!!e}catch{return!1}},t}();Cm.exports=hA});var Yl=d((vM,xm)=>{"use strict";var Tm=require("http"),bm=require("https"),Im=qe(),wm=gt(),vA=oi(),Kl=cl(),_r=rn(),gA=No(),mA=function(){function t(e){if(t.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,(this._isAutoCorrelating||this._isEnabled||gA.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},t.prototype.useAutoCorrelation=function(e,r){e&&!this._isAutoCorrelating?_r.CorrelationContextManager.enable(r):!e&&this._isAutoCorrelating&&_r.CorrelationContextManager.disable(),this._isAutoCorrelating=e},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},t.prototype._generateCorrelationContext=function(e){if(!!this._isAutoCorrelating)return _r.CorrelationContextManager.generateContextObject(e.getOperationId(this._client.context.tags),e.getRequestId(),e.getOperationName(this._client.context.tags),e.getCorrelationContextHeader(),e.getTraceparent(),e.getTracestate())},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=function(a){if(!!a){if(typeof a!="function")throw new Error("onRequest handler must be a function");return function(o,c){_r.CorrelationContextManager.wrapEmitter(o),_r.CorrelationContextManager.wrapEmitter(c);var u=o&&!o[t.alreadyAutoCollectedFlag];if(o&&u){var l=new Kl(o),p=e._generateCorrelationContext(l);_r.CorrelationContextManager.runWithContext(p,function(){e._isEnabled&&(o[t.alreadyAutoCollectedFlag]=!0,t.trackRequest(e._client,{request:o,response:c},l)),typeof a=="function"&&a(o,c)})}else typeof a=="function"&&a(o,c)}}},n=function(a){var o=a.addListener.bind(a);a.addListener=function(c,u){switch(c){case"request":case"checkContinue":return o(c,r(u));default:return o(c,u)}},a.on=a.addListener},i=Tm.createServer;Tm.createServer=function(a,o){if(o&&typeof o=="function"){var c=i(a,r(o));return n(c),c}else{var c=i(r(a));return n(c),c}};var s=bm.createServer;bm.createServer=function(a,o){var c=s(a,r(o));return n(c),c}},t.trackRequestSync=function(e,r){if(!r.request||!r.response||!e){Im.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!r.request,!r.response,!e);return}t.addResponseCorrelationIdHeader(e,r.response);var n=_r.CorrelationContextManager.getCurrentContext(),i=new Kl(r.request,n&&n.operation.parentId);n&&(n.operation.id=i.getOperationId(e.context.tags)||n.operation.id,n.operation.name=i.getOperationName(e.context.tags)||n.operation.name,n.operation.parentId=i.getRequestId()||n.operation.parentId,n.customProperties.addHeaderData(i.getCorrelationContextHeader())),t.endRequest(e,i,r,r.duration,r.error)},t.trackRequest=function(e,r,n){if(!r.request||!r.response||!e){Im.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!r.request,!r.response,!e);return}var i=_r.CorrelationContextManager.getCurrentContext(),s=n||new Kl(r.request,i&&i.operation.parentId);wm.canIncludeCorrelationHeader(e,s.getUrl())&&t.addResponseCorrelationIdHeader(e,r.response),i&&!n&&(i.operation.id=s.getOperationId(e.context.tags)||i.operation.id,i.operation.name=s.getOperationName(e.context.tags)||i.operation.name,i.operation.parentId=s.getOperationParentId(e.context.tags)||i.operation.parentId,i.customProperties.addHeaderData(s.getCorrelationContextHeader())),r.response.once&&r.response.once("finish",function(){t.endRequest(e,s,r,null,null)}),r.request.on&&r.request.on("error",function(a){t.endRequest(e,s,r,null,a)})},t.addResponseCorrelationIdHeader=function(e,r){if(e.config&&e.config.correlationId&&r.getHeader&&r.setHeader&&!r.headersSent){var n=r.getHeader(vA.requestContextHeader);wm.safeIncludeCorrelationHeader(e,r,n)}},t.endRequest=function(e,r,n,i,s){s?r.onError(s,i):r.onResponse(n.response,i);var a=r.getRequestTelemetry(n);if(a.tagOverrides=r.getRequestTags(e.context.tags),n.tagOverrides)for(var o in n.tagOverrides)a.tagOverrides[o]=n.tagOverrides[o];var c=r.getLegacyRootId();c&&(a.properties.ai_legacyRootId=c),a.contextObjects=a.contextObjects||{},a.contextObjects["http.ServerRequest"]=n.request,a.contextObjects["http.ServerResponse"]=n.response,e.trackRequest(a)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1,_r.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();xm.exports=mA});var Pm=d((gM,Am)=>{"use strict";var Sm=jr(),yA=function(){function t(){}return t.parse=function(e){if(!e)return{};var r=e.split(t._FIELDS_SEPARATOR),n=r.reduce(function(s,a){var o=a.split(t._FIELD_KEY_VALUE_SEPARATOR);if(o.length===2){var c=o[0].toLowerCase(),u=o[1];s[c]=u}return s},{});if(Object.keys(n).length>0){if(n.endpointsuffix){var i=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+i+"dc."+n.endpointsuffix,n.liveendpoint=n.liveendpoint||"https://"+i+"live."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||Sm.DEFAULT_BREEZE_ENDPOINT,n.liveendpoint=n.liveendpoint||Sm.DEFAULT_LIVEMETRICS_ENDPOINT}return n},t._FIELDS_SEPARATOR=";",t._FIELD_KEY_VALUE_SEPARATOR="=",t}();Am.exports=yA});var Mo=d((mM,Rm)=>{"use strict";var Jl=un(),km=Pm(),_A=qe(),Dm=jr(),CA=require("url"),EA=function(){function t(e){var r=this;this.endpointBase=Dm.DEFAULT_BREEZE_ENDPOINT;var n=process.env[t.ENV_connectionString],i=km.parse(e),s=km.parse(n),a=!i.instrumentationkey&&Object.keys(i).length>0?null:e;this.instrumentationKey=i.instrumentationkey||a||s.instrumentationkey||t._getInstrumentationKey(),t._validateInstrumentationKey(this.instrumentationKey)||_A.warn("An invalid instrumentation key was provided. There may be resulting telemetry loss",this.instrumentationKey),this.endpointUrl=(i.ingestionendpoint||s.ingestionendpoint||this.endpointBase)+"/v2/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=30*1e3,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(o){return r.correlationId=o},this.proxyHttpUrl=process.env[t.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[t.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=i.ingestionendpoint||s.ingestionendpoint||process.env[t.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=i.liveendpoint||s.liveendpoint||process.env[t.ENV_quickPulseHost]||Dm.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=CA.parse(this._quickPulseHost).host)}return Object.defineProperty(t.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(e){Jl.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=e,this.correlationId=Jl.correlationIdPrefix,Jl.queryCorrelationId(this,this.setCorrelationId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(e){this._quickPulseHost=e},enumerable:!0,configurable:!0}),t._getInstrumentationKey=function(){var e=process.env[t.ENV_iKey]||process.env[t.ENV_azurePrefix+t.ENV_iKey]||process.env[t.legacy_ENV_iKey]||process.env[t.ENV_azurePrefix+t.legacy_ENV_iKey];if(!e||e=="")throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return e},t._validateInstrumentationKey=function(e){var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(e)},t.ENV_azurePrefix="APPSETTING_",t.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",t.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",t.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",t.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",t.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",t.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",t.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",t.ENV_http_proxy="http_proxy",t.ENV_https_proxy="https_proxy",t}();Rm.exports=EA});var Nm=d((ep,Om)=>{"use strict";var Os=ep&&ep.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Zl=require("os"),_n=ut(),qm=jr(),TA=gt(),bA=qe(),IA=TA.w3cTraceId(),wA=function(){function t(){}return t.createQuickPulseEnvelope=function(e,r,n,i){var s=Zl&&typeof Zl.hostname=="function"&&Zl.hostname()||"Unknown",a=i.tags&&i.keys&&i.keys.cloudRoleInstance&&i.tags[i.keys.cloudRoleInstance]||s,o={Documents:r.length>0?r:null,InstrumentationKey:n.instrumentationKey||"",Metrics:e.length>0?e:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:i.tags[i.keys.internalSdkVersion],StreamId:IA,MachineName:s,Instance:a};return o},t.createQuickPulseMetric=function(e){var r;return r={Name:e.name,Value:e.value,Weight:e.count||1},r},t.telemetryEnvelopeToQuickPulseDocument=function(e){switch(e.data.baseType){case _n.TelemetryTypeString.Event:return t.createQuickPulseEventDocument(e);case _n.TelemetryTypeString.Exception:return t.createQuickPulseExceptionDocument(e);case _n.TelemetryTypeString.Trace:return t.createQuickPulseTraceDocument(e);case _n.TelemetryTypeString.Dependency:return t.createQuickPulseDependencyDocument(e);case _n.TelemetryTypeString.Request:return t.createQuickPulseRequestDocument(e)}return null},t.createQuickPulseEventDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.name,i=Os({},r,{Name:n});return i},t.createQuickPulseTraceDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.severityLevel||0,i=Os({},r,{Message:e.data.baseData.message,SeverityLevel:_n.SeverityLevel[n]});return i},t.createQuickPulseExceptionDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.exceptions,i="",s="",a="";n&&n.length>0&&(n[0].parsedStack&&n[0].parsedStack.length>0?n[0].parsedStack.forEach(function(c){i+=c.assembly+`
`}):n[0].stack&&n[0].stack.length>0&&(i=n[0].stack),s=n[0].message,a=n[0].typeName);var o=Os({},r,{Exception:i,ExceptionMessage:s,ExceptionType:a});return o},t.createQuickPulseRequestDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=Os({},r,{Name:n.name,Success:n.success,Duration:n.duration,ResponseCode:n.responseCode,OperationName:n.name});return i},t.createQuickPulseDependencyDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=Os({},r,{Name:n.name,Target:n.target,Success:n.success,Duration:n.duration,ResultCode:n.resultCode,CommandName:n.data,OperationName:r.OperationId,DependencyTypeName:n.type});return i},t.createQuickPulseDocument=function(e){var r,n,i,s;e.data.baseType?(n=qm.TelemetryTypeStringToQuickPulseType[e.data.baseType],r=qm.TelemetryTypeStringToQuickPulseDocumentType[e.data.baseType]):bA.warn("Document type invalid; not sending live metric document",e.data.baseType),i=e.tags[t.keys.operationId],s=t.aggregateProperties(e);var a={DocumentType:r,__type:n,OperationId:i,Version:"1.0",Properties:s};return a},t.aggregateProperties=function(e){var r=[],n=e.data.baseData.measurements||{};for(var i in n)if(n.hasOwnProperty(i)){var s=n[i],a={key:i,value:s};r.push(a)}var o=e.data.baseData.properties||{};for(var i in o)if(o.hasOwnProperty(i)){var s=o[i],a={key:i,value:s};r.push(a)}return r},t.keys=new _n.ContextTagKeys,t}();Om.exports=wA});var Mm=d((yM,Lm)=>{"use strict";var xA=function(){return(Date.now()+621355968e5)*1e4};Lm.exports={getTransmissionTime:xA}});var jm=d((_M,Fm)=>{"use strict";var SA=require("https"),AA=wi(),Hm=qe(),PA=Mm(),kA=gt(),tp={method:"POST",time:"x-ms-qps-transmission-time",subscribed:"x-ms-qps-subscribed"},DA=function(){function t(e){this._config=e,this._consecutiveErrors=0}return t.prototype.ping=function(e,r){this._submitData(e,r,"ping")},t.prototype.post=function(e,r){this._submitData([e],r,"post")},t.prototype._submitData=function(e,r,n){var i=this,s=JSON.stringify(e),a=(c={},c[AA.disableCollectionRequestOption]=!0,c.host=this._config.quickPulseHost,c.method=tp.method,c.path="/QuickPulseService.svc/"+n+"?ikey="+this._config.instrumentationKey,c.headers=(u={Expect:"100-continue"},u[tp.time]=PA.getTransmissionTime(),u["Content-Type"]="application/json",u["Content-Length"]=Buffer.byteLength(s),u),c);this._config.httpsAgent?a.agent=this._config.httpsAgent:a.agent=kA.tlsRestrictedAgent;var o=SA.request(a,function(l){var p=l.headers[tp.subscribed]==="true";i._consecutiveErrors=0,r(p,l)});o.on("error",function(l){i._consecutiveErrors++;var p="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";i._consecutiveErrors%t.MAX_QPS_FAILURES_BEFORE_WARN===0?(p="Live Metrics endpoint could not be reached "+i._consecutiveErrors+" consecutive times. Most recent error:",Hm.warn(t.TAG,p,l)):Hm.info(t.TAG,p,l),r()}),o.write(s),o.end();var c,u},t.TAG="QuickPulseSender",t.MAX_QPS_FAILURES_BEFORE_WARN=25,t}();Fm.exports=DA});var $m=d((CM,Um)=>{"use strict";var RA=qe(),qA=Mo(),rp=Nm(),OA=jm(),NA=jr(),LA=Rs(),MA=function(){function t(e,r){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this.config=new qA(e),this.context=r||new LA,this._sender=new OA(this.config),this._isEnabled=!1}return t.prototype.addCollector=function(e){this._collectors.push(e)},t.prototype.trackMetric=function(e){this._addMetric(e)},t.prototype.addDocument=function(e){var r=rp.telemetryEnvelopeToQuickPulseDocument(e);r&&this._documents.push(r)},t.prototype.enable=function(e){e&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!e&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},t.prototype.enableCollectors=function(e){this._collectors.forEach(function(r){r.enable(e)})},t.prototype._addMetric=function(e){var r=e.value,n=e.count||1,i=NA.PerformanceToQuickPulseCounter[e.name];i&&(this._metrics[i]?(this._metrics[i].Value=(this._metrics[i].Value*this._metrics[i].Weight+r*n)/(this._metrics[i].Weight+n),this._metrics[i].Weight+=n):(this._metrics[i]=rp.createQuickPulseMetric(e),this._metrics[i].Name=i,this._metrics[i].Weight=1))},t.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},t.prototype._goQuickPulse=function(){var e=this,r=Object.keys(this._metrics).map(function(s){return e._metrics[s]}),n=rp.createQuickPulseEnvelope(r,this._documents.slice(),this.config,this.context);this._resetQuickPulseBuffer(),this._isCollectingData?this._post(n):this._ping(n);var i=this._isCollectingData?t.POST_INTERVAL:t.PING_INTERVAL;this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,i=t.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(i=t.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),i),this._handle.unref()},t.prototype._ping=function(e){this._sender.ping(e,this._quickPulseDone.bind(this))},t.prototype._post=function(e){this._sender.post(e,this._quickPulseDone.bind(this))},t.prototype._quickPulseDone=function(e,r){e!=null?(this._isCollectingData!==e&&(RA.info("Live Metrics sending data",e),this.enableCollectors(e)),this._isCollectingData=e,r&&r.statusCode<300&&r.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},t.MAX_POST_WAIT_TIME=2e4,t.MAX_PING_WAIT_TIME=6e4,t.FALLBACK_INTERVAL=6e4,t.PING_INTERVAL=5e3,t.POST_INTERVAL=1e3,t}();Um.exports=MA});var Bm=d(Ls=>{"use strict";var HA=Ls&&Ls.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Ls,"__esModule",{value:!0});var Vm=Mo(),Ns=Rs(),FA=qe(),jA=function(){function t(e){this._disabledMetrics={},t.INSTANCE&&t.INSTANCE.dispose(),t.INSTANCE=this,this._client=e}return t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>=6},t.prototype.enable=function(e,r,n){var i=this;if(r===void 0&&(r={}),n===void 0&&(n=6e4),!!t.isNodeVersionCompatible()){if(t._metricsAvailable==null&&e&&!this._isInitialized)try{var s=require("applicationinsights-native-metrics");t._emitter=new s,t._metricsAvailable=!0,FA.info("Native metrics module successfully loaded!")}catch{t._metricsAvailable=!1;return}this._isEnabled=e,this._disabledMetrics=r,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&t._emitter?(t._emitter.enable(!0,n),this._handle=setInterval(function(){return i._trackNativeMetrics()},n),this._handle.unref()):t._emitter&&(t._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},t.prototype.dispose=function(){this.enable(!1)},t.parseEnabled=function(e){var r=process.env[Vm.ENV_nativeMetricsDisableAll],n=process.env[Vm.ENV_nativeMetricsDisablers];if(r)return{isEnabled:!1,disabledMetrics:{}};if(n){var i=n.split(","),s={};if(i.length>0)for(var a=0,o=i;a<o.length;a++){var c=o[a];s[c]=!0}return typeof e=="object"?{isEnabled:!0,disabledMetrics:HA({},e,s)}:{isEnabled:e,disabledMetrics:s}}return typeof e=="boolean"?{isEnabled:e,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:e}},t.prototype._trackNativeMetrics=function(){var e=!0;typeof this._isEnabled!="object"&&(e=this._isEnabled),e&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},t.prototype._trackGarbageCollection=function(){if(!this._disabledMetrics.gc){var e=t._emitter.getGCData();for(var r in e){var n=e[r].metrics,i=r+" Garbage Collection Duration",s=Math.sqrt(n.sumSquares/n.count-Math.pow(n.total/n.count,2))||0;this._client.trackMetric({name:i,value:n.total,count:n.count,max:n.max,min:n.min,stdDev:s,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Ns.sdkVersion,a)})}var a}},t.prototype._trackEventLoop=function(){if(!this._disabledMetrics.loop){var e=t._emitter.getLoopData(),r=e.loopUsage;if(r.count!=0){var n="Event Loop CPU Time",i=Math.sqrt(r.sumSquares/r.count-Math.pow(r.total/r.count,2))||0;this._client.trackMetric({name:n,value:r.total,count:r.count,min:r.min,max:r.max,stdDev:i,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Ns.sdkVersion,s)});var s}}},t.prototype._trackHeapUsage=function(){if(!this._disabledMetrics.heap){var e=process.memoryUsage(),r=e.heapUsed,n=e.heapTotal,i=e.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:r,count:1,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Ns.sdkVersion,s)}),this._client.trackMetric({name:"Memory Total (Heap)",value:n,count:1,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Ns.sdkVersion,a)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:i-n,count:1,tagOverrides:(o={},o[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Ns.sdkVersion,o)});var s,a,o}},t}();Ls.AutoCollectNativePerformance=jA});var Qm=d((TM,zm)=>{"use strict";var Gm=qe(),UA=function(){function t(e,r,n,i){this._buffer=[],this._lastSend=0,this._isDisabled=e,this._getBatchSize=r,this._getBatchIntervalMs=n,this._sender=i}return t.prototype.setUseDiskRetryCaching=function(e,r,n){this._sender.setDiskRetryMode(e,r,n)},t.prototype.send=function(e){var r=this;if(!this._isDisabled()){if(!e){Gm.warn("Cannot send null/undefined telemetry");return}var n=this._stringify(e);if(typeof n=="string"){if(this._buffer.push(n),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){r._timeoutHandle=null,r.triggerSend(!1)},this._getBatchIntervalMs()))}}},t.prototype.triggerSend=function(e,r){var n=this._buffer.length<1;if(!n){var i=this._buffer.join(`
`);e?(this._sender.saveOnCrash(i),typeof r=="function"&&r("data saved on crash")):this._sender.send(Buffer.from?Buffer.from(i):new Buffer(i),r)}this._lastSend=+new Date,this._buffer.length=0,clearTimeout(this._timeoutHandle),this._timeoutHandle=null,n&&typeof r=="function"&&r("no data to send")},t.prototype._stringify=function(e){try{return JSON.stringify(e)}catch(r){Gm.warn("Failed to serialize payload",r,e)}},t}();zm.exports=UA});var Wm=d(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});function $A(t,e){process.env.WEBSITE_SITE_NAME&&(t.tags[e.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}np.azureRoleEnvironmentTelemetryProcessor=$A});var Ym=d(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});var Xm=ut();function VA(t,e){var r=t.sampleRate,n=!1;return r==null||r>=100||t.data&&Xm.TelemetryType.Metric===Xm.baseTypeToTelemetryType(t.data.baseType)?!0:(e.correlationContext&&e.correlationContext.operation?n=Km(e.correlationContext.operation.id)<r:n=Math.random()*100<r,n)}Ho.samplingTelemetryProcessor=VA;function Km(t){var e=-2147483648,r=2147483647,n=5381;if(!t)return 0;for(;t.length<8;)t=t+t;for(var i=0;i<t.length;i++)n=((n<<5)+n|0)+t.charCodeAt(i)|0;return n=n<=e?r:Math.abs(n),n/r*100}Ho.getSamplingHashCode=Km});var Jm=d(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});var ip=No(),sp=ut();function BA(t,e){switch(e&&e.addDocument(t),t.data.baseType){case sp.TelemetryTypeString.Exception:ip.countException();break;case sp.TelemetryTypeString.Request:var r=t.data.baseData;ip.countRequest(r.duration,r.success);break;case sp.TelemetryTypeString.Dependency:var n=t.data.baseData;ip.countDependency(n.duration,n.success);break}return!0}ap.performanceMetricsTelemetryProcessor=BA});var Zm=d(Fo=>{"use strict";function op(t){for(var e in t)Fo.hasOwnProperty(e)||(Fo[e]=t[e])}Object.defineProperty(Fo,"__esModule",{value:!0});op(Wm());op(Ym());op(Jm())});var ty=d((SM,ey)=>{"use strict";var rt=require("fs"),jo=require("os"),Cr=require("path"),GA=require("zlib"),xi=require("child_process"),We=qe(),zA=wi(),QA=gt(),WA=function(){function t(e,r,n){if(this._config=e,this._onSuccess=r,this._onError=n,this._enableDiskRetryMode=!1,this._resendInterval=t.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=t.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._resendTimer=null,!t.OS_PROVIDES_FILE_PROTECTION)if(t.USE_ICACLS){try{t.OS_PROVIDES_FILE_PROTECTION=rt.existsSync(t.ICACLS_PATH)}catch{}t.OS_PROVIDES_FILE_PROTECTION||We.warn(t.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else t.OS_PROVIDES_FILE_PROTECTION=!0}return t.prototype.setDiskRetryMode=function(e,r,n){this._enableDiskRetryMode=t.OS_PROVIDES_FILE_PROTECTION&&e,typeof r=="number"&&r>=0&&(this._resendInterval=Math.floor(r)),typeof n=="number"&&n>=0&&(this._maxBytesOnDisk=Math.floor(n)),e&&!t.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,We.warn(t.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected."))},t.prototype.send=function(e,r){var n=this,i=this._config.endpointUrl,s={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}};GA.gzip(e,function(a,o){var c=o;a?(We.warn(a),c=e,s.headers["Content-Length"]=e.length.toString()):(s.headers["Content-Encoding"]="gzip",s.headers["Content-Length"]=o.length),We.info(t.TAG,s),s[zA.disableCollectionRequestOption]=!0;var u=function(p){p.setEncoding("utf-8");var f="";p.on("data",function(h){f+=h}),p.on("end",function(){n._numConsecutiveFailures=0,We.info(t.TAG,f),typeof n._onSuccess=="function"&&n._onSuccess(f),typeof r=="function"&&r(f),n._enableDiskRetryMode&&(p.statusCode===200?n._resendTimer||(n._resendTimer=setTimeout(function(){n._resendTimer=null,n._sendFirstFileOnDisk()},n._resendInterval),n._resendTimer.unref()):(p.statusCode===408||p.statusCode===429||p.statusCode===439||p.statusCode===500||p.statusCode===503)&&n._storeToDisk(e))})},l=QA.makeRequest(n._config,i,s,u);l.on("error",function(p){if(n._numConsecutiveFailures++,!n._enableDiskRetryMode||n._numConsecutiveFailures>0&&n._numConsecutiveFailures%t.MAX_CONNECTION_FAILURES_BEFORE_WARN===0){var f="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";n._enableDiskRetryMode&&(f="Ingestion endpoint could not be reached "+n._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),We.warn(t.TAG,f,p)}else{var f="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";We.info(t.TAG,f,p)}if(n._onErrorHelper(p),typeof r=="function"){var h="error sending telemetry";p&&typeof p.toString=="function"&&(h=p.toString()),r(h)}n._enableDiskRetryMode&&n._storeToDisk(e)}),l.write(c),l.end()})},t.prototype.saveOnCrash=function(e){this._enableDiskRetryMode&&this._storeToDiskSync(e)},t.prototype._runICACLS=function(e,r){var n=xi.spawn(t.ICACLS_PATH,e,{windowsHide:!0});n.on("error",function(i){return r(i)}),n.on("close",function(i,s){return r(i===0?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+i+")"))})},t.prototype._runICACLSSync=function(e){if(xi.spawnSync){var r=xi.spawnSync(t.ICACLS_PATH,e,{windowsHide:!0});if(r.error)throw r.error;if(r.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+r.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},t.prototype._getACLIdentity=function(e){if(t.ACL_IDENTITY)return e(null,t.ACL_IDENTITY);var r=xi.spawn(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),n="";r.stdout.on("data",function(i){return n+=i}),r.on("error",function(i){return e(i,null)}),r.on("close",function(i,s){return t.ACL_IDENTITY=n&&n.trim(),e(i===0?null:new Error("Getting ACL identity did not succeed (PS returned code "+i+")"),t.ACL_IDENTITY)})},t.prototype._getACLIdentitySync=function(){if(t.ACL_IDENTITY)return t.ACL_IDENTITY;if(xi.spawnSync){var e=xi.spawnSync(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(e.error)throw e.error;if(e.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+e.status+")");return t.ACL_IDENTITY=e.stdout&&e.stdout.toString().trim(),t.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},t.prototype._getACLArguments=function(e,r){return[e,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",r+":(OI)(CI)F","/inheritance:r"]},t.prototype._applyACLRules=function(e,r){var n=this;if(!t.USE_ICACLS)return r(null);if(t.ACLED_DIRECTORIES[e]===void 0)t.ACLED_DIRECTORIES[e]=!1,this._getACLIdentity(function(i,s){if(i)return t.ACLED_DIRECTORIES[e]=!1,r(i);n._runICACLS(n._getACLArguments(e,s),function(a){return t.ACLED_DIRECTORIES[e]=!a,r(a)})});else return r(t.ACLED_DIRECTORIES[e]?null:new Error("Setting ACL restrictions did not succeed (cached result)"))},t.prototype._applyACLRulesSync=function(e){if(t.USE_ICACLS){if(t.ACLED_DIRECTORIES[e]===void 0){this._runICACLSSync(this._getACLArguments(e,this._getACLIdentitySync())),t.ACLED_DIRECTORIES[e]=!0;return}else if(!t.ACLED_DIRECTORIES[e])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},t.prototype._confirmDirExists=function(e,r){var n=this;rt.lstat(e,function(i,s){i&&i.code==="ENOENT"?rt.mkdir(e,function(a){a&&a.code!=="EEXIST"?r(a):n._applyACLRules(e,r)}):!i&&s.isDirectory()?n._applyACLRules(e,r):r(i||new Error("Path existed but was not a directory"))})},t.prototype._getShallowDirectorySize=function(e,r){rt.readdir(e,function(n,i){if(n)return r(n,-1);var s=null,a=0,o=0;if(i.length===0){r(null,0);return}for(var c=0;c<i.length;c++)rt.stat(Cr.join(e,i[c]),function(u,l){o++,u?s=u:l.isFile()&&(a+=l.size),o===i.length&&(s?r(s,-1):r(s,a))})})},t.prototype._getShallowDirectorySizeSync=function(e){for(var r=rt.readdirSync(e),n=0,i=0;i<r.length;i++)n+=rt.statSync(Cr.join(e,r[i])).size;return n},t.prototype._storeToDisk=function(e){var r=this,n=Cr.join(jo.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);We.info(t.TAG,"Checking existence of data storage directory: "+n),this._confirmDirExists(n,function(i){if(i){We.warn(t.TAG,"Error while checking/creating directory: "+(i&&i.message)),r._onErrorHelper(i);return}r._getShallowDirectorySize(n,function(s,a){if(s||a<0){We.warn(t.TAG,"Error while checking directory size: "+(s&&s.message)),r._onErrorHelper(s);return}else if(a>r._maxBytesOnDisk){We.warn(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+a);return}var o=new Date().getTime()+".ai.json",c=Cr.join(n,o);We.info(t.TAG,"saving data to disk at: "+c),rt.writeFile(c,e,{mode:384},function(u){return r._onErrorHelper(u)})})})},t.prototype._storeToDiskSync=function(e){var r=Cr.join(jo.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);try{We.info(t.TAG,"Checking existence of data storage directory: "+r),rt.existsSync(r)||rt.mkdirSync(r),this._applyACLRulesSync(r);var n=this._getShallowDirectorySizeSync(r);if(n>this._maxBytesOnDisk){We.info(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+n);return}var i=new Date().getTime()+".ai.json",s=Cr.join(r,i);We.info(t.TAG,"saving data before crash to disk at: "+s),rt.writeFileSync(s,e,{mode:384})}catch(a){We.warn(t.TAG,"Error while saving data to disk: "+(a&&a.message)),this._onErrorHelper(a)}},t.prototype._sendFirstFileOnDisk=function(){var e=this,r=Cr.join(jo.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);rt.exists(r,function(n){n&&rt.readdir(r,function(i,s){if(i)e._onErrorHelper(i);else if(s=s.filter(function(c){return Cr.basename(c).indexOf(".ai.json")>-1}),s.length>0){var a=s[0],o=Cr.join(r,a);rt.readFile(o,function(c,u){c?e._onErrorHelper(c):rt.unlink(o,function(l){l?e._onErrorHelper(l):e.send(u)})})}})})},t.prototype._onErrorHelper=function(e){typeof this._onError=="function"&&this._onError(e)},t.TAG="Sender",t.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",t.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",t.ACLED_DIRECTORIES={},t.ACL_IDENTITY=null,t.WAIT_BETWEEN_RESEND=60*1e3,t.MAX_BYTES_ON_DISK=50*1e3*1e3,t.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,t.TEMPDIR_PREFIX="appInsights-node",t.OS_PROVIDES_FILE_PROTECTION=!1,t.USE_ICACLS=jo.type()==="Windows_NT",t}();ey.exports=WA});var iy=d((AM,ny)=>{"use strict";var k=ut(),xt=gt(),XA=rn(),KA=function(){function t(){}return t.createEnvelope=function(e,r,n,i,s){var a=null;switch(r){case k.TelemetryType.Trace:a=t.createTraceData(e);break;case k.TelemetryType.Dependency:a=t.createDependencyData(e);break;case k.TelemetryType.Event:a=t.createEventData(e);break;case k.TelemetryType.Exception:a=t.createExceptionData(e);break;case k.TelemetryType.Request:a=t.createRequestData(e);break;case k.TelemetryType.Metric:a=t.createMetricData(e);break;case k.TelemetryType.Availability:a=t.createAvailabilityData(e);break;case k.TelemetryType.PageView:a=t.createPageViewData(e);break}if(n&&k.domainSupportsProperties(a.baseData)){if(a&&a.baseData)if(!a.baseData.properties)a.baseData.properties=n;else for(var o in n)a.baseData.properties[o]||(a.baseData.properties[o]=n[o]);a.baseData.properties=xt.validateStringMap(a.baseData.properties)}var c=s&&s.instrumentationKey||"",u=new k.Envelope;return u.data=a,u.iKey=c,u.name="Microsoft.ApplicationInsights."+c.replace(/-/g,"")+"."+a.baseType.substr(0,a.baseType.length-4),u.tags=this.getTags(i,e.tagOverrides),u.time=new Date().toISOString(),u.ver=1,u.sampleRate=s?s.samplingPercentage:100,r===k.TelemetryType.Metric&&(u.sampleRate=100),u},t.createTraceData=function(e){var r=new k.MessageData;r.message=e.message,r.properties=e.properties,isNaN(e.severity)?r.severityLevel=k.SeverityLevel.Information:r.severityLevel=e.severity;var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Trace),n.baseData=r,n},t.createDependencyData=function(e){var r=new k.RemoteDependencyData;typeof e.name=="string"&&(r.name=e.name.length>1024?e.name.slice(0,1021)+"...":e.name),r.data=e.data,r.target=e.target,r.duration=xt.msToTimeSpan(e.duration),r.success=e.success,r.type=e.dependencyTypeName,r.properties=e.properties,r.resultCode=e.resultCode?e.resultCode+"":"",e.id?r.id=e.id:r.id=xt.w3cTraceId();var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Dependency),n.baseData=r,n},t.createEventData=function(e){var r=new k.EventData;r.name=e.name,r.properties=e.properties,r.measurements=e.measurements;var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Event),n.baseData=r,n},t.createExceptionData=function(e){var r=new k.ExceptionData;r.properties=e.properties,isNaN(e.severity)?r.severityLevel=k.SeverityLevel.Error:r.severityLevel=e.severity,r.measurements=e.measurements,r.exceptions=[];var n=e.exception.stack,i=new k.ExceptionDetails;i.message=e.exception.message,i.typeName=e.exception.name,i.parsedStack=this.parseStack(n),i.hasFullStack=xt.isArray(i.parsedStack)&&i.parsedStack.length>0,r.exceptions.push(i);var s=new k.Data;return s.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Exception),s.baseData=r,s},t.createRequestData=function(e){var r=new k.RequestData;e.id?r.id=e.id:r.id=xt.w3cTraceId(),r.name=e.name,r.url=e.url,r.source=e.source,r.duration=xt.msToTimeSpan(e.duration),r.responseCode=e.resultCode?e.resultCode+"":"",r.success=e.success,r.properties=e.properties;var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Request),n.baseData=r,n},t.createMetricData=function(e){var r=new k.MetricData;r.metrics=[];var n=new k.DataPoint;n.count=isNaN(e.count)?1:e.count,n.kind=k.DataPointType.Aggregation,n.max=isNaN(e.max)?e.value:e.max,n.min=isNaN(e.min)?e.value:e.min,n.name=e.name,n.stdDev=isNaN(e.stdDev)?0:e.stdDev,n.value=e.value,r.metrics.push(n),r.properties=e.properties;var i=new k.Data;return i.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Metric),i.baseData=r,i},t.createAvailabilityData=function(e){var r=new k.AvailabilityData;e.id?r.id=e.id:r.id=xt.w3cTraceId(),r.name=e.name,r.duration=xt.msToTimeSpan(e.duration),r.success=e.success,r.runLocation=e.runLocation,r.message=e.message,r.measurements=e.measurements,r.properties=e.properties;var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.Availability),n.baseData=r,n},t.createPageViewData=function(e){var r=new k.PageViewData;r.name=e.name,r.duration=xt.msToTimeSpan(e.duration),r.url=e.url,r.measurements=e.measurements,r.properties=e.properties;var n=new k.Data;return n.baseType=k.telemetryTypeToBaseType(k.TelemetryType.PageView),n.baseData=r,n},t.getTags=function(e,r){var n=XA.CorrelationContextManager.getCurrentContext(),i={};if(e&&e.tags)for(var s in e.tags)i[s]=e.tags[s];if(r)for(var s in r)i[s]=r[s];return n&&(i[e.keys.operationId]=i[e.keys.operationId]||n.operation.id,i[e.keys.operationName]=i[e.keys.operationName]||n.operation.name,i[e.keys.operationParentId]=i[e.keys.operationParentId]||n.operation.parentId),i},t.parseStack=function(e){var r=void 0;if(typeof e=="string"){var n=e.split(`
`);r=[];for(var i=0,s=0,a=0;a<=n.length;a++){var o=n[a];if(ry.regex.test(o)){var c=new ry(n[a],i++);s+=c.sizeInBytes,r.push(c)}}var u=32*1024;if(s>u)for(var l=0,p=r.length-1,f=0,h=l,v=p;l<p;){var C=r[l].sizeInBytes,I=r[p].sizeInBytes;if(f+=C+I,f>u){var w=v-h+1;r.splice(h,w);break}h=l,v=p,l++,p--}}return r},t}(),ry=function(){function t(e,r){this.sizeInBytes=0,this.level=r,this.method="<no_method>",this.assembly=xt.trim(e);var n=e.match(t.regex);n&&n.length>=5&&(this.method=xt.trim(n[2])||this.method,this.fileName=xt.trim(n[4])||"<no_filename>",this.line=parseInt(n[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=t.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return t.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,t.baseSize=58,t}();ny.exports=KA});var cy=d((PM,oy)=>{"use strict";var YA=require("url"),JA=Mo(),ZA=Rs(),Er=ut(),eP=Qm(),cp=Zm(),sy=rn(),tP=ty(),rP=gt(),ay=qe(),nP=iy(),iP=function(){function t(e){this._telemetryProcessors=[],this._enableAzureProperties=!1;var r=new JA(e);this.config=r,this.context=new ZA,this.commonProperties={};var n=new tP(this.config);this.channel=new eP(function(){return r.disableAppInsights},function(){return r.maxBatchSize},function(){return r.maxBatchIntervalMs},n)}return t.prototype.trackAvailability=function(e){this.track(e,Er.TelemetryType.Availability)},t.prototype.trackPageView=function(e){this.track(e,Er.TelemetryType.PageView)},t.prototype.trackTrace=function(e){this.track(e,Er.TelemetryType.Trace)},t.prototype.trackMetric=function(e){this.track(e,Er.TelemetryType.Metric)},t.prototype.trackException=function(e){e&&e.exception&&!rP.isError(e.exception)&&(e.exception=new Error(e.exception.toString())),this.track(e,Er.TelemetryType.Exception)},t.prototype.trackEvent=function(e){this.track(e,Er.TelemetryType.Event)},t.prototype.trackRequest=function(e){this.track(e,Er.TelemetryType.Request)},t.prototype.trackDependency=function(e){e&&!e.target&&e.data&&(e.target=YA.parse(e.data).host),this.track(e,Er.TelemetryType.Dependency)},t.prototype.flush=function(e){this.channel.triggerSend(e?!!e.isAppCrashing:!1,e?e.callback:void 0)},t.prototype.track=function(e,r){if(e&&Er.telemetryTypeToBaseType(r)){var n=nP.createEnvelope(e,r,this.commonProperties,this.context,this.config);e.time&&(n.time=e.time.toISOString()),this._enableAzureProperties&&cp.azureRoleEnvironmentTelemetryProcessor(n,this.context);var i=this.runTelemetryProcessors(n,e.contextObjects);i=i&&cp.samplingTelemetryProcessor(n,{correlationContext:sy.CorrelationContextManager.getCurrentContext()}),i&&(cp.performanceMetricsTelemetryProcessor(n,this.quickPulseClient),this.channel.send(n))}else ay.warn("track() requires telemetry object and telemetryType to be specified.")},t.prototype.setAutoPopulateAzureProperties=function(e){this._enableAzureProperties=e},t.prototype.addTelemetryProcessor=function(e){this._telemetryProcessors.push(e)},t.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},t.prototype.runTelemetryProcessors=function(e,r){var n=!0,i=this._telemetryProcessors.length;if(i===0)return n;r=r||{},r.correlationContext=sy.CorrelationContextManager.getCurrentContext();for(var s=0;s<i;++s)try{var a=this._telemetryProcessors[s];if(a&&a.apply(null,[e,r])===!1){n=!1;break}}catch(o){n=!0,ay.warn("One of telemetry processors failed, telemetry item will be sent.",o,e)}return n},t}();oy.exports=iP});var py=d((up,ly)=>{"use strict";var sP=up&&up.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),aP=cy(),uy=Yl(),oP=wi(),Uo=qe(),cP=function(t){sP(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.trackNodeHttpRequestSync=function(r){r&&r.request&&r.response&&r.duration?uy.trackRequestSync(this,r):Uo.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},e.prototype.trackNodeHttpRequest=function(r){(r.duration||r.error)&&Uo.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),r&&r.request&&r.response?uy.trackRequest(this,r):Uo.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},e.prototype.trackNodeHttpDependency=function(r){r&&r.request?oP.trackRequest(this,r):Uo.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},e}(aP);ly.exports=cP});var dy=d(fy=>{"use strict";Object.defineProperty(fy,"__esModule",{value:!0})});var qy=d(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});var lp=rn(),uP=Qg(),lP=Xg(),vy=No(),pP=Em(),fP=wi(),dP=Yl(),gy=un(),Ms=qe(),hP=$m(),my=Bm();A.TelemetryClient=py();A.Contracts=ut();A.azureFunctionsTypes=dy();var yy;(function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C"})(yy=A.DistributedTracingModes||(A.DistributedTracingModes={}));var _y=!0,Cy=!1,Ey=!0,Ty=!0,by=!1,Iy=!0,wy=!0,xy=!0,pp=!0,Sy,$o=!1,Ay=!0,Py,ky=void 0,Dy=void 0,Hs,Fs,js,Us,Si,Cn,$s,Tr=!1,hy;function vP(t){return A.defaultClient?Ms.info("The default client is already setup"):(A.defaultClient=new A.TelemetryClient(t),Hs=new uP(A.defaultClient),Fs=new lP(A.defaultClient),js=new vy(A.defaultClient),Us=new pP(A.defaultClient),Cn=new dP(A.defaultClient),$s=new fP(A.defaultClient),Si||(Si=new my.AutoCollectNativePerformance(A.defaultClient))),A.defaultClient&&A.defaultClient.channel&&A.defaultClient.channel.setUseDiskRetryCaching(xy,ky,Dy),fp}A.setup=vP;function Ry(){return A.defaultClient?(Tr=!0,Hs.enable(_y,Cy),Fs.enable(Ey),js.enable(Ty),Us.enable(by,A.defaultClient.config),Si.enable(Ay,Py),Cn.useAutoCorrelation(pp,Sy),Cn.enable(Iy),$s.enable(wy),A.liveMetricsClient&&$o&&A.liveMetricsClient.enable($o)):Ms.warn("Start cannot be called before setup"),fp}A.start=Ry;function gP(){return pp?lp.CorrelationContextManager.getCurrentContext():null}A.getCorrelationContext=gP;function mP(t,e){return lp.CorrelationContextManager.startOperation(t,e)}A.startOperation=mP;function yP(t,e){return lp.CorrelationContextManager.wrapCallback(t,e)}A.wrapWithCorrelationContext=yP;var fp=function(){function t(){}return t.setDistributedTracingMode=function(e){return gy.w3cEnabled=e===yy.AI_AND_W3C,t},t.setAutoCollectConsole=function(e,r){return r===void 0&&(r=!1),_y=e,Cy=r,Tr&&Hs.enable(e,r),t},t.setAutoCollectExceptions=function(e){return Ey=e,Tr&&Fs.enable(e),t},t.setAutoCollectPerformance=function(e,r){r===void 0&&(r=!0),Ty=e;var n=my.AutoCollectNativePerformance.parseEnabled(r);return Ay=n.isEnabled,Py=n.disabledMetrics,Tr&&(js.enable(e),Si.enable(n.isEnabled,n.disabledMetrics)),t},t.setAutoCollectHeartbeat=function(e){return by=e,Tr&&Us.enable(e,A.defaultClient.config),t},t.setAutoCollectRequests=function(e){return Iy=e,Tr&&Cn.enable(e),t},t.setAutoCollectDependencies=function(e){return wy=e,Tr&&$s.enable(e),t},t.setAutoDependencyCorrelation=function(e,r){return pp=e,Sy=r,Tr&&Cn.useAutoCorrelation(e,r),t},t.setUseDiskRetryCaching=function(e,r,n){return xy=e,ky=r,Dy=n,A.defaultClient&&A.defaultClient.channel&&A.defaultClient.channel.setUseDiskRetryCaching(e,r,n),t},t.setInternalLogging=function(e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),Ms.enableDebug=e,Ms.disableWarnings=!r,t},t.setSendLiveMetrics=function(e){return e===void 0&&(e=!1),A.defaultClient?(!A.liveMetricsClient&&e?(A.liveMetricsClient=new hP(A.defaultClient.config.instrumentationKey),hy=new vy(A.liveMetricsClient,1e3,!0),A.liveMetricsClient.addCollector(hy),A.defaultClient.quickPulseClient=A.liveMetricsClient):A.liveMetricsClient&&A.liveMetricsClient.enable(e),$o=e,t):(Ms.warn("Live metrics client cannot be setup without the default client"),t)},t.start=Ry,t}();A.Configuration=fp;function _P(){gy.w3cEnabled=!0,A.defaultClient=null,Tr=!1,Hs&&Hs.dispose(),Fs&&Fs.dispose(),js&&js.dispose(),Us&&Us.dispose(),Si&&Si.dispose(),Cn&&Cn.dispose(),$s&&$s.dispose(),A.liveMetricsClient&&(A.liveMetricsClient.enable(!1),$o=!1,A.liveMetricsClient=void 0)}A.dispose=_P});var dp=d((Vo,Oy)=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.default=TP;var CP=EP(require("crypto"));function EP(t){return t&&t.__esModule?t:{default:t}}function TP(){return CP.default.randomBytes(16)}Oy.exports=Vo.default});var Bo=d((Bs,Ly)=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.default=void 0;var Ny=[];for(Vs=0;Vs<256;++Vs)Ny[Vs]=(Vs+256).toString(16).substr(1);var Vs;function bP(t,e){var r=e||0,n=Ny;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}var IP=bP;Bs.default=IP;Ly.exports=Bs.default});var jy=d((Gs,Fy)=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});Gs.default=void 0;var wP=Hy(dp()),xP=Hy(Bo());function Hy(t){return t&&t.__esModule?t:{default:t}}var My,hp,vp=0,gp=0;function SP(t,e,r){var n=e&&r||0,i=e||[];t=t||{};var s=t.node||My,a=t.clockseq!==void 0?t.clockseq:hp;if(s==null||a==null){var o=t.random||(t.rng||wP.default)();s==null&&(s=My=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),a==null&&(a=hp=(o[6]<<8|o[7])&16383)}var c=t.msecs!==void 0?t.msecs:new Date().getTime(),u=t.nsecs!==void 0?t.nsecs:gp+1,l=c-vp+(u-gp)/1e4;if(l<0&&t.clockseq===void 0&&(a=a+1&16383),(l<0||c>vp)&&t.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");vp=c,gp=u,hp=a,c+=122192928e5;var p=((c&268435455)*1e4+u)%4294967296;i[n++]=p>>>24&255,i[n++]=p>>>16&255,i[n++]=p>>>8&255,i[n++]=p&255;var f=c/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(var h=0;h<6;++h)i[n+h]=s[h];return e||(0,xP.default)(i)}var AP=SP;Gs.default=AP;Fy.exports=Gs.default});var mp=d(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.default=qP;En.URL=En.DNS=void 0;var PP=kP(Bo());function kP(t){return t&&t.__esModule?t:{default:t}}function DP(t){var e=[];return t.replace(/[a-fA-F0-9]{2}/g,function(r){e.push(parseInt(r,16))}),e}function RP(t){t=unescape(encodeURIComponent(t));for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}var Uy="6ba7b810-9dad-11d1-80b4-00c04fd430c8";En.DNS=Uy;var $y="6ba7b811-9dad-11d1-80b4-00c04fd430c8";En.URL=$y;function qP(t,e,r){var n=function(i,s,a,o){var c=a&&o||0;if(typeof i=="string"&&(i=RP(i)),typeof s=="string"&&(s=DP(s)),!Array.isArray(i))throw TypeError("value must be an array of bytes");if(!Array.isArray(s)||s.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var u=r(s.concat(i));if(u[6]=u[6]&15|e,u[8]=u[8]&63|128,a)for(var l=0;l<16;++l)a[c+l]=u[l];return a||(0,PP.default)(u)};try{n.name=t}catch{}return n.DNS=Uy,n.URL=$y,n}});var By=d((zs,Vy)=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.default=void 0;var OP=NP(require("crypto"));function NP(t){return t&&t.__esModule?t:{default:t}}function LP(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),OP.default.createHash("md5").update(t).digest()}var MP=LP;zs.default=MP;Vy.exports=zs.default});var Qy=d((Qs,zy)=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.default=void 0;var HP=Gy(mp()),FP=Gy(By());function Gy(t){return t&&t.__esModule?t:{default:t}}var jP=(0,HP.default)("v3",48,FP.default),UP=jP;Qs.default=UP;zy.exports=Qs.default});var Ky=d((Ws,Xy)=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});Ws.default=void 0;var $P=Wy(dp()),VP=Wy(Bo());function Wy(t){return t&&t.__esModule?t:{default:t}}function BP(t,e,r){var n=e&&r||0;typeof t=="string"&&(e=t==="binary"?new Array(16):null,t=null),t=t||{};var i=t.random||(t.rng||$P.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var s=0;s<16;++s)e[n+s]=i[s];return e||(0,VP.default)(i)}var GP=BP;Ws.default=GP;Xy.exports=Ws.default});var Jy=d((Xs,Yy)=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.default=void 0;var zP=QP(require("crypto"));function QP(t){return t&&t.__esModule?t:{default:t}}function WP(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),zP.default.createHash("sha1").update(t).digest()}var XP=WP;Xs.default=XP;Yy.exports=Xs.default});var t_=d((Ks,e_)=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.default=void 0;var KP=Zy(mp()),YP=Zy(Jy());function Zy(t){return t&&t.__esModule?t:{default:t}}var JP=(0,KP.default)("v5",80,YP.default),ZP=JP;Ks.default=ZP;e_.exports=Ks.default});var r_=d(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Object.defineProperty(Ai,"v1",{enumerable:!0,get:function(){return ek.default}});Object.defineProperty(Ai,"v3",{enumerable:!0,get:function(){return tk.default}});Object.defineProperty(Ai,"v4",{enumerable:!0,get:function(){return rk.default}});Object.defineProperty(Ai,"v5",{enumerable:!0,get:function(){return nk.default}});var ek=Go(jy()),tk=Go(Qy()),rk=Go(Ky()),nk=Go(t_());function Go(t){return t&&t.__esModule?t:{default:t}}});var i_=d((OM,n_)=>{"use strict";function ik(t){for(var e=5381,r=t.length;r;)e=e*33^t.charCodeAt(--r);return e>>>0}n_.exports=ik});var y_=d(()=>{"use strict";var m_=require("url"),bn=require("https"),g_="__agent_base_https_request_patched__";bn.request[g_]||(bn.request=function(t){return function(e,r){let n;return typeof e=="string"?n=m_.parse(e):n=Object.assign({},e),n.port==null&&(n.port=443),n.secureEndpoint=!0,t.call(bn,n,r)}}(bn.request),bn.request[g_]=!0);bn.get=function(t,e,r){let n;typeof t=="string"&&e&&typeof e!="function"?n=Object.assign({},m_.parse(t),e):!e&&!r?n=t:r||(n=t,r=e);let i=bn.request(n,r);return i.end(),i}});var __=d((Ip,wp)=>{(function(t,e){typeof Ip=="object"&&typeof wp<"u"?wp.exports=e():typeof define=="function"&&define.amd?define(e):t.ES6Promise=e()})(Ip,function(){"use strict";function t(g){var E=typeof g;return g!==null&&(E==="object"||E==="function")}function e(g){return typeof g=="function"}var r=void 0;Array.isArray?r=Array.isArray:r=function(g){return Object.prototype.toString.call(g)==="[object Array]"};var n=r,i=0,s=void 0,a=void 0,o=function(E,T){V[i]=E,V[i+1]=T,i+=2,i===2&&(a?a(B):Be())};function c(g){a=g}function u(g){o=g}var l=typeof window<"u"?window:void 0,p=l||{},f=p.MutationObserver||p.WebKitMutationObserver,h=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",v=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function C(){return function(){return process.nextTick(B)}}function I(){return typeof s<"u"?function(){s(B)}:x()}function w(){var g=0,E=new f(B),T=document.createTextNode("");return E.observe(T,{characterData:!0}),function(){T.data=g=++g%2}}function m(){var g=new MessageChannel;return g.port1.onmessage=B,function(){return g.port2.postMessage(0)}}function x(){var g=setTimeout;return function(){return g(B,1)}}var V=new Array(1e3);function B(){for(var g=0;g<i;g+=2){var E=V[g],T=V[g+1];E(T),V[g]=void 0,V[g+1]=void 0}i=0}function ne(){try{var g=Function("return this")().require("vertx");return s=g.runOnLoop||g.runOnContext,I()}catch{return x()}}var Be=void 0;h?Be=C():f?Be=w():v?Be=m():l===void 0&&typeof require=="function"?Be=ne():Be=x();function Et(g,E){var T=this,S=new this.constructor(or);S[zn]===void 0&&$d(S);var N=T._state;if(N){var L=arguments[N-1];o(function(){return jd(N,S,L,T._result)})}else nu(T,S,g,E);return S}function Ze(g){var E=this;if(g&&typeof g=="object"&&g.constructor===E)return g;var T=new E(or);return qt(T,g),T}var zn=Math.random().toString(36).substring(2);function or(){}var cr=void 0,Kr=1,ur=2;function Yr(){return new TypeError("You cannot resolve a promise with itself")}function Jr(){return new TypeError("A promises callback cannot return that same promise.")}function tu(g,E,T,S){try{g.call(E,T,S)}catch(N){return N}}function ru(g,E,T){o(function(S){var N=!1,L=tu(T,E,function(Re){N||(N=!0,E!==Re?qt(S,Re):Ot(S,Re))},function(Re){N||(N=!0,we(S,Re))},"Settle: "+(S._label||" unknown promise"));!N&&L&&(N=!0,we(S,L))},g)}function Zr(g,E){E._state===Kr?Ot(g,E._result):E._state===ur?we(g,E._result):nu(E,void 0,function(T){return qt(g,T)},function(T){return we(g,T)})}function Wt(g,E,T){E.constructor===g.constructor&&T===Et&&E.constructor.resolve===Ze?Zr(g,E):T===void 0?Ot(g,E):e(T)?ru(g,E,T):Ot(g,E)}function qt(g,E){if(g===E)we(g,Yr());else if(t(E)){var T=void 0;try{T=E.then}catch(S){we(g,S);return}Wt(g,E,T)}else Ot(g,E)}function Qn(g){g._onerror&&g._onerror(g._result),iu(g)}function Ot(g,E){g._state===cr&&(g._result=E,g._state=Kr,g._subscribers.length!==0&&o(iu,g))}function we(g,E){g._state===cr&&(g._state=ur,g._result=E,o(Qn,g))}function nu(g,E,T,S){var N=g._subscribers,L=N.length;g._onerror=null,N[L]=E,N[L+Kr]=T,N[L+ur]=S,L===0&&g._state&&o(iu,g)}function iu(g){var E=g._subscribers,T=g._state;if(E.length!==0){for(var S=void 0,N=void 0,L=g._result,Re=0;Re<E.length;Re+=3)S=E[Re],N=E[Re+T],S?jd(T,S,N,L):N(L);g._subscribers.length=0}}function jd(g,E,T,S){var N=e(T),L=void 0,Re=void 0,Wn=!0;if(N){try{L=T(S)}catch(Ba){Wn=!1,Re=Ba}if(E===L){we(E,Jr());return}}else L=S;E._state!==cr||(N&&Wn?qt(E,L):Wn===!1?we(E,Re):g===Kr?Ot(E,L):g===ur&&we(E,L))}function Vb(g,E){try{E(function(S){qt(g,S)},function(S){we(g,S)})}catch(T){we(g,T)}}var Ud=0;function Bb(){return Ud++}function $d(g){g[zn]=Ud++,g._state=void 0,g._result=void 0,g._subscribers=[]}function Gb(){return new Error("Array Methods must be provided an Array")}var zb=function(){function g(E,T){this._instanceConstructor=E,this.promise=new E(or),this.promise[zn]||$d(this.promise),n(T)?(this.length=T.length,this._remaining=T.length,this._result=new Array(this.length),this.length===0?Ot(this.promise,this._result):(this.length=this.length||0,this._enumerate(T),this._remaining===0&&Ot(this.promise,this._result))):we(this.promise,Gb())}return g.prototype._enumerate=function(T){for(var S=0;this._state===cr&&S<T.length;S++)this._eachEntry(T[S],S)},g.prototype._eachEntry=function(T,S){var N=this._instanceConstructor,L=N.resolve;if(L===Ze){var Re=void 0,Wn=void 0,Ba=!1;try{Re=T.then}catch(au){Ba=!0,Wn=au}if(Re===Et&&T._state!==cr)this._settledAt(T._state,S,T._result);else if(typeof Re!="function")this._remaining--,this._result[S]=T;else if(N===ot){var su=new N(or);Ba?we(su,Wn):Wt(su,T,Re),this._willSettleAt(su,S)}else this._willSettleAt(new N(function(au){return au(T)}),S)}else this._willSettleAt(L(T),S)},g.prototype._settledAt=function(T,S,N){var L=this.promise;L._state===cr&&(this._remaining--,T===ur?we(L,N):this._result[S]=N),this._remaining===0&&Ot(L,this._result)},g.prototype._willSettleAt=function(T,S){var N=this;nu(T,void 0,function(L){return N._settledAt(Kr,S,L)},function(L){return N._settledAt(ur,S,L)})},g}();function Qb(g){return new zb(this,g).promise}function Wb(g){var E=this;return n(g)?new E(function(T,S){for(var N=g.length,L=0;L<N;L++)E.resolve(g[L]).then(T,S)}):new E(function(T,S){return S(new TypeError("You must pass an array to race."))})}function Xb(g){var E=this,T=new E(or);return we(T,g),T}function Kb(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Yb(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ot=function(){function g(E){this[zn]=Bb(),this._result=this._state=void 0,this._subscribers=[],or!==E&&(typeof E!="function"&&Kb(),this instanceof g?Vb(this,E):Yb())}return g.prototype.catch=function(T){return this.then(null,T)},g.prototype.finally=function(T){var S=this,N=S.constructor;return e(T)?S.then(function(L){return N.resolve(T()).then(function(){return L})},function(L){return N.resolve(T()).then(function(){throw L})}):S.then(T,T)},g}();ot.prototype.then=Et,ot.all=Qb,ot.race=Wb,ot.resolve=Ze,ot.reject=Xb,ot._setScheduler=c,ot._setAsap=u,ot._asap=o;function Jb(){var g=void 0;if(typeof global<"u")g=global;else if(typeof self<"u")g=self;else try{g=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var E=g.Promise;if(E){var T=null;try{T=Object.prototype.toString.call(E.resolve())}catch{}if(T==="[object Promise]"&&!E.cast)return}g.Promise=ot}return ot.polyfill=Jb,ot.Promise=ot,ot})});var E_=d((WH,C_)=>{"use strict";C_.exports=function(){"use strict";var t=void 0;function e(n){return typeof n=="function"}global!==void 0?t=global:window!==void 0&&window.document?t=window:t=self;var r=function(){if(!t.hasOwnProperty("Promise"))return!1;var n=t.Promise;return!n.hasOwnProperty("resolve")||!n.hasOwnProperty("reject")||!n.hasOwnProperty("all")||!n.hasOwnProperty("race")?!1:function(){var i=void 0,s=new t.Promise(function(a){i=a});return s?e(i):!1}()}();return r?t.Promise:__().Promise}()});var b_=d((XH,T_)=>{"use strict";T_.exports=function(){"use strict";var t=E_();function e(r){return r&&typeof r.then=="function"&&typeof r.catch=="function"}return function(n,i){return function(){for(var s=arguments.length,a=Array(s),o=0;o<s;o++)a[o]=arguments[o];var c=i&&i.multiArgs,u=void 0;return i&&i.thisArg?u=i.thisArg:i&&(u=i),new t(function(l,p){a.push(function(v){if(v)return p(v);for(var C=arguments.length,I=Array(C>1?C-1:0),w=1;w<C;w++)I[w-1]=arguments[w];if(!c)return l(I[0]);l(I)});var f=n.apply(u,a);e(f)&&l(f)})}}}()});var xp=d((KH,w_)=>{"use strict";y_();var pk=require("util").inherits,fk=b_(),I_=require("events").EventEmitter;w_.exports=In;function dk(t){return t&&typeof t.addRequest=="function"}function In(t,e){if(!(this instanceof In))return new In(t,e);I_.call(this),this._promisifiedCallback=!1;let r=e;typeof t=="function"?this.callback=t:t&&(r=t),this.timeout=r&&r.timeout||null,this.options=r}pk(In,I_);In.prototype.callback=function(e,r){throw new Error('"agent-base" has no default implementation, you must subclass and override `callback()`')};In.prototype.addRequest=function(e,r){let n=Object.assign({},r);n.host==null&&(n.host="localhost"),n.port==null&&(n.port=n.secureEndpoint?443:80);let i=Object.assign({},this.options,n);i.host&&i.path&&delete i.path,delete i.agent,delete i.hostname,delete i._defaultAgent,delete i.defaultPort,delete i.createConnection,e._last=!0,e.shouldKeepAlive=!1;let s,a=!1,o=this.timeout,c=this.freeSocket;function u(h){e._hadError||(e.emit("error",h),e._hadError=!0)}function l(){s=null,a=!0;let h=new Error('A "socket" was not created for HTTP request before '+o+"ms");h.code="ETIMEOUT",u(h)}function p(h){a||(s!=null&&(clearTimeout(s),s=null),u(h))}function f(h){if(!a)if(s!=null&&(clearTimeout(s),s=null),dk(h))h.addRequest(e,i);else if(h){let v=function(){c(h,i)};h.on("free",v),e.onSocket(h)}else{let v=new Error("no Duplex stream was returned to agent-base for `"+e.method+" "+e.path+"`");u(v)}}!this._promisifiedCallback&&this.callback.length>=3&&(this.callback=fk(this.callback,this),this._promisifiedCallback=!0),o>0&&(s=setTimeout(l,o));try{Promise.resolve(this.callback(e,i)).then(f,p)}catch(h){Promise.reject(h).catch(p)}};In.prototype.freeSocket=function(e,r){e.destroy()}});var S_=d((YH,x_)=>{var ea=1e3,ta=ea*60,ra=ta*60,na=ra*24,hk=na*365.25;x_.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return vk(t);if(r==="number"&&isNaN(t)===!1)return e.long?mk(t):gk(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function vk(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*hk;case"days":case"day":case"d":return r*na;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ra;case"minutes":case"minute":case"mins":case"min":case"m":return r*ta;case"seconds":case"second":case"secs":case"sec":case"s":return r*ea;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function gk(t){return t>=na?Math.round(t/na)+"d":t>=ra?Math.round(t/ra)+"h":t>=ta?Math.round(t/ta)+"m":t>=ea?Math.round(t/ea)+"s":t+"ms"}function mk(t){return Jo(t,na,"day")||Jo(t,ra,"hour")||Jo(t,ta,"minute")||Jo(t,ea,"second")||t+" ms"}function Jo(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}});var Ap=d((M,A_)=>{M=A_.exports=Sp.debug=Sp.default=Sp;M.coerce=bk;M.disable=Ek;M.enable=Ck;M.enabled=Tk;M.humanize=S_();M.instances=[];M.names=[];M.skips=[];M.formatters={};function yk(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return M.colors[Math.abs(e)%M.colors.length]}function Sp(t){var e;function r(){if(!!r.enabled){var n=r,i=+new Date,s=i-(e||i);n.diff=s,n.prev=e,n.curr=i,e=i;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=M.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(l,p){if(l==="%%")return l;c++;var f=M.formatters[p];if(typeof f=="function"){var h=a[c];l=f.call(n,h),a.splice(c,1),c--}return l}),M.formatArgs.call(n,a);var u=r.log||M.log||console.log.bind(console);u.apply(n,a)}}return r.namespace=t,r.enabled=M.enabled(t),r.useColors=M.useColors(),r.color=yk(t),r.destroy=_k,typeof M.init=="function"&&M.init(r),M.instances.push(r),r}function _k(){var t=M.instances.indexOf(this);return t!==-1?(M.instances.splice(t,1),!0):!1}function Ck(t){M.save(t),M.names=[],M.skips=[];var e,r=(typeof t=="string"?t:"").split(/[\s,]+/),n=r.length;for(e=0;e<n;e++)!r[e]||(t=r[e].replace(/\*/g,".*?"),t[0]==="-"?M.skips.push(new RegExp("^"+t.substr(1)+"$")):M.names.push(new RegExp("^"+t+"$")));for(e=0;e<M.instances.length;e++){var i=M.instances[e];i.enabled=M.enabled(i.namespace)}}function Ek(){M.enable("")}function Tk(t){if(t[t.length-1]==="*")return!0;var e,r;for(e=0,r=M.skips.length;e<r;e++)if(M.skips[e].test(t))return!1;for(e=0,r=M.names.length;e<r;e++)if(M.names[e].test(t))return!0;return!1}function bk(t){return t instanceof Error?t.stack||t.message:t}});var D_=d((nt,k_)=>{nt=k_.exports=Ap();nt.log=xk;nt.formatArgs=wk;nt.save=Sk;nt.load=P_;nt.useColors=Ik;nt.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:Ak();nt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ik(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}nt.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function wk(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+nt.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(i=n))}),t.splice(i,0,r)}}function xk(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Sk(t){try{t==null?nt.storage.removeItem("debug"):nt.storage.debug=t}catch{}}function P_(){var t;try{t=nt.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}nt.enable(P_());function Ak(){try{return window.localStorage}catch{}}});var q_=d((JH,R_)=>{"use strict";R_.exports=(t,e=process.argv)=>{let r=t.startsWith("-")?"":t.length===1?"-":"--",n=e.indexOf(r+t),i=e.indexOf("--");return n!==-1&&(i===-1||n<i)}});var L_=d((ZH,N_)=>{"use strict";var Pk=require("os"),O_=require("tty"),St=q_(),{env:Ne}=process,Zo;St("no-color")||St("no-colors")||St("color=false")||St("color=never")?Zo=0:(St("color")||St("colors")||St("color=true")||St("color=always"))&&(Zo=1);function kk(){if("FORCE_COLOR"in Ne)return Ne.FORCE_COLOR==="true"?1:Ne.FORCE_COLOR==="false"?0:Ne.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(Ne.FORCE_COLOR,10),3)}function Dk(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function Rk(t,{streamIsTTY:e,sniffFlags:r=!0}={}){let n=kk();n!==void 0&&(Zo=n);let i=r?Zo:n;if(i===0)return 0;if(r){if(St("color=16m")||St("color=full")||St("color=truecolor"))return 3;if(St("color=256"))return 2}if(t&&!e&&i===void 0)return 0;let s=i||0;if(Ne.TERM==="dumb")return s;if(process.platform==="win32"){let a=Pk.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in Ne)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(a=>a in Ne)||Ne.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in Ne)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ne.TEAMCITY_VERSION)?1:0;if(Ne.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ne){let a=Number.parseInt((Ne.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ne.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ne.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ne.TERM)||"COLORTERM"in Ne?1:s}function Pp(t,e={}){let r=Rk(t,{streamIsTTY:t&&t.isTTY,...e});return Dk(r)}N_.exports={supportsColor:Pp,stdout:Pp({isTTY:O_.isatty(1)}),stderr:Pp({isTTY:O_.isatty(2)})}});var F_=d((Ae,H_)=>{var qk=require("tty"),ec=require("util");Ae=H_.exports=Ap();Ae.init=Fk;Ae.log=Mk;Ae.formatArgs=Nk;Ae.save=Hk;Ae.load=M_;Ae.useColors=Ok;Ae.colors=[6,2,3,4,5,1];try{kp=L_(),kp&&kp.level>=2&&(Ae.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var kp;Ae.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});function Ok(){return"colors"in Ae.inspectOpts?Boolean(Ae.inspectOpts.colors):qk.isatty(process.stderr.fd)}Ae.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,ec.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};Ae.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,ec.inspect(t,this.inspectOpts)};function Nk(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),s="  "+i+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push(i+"m+"+Ae.humanize(this.diff)+"\x1B[0m")}else t[0]=Lk()+e+" "+t[0]}function Lk(){return Ae.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Mk(){return process.stderr.write(ec.format.apply(ec,arguments)+`
`)}function Hk(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}function M_(){return process.env.DEBUG}function Fk(t){t.inspectOpts={};for(var e=Object.keys(Ae.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=Ae.inspectOpts[e[r]]}Ae.enable(M_())});var Rp=d((eF,Dp)=>{typeof process>"u"||process.type==="renderer"?Dp.exports=D_():Dp.exports=F_()});var $_=d((tF,U_)=>{var jk=require("net"),Uk=require("tls"),qp=require("url"),j_=xp(),$k=require("util").inherits,tc=Rp()("http-proxy-agent");U_.exports=ia;function ia(t){if(!(this instanceof ia))return new ia(t);if(typeof t=="string"&&(t=qp.parse(t)),!t)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");tc("creating new HttpProxyAgent instance: %o",t),j_.call(this,t);var e=Object.assign({},t);this.secureProxy=e.protocol?/^https:?$/i.test(e.protocol):!1,e.host=e.hostname||e.host,e.port=+e.port||(this.secureProxy?443:80),e.host&&e.path&&(delete e.path,delete e.pathname),this.proxy=e}$k(ia,j_);ia.prototype.callback=function(e,r,n){var i=this.proxy,s=qp.parse(e.path);s.protocol==null&&(s.protocol="http:"),s.hostname==null&&(s.hostname=r.hostname||r.host),s.port==null&&(s.port=r.port),s.port==80&&delete s.port;var a=qp.format(s);e.path=a,i.auth&&e.setHeader("Proxy-Authorization","Basic "+Buffer.from(i.auth).toString("base64"));var o;if(this.secureProxy?o=Uk.connect(i):o=jk.connect(i),e._header&&(tc("regenerating stored HTTP header string for request"),e._header=null,e._implicitHeader(),e.output&&e.output.length>0)){tc("patching connection write() output buffer with updated header");var c=e.output[0],u=c.indexOf(`\r
\r
`)+4;e.output[0]=e._header+c.substring(u),tc("output buffer: %o",e.output)}n(null,o)}});var Q_=d((rF,z_)=>{var V_=require("net"),B_=require("tls"),Vk=require("url"),Bk=require("assert"),G_=xp(),Gk=require("util").inherits,wn=Rp()("https-proxy-agent");z_.exports=sa;function sa(t){if(!(this instanceof sa))return new sa(t);if(typeof t=="string"&&(t=Vk.parse(t)),!t)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");wn("creating new HttpsProxyAgent instance: %o",t),G_.call(this,t);var e=Object.assign({},t);this.secureProxy=e.protocol?/^https:?$/i.test(e.protocol):!1,e.host=e.hostname||e.host,e.port=+e.port||(this.secureProxy?443:80),this.secureProxy&&!("ALPNProtocols"in e)&&(e.ALPNProtocols=["http 1.1"]),e.host&&e.path&&(delete e.path,delete e.pathname),this.proxy=e,this.defaultPort=443}Gk(sa,G_);sa.prototype.callback=function(e,r,n){var i=this.proxy,s;this.secureProxy?s=B_.connect(i):s=V_.connect(i);var a=[],o=0;function c(){var x=s.read();x?h(x):s.once("readable",c)}function u(){s.removeListener("end",p),s.removeListener("error",f),s.removeListener("close",l),s.removeListener("readable",c)}function l(x){wn("onclose had error %o",x)}function p(){wn("onend")}function f(x){u(),n(x)}function h(x){a.push(x),o+=x.length;var V=Buffer.concat(a,o),B=V.toString("ascii");if(!~B.indexOf(`\r
\r
`)){wn("have not received end of HTTP headers yet..."),c();return}var ne=B.substring(0,B.indexOf(`\r
`)),Be=+ne.split(" ")[1];if(wn("got proxy server response: %o",ne),Be==200){var Et=s;a=V=null,r.secureEndpoint&&(wn("upgrading proxy-connected socket to TLS connection: %o",r.host),r.socket=s,r.servername=r.servername||r.host,r.host=null,r.hostname=null,r.port=null,Et=B_.connect(r)),u(),e.once("socket",zk),n(null,Et)}else u(),s.destroy(),s=new V_.Socket,s.readable=!0,a=V,e.once("socket",v),n(null,s)}function v(x){wn("replaying proxy buffer for failed request"),Bk(x.listenerCount("data")>0),x.push(a),a=null}s.on("error",f),s.on("close",l),s.on("end",p),c();var C=r.host+":"+r.port,I="CONNECT "+C+` HTTP/1.1\r
`,w=Object.assign({},i.headers);i.auth&&(w["Proxy-Authorization"]="Basic "+Buffer.from(i.auth).toString("base64"));var m=r.host;Qk(r.port,r.secureEndpoint)||(m+=":"+r.port),w.Host=m,w.Connection="close",Object.keys(w).forEach(function(x){I+=x+": "+w[x]+`\r
`}),s.write(I+`\r
`)};function zk(t){t.resume()}function Qk(t,e){return Boolean(!e&&t===80||e&&t===443)}});var Me=d((RF,iC)=>{"use strict";var rD=function(){function t(){}return t.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.enableDebug&&console.info(t.TAG+e,r)},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.disableWarnings||console.warn(t.TAG+e,r)},t.enableDebug=!1,t.disableWarnings=!1,t.disableErrors=!1,t.TAG="ApplicationInsights:",t}();iC.exports=rD});var ac=d(Vr=>{"use strict";var sC=Vr&&Vr.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Vr,"__esModule",{value:!0});var Sn=An(),nD=require("events"),iD;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(iD=Vr.SpanKind||(Vr.SpanKind={}));var aC=function(){function t(){}return t.prototype.active=function(){var e=this,r=Sn.CorrelationContextManager.getCurrentContext();return sC({},r,{getValue:function(n){return e._activeSymbol?n===e._activeSymbol?r:!1:(e._activeSymbol=n,r)},setValue:function(){}})},t.prototype.with=function(e,r){var n=e.parentSpanId,i=e.name,s=t._spanToContext(e,n,i);return Sn.CorrelationContextManager.runWithContext(s,r)()},t.prototype.bind=function(e){return typeof e=="function"?Sn.CorrelationContextManager.wrapCallback(e):(e instanceof nD.EventEmitter&&Sn.CorrelationContextManager.wrapEmitter(e),e)},t.prototype.enable=function(){return Sn.CorrelationContextManager.enable(),this},t.prototype.disable=function(){return Sn.CorrelationContextManager.disable(),this},t._spanToContext=function(e,r,n){var i=r?"|"+e.context().traceId+"."+r+".":e.context().traceId,s=sC({},e.context(),{traceFlags:e.context().traceFlags.toString()}),a=Sn.CorrelationContextManager.spanToContextObject(s,i,n);return a},t}();Vr.OpenTelemetryScopeManagerWrapper=aC;Vr.AsyncScopeManager=new aC});var gc=d((q,TC)=>{q=TC.exports=$;var Z;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Z=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:Z=function(){};q.SEMVER_SPEC_VERSION="2.0.0";var aa=256,oc=Number.MAX_SAFE_INTEGER||9007199254740991,Np=16,sD=aa-6,oa=q.re=[],ae=q.safeRe=[],_=q.src=[],F=0,jp="[a-zA-Z0-9-]",Lp=[["\\s",1],["\\d",aa],[jp,sD]];function dc(t){for(var e=0;e<Lp.length;e++){var r=Lp[e][0],n=Lp[e][1];t=t.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return t}var Pi=F++;_[Pi]="0|[1-9]\\d*";var ki=F++;_[ki]="\\d+";var Up=F++;_[Up]="\\d*[a-zA-Z-]"+jp+"*";var cC=F++;_[cC]="("+_[Pi]+")\\.("+_[Pi]+")\\.("+_[Pi]+")";var uC=F++;_[uC]="("+_[ki]+")\\.("+_[ki]+")\\.("+_[ki]+")";var Mp=F++;_[Mp]="(?:"+_[Pi]+"|"+_[Up]+")";var Hp=F++;_[Hp]="(?:"+_[ki]+"|"+_[Up]+")";var $p=F++;_[$p]="(?:-("+_[Mp]+"(?:\\."+_[Mp]+")*))";var Vp=F++;_[Vp]="(?:-?("+_[Hp]+"(?:\\."+_[Hp]+")*))";var Fp=F++;_[Fp]=jp+"+";var ua=F++;_[ua]="(?:\\+("+_[Fp]+"(?:\\."+_[Fp]+")*))";var Bp=F++,lC="v?"+_[cC]+_[$p]+"?"+_[ua]+"?";_[Bp]="^"+lC+"$";var Gp="[v=\\s]*"+_[uC]+_[Vp]+"?"+_[ua]+"?",zp=F++;_[zp]="^"+Gp+"$";var Ni=F++;_[Ni]="((?:<|>)?=?)";var cc=F++;_[cc]=_[ki]+"|x|X|\\*";var uc=F++;_[uc]=_[Pi]+"|x|X|\\*";var Pn=F++;_[Pn]="[v=\\s]*("+_[uc]+")(?:\\.("+_[uc]+")(?:\\.("+_[uc]+")(?:"+_[$p]+")?"+_[ua]+"?)?)?";var Ri=F++;_[Ri]="[v=\\s]*("+_[cc]+")(?:\\.("+_[cc]+")(?:\\.("+_[cc]+")(?:"+_[Vp]+")?"+_[ua]+"?)?)?";var pC=F++;_[pC]="^"+_[Ni]+"\\s*"+_[Pn]+"$";var fC=F++;_[fC]="^"+_[Ni]+"\\s*"+_[Ri]+"$";var dC=F++;_[dC]="(?:^|[^\\d])(\\d{1,"+Np+"})(?:\\.(\\d{1,"+Np+"}))?(?:\\.(\\d{1,"+Np+"}))?(?:$|[^\\d])";var hc=F++;_[hc]="(?:~>?)";var qi=F++;_[qi]="(\\s*)"+_[hc]+"\\s+";oa[qi]=new RegExp(_[qi],"g");ae[qi]=new RegExp(dc(_[qi]),"g");var aD="$1~",hC=F++;_[hC]="^"+_[hc]+_[Pn]+"$";var vC=F++;_[vC]="^"+_[hc]+_[Ri]+"$";var vc=F++;_[vc]="(?:\\^)";var Oi=F++;_[Oi]="(\\s*)"+_[vc]+"\\s+";oa[Oi]=new RegExp(_[Oi],"g");ae[Oi]=new RegExp(dc(_[Oi]),"g");var oD="$1^",gC=F++;_[gC]="^"+_[vc]+_[Pn]+"$";var mC=F++;_[mC]="^"+_[vc]+_[Ri]+"$";var Qp=F++;_[Qp]="^"+_[Ni]+"\\s*("+Gp+")$|^$";var Wp=F++;_[Wp]="^"+_[Ni]+"\\s*("+lC+")$|^$";var kn=F++;_[kn]="(\\s*)"+_[Ni]+"\\s*("+Gp+"|"+_[Pn]+")";oa[kn]=new RegExp(_[kn],"g");ae[kn]=new RegExp(dc(_[kn]),"g");var cD="$1$2$3",yC=F++;_[yC]="^\\s*("+_[Pn]+")\\s+-\\s+("+_[Pn]+")\\s*$";var _C=F++;_[_C]="^\\s*("+_[Ri]+")\\s+-\\s+("+_[Ri]+")\\s*$";var CC=F++;_[CC]="(<|>)?=?\\s*\\*";for(nr=0;nr<F;nr++)Z(nr,_[nr]),oa[nr]||(oa[nr]=new RegExp(_[nr]),ae[nr]=new RegExp(dc(_[nr])));var nr;q.parse=Dn;function Dn(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof $)return t;if(typeof t!="string"||t.length>aa)return null;var r=e.loose?ae[zp]:ae[Bp];if(!r.test(t))return null;try{return new $(t,e)}catch{return null}}q.valid=uD;function uD(t,e){var r=Dn(t,e);return r?r.version:null}q.clean=lD;function lD(t,e){var r=Dn(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}q.SemVer=$;function $(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof $){if(t.loose===e.loose)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>aa)throw new TypeError("version is longer than "+aa+" characters");if(!(this instanceof $))return new $(t,e);Z("SemVer",t,e),this.options=e,this.loose=!!e.loose;var r=t.trim().match(e.loose?ae[zp]:ae[Bp]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>oc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>oc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>oc||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<oc)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}$.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};$.prototype.toString=function(){return this.version};$.prototype.compare=function(t){return Z("SemVer.compare",this.version,this.options,t),t instanceof $||(t=new $(t,this.options)),this.compareMain(t)||this.comparePre(t)};$.prototype.compareMain=function(t){return t instanceof $||(t=new $(t,this.options)),Di(this.major,t.major)||Di(this.minor,t.minor)||Di(this.patch,t.patch)};$.prototype.comparePre=function(t){if(t instanceof $||(t=new $(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],n=t.prerelease[e];if(Z("prerelease compare",e,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return Di(r,n)}while(++e)};$.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this};q.inc=pD;function pD(t,e,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new $(t,r).inc(e,n).version}catch{return null}}q.diff=fD;function fD(t,e){if(Xp(t,e))return null;var r=Dn(t),n=Dn(e),i="";if(r.prerelease.length||n.prerelease.length){i="pre";var s="prerelease"}for(var a in r)if((a==="major"||a==="minor"||a==="patch")&&r[a]!==n[a])return i+a;return s}q.compareIdentifiers=Di;var oC=/^[0-9]+$/;function Di(t,e){var r=oC.test(t),n=oC.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1}q.rcompareIdentifiers=dD;function dD(t,e){return Di(e,t)}q.major=hD;function hD(t,e){return new $(t,e).major}q.minor=vD;function vD(t,e){return new $(t,e).minor}q.patch=gD;function gD(t,e){return new $(t,e).patch}q.compare=br;function br(t,e,r){return new $(t,r).compare(new $(e,r))}q.compareLoose=mD;function mD(t,e){return br(t,e,!0)}q.rcompare=yD;function yD(t,e,r){return br(e,t,r)}q.sort=_D;function _D(t,e){return t.sort(function(r,n){return q.compare(r,n,e)})}q.rsort=CD;function CD(t,e){return t.sort(function(r,n){return q.rcompare(r,n,e)})}q.gt=ca;function ca(t,e,r){return br(t,e,r)>0}q.lt=lc;function lc(t,e,r){return br(t,e,r)<0}q.eq=Xp;function Xp(t,e,r){return br(t,e,r)===0}q.neq=EC;function EC(t,e,r){return br(t,e,r)!==0}q.gte=Kp;function Kp(t,e,r){return br(t,e,r)>=0}q.lte=Yp;function Yp(t,e,r){return br(t,e,r)<=0}q.cmp=pc;function pc(t,e,r,n){switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return Xp(t,r,n);case"!=":return EC(t,r,n);case">":return ca(t,r,n);case">=":return Kp(t,r,n);case"<":return lc(t,r,n);case"<=":return Yp(t,r,n);default:throw new TypeError("Invalid operator: "+e)}}q.Comparator=At;function At(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof At){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof At))return new At(t,e);t=t.trim().split(/\s+/).join(" "),Z("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===la?this.value="":this.value=this.operator+this.semver.version,Z("comp",this)}var la={};At.prototype.parse=function(t){var e=this.options.loose?ae[Qp]:ae[Wp],r=t.match(e);if(!r)throw new TypeError("Invalid comparator: "+t);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new $(r[2],this.options.loose):this.semver=la};At.prototype.toString=function(){return this.value};At.prototype.test=function(t){return Z("Comparator.test",t,this.options.loose),this.semver===la?!0:(typeof t=="string"&&(t=new $(t,this.options)),pc(t,this.operator,this.semver,this.options))};At.prototype.intersects=function(t,e){if(!(t instanceof At))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var r;if(this.operator==="")return r=new he(t.value,e),fc(this.value,r,e);if(t.operator==="")return r=new he(this.value,e),fc(t.semver,r,e);var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),o=pc(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),c=pc(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||i||s&&a||o||c};q.Range=he;function he(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof he)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new he(t.raw,e);if(t instanceof At)return new he(t.value,e);if(!(this instanceof he))return new he(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}he.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range};he.prototype.toString=function(){return this.range};he.prototype.parseRange=function(t){var e=this.options.loose,r=e?ae[_C]:ae[yC];t=t.replace(r,kD),Z("hyphen replace",t),t=t.replace(ae[kn],cD),Z("comparator trim",t,ae[kn]),t=t.replace(ae[qi],aD),t=t.replace(ae[Oi],oD);var n=e?ae[Qp]:ae[Wp],i=t.split(" ").map(function(s){return TD(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(s){return!!s.match(n)})),i=i.map(function(s){return new At(s,this.options)},this),i};he.prototype.intersects=function(t,e){if(!(t instanceof he))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return t.set.some(function(i){return i.every(function(s){return n.intersects(s,e)})})})})};q.toComparators=ED;function ED(t,e){return new he(t,e).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function TD(t,e){return Z("comp",t,e),t=wD(t,e),Z("caret",t),t=bD(t,e),Z("tildes",t),t=SD(t,e),Z("xrange",t),t=PD(t,e),Z("stars",t),t}function it(t){return!t||t.toLowerCase()==="x"||t==="*"}function bD(t,e){return t.trim().split(/\s+/).map(function(r){return ID(r,e)}).join(" ")}function ID(t,e){var r=e.loose?ae[vC]:ae[hC];return t.replace(r,function(n,i,s,a,o){Z("tilde",t,n,i,s,a,o);var c;return it(i)?c="":it(s)?c=">="+i+".0.0 <"+(+i+1)+".0.0":it(a)?c=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":o?(Z("replaceTilde pr",o),c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0"):c=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0",Z("tilde return",c),c})}function wD(t,e){return t.trim().split(/\s+/).map(function(r){return xD(r,e)}).join(" ")}function xD(t,e){Z("caret",t,e);var r=e.loose?ae[mC]:ae[gC];return t.replace(r,function(n,i,s,a,o){Z("caret",t,n,i,s,a,o);var c;return it(i)?c="":it(s)?c=">="+i+".0.0 <"+(+i+1)+".0.0":it(a)?i==="0"?c=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+".0 <"+(+i+1)+".0.0":o?(Z("replaceCaret pr",o),i==="0"?s==="0"?c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+s+"."+(+a+1):c=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+"."+a+"-"+o+" <"+(+i+1)+".0.0"):(Z("no pr"),i==="0"?s==="0"?c=">="+i+"."+s+"."+a+" <"+i+"."+s+"."+(+a+1):c=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0":c=">="+i+"."+s+"."+a+" <"+(+i+1)+".0.0"),Z("caret return",c),c})}function SD(t,e){return Z("replaceXRanges",t,e),t.split(/\s+/).map(function(r){return AD(r,e)}).join(" ")}function AD(t,e){t=t.trim();var r=e.loose?ae[fC]:ae[pC];return t.replace(r,function(n,i,s,a,o,c){Z("xRange",t,n,i,s,a,o,c);var u=it(s),l=u||it(a),p=l||it(o),f=p;return i==="="&&f&&(i=""),u?i===">"||i==="<"?n="<0.0.0":n="*":i&&f?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),n=i+s+"."+a+"."+o):l?n=">="+s+".0.0 <"+(+s+1)+".0.0":p&&(n=">="+s+"."+a+".0 <"+s+"."+(+a+1)+".0"),Z("xRange return",n),n})}function PD(t,e){return Z("replaceStars",t,e),t.trim().replace(ae[CC],"")}function kD(t,e,r,n,i,s,a,o,c,u,l,p,f){return it(r)?e="":it(n)?e=">="+r+".0.0":it(i)?e=">="+r+"."+n+".0":e=">="+e,it(c)?o="":it(u)?o="<"+(+c+1)+".0.0":it(l)?o="<"+c+"."+(+u+1)+".0":p?o="<="+c+"."+u+"."+l+"-"+p:o="<="+o,(e+" "+o).trim()}he.prototype.test=function(t){if(!t)return!1;typeof t=="string"&&(t=new $(t,this.options));for(var e=0;e<this.set.length;e++)if(DD(this.set[e],t,this.options))return!0;return!1};function DD(t,e,r){for(var n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(n=0;n<t.length;n++)if(Z(t[n].semver),t[n].semver!==la&&t[n].semver.prerelease.length>0){var i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}q.satisfies=fc;function fc(t,e,r){try{e=new he(e,r)}catch{return!1}return e.test(t)}q.maxSatisfying=RD;function RD(t,e,r){var n=null,i=null;try{var s=new he(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new $(n,r))}),n}q.minSatisfying=qD;function qD(t,e,r){var n=null,i=null;try{var s=new he(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new $(n,r))}),n}q.minVersion=OD;function OD(t,e){t=new he(t,e);var r=new $("0.0.0");if(t.test(r)||(r=new $("0.0.0-0"),t.test(r)))return r;r=null;for(var n=0;n<t.set.length;++n){var i=t.set[n];i.forEach(function(s){var a=new $(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!r||ca(r,a))&&(r=a);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&t.test(r)?r:null}q.validRange=ND;function ND(t,e){try{return new he(t,e).range||"*"}catch{return null}}q.ltr=LD;function LD(t,e,r){return Jp(t,e,"<",r)}q.gtr=MD;function MD(t,e,r){return Jp(t,e,">",r)}q.outside=Jp;function Jp(t,e,r,n){t=new $(t,n),e=new he(e,n);var i,s,a,o,c;switch(r){case">":i=ca,s=Yp,a=lc,o=">",c=">=";break;case"<":i=lc,s=Kp,a=ca,o="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(fc(t,e,n))return!1;for(var u=0;u<e.set.length;++u){var l=e.set[u],p=null,f=null;if(l.forEach(function(h){h.semver===la&&(h=new At(">=0.0.0")),p=p||h,f=f||h,i(h.semver,p.semver,n)?p=h:a(h.semver,f.semver,n)&&(f=h)}),p.operator===o||p.operator===c||(!f.operator||f.operator===o)&&s(t,f.semver))return!1;if(f.operator===c&&a(t,f.semver))return!1}return!0}q.prerelease=HD;function HD(t,e){var r=Dn(t,e);return r&&r.prerelease.length?r.prerelease:null}q.intersects=FD;function FD(t,e,r){return t=new he(t,r),e=new he(e,r),t.intersects(e)}q.coerce=jD;function jD(t){if(t instanceof $)return t;if(typeof t!="string")return null;var e=t.match(ae[dC]);return e==null?null:Dn(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var ef=d(Zp=>{"use strict";Object.defineProperty(Zp,"__esModule",{value:!0});var UD=require("path"),$D=gc(),IC=require("module"),VD=Object.keys(process.binding("natives")),bC=IC.prototype.require;function BD(t){var e={};return function(n){var i=bC.apply(this,arguments);if(t[n]){var s=IC._resolveFilename(n,this);if(e.hasOwnProperty(s))return e[s];var a=void 0;if(VD.indexOf(n)<0)try{a=bC.call(this,UD.join(n,"package.json")).version}catch{return i}else a=process.version.substring(1);var o=a.indexOf("-");o>=0&&(a=a.substring(0,o));for(var c=i,u=0,l=t[n];u<l.length;u++){var p=l[u];$D.satisfies(a,p.versionSpecifier)&&(c=p.patch(c,s))}return e[s]=c}return i}}Zp.makePatchingRequire=BD});var wC=d((NF,GD)=>{GD.exports={name:"diagnostic-channel",version:"0.3.1",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"tslint -c tslint.json -p tsconfig.json",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^5.3.0"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"^7.0.12",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"^2.2.1"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}});var Te=d(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});var zD=ef(),QD=ef();mc.makePatchingRequire=QD.makePatchingRequire;var xC=function(t){return!0},WD=function(){function t(){this.version=wC().version,this.subscribers={},this.contextPreservationFunction=function(e){return e},this.knownPatches={},this.currentlyPublishing=!1}return t.prototype.shouldPublish=function(e){var r=this.subscribers[e];return r?r.some(function(n){var i=n.filter;return!i||i(!1)}):!1},t.prototype.publish=function(e,r){if(!this.currentlyPublishing){var n=this.subscribers[e];if(n){var i={timestamp:Date.now(),data:r};this.currentlyPublishing=!0,n.forEach(function(s){var a=s.listener,o=s.filter;try{o&&o(!0)&&a(i)}catch{}}),this.currentlyPublishing=!1}}},t.prototype.subscribe=function(e,r,n){n===void 0&&(n=xC),this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push({listener:r,filter:n})},t.prototype.unsubscribe=function(e,r,n){n===void 0&&(n=xC);var i=this.subscribers[e];if(i){for(var s=0;s<i.length;++s)if(i[s].listener===r&&i[s].filter===n)return i.splice(s,1),!0}return!1},t.prototype.reset=function(){var e=this;this.subscribers={},this.contextPreservationFunction=function(r){return r},Object.getOwnPropertyNames(this.knownPatches).forEach(function(r){return delete e.knownPatches[r]})},t.prototype.bindToContext=function(e){return this.contextPreservationFunction(e)},t.prototype.addContextPreservation=function(e){var r=this.contextPreservationFunction;this.contextPreservationFunction=function(n){return e(r(n))}},t.prototype.registerMonkeyPatch=function(e,r){this.knownPatches[e]||(this.knownPatches[e]=[]),this.knownPatches[e].push(r)},t.prototype.getPatchesObject=function(){return this.knownPatches},t}();global.diagnosticsSource||(global.diagnosticsSource=new WD,SC=require("module"),SC.prototype.require=zD.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var SC;mc.channel=global.diagnosticsSource});var PC=d(Ir=>{"use strict";var XD=Ir&&Ir.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Ir,"__esModule",{value:!0});var yc=Te();Ir.AzureMonitorSymbol="Azure_Monitor_Tracer";var AC=!1,KD=function(t){if(AC)return t;try{var e=require("@opentelemetry/tracing"),r=require("@opentelemetry/api"),n=yc.channel.spanContextPropagator?{contextManager:yc.channel.spanContextPropagator}:void 0;new e.BasicTracerProvider().register(n);var i=r.trace.getTracer("applicationinsights tracer"),s=i.startSpan;i.startSpan=function(a,o){if(!o||!o.parent){var c=r.getSpan(r.context.active());c&&c.operation&&c.operation.traceparent&&(o=XD({},o,{parent:{traceId:c.operation.traceparent.traceId,spanId:c.operation.traceparent.spanId,traceFlags:1}}))}var u=s.call(this,a,o),l=u.end;return u.end=function(){var p=l.apply(this,arguments);return yc.channel.publish("azure-coretracing",u),p},u},r.getSpan(r.context.active()),i[Ir.AzureMonitorSymbol]=!0,t.setTracer(i),AC=!0}catch{}return t};Ir.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:KD};function YD(){yc.channel.registerMonkeyPatch("@azure/core-tracing",Ir.azureCoreTracing)}Ir.enable=YD});var DC=d(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});var kC=Te(),JD=function(t){var e=t.prototype._emit;return t.prototype._emit=function(r,n){var i=e.apply(this,arguments);if(!n){var s=i;s||(s=e.call(this,r,!0)),kC.channel.publish("bunyan",{level:r.level,result:s})}return i},t};pa.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:JD};function ZD(){kC.channel.registerMonkeyPatch("bunyan",pa.bunyan)}pa.enable=ZD});var qC=d(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});var tf=Te(),RC=require("stream"),eR=function(t){var e=new RC.Writable,r=new RC.Writable;e.write=function(u){if(!u)return!0;var l=u.toString();return tf.channel.publish("console",{message:l}),!0},r.write=function(u){if(!u)return!0;var l=u.toString();return tf.channel.publish("console",{message:l,stderr:!0}),!0};for(var n=new t.Console(e,r),i=["log","info","warn","error","dir","time","timeEnd","trace","assert"],s=function(u){var l=t[u];l&&(t[u]=function(){if(n[u])try{n[u].apply(n,arguments)}catch{}return l.apply(t,arguments)})},a=0,o=i;a<o.length;a++){var c=o[a];s(c)}return t};fa.console={versionSpecifier:">= 4.0.0",patch:eR};function tR(){tf.channel.registerMonkeyPatch("console",fa.console),require("console")}fa.enable=tR});var OC=d(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});var rf=Te(),rR=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.pool.write;this.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=rf.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=rf.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t};da.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:rR};function nR(){rf.channel.registerMonkeyPatch("mongodb-core",da.mongoCore)}da.enable=nR});var LC=d($t=>{"use strict";var NC=$t&&$t.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty($t,"__esModule",{value:!0});var Xe=Te(),iR=function(t){var e=t.instrument({operationIdGenerator:{next:function(){return Xe.channel.bindToContext(function(n){return n()})}}}),r={};return e.on("started",function(n){r[n.requestId]||(r[n.requestId]=NC({},n,{time:new Date}))}),e.on("succeeded",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Xe.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}):Xe.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}),e.on("failed",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Xe.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}):Xe.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}),t},sR=function(t){var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=Xe.channel.bindToContext(function(s){return s()}),r[i.requestId]=NC({},i,{time:new Date}))}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Xe.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Xe.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t},aR=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=Xe.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=Xe.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t},oR=function(t){aR(t);var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=Xe.channel.bindToContext(function(s){return s()}),r[i.requestId]=i)}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Xe.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return Xe.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t};$t.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:iR};$t.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:sR};$t.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:oR};function cR(){Xe.channel.registerMonkeyPatch("mongodb",$t.mongo2),Xe.channel.registerMonkeyPatch("mongodb",$t.mongo3),Xe.channel.registerMonkeyPatch("mongodb",$t.mongo330)}$t.enable=cR});var HC=d(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});var _c=Te(),MC=require("path"),uR=function(t,e){var r=function(c,u){return function(l,p){var f=c[l];f&&(c[l]=function(){for(var v=arguments.length-1,C=arguments.length-1;C>=0;--C)if(typeof arguments[C]=="function"){v=C;break}else if(typeof arguments[C]<"u")break;var I=arguments[v],w={result:null,startTime:null,startDate:null};typeof I=="function"&&(p?(w.startTime=process.hrtime(),w.startDate=new Date,arguments[v]=_c.channel.bindToContext(p(w,I))):arguments[v]=_c.channel.bindToContext(I));var m=f.apply(this,arguments);return w.result=m,m})}},n=function(c,u){return r(c.prototype,u+".prototype")},i=["connect","changeUser","ping","statistics","end"],s=require(MC.dirname(e)+"/lib/Connection");i.forEach(function(c){return n(s,"Connection")(c)}),r(s,"Connection")("createQuery",function(c,u){return function(l){var p=process.hrtime(c.startTime),f=p[0]*1e3+p[1]/1e6|0;_c.channel.publish("mysql",{query:c.result,callbackArgs:arguments,err:l,duration:f,time:c.startDate}),u.apply(this,arguments)}});var a=["_enqueueCallback"],o=require(MC.dirname(e)+"/lib/Pool");return a.forEach(function(c){return n(o,"Pool")(c)}),t};ha.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:uR};function lR(){_c.channel.registerMonkeyPatch("mysql",ha.mysql)}ha.enable=lR});var jC=d(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});var FC=Te();function pR(t){var e=t.prototype.connect;return t.prototype.connect=function(n){return n&&(arguments[0]=FC.channel.bindToContext(n)),e.apply(this,arguments)},t}va.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:pR};function fR(){FC.channel.registerMonkeyPatch("pg-pool",va.postgresPool1)}va.enable=fR});var $C=d(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});var Li=Te(),UC=require("events");function dR(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var c={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},u=process.hrtime(),l;function p(f){f&&f[n]&&(f=f[n]);var h=Li.channel.bindToContext(function(v,C){var I=process.hrtime(u);if(c.result=C&&{rowCount:C.rowCount,command:C.command},c.error=v,c.duration=Math.ceil(I[0]*1e3+I[1]/1e6),Li.channel.publish("postgres",c),v){if(f)return f.apply(this,arguments);l&&l instanceof UC.EventEmitter&&l.emit("error",v)}else f&&f.apply(this,arguments)});try{return Object.defineProperty(h,n,{value:f}),h}catch{return f}}try{typeof s=="string"?a instanceof Array?(c.query.preparable={text:s,args:a},o=p(o)):(c.query.text=s,o?o=p(o):a=p(a)):(typeof s.name=="string"?c.query.plan=s.name:s.values instanceof Array?c.query.preparable={text:s.text,args:s.values}:c.query.text=s.text,o?o=p(o):a?a=p(a):s.callback=p(s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,l=r.apply(this,arguments),l},t}function hR(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var c=this,u=!!o,l={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},p=process.hrtime(),f;function h(v){v&&v[n]&&(v=v[n]);var C=Li.channel.bindToContext(function(I,w){var m=process.hrtime(p);if(l.result=w&&{rowCount:w.rowCount,command:w.command},l.error=I,l.duration=Math.ceil(m[0]*1e3+m[1]/1e6),Li.channel.publish("postgres",l),I){if(v)return v.apply(this,arguments);f&&f instanceof UC.EventEmitter&&f.emit("error",I)}else v&&v.apply(this,arguments)});try{return Object.defineProperty(C,n,{value:v}),C}catch{return v}}try{typeof s=="string"?a instanceof Array?(l.query.preparable={text:s,args:a},u=typeof o=="function",o=u?h(o):o):(l.query.text=s,o?(u=typeof o=="function",o=u?h(o):o):(u=typeof a=="function",a=u?h(a):a)):(typeof s.name=="string"?l.query.plan=s.name:s.values instanceof Array?l.query.preparable={text:s.text,args:s.values}:l.query.text=s.text,o?(u=typeof o=="function",o=h(o)):a?(u=typeof a=="function",a=u?h(a):a):(u=typeof s.callback=="function",s.callback=u?h(s.callback):s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,f=r.apply(this,arguments),u?f:f.then(function(v){return h()(void 0,v),new c._Promise(function(C,I){C(v)})}).catch(function(v){return h()(v,void 0),new c._Promise(function(C,I){I(v)})})},t}Rn.postgres6={versionSpecifier:"6.*",patch:dR};Rn.postgres7={versionSpecifier:">=7.* <=8.*",patch:hR};function vR(){Li.channel.registerMonkeyPatch("pg",Rn.postgres6),Li.channel.registerMonkeyPatch("pg",Rn.postgres7)}Rn.enable=vR});var VC=d(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});var nf=Te(),gR=function(t){var e=t.RedisClient.prototype.internal_send_command;return t.RedisClient.prototype.internal_send_command=function(r){if(r){var n=r.callback;if(!n||!n.pubsubBound){var i=this.address,s=process.hrtime(),a=new Date;r.callback=nf.channel.bindToContext(function(o,c){var u=process.hrtime(s),l=u[0]*1e3+u[1]/1e6|0;nf.channel.publish("redis",{duration:l,address:i,commandObj:r,err:o,result:c,time:a}),typeof n=="function"&&n.apply(this,arguments)}),r.callback.pubsubBound=!0}}return e.call(this,r)},t};ga.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:gR};function mR(){nf.channel.registerMonkeyPatch("redis",ga.redis)}ga.enable=mR});var BC=d(qn=>{"use strict";var yR=qn&&qn.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(qn,"__esModule",{value:!0});var sf=Te(),_R=function(t){var e=t.Connection.prototype.makeRequest;return t.Connection.prototype.makeRequest=function(){function n(s){var a=process.hrtime(),o={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return sf.channel.bindToContext(function(c,u,l){var p=process.hrtime(a);o=yR({},o,{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!c&&{rowCount:u,rows:l},query:{text:this.parametersByName.statement.value},error:c,duration:Math.ceil(p[0]*1e3+p[1]/1e6)}),sf.channel.publish("tedious",o),s.call(this,c,u,l)})}var i=arguments[0];arguments[0].callback=n(i.callback),e.apply(this,arguments)},t};qn.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:_R};function CR(){sf.channel.registerMonkeyPatch("tedious",qn.tedious)}qn.enable=CR});var GC=d(Vt=>{"use strict";var ER=Vt&&Vt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),TR=Vt&&Vt.__rest||function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]]);return r};Object.defineProperty(Vt,"__esModule",{value:!0});var Cc=Te(),bR=function(t){var e=t.Logger.prototype.log,r,n=function(i,s,a){var o;return r===t.config.npm.levels?o="npm":r===t.config.syslog.levels?o="syslog":o="unknown",Cc.channel.publish("winston",{level:i,message:s,meta:a,levelKind:o}),s};return t.Logger.prototype.log=function(){return r=this.levels,!this.filters||this.filters.length===0?this.filters=[n]:this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter(function(s){return s!==n}),this.filters.push(n)),e.apply(this,arguments)},t},IR=function(t){var e=function(a,o){var c;return a.config.npm.levels[o]!=null?c="npm":a.config.syslog.levels[o]!=null?c="syslog":c="unknown",c},r=function(a){ER(o,a);function o(c,u){var l=a.call(this,u)||this;return l.winston=c,l}return o.prototype.log=function(c,u){var l=c.message,p=c.level,f=c.meta,h=TR(c,["message","level","meta"]);p=typeof Symbol.for=="function"?c[Symbol.for("level")]:p,l=c instanceof Error?c:l;var v=e(this.winston,p);f=f||{};for(var C in h)h.hasOwnProperty(C)&&(f[C]=h[C]);Cc.channel.publish("winston",{message:l,level:p,levelKind:v,meta:f}),u()},o}(t.Transport);function n(){var a=arguments[0].levels||t.config.npm.levels,o;for(var c in a)a.hasOwnProperty(c)&&(o=o===void 0||a[c]>a[o]?c:o);this.add(new r(t,{level:o}))}var i=t.createLogger;t.createLogger=function(){var o=arguments[0].levels||t.config.npm.levels,c;for(var u in o)o.hasOwnProperty(u)&&(c=c===void 0||o[u]>o[c]?u:c);var l=i.apply(this,arguments);l.add(new r(t,{level:c}));var p=l.configure;return l.configure=function(){p.apply(this,arguments),n.apply(this,arguments)},l};var s=t.configure;return t.configure=function(){s.apply(this,arguments),n.apply(this,arguments)},t.add(new r(t)),t};Vt.winston3={versionSpecifier:"3.x",patch:IR};Vt.winston2={versionSpecifier:"2.x",patch:bR};function wR(){Cc.channel.registerMonkeyPatch("winston",Vt.winston2),Cc.channel.registerMonkeyPatch("winston",Vt.winston3)}Vt.enable=wR});var nE=d(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});var zC=PC();ft.azuresdk=zC;var QC=DC();ft.bunyan=QC;var WC=qC();ft.console=WC;var XC=OC();ft.mongodbCore=XC;var KC=LC();ft.mongodb=KC;var YC=HC();ft.mysql=YC;var JC=jC();ft.pgPool=JC;var ZC=$C();ft.pg=ZC;var eE=VC();ft.redis=eE;var tE=BC();ft.tedious=tE;var rE=GC();ft.winston=rE;function xR(){QC.enable(),WC.enable(),XC.enable(),KC.enable(),YC.enable(),ZC.enable(),JC.enable(),eE.enable(),rE.enable(),zC.enable(),tE.enable()}ft.enable=xR});var bc=d(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});var SR=ac(),af=Me();Mi.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var of="DiagnosticChannel";if(Mi.IsInitialized){Bt=nE(),iE=process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"",Ec=iE.split(","),cf={bunyan:Bt.bunyan,console:Bt.console,mongodb:Bt.mongodb,mongodbCore:Bt.mongodbCore,mysql:Bt.mysql,redis:Bt.redis,pg:Bt.pg,pgPool:Bt.pgPool,winston:Bt.winston,azuresdk:Bt.azuresdk};for(Tc in cf)Ec.indexOf(Tc)===-1&&(cf[Tc].enable(),af.info(of,"Subscribed to "+Tc+" events"));Ec.length>0&&af.info(of,"Some modules will not be patched",Ec)}else af.info(of,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var Bt,iE,Ec,cf,Tc;function AR(t){if(!!Mi.IsInitialized){var e=Te();e.channel.addContextPreservation(t),e.channel.spanContextPropagator=SR.AsyncScopeManager}}Mi.registerContextPreservation=AR});var Hi=d((KF,sE)=>{"use strict";sE.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}});var yt=d((pf,oE)=>{"use strict";var uf=pf&&pf.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},PR=require("http"),aE=require("https"),lf=require("url"),Ic=require("constants"),ma=Me(),Fi=Hi(),kR=function(){function t(){}return t.getCookie=function(e,r){var n="";if(e&&e.length&&typeof r=="string")for(var i=e+"=",s=r.split(";"),a=0;a<s.length;a++){var r=s[a];if(r=t.trim(r),r&&r.indexOf(i)===0){n=r.substring(i.length,s[a].length);break}}return n},t.trim=function(e){return typeof e=="string"?e.replace(/^\s+|\s+$/g,""):""},t.int32ArrayToBase64=function(e){var r=function(o,c){return String.fromCharCode(o>>c&255)},n=function(o){return r(o,24)+r(o,16)+r(o,8)+r(o,0)},i=e.map(n).join(""),s=Buffer.from?Buffer.from(i,"binary"):new Buffer(i,"binary"),a=s.toString("base64");return a.substr(0,a.indexOf("="))},t.random32=function(){return 4294967296*Math.random()|0},t.randomu32=function(){return t.random32()+2147483648},t.w3cTraceId=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n,i=0;i<4;i++)n=t.random32(),r+=e[n&15]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var s=e[8+Math.random()*4|0];return r.substr(0,8)+r.substr(9,4)+"4"+r.substr(13,3)+s+r.substr(16,3)+r.substr(19,12)},t.w3cSpanId=function(){return t.w3cTraceId().substring(16)},t.isValidW3CId=function(e){return e.length===32&&e!=="00000000000000000000000000000000"},t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},t.isError=function(e){return e instanceof Error},t.isPrimitive=function(e){var r=typeof e;return r==="string"||r==="number"||r==="boolean"},t.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},t.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var r=(e/1e3%60).toFixed(7).replace(/0{0,4}$/,""),n=""+Math.floor(e/(1e3*60))%60,i=""+Math.floor(e/(1e3*60*60))%24,s=Math.floor(e/(1e3*60*60*24));r=r.indexOf(".")<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i;var a=s>0?s+".":"";return a+i+":"+n+":"+r},t.extractError=function(e){var r=e;return{message:e.message,code:r.code||r.id||""}},t.extractObject=function(e){return e instanceof Error?t.extractError(e):typeof e.toJSON=="function"?e.toJSON():e},t.validateStringMap=function(e){if(typeof e!="object"){ma.info("Invalid properties dropped from payload");return}var r={};for(var n in e){var i="",s=e[n],a=typeof s;if(t.isPrimitive(s))i=s.toString();else if(s===null||a==="undefined")i="";else if(a==="function"){ma.info("key: "+n+" was function; will not serialize");continue}else{var o=t.isArray(s)?s:t.extractObject(s);try{t.isPrimitive(o)?i=o:i=JSON.stringify(o)}catch(c){i=s.constructor.name.toString()+" (Error: "+c.message+")",ma.info("key: "+n+", could not be serialized")}}r[n]=i.substring(0,t.MAX_PROPERTY_LENGTH)}return r},t.canIncludeCorrelationHeader=function(e,r){var n=e&&e.config&&e.config.correlationHeaderExcludedDomains;if(!n||n.length==0||!r)return!0;for(var i=0;i<n.length;i++){var s=new RegExp(n[i].replace(/\./g,".").replace(/\*/g,".*"));if(s.test(lf.parse(r).hostname))return!1}return!0},t.getCorrelationContextTarget=function(e,r){var n=e.headers&&e.headers[Fi.requestContextHeader];if(n)for(var i=n.split(","),s=0;s<i.length;++s){var a=i[s].split("=");if(a.length==2&&a[0]==r)return a[1]}},t.makeRequest=function(e,r,n,i){r&&r.indexOf("//")===0&&(r="https:"+r);var s=lf.parse(r),a=uf({},n,{host:s.hostname,port:s.port,path:s.pathname}),o=void 0;if(s.protocol==="https:"&&(o=e.proxyHttpsUrl||void 0),s.protocol==="http:"&&(o=e.proxyHttpUrl||void 0),o){o.indexOf("//")===0&&(o="http:"+o);var c=lf.parse(o);c.protocol==="https:"?(ma.info("Proxies that use HTTPS are not supported"),o=void 0):a=uf({},a,{host:c.hostname,port:c.port||"80",path:r,headers:uf({},a.headers,{Host:s.hostname})})}var u=s.protocol==="https:"&&!o;return u&&e.httpsAgent!==void 0?a.agent=e.httpsAgent:!u&&e.httpAgent!==void 0?a.agent=e.httpAgent:u&&(a.agent=t.tlsRestrictedAgent),u?aE.request(a,i):PR.request(a,i)},t.safeIncludeCorrelationHeader=function(e,r,n){var i;if(typeof n=="string")i=n;else if(n instanceof Array)i=n.join(",");else if(n&&typeof n.toString=="function")try{i=n.toString()}catch(s){ma.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",s,n)}i?t.addCorrelationIdHeaderFromString(e,r,i):r.setHeader(Fi.requestContextHeader,Fi.requestContextSourceKey+"="+e.config.correlationId)},t.addCorrelationIdHeaderFromString=function(e,r,n){var i=n.split(","),s=Fi.requestContextSourceKey+"=",a=i.some(function(o){return o.substring(0,s.length)===s});a||r.setHeader(Fi.requestContextHeader,n+","+Fi.requestContextSourceKey+"="+e.config.correlationId)},t.MAX_PROPERTY_LENGTH=8192,t.tlsRestrictedAgent=new aE.Agent({secureOptions:Ic.SSL_OP_NO_SSLv2|Ic.SSL_OP_NO_SSLv3|Ic.SSL_OP_NO_TLSv1|Ic.SSL_OP_NO_TLSv1_1}),t}();oE.exports=kR});var On=d((YF,cE)=>{"use strict";var wc=yt(),ff=Me(),DR=function(){function t(){}return t.queryCorrelationId=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId";if(t.completedLookups.hasOwnProperty(n)){r(t.completedLookups[n]);return}else if(t.pendingLookups[n]){t.pendingLookups[n].push(r);return}t.pendingLookups[n]=[r];var i=function(){if(!!t.pendingLookups[n]){var s={method:"GET",disableAppInsightsAutoCollection:!0};ff.info(t.TAG,s);var a=wc.makeRequest(e,n,s,function(o){if(o.statusCode===200){var c="";o.setEncoding("utf-8"),o.on("data",function(u){c+=u}),o.on("end",function(){ff.info(t.TAG,c);var u=t.correlationIdPrefix+c;t.completedLookups[n]=u,t.pendingLookups[n]&&t.pendingLookups[n].forEach(function(l){return l(u)}),delete t.pendingLookups[n]})}else o.statusCode>=400&&o.statusCode<500?(t.completedLookups[n]=void 0,delete t.pendingLookups[n]):setTimeout(i,e.correlationIdRetryIntervalMs)});a&&(a.on("error",function(o){ff.warn(t.TAG,o)}),a.end())}};setTimeout(i,0)},t.cancelCorrelationIdQuery=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId",i=t.pendingLookups[n];i&&(t.pendingLookups[n]=i.filter(function(s){return s!=r}),t.pendingLookups[n].length==0&&delete t.pendingLookups[n])},t.generateRequestId=function(e){if(e){e=e[0]=="|"?e:"|"+e,e[e.length-1]!=="."&&(e+=".");var r=(t.currentRootId++).toString(16);return t.appendSuffix(e,r,"_")}else return t.generateRootId()},t.getRootId=function(e){var r=e.indexOf(".");r<0&&(r=e.length);var n=e[0]==="|"?1:0;return e.substring(n,r)},t.generateRootId=function(){return"|"+wc.w3cTraceId()+"."},t.appendSuffix=function(e,r,n){if(e.length+r.length<t.requestIdMaxLength)return e+r+n;var i=t.requestIdMaxLength-9;if(e.length>i)for(;i>1;--i){var s=e[i-1];if(s==="."||s==="_")break}if(i<=1)return t.generateRootId();for(r=wc.randomu32().toString(16);r.length<8;)r="0"+r;return e.substring(0,i)+r+"#"},t.TAG="CorrelationIdManager",t.correlationIdPrefix="cid-v1:",t.w3cEnabled=!0,t.pendingLookups={},t.completedLookups={},t.requestIdMaxLength=1024,t.currentRootId=wc.randomu32(),t}();cE.exports=DR});var ya=d((JF,uE)=>{"use strict";var Ue=yt(),RR=On(),qR=function(){function t(e,r){if(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.version=t.DEFAULT_VERSION,e&&typeof e=="string")if(e.split(",").length>1)this.traceId=Ue.w3cTraceId(),this.spanId=Ue.w3cTraceId().substr(0,16);else{var n=e.trim().split("-"),i=n.length;i>=4?(this.version=n[0],this.traceId=n[1],this.spanId=n[2],this.traceFlag=n[3]):(this.traceId=Ue.w3cTraceId(),this.spanId=Ue.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=t.DEFAULT_VERSION,this.traceId=Ue.w3cTraceId()),this.version==="00"&&i!==4&&(this.traceId=Ue.w3cTraceId(),this.spanId=Ue.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=t.DEFAULT_VERSION,this.traceId=Ue.w3cTraceId(),this.spanId=Ue.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=t.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.traceId=Ue.w3cTraceId()),t.isValidTraceId(this.traceId)||(this.traceId=Ue.w3cTraceId()),t.isValidSpanId(this.spanId)||(this.spanId=Ue.w3cTraceId().substr(0,16),this.traceId=Ue.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(r){this.parentId=r.slice();var s=RR.getRootId(r);t.isValidTraceId(s)||(this.legacyRootId=s,s=Ue.w3cTraceId()),r.indexOf("|")!==-1&&(r=r.substring(1+r.substring(0,r.length-1).lastIndexOf("."),r.length-1)),this.traceId=s,this.spanId=r}else this.traceId=Ue.w3cTraceId(),this.spanId=Ue.w3cTraceId().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},t.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},t.prototype.updateSpanId=function(){this.spanId=Ue.w3cTraceId().substr(0,16)},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}();uE.exports=qR});var df=d((ZF,lE)=>{"use strict";var OR=function(){function t(e){this.fieldmap=[],e&&(this.fieldmap=this.parseHeader(e))}return t.prototype.toString=function(){var e=this.fieldmap;return!e||e.length==0?null:e.join(", ")},t.validateKeyChars=function(e){var r=e.split("@");if(r.length==2){var n=r[0].trim(),i=r[1].trim(),s=Boolean(n.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),a=Boolean(i.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return s&&a}else if(r.length==1)return Boolean(e.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/));return!1},t.prototype.parseHeader=function(e){var r=[],n={},i=e.split(",");if(i.length>32)return null;for(var s=0,a=i;s<a.length;s++){var o=a[s],c=o.trim();if(c.length!==0){var u=c.split("=");if(u.length!==2||!t.validateKeyChars(u[0])||n[u[0]])return null;n[u[0]]=!0,r.push(c)}}return r},t.strict=!0,t}();lE.exports=OR});var wr=d((ej,pE)=>{"use strict";var NR=function(){function t(){}return t}();pE.exports=NR});var dE=d((hf,fE)=>{"use strict";var LR=hf&&hf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),MR=wr(),HR=function(t){LR(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(MR);fE.exports=HR});var vf=d((tj,hE)=>{"use strict";var FR=function(){function t(){}return t}();hE.exports=FR});var gE=d((rj,vE)=>{"use strict";var jR=function(){function t(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return t}();vE.exports=jR});var yE=d((gf,mE)=>{"use strict";var UR=gf&&gf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),$R=vf(),VR=function(t){UR(e,t);function e(){return t.call(this)||this}return e}($R);mE.exports=VR});var yf=d((nj,_E)=>{"use strict";var mf;(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(mf||(mf={}));_E.exports=mf});var EE=d((ij,CE)=>{"use strict";var BR=yf(),GR=function(){function t(){this.kind=BR.Measurement}return t}();CE.exports=GR});var bE=d((sj,TE)=>{"use strict";var zR=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}();TE.exports=zR});var Cf=d((_f,IE)=>{"use strict";var QR=_f&&_f.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),WR=wr(),XR=function(t){QR(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(WR);IE.exports=XR});var xE=d((Ef,wE)=>{"use strict";var KR=Ef&&Ef.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),YR=wr(),JR=function(t){KR(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.exceptions=[],r.properties={},r.measurements={},r}return e}(YR);wE.exports=JR});var AE=d((aj,SE)=>{"use strict";var ZR=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}();SE.exports=ZR});var kE=d((Tf,PE)=>{"use strict";var eq=Tf&&Tf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),tq=wr(),rq=function(t){eq(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r}return e}(tq);PE.exports=rq});var RE=d((bf,DE)=>{"use strict";var nq=bf&&bf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),iq=wr(),sq=function(t){nq(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.metrics=[],r.properties={},r}return e}(iq);DE.exports=sq});var OE=d((If,qE)=>{"use strict";var aq=If&&If.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),oq=Cf(),cq=function(t){aq(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(oq);qE.exports=cq});var LE=d((wf,NE)=>{"use strict";var uq=wf&&wf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),lq=wr(),pq=function(t){uq(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.success=!0,r.properties={},r.measurements={},r}return e}(lq);NE.exports=pq});var HE=d((xf,ME)=>{"use strict";var fq=xf&&xf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),dq=wr(),hq=function(t){fq(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(dq);ME.exports=hq});var Af=d((oj,FE)=>{"use strict";var Sf;(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(Sf||(Sf={}));FE.exports=Sf});var UE=d((cj,jE)=>{"use strict";var vq=function(){function t(){}return t}();jE.exports=vq});var Pf=d(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.AvailabilityData=dE();Pe.Base=vf();Pe.ContextTagKeys=gE();Pe.Data=yE();Pe.DataPoint=EE();Pe.DataPointType=yf();Pe.Domain=wr();Pe.Envelope=bE();Pe.EventData=Cf();Pe.ExceptionData=xE();Pe.ExceptionDetails=AE();Pe.MessageData=kE();Pe.MetricData=RE();Pe.PageViewData=OE();Pe.RemoteDependencyData=LE();Pe.RequestData=HE();Pe.SeverityLevel=Af();Pe.StackFrame=UE()});var $E=d(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});var Nn=Pf(),gq=function(){function t(){}return t.TYPE_HTTP="Http",t.TYPE_AI="Http (tracked component)",t}();xc.RemoteDependencyDataConstants=gq;function mq(t){return"properties"in t||t instanceof Nn.EventData||t instanceof Nn.ExceptionData||t instanceof Nn.MessageData||t instanceof Nn.MetricData||t instanceof Nn.PageViewData||t instanceof Nn.RemoteDependencyData||t instanceof Nn.RequestData}xc.domainSupportsProperties=mq});var VE=d(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});function yq(t){switch(t){case $e.Event:return"EventData";case $e.Exception:return"ExceptionData";case $e.Trace:return"MessageData";case $e.Metric:return"MetricData";case $e.Request:return"RequestData";case $e.Dependency:return"RemoteDependencyData";case $e.Availability:return"AvailabilityData";case $e.PageView:return"PageViewData"}}Ln.telemetryTypeToBaseType=yq;function _q(t){switch(t){case"EventData":return $e.Event;case"ExceptionData":return $e.Exception;case"MessageData":return $e.Trace;case"MetricData":return $e.Metric;case"RequestData":return $e.Request;case"RemoteDependencyData":return $e.Dependency;case"AvailabilityData":return $e.Availability;case"PageViewData":return $e.PageView}}Ln.baseTypeToTelemetryType=_q;Ln.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var $e;(function(t){t[t.Event=0]="Event",t[t.Exception=1]="Exception",t[t.Trace=2]="Trace",t[t.Metric=3]="Metric",t[t.Request=4]="Request",t[t.Dependency=5]="Dependency",t[t.Availability=6]="Availability",t[t.PageView=7]="PageView"})($e=Ln.TelemetryType||(Ln.TelemetryType={}))});var BE=d(Sc=>{"use strict";function Cq(t){for(var e in t)Sc.hasOwnProperty(e)||(Sc[e]=t[e])}Object.defineProperty(Sc,"__esModule",{value:!0});Cq(VE())});var _t=d(Ac=>{"use strict";function kf(t){for(var e in t)Ac.hasOwnProperty(e)||(Ac[e]=t[e])}Object.defineProperty(Ac,"__esModule",{value:!0});kf($E());kf(Pf());kf(BE())});var Df=d((hj,GE)=>{"use strict";var Eq=function(){function t(){}return t.prototype.getUrl=function(){return this.url},t.prototype.RequestParser=function(){this.startTime=+new Date},t.prototype._setStatus=function(e,r){var n=+new Date;this.duration=n-this.startTime,this.statusCode=e;var i=this.properties||{};if(r){if(typeof r=="string")i.error=r;else if(r instanceof Error)i.error=r.message;else if(typeof r=="object")for(var s in r)i[s]=r[s]&&r[s].toString&&r[s].toString()}this.properties=i},t.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},t}();GE.exports=Eq});var Of=d((qf,QE)=>{"use strict";var Tq=qf&&qf.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pc=require("url"),bq=_t(),zE=yt(),Mn=Hi(),Iq=Df(),Br=On(),wq=df(),Rf=ya(),xq=function(t){Tq(e,t);function e(r,n){var i=t.call(this)||this;return r&&(i.method=r.method,i.url=i._getAbsoluteUrl(r),i.startTime=+new Date,i.socketRemoteAddress=r.socket&&r.socket.remoteAddress,i.parseHeaders(r,n),r.connection&&(i.connectionRemoteAddress=r.connection.remoteAddress,i.legacySocketRemoteAddress=r.connection.socket&&r.connection.socket.remoteAddress)),i}return e.prototype.onError=function(r,n){this._setStatus(void 0,r),n&&(this.duration=n)},e.prototype.onResponse=function(r,n){this._setStatus(r.statusCode,void 0),n&&(this.duration=n)},e.prototype.getRequestTelemetry=function(r){var n={id:this.requestId,name:this.method+" "+Pc.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(r&&r.time?n.time=r.time:this.startTime&&(n.time=new Date(this.startTime)),r){for(var i in r)n[i]||(n[i]=r[i]);if(r.properties)for(var i in r.properties)n.properties[i]=r.properties[i]}return n},e.prototype.getRequestTags=function(r){var n={};for(var i in r)n[i]=r[i];return n[e.keys.locationIp]=r[e.keys.locationIp]||this._getIp(),n[e.keys.sessionId]=r[e.keys.sessionId]||this._getId("ai_session"),n[e.keys.userId]=r[e.keys.userId]||this._getId("ai_user"),n[e.keys.userAuthUserId]=r[e.keys.userAuthUserId]||this._getId("ai_authUser"),n[e.keys.operationName]=this.getOperationName(r),n[e.keys.operationParentId]=this.getOperationParentId(r),n[e.keys.operationId]=this.getOperationId(r),n},e.prototype.getOperationId=function(r){return r[e.keys.operationId]||this.operationId},e.prototype.getOperationParentId=function(r){return r[e.keys.operationParentId]||this.parentId||this.getOperationId(r)},e.prototype.getOperationName=function(r){return r[e.keys.operationName]||this.method+" "+Pc.parse(this.url).pathname},e.prototype.getRequestId=function(){return this.requestId},e.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},e.prototype.getTraceparent=function(){return this.traceparent},e.prototype.getTracestate=function(){return this.tracestate},e.prototype.getLegacyRootId=function(){return this.legacyRootId},e.prototype._getAbsoluteUrl=function(r){if(!r.headers)return r.url;var n=r.connection?r.connection.encrypted:null,i=Pc.parse(r.url),s=i.pathname,a=i.search,o=Pc.format({protocol:n?"https":"http",host:r.headers.host,pathname:s,search:a});return o},e.prototype._getIp=function(){var r=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(s){var a=r.exec(s);if(a)return a[0]},i=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!i&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(i="127.0.0.1"),i},e.prototype._getId=function(r){var n=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"",i=e.parseId(zE.getCookie(r,n));return i},e.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},e.prototype.parseHeaders=function(r,n){if(this.rawHeaders=r.headers||r.rawHeaders,this.userAgent=r.headers&&r.headers["user-agent"],this.sourceCorrelationId=zE.getCorrelationContextTarget(r,Mn.requestContextSourceKey),r.headers){var i=r.headers[Mn.traceStateHeader],s=r.headers[Mn.traceparentHeader],a=r.headers[Mn.requestIdHeader],o=r.headers[Mn.parentIdHeader],c=r.headers[Mn.rootIdHeader];this.correlationContextHeader=r.headers[Mn.correlationContextHeader],Br.w3cEnabled&&(s||i)?(this.traceparent=new Rf(s),this.tracestate=s&&i&&new wq(i),this.setBackCompatFromThisTraceContext()):a?Br.w3cEnabled?(this.traceparent=new Rf(null,a),this.setBackCompatFromThisTraceContext()):(this.parentId=a,this.requestId=Br.generateRequestId(this.parentId),this.operationId=Br.getRootId(this.requestId)):Br.w3cEnabled?(this.traceparent=new Rf,this.traceparent.parentId=o,this.traceparent.legacyRootId=c||o,this.setBackCompatFromThisTraceContext()):(this.parentId=o,this.requestId=Br.generateRequestId(c||this.parentId),this.correlationContextHeader=null,this.operationId=Br.getRootId(this.requestId)),n&&(this.requestId=n,this.operationId=Br.getRootId(this.requestId))}},e.parseId=function(r){var n=r.split("|");return n.length>0?n[0]:""},e.keys=new bq.ContextTagKeys,e}(Iq);QE.exports=xq});var kc=d((vj,KE)=>{"use strict";function Nf(t){return typeof t=="function"}var st=console.error.bind(console);function _a(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Ca(t){t&&t.logger&&(Nf(t.logger)?st=t.logger:st("new logger isn't a function, not replacing"))}function WE(t,e,r){if(!t||!t[e]){st("no original function "+e+" to wrap");return}if(!r){st("no wrapper function"),st(new Error().stack);return}if(!Nf(t[e])||!Nf(r)){st("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return _a(i,"__original",n),_a(i,"__unwrap",function(){t[e]===i&&_a(t,e,n)}),_a(i,"__wrapped",!0),_a(t,e,i),i}function Sq(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{st("must provide one or more modules to patch"),st(new Error().stack);return}if(!(e&&Array.isArray(e))){st("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){WE(n,i,r)})})}function XE(t,e){if(!t||!t[e]){st("no function to unwrap."),st(new Error().stack);return}if(!t[e].__unwrap)st("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function Aq(t,e){if(t)Array.isArray(t)||(t=[t]);else{st("must provide one or more modules to patch"),st(new Error().stack);return}if(!(e&&Array.isArray(e))){st("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){XE(r,n)})})}Ca.wrap=WE;Ca.massWrap=Sq;Ca.unwrap=XE;Ca.massUnwrap=Aq;KE.exports=Ca});var qc=d((gj,e0)=>{"use strict";var JE=kc(),ji=JE.wrap,Dc=JE.unwrap,xr="wrap@before";function Rc(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Pq(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[xr];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function ZE(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function kq(t,e,r){var n=ZE(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&Pq(t,i)}function YE(t,e){if(!!t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}e0.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(c,u){var l=ZE(this,c).slice();try{var p=a.call(this,c,u);return kq(this,c,l),p}finally{this.on.__wrapped||ji(this,"on",i),this.addListener.__wrapped||ji(this,"addListener",i)}}}function s(a){return function(c){if(!this._events||!this._events[c])return a.apply(this,arguments);var u=this._events[c];function l(p){return function(){this._events[c]=u;try{return p.apply(this,arguments)}finally{u=this._events[c],this._events[c]=YE(u,n)}}}ji(this,"removeListener",l);try{return this._events[c]=YE(u,n),a.apply(this,arguments)}finally{Dc(this,"removeListener"),this._events[c]=u}}}e[xr]?typeof e[xr]=="function"?Rc(e,xr,[e[xr],r]):Array.isArray(e[xr])&&e[xr].push(r):Rc(e,xr,r),e.__wrapped||(ji(e,"addListener",i),ji(e,"on",i),ji(e,"emit",s),Rc(e,"__unwrap",function(){Dc(e,"addListener"),Dc(e,"on"),Dc(e,"emit"),delete e[xr],delete e.__wrapped}),Rc(e,"__wrapped",!0))}});var i0=d((mj,n0)=>{"use strict";var K=require("util"),Sr=require("assert"),Dq=qc(),ce=require("async_hooks"),Ea="cls@contexts",Ta="error@context",ve=process.env.DEBUG_CLS_HOOKED,X=-1;n0.exports={getNamespace:t0,createNamespace:Rq,destroyNamespace:r0,reset:qq,ERROR_SYMBOL:Ta};function Pt(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}Pt.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,ve){let n=" ".repeat(this._indent<0?0:this._indent);le(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+X+" active:"+K.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};Pt.prototype.get=function(e){if(!this.active){if(ve){let r=ce.currentId(),n=ce.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);le(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${X} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(ve){let r=ce.executionAsyncId(),n=ce.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);le(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+X+" active:"+K.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),le(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${X} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${K.inspect(this.active)}`)}return this.active[e]};Pt.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=X,ve){let r=ce.executionAsyncId(),n=ce.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);le(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${X} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${K.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};Pt.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(ve){let n=ce.triggerAsyncId(),i=ce.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);le(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${X} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${K.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[Ta]=r),n}finally{if(ve){let n=ce.triggerAsyncId(),i=ce.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);le(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${X} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${K.inspect(r)}`)}this.exit(r)}};Pt.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};Pt.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return ve&&le("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+X+" len:"+this._set.length+" "+K.inspect(r)),n.then(i=>(ve&&le("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+X+" len:"+this._set.length+" "+K.inspect(r)),this.exit(r),i)).catch(i=>{throw i[Ta]=r,ve&&le("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+X+" len:"+this._set.length+" "+K.inspect(r)),this.exit(r),i})};Pt.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[Ta]=r),s}finally{n.exit(r)}}};Pt.prototype.enter=function(e){if(Sr.ok(e,"context must be provided for entering"),ve){let r=ce.executionAsyncId(),n=ce.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);le(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${X} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${K.inspect(e)}`)}this._set.push(this.active),this.active=e};Pt.prototype.exit=function(e){if(Sr.ok(e,"context must be provided for exiting"),ve){let n=ce.executionAsyncId(),i=ce.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);le(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${X} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${K.inspect(e)}`)}if(this.active===e){Sr.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(ve&&le("??ERROR?? context exiting but not entered - ignoring: "+K.inspect(e)),Sr.ok(r>=0,`context not currently entered; can't exit. 
`+K.inspect(this)+`
`+K.inspect(e))):(Sr.ok(r,"can't remove top context"),this._set.splice(r,1))};Pt.prototype.bindEmitter=function(e){Sr.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[Ea]||(a[Ea]=Object.create(null)),a[Ea][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[Ea]))return a;let o=a,c=a[Ea];return Object.keys(c).forEach(function(u){let l=c[u];o=l.namespace.bind(o,l.context)}),o}Dq(e,i,s)};Pt.prototype.fromException=function(e){return e[Ta]};function t0(t){return process.namespaces[t]}function Rq(t){Sr.ok(t,"namespace must be given a name."),ve&&le(`NS-CREATING NAMESPACE (${t})`);let e=new Pt(t);return e.id=X,ce.createHook({init(n,i,s,a){if(X=ce.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),ve){let o=" ".repeat(e._indent<0?0:e._indent);le(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(X===0){let o=ce.triggerAsyncId(),c=e._contexts.get(o);if(c){if(e._contexts.set(n,c),ve){let u=" ".repeat(e._indent<0?0:e._indent);le(`${u}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${X} triggerId:${o} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(ve){let u=" ".repeat(e._indent<0?0:e._indent);le(`${u}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${X} triggerId:${o} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(ve&&i==="PROMISE"){le(K.inspect(a,{showHidden:!0}));let o=a.parentId,c=" ".repeat(e._indent<0?0:e._indent);le(`${c}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){X=ce.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(X),i){if(ve){let s=ce.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);le(`${a}BEFORE (${t}) asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${K.inspect(i)}`),e._indent+=2}e.enter(i)}else if(ve){let s=ce.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);le(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${K.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){X=ce.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(X),i){if(ve){let s=ce.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);le(`${a}AFTER (${t}) asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${K.inspect(i)}`)}e.exit(i)}else if(ve){let s=ce.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);le(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${X} triggerId:${s} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${K.inspect(i)}`)}},destroy(n){if(X=ce.executionAsyncId(),ve){let i=ce.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);le(`${s}DESTROY (${t}) currentUid:${X} asyncId:${n} triggerId:${i} active:${K.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${K.inspect(e._contexts.get(X))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function r0(t){let e=t0(t);Sr.ok(e,`can't delete nonexistent namespace! "`+t+'"'),Sr.ok(e.id,"don't assign to process.namespaces directly! "+K.inspect(e)),process.namespaces[t]=null}function qq(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){r0(t)}),process.namespaces=Object.create(null)}process.namespaces={};function le(...t){ve&&process._rawDebug(`${K.format(...t)}`)}});var a0=d((yj,s0)=>{"use strict";function Oq(){}s0.exports=function(){let e=this._hooks,r=this._state,n=process.nextTick;process.nextTick=function(){if(!r.enabled)return n.apply(process,arguments);let i=new Array(arguments.length);for(let c=0;c<arguments.length;c++)i[c]=arguments[c];let s=i[0];if(typeof s!="function")throw new TypeError("callback is not a function");let a=new Oq,o=--r.counter;return e.init.call(a,o,0,null,null),i[0]=function(){e.pre.call(a,o);let c=!0;try{s.apply(this,arguments),c=!1}finally{c&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){e.post.call(a,o,!0),e.destroy.call(null,o)})}e.post.call(a,o,!1),e.destroy.call(null,o)},n.apply(process,i)}}});var c0=d((_j,o0)=>{"use strict";function Nq(){}o0.exports=function(){let e=this._hooks,r=this._state,n=global.Promise,i=n.prototype.then;n.prototype.then=c;function s(u,l,p,f){return typeof u!="function"?f?a(p):o(p):function(){e.pre.call(l,p);try{return u.apply(this,arguments)}finally{e.post.call(l,p,!1),e.destroy.call(null,p)}}}function a(u){return function(p){return e.destroy.call(null,u),p}}function o(u){return function(p){throw e.destroy.call(null,u),p}}function c(u,l){if(!r.enabled)return i.call(this,u,l);let p=new Nq,f=--r.counter;return e.init.call(p,f,0,null,null),i.call(this,s(u,p,f,!0),s(l,p,f,!1))}}});var l0=d((Cj,u0)=>{"use strict";var Ct=require("timers");function Lq(){}function Mq(){}function Hq(){}var Fq=new Map,jq=new Map,Uq=new Map,Lf=null,Mf=!1;u0.exports=function(){Hf(this._hooks,this._state,"setTimeout","clearTimeout",Lq,Fq,!0),Hf(this._hooks,this._state,"setInterval","clearInterval",Mq,jq,!1),Hf(this._hooks,this._state,"setImmediate","clearImmediate",Hq,Uq,!0),global.setTimeout=Ct.setTimeout,global.setInterval=Ct.setInterval,global.setImmediate=Ct.setImmediate,global.clearTimeout=Ct.clearTimeout,global.clearInterval=Ct.clearInterval,global.clearImmediate=Ct.clearImmediate};function Hf(t,e,r,n,i,s,a){let o=Ct[r],c=Ct[n];Ct[r]=function(){if(!e.enabled)return o.apply(Ct,arguments);let u=new Array(arguments.length);for(let v=0;v<arguments.length;v++)u[v]=arguments[v];let l=u[0];if(typeof l!="function")throw new TypeError('"callback" argument must be a function');let p=new i,f=--e.counter,h;return t.init.call(p,f,0,null,null),u[0]=function(){Lf=h,t.pre.call(p,f);let v=!0;try{l.apply(this,arguments),v=!1}finally{v&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){t.post.call(p,f,!0),s.delete(h),t.destroy.call(null,f)})}t.post.call(p,f,!1),Lf=null,(a||Mf)&&(Mf=!1,s.delete(h),t.destroy.call(null,f))},h=o.apply(Ct,u),s.set(h,f),h},Ct[n]=function(u){if(Lf===u&&u!==null)Mf=!0;else if(s.has(u)){let l=s.get(u);s.delete(u),t.destroy.call(null,l)}c.apply(Ct,arguments)}}});var Ff=d((Ej,$q)=>{$q.exports={name:"async-hook-jl",description:"Inspect the life of handle objects in node",version:"1.7.6",author:"Andreas Madsen <amwebdk@gmail.com>",main:"./index.js",scripts:{test:"node ./test/runner.js && eslint ."},repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},keywords:["async","async hooks","inspect","async wrap"],license:"MIT",dependencies:{"stack-chain":"^1.3.7"},devDependencies:{async:"1.5.x","cli-color":"1.1.x",eslint:"^3.4.0",endpoint:"0.4.x"},engines:{node:"^4.7 || >=6.9 || >=7.3"}}});var d0=d((Tj,f0)=>{"use strict";var Ia=process.binding("async_wrap"),Vq=Ia.Providers.TIMERWRAP,p0={nextTick:a0(),promise:c0(),timers:l0()},ba=new Set;function Bq(){this.enabled=!1,this.counter=0}function jf(){let t=this.initFns=[],e=this.preFns=[],r=this.postFns=[],n=this.destroyFns=[];this.init=function(i,s,a,o){if(s===Vq){ba.add(i);return}for(let c of t)c(i,this,s,a,o)},this.pre=function(i){if(!ba.has(i))for(let s of e)s(i,this)},this.post=function(i,s){if(!ba.has(i))for(let a of r)a(i,this,s)},this.destroy=function(i){if(ba.has(i)){ba.delete(i);return}for(let s of n)s(i)}}jf.prototype.add=function(t){t.init&&this.initFns.push(t.init),t.pre&&this.preFns.push(t.pre),t.post&&this.postFns.push(t.post),t.destroy&&this.destroyFns.push(t.destroy)};function Oc(t,e){let r=t.indexOf(e);r!==-1&&t.splice(r,1)}jf.prototype.remove=function(t){t.init&&Oc(this.initFns,t.init),t.pre&&Oc(this.preFns,t.pre),t.post&&Oc(this.postFns,t.post),t.destroy&&Oc(this.destroyFns,t.destroy)};function wa(){this._state=new Bq,this._hooks=new jf,this.version=Ff().version,this.providers=Ia.Providers;for(let t of Object.keys(p0))p0[t].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),Ia.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}f0.exports=wa;wa.prototype.addHooks=function(t){this._hooks.add(t)};wa.prototype.removeHooks=function(t){this._hooks.remove(t)};wa.prototype.enable=function(){this._state.enabled=!0,Ia.enable()};wa.prototype.disable=function(){this._state.enabled=!1,Ia.disable()}});var Uf=d((bj,Gq)=>{Gq.exports={name:"stack-chain",description:"API for combining call site modifiers",version:"1.3.7",author:"Andreas Madsen <amwebdk@gmail.com>",scripts:{test:"tap ./test/simple"},repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},keywords:["stack","chain","trace","call site","concat","format"],devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},license:"MIT"}});var v0=d((Ij,h0)=>{function zq(t){try{return Error.prototype.toString.call(t)}catch(e){try{return"<error: "+e+">"}catch{return"<error>"}}}h0.exports=function(e,r){var n=[];n.push(zq(e));for(var i=0;i<r.length;i++){var s=r[i],a;try{a=s.toString()}catch(o){try{a="<error: "+o+">"}catch{a="<error>"}}n.push("    at "+a)}return n.join(`
`)}});var _0=d((wj,y0)=>{var Nc=v0();function m0(){this.extend=new xa,this.filter=new xa,this.format=new Sa,this.version=Uf().version}var Vf=!1;m0.prototype.callSite=function t(e){e||(e={}),Vf=!0;var r={};Error.captureStackTrace(r,t);var n=r.stack;return Vf=!1,n=n.slice(e.slice||0),e.extend&&(n=this.extend._modify(r,n)),e.filter&&(n=this.filter._modify(r,n)),n};var Gr=new m0;function xa(){this._modifiers=[]}xa.prototype._modify=function(t,e){for(var r=0,n=this._modifiers.length;r<n;r++)e=this._modifiers[r](t,e);return e};xa.prototype.attach=function(t){this._modifiers.push(t)};xa.prototype.deattach=function(t){var e=this._modifiers.indexOf(t);return e===-1?!1:(this._modifiers.splice(e,1),!0)};function Sa(){this._formater=Nc,this._previous=void 0}Sa.prototype.replace=function(t){t?this._formater=t:this.restore()};Sa.prototype.restore=function(){this._formater=Nc,this._previous=void 0};Sa.prototype._backup=function(){this._previous=this._formater};Sa.prototype._roolback=function(){this._previous===Nc?this.replace(void 0):this.replace(this._previous),this._previous=void 0};Error.prepareStackTrace&&Gr.format.replace(Error.prepareStackTrace);var $f=!1;function g0(t,e){if(Vf)return e;if($f)return Nc(t,e);var r=e.concat();r=Gr.extend._modify(t,r),r=Gr.filter._modify(t,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(t)&&Object.getOwnPropertyDescriptor(t,"callSite")===void 0&&(t.callSite={original:e,mutated:r}),$f=!0;var n=Gr.format._formater(t,r);return $f=!1,n}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return g0},set:function(t){t===g0?Gr.format._roolback():(Gr.format._backup(),Gr.format.replace(t))}});function Qq(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:Qq,set:function(t){Object.defineProperty(this,"callSite",{value:t,writable:!0,configurable:!0})},configurable:!0});y0.exports=Gr});var Gf=d((xj,Bf)=>{if(global._stackChain)if(global._stackChain.version===Uf().version)Bf.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else Bf.exports=global._stackChain=_0()});var C0=d((Sj,zf)=>{"use strict";var Wq=d0();if(global._asyncHook)if(global._asyncHook.version===Ff().version)zf.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else Gf().filter.attach(function(e,r){return r.filter(function(n){let i=n.getFileName();return!(i&&i.slice(0,__dirname.length)===__dirname)})}),zf.exports=global._asyncHook=new Wq});var x0=d((Aj,w0)=>{"use strict";var Ie=require("util"),Ar=require("assert"),Xq=qc(),Ui=C0(),Aa="cls@contexts",Pa="error@context",T0=[];for(let t in Ui.providers)T0[Ui.providers[t]]=t;var ye=process.env.DEBUG_CLS_HOOKED,ke=-1;w0.exports={getNamespace:b0,createNamespace:Kq,destroyNamespace:I0,reset:Yq,ERROR_SYMBOL:Pa};function kt(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map}kt.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return ye&&be("    SETTING KEY:"+e+"="+r+" in ns:"+this.name+" uid:"+ke+" active:"+Ie.inspect(this.active,!0)),this.active[e]=r,r};kt.prototype.get=function(e){if(!this.active){ye&&be("    GETTING KEY:"+e+"=undefined "+this.name+" uid:"+ke+" active:"+Ie.inspect(this.active,!0));return}return ye&&be("    GETTING KEY:"+e+"="+this.active[e]+" "+this.name+" uid:"+ke+" active:"+Ie.inspect(this.active,!0)),this.active[e]};kt.prototype.createContext=function(){ye&&be("   CREATING Context: "+this.name+" uid:"+ke+" len:"+this._set.length+"  active:"+Ie.inspect(this.active,!0,2,!0));let e=Object.create(this.active?this.active:Object.prototype);return e._ns_name=this.name,e.id=ke,ye&&be("   CREATED Context: "+this.name+" uid:"+ke+" len:"+this._set.length+"  context:"+Ie.inspect(e,!0,2,!0)),e};kt.prototype.run=function(e){let r=this.createContext();this.enter(r);try{return ye&&be(" BEFORE RUN: "+this.name+" uid:"+ke+" len:"+this._set.length+" "+Ie.inspect(r)),e(r),r}catch(n){throw n&&(n[Pa]=r),n}finally{ye&&be(" AFTER RUN: "+this.name+" uid:"+ke+" len:"+this._set.length+" "+Ie.inspect(r)),this.exit(r)}};kt.prototype.runAndReturn=function(e){var r;return this.run(function(n){r=e(n)}),r};kt.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return ye&&be(" BEFORE runPromise: "+this.name+" uid:"+ke+" len:"+this._set.length+" "+Ie.inspect(r)),n.then(i=>(ye&&be(" AFTER runPromise: "+this.name+" uid:"+ke+" len:"+this._set.length+" "+Ie.inspect(r)),this.exit(r),i)).catch(i=>{throw i[Pa]=r,ye&&be(" AFTER runPromise: "+this.name+" uid:"+ke+" len:"+this._set.length+" "+Ie.inspect(r)),this.exit(r),i})};kt.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[Pa]=r),s}finally{n.exit(r)}}};kt.prototype.enter=function(e){Ar.ok(e,"context must be provided for entering"),ye&&be("  ENTER "+this.name+" uid:"+ke+" len:"+this._set.length+" context: "+Ie.inspect(e)),this._set.push(this.active),this.active=e};kt.prototype.exit=function(e){if(Ar.ok(e,"context must be provided for exiting"),ye&&be("  EXIT "+this.name+" uid:"+ke+" len:"+this._set.length+" context: "+Ie.inspect(e)),this.active===e){Ar.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(ye&&be("??ERROR?? context exiting but not entered - ignoring: "+Ie.inspect(e)),Ar.ok(r>=0,`context not currently entered; can't exit. 
`+Ie.inspect(this)+`
`+Ie.inspect(e))):(Ar.ok(r,"can't remove top context"),this._set.splice(r,1))};kt.prototype.bindEmitter=function(e){Ar.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[Aa]||(a[Aa]=Object.create(null)),a[Aa][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[Aa]))return a;let o=a,c=a[Aa];return Object.keys(c).forEach(function(u){let l=c[u];o=l.namespace.bind(o,l.context)}),o}Xq(e,i,s)};kt.prototype.fromException=function(e){return e[Pa]};function b0(t){return process.namespaces[t]}function Kq(t){Ar.ok(t,"namespace must be given a name."),ye&&be("CREATING NAMESPACE "+t);let e=new kt(t);return e.id=ke,Ui.addHooks({init(r,n,i,s,a){ke=r,s?(e._contexts.set(r,e._contexts.get(s)),ye&&be("PARENTID: "+t+" uid:"+r+" parent:"+s+" provider:"+i)):e._contexts.set(ke,e.active),ye&&be("INIT "+t+" uid:"+r+" parent:"+s+" provider:"+T0[i]+" active:"+Ie.inspect(e.active,!0))},pre(r,n){ke=r;let i=e._contexts.get(r);i?(ye&&be(" PRE "+t+" uid:"+r+" handle:"+Lc(n)+" context:"+Ie.inspect(i)),e.enter(i)):ye&&be(" PRE MISSING CONTEXT "+t+" uid:"+r+" handle:"+Lc(n))},post(r,n){ke=r;let i=e._contexts.get(r);i?(ye&&be(" POST "+t+" uid:"+r+" handle:"+Lc(n)+" context:"+Ie.inspect(i)),e.exit(i)):ye&&be(" POST MISSING CONTEXT "+t+" uid:"+r+" handle:"+Lc(n))},destroy(r){ke=r,ye&&be("DESTROY "+t+" uid:"+r+" context:"+Ie.inspect(e._contexts.get(ke))+" active:"+Ie.inspect(e.active,!0)),e._contexts.delete(r)}}),process.namespaces[t]=e,e}function I0(t){let e=b0(t);Ar.ok(e,`can't delete nonexistent namespace! "`+t+'"'),Ar.ok(e.id,"don't assign to process.namespaces directly! "+Ie.inspect(e)),process.namespaces[t]=null}function Yq(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){I0(t)}),process.namespaces=Object.create(null)}process.namespaces={};Ui._state&&!Ui._state.enabled&&Ui.enable();function be(t){process.env.DEBUG&&process._rawDebug(t)}function Lc(t){if(!t)return t;if(typeof t=="function")return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(t.constructor&&t.constructor.name)return t.constructor.name}if(ye){Qf=Gf();for(E0 in Qf.filter._modifiers)Qf.filter.deattach(E0)}var Qf,E0});var S0=d((Pj,Wf)=>{"use strict";var Jq=gc();process&&Jq.gte(process.versions.node,"8.0.0")?Wf.exports=i0():Wf.exports=x0()});var k0=d((kj,P0)=>{var Zq=kc().wrap,Kf=1<<0,Yf=1<<1,Jf=1<<2,Hc=1<<3,re=[],eO=0,Ke=!1,zr=[],$i,Zf;function ed(t,e){var r=t.length,n=e.length,i=[];if(r===0&&n===0)return i;for(var s=0;s<r;s++)i[s]=t[s];if(n===0)return i;for(var a=0;a<n;a++){var o=!0;for(s=0;s<r;s++)if(t[s].uid===e[a].uid){o=!1;break}o&&i.push(e[a])}return i}process._fatalException?(Mc=!1,$i=function(e){var r=re.length;if(Mc||r===0)return!1;var n=!1;Mc=!0;for(var i=0;i<r;++i){var s=re[i];if((s.flags&Hc)!==0){var a=Vi&&Vi[s.uid];n=s.error(a,e)||n}}return Mc=!1,zr.length>0&&(re=zr.pop()),Vi=void 0,n&&!Ke},Zf=function(e,r,n){var i=[];Ke=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&Kf)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return Ke=!1,function(){Vi=i,zr.push(re),re=ed(r,re),Ke=!0;for(var c=0;c<n;++c)(r[c].flags&Yf)>0&&r[c].before(this,i[r[c].uid]);Ke=!1;var u=e.apply(this,arguments);for(Ke=!0,c=0;c<n;++c)(r[c].flags&Jf)>0&&r[c].after(this,i[r[c].uid]);return Ke=!1,re=zr.pop(),Vi=void 0,u}},Zq(process,"_fatalException",function(t){return function(r){return $i(r)||t(r)}})):(Xf=!1,$i=function(e){if(Xf)throw e;for(var r=!1,n=re.length,i=0;i<n;++i){var s=re[i];(s.flags&Hc)!==0&&(r=s.error(null,e)||r)}if(!r&&Ke)throw e},Zf=function(e,r,n){var i=[];Ke=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&Kf)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return Ke=!1,function(){var c=!1,u=!1;zr.push(re),re=ed(r,re),Ke=!0;for(var l=0;l<n;++l)(r[l].flags&Yf)>0&&r[l].before(this,i[r[l].uid]);Ke=!1;var p;try{p=e.apply(this,arguments)}catch(f){c=!0;for(var l=0;l<n;++l)if((re[l].flags&Hc)!=0)try{u=re[l].error(i[r[l].uid],f)||u}catch(v){throw Xf=!0,v}if(!u)throw process.removeListener("uncaughtException",$i),process._originalNextTick(function(){process.addListener("uncaughtException",$i)}),f}finally{if(!c||u){for(Ke=!0,l=0;l<n;++l)(r[l].flags&Jf)>0&&r[l].after(this,i[r[l].uid]);Ke=!1}re=zr.pop()}return p}},process.addListener("uncaughtException",$i));var Mc,Vi,Xf;function tO(t,e,r){Ke=!0;for(var n=0;n<r;++n){var i=e[n];i.create&&i.create(i.data)}return Ke=!1,function(){zr.push(re),re=ed(e,re);var s=t.apply(this,arguments);return re=zr.pop(),s}}function rO(t){var e=re.length;if(e===0)return t;for(var r=re.slice(),n=0;n<e;++n)if(r[n].flags>0)return Zf(t,r,e);return tO(t,r,e)}function ir(t,e){typeof t.create=="function"&&(this.create=t.create,this.flags|=Kf),typeof t.before=="function"&&(this.before=t.before,this.flags|=Yf),typeof t.after=="function"&&(this.after=t.after,this.flags|=Jf),typeof t.error=="function"&&(this.error=t.error,this.flags|=Hc),this.uid=++eO,this.data=e===void 0?null:e}ir.prototype.create=void 0;ir.prototype.before=void 0;ir.prototype.after=void 0;ir.prototype.error=void 0;ir.prototype.data=void 0;ir.prototype.uid=0;ir.prototype.flags=0;function A0(t,e){if(typeof t!="object"||!t)throw new TypeError("callbacks argument must be an object");return t instanceof ir?t:new ir(t,e)}function nO(t,e){var r;t instanceof ir?r=t:r=A0(t,e);for(var n=!1,i=0;i<re.length;i++)if(r===re[i]){n=!0;break}return n||re.push(r),r}function iO(t){for(var e=0;e<re.length;e++)if(t===re[e]){re.splice(e,1);break}}process.createAsyncListener=A0;process.addAsyncListener=nO;process.removeAsyncListener=iO;P0.exports=rO});var R0=d((Rj,D0)=>{"use strict";D0.exports=(t,e)=>class extends t{constructor(n){var i,s;super(o);var a=this;try{n.apply(i,s)}catch(c){s[1](c)}return a;function o(c,u){i=this,s=[l,p];function l(f){return e(a,!1),c(f)}function p(f){return e(a,!1),u(f)}}}}});var F0=d(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var L0=kc(),jc=gc(),dt=L0.wrap,Qr=L0.massWrap,ge=k0(),sO=require("util"),aO=jc.gte(process.version,"6.0.0"),nd=jc.gte(process.version,"7.0.0"),oO=jc.gte(process.version,"8.0.0"),cO=jc.gte(process.version,"11.0.0"),sr=require("net");nd&&!sr._normalizeArgs?sr._normalizeArgs=function(t){if(t.length===0)return[{},null];var e=t[0],r={};typeof e=="object"&&e!==null?r=e:dO(e)?r.path=e:(r.port=e,t.length>1&&typeof t[1]=="string"&&(r.host=t[1]));var n=t[t.length-1];return typeof n!="function"?[r,null]:[r,n]}:!nd&&!sr._normalizeConnectArgs&&(sr._normalizeConnectArgs=function(t){var e={};function r(i){return(i=Number(i))>=0?i:!1}typeof t[0]=="object"&&t[0]!==null?e=t[0]:typeof t[0]=="string"&&r(t[0])===!1?e.path=t[0]:(e.port=t[0],typeof t[1]=="string"&&(e.host=t[1]));var n=t[t.length-1];return typeof n=="function"?[e,n]:[e]});"_setUpListenHandle"in sr.Server.prototype?dt(sr.Server.prototype,"_setUpListenHandle",q0):dt(sr.Server.prototype,"_listen2",q0);function q0(t){return function(){this.on("connection",function(e){e._handle&&(e._handle.onread=ge(e._handle.onread))});try{return t.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=ge(this._handle.onconnection))}}}function M0(t){if(t&&t._handle){var e=t._handle;e._originalOnread||(e._originalOnread=e.onread),e.onread=ge(e._originalOnread)}}dt(sr.Socket.prototype,"connect",function(t){return function(){var e;oO&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?e=arguments[0]:e=nd?sr._normalizeArgs(arguments):sr._normalizeConnectArgs(arguments),e[1]&&(e[1]=ge(e[1]));var r=t.apply(this,e);return M0(this),r}});var uO=require("http");dt(uO.Agent.prototype,"addRequest",function(t){return function(e){var r=e.onSocket;return e.onSocket=ge(function(n){return M0(n),r.apply(this,arguments)}),t.apply(this,arguments)}});var td=require("child_process");function O0(t){Array.isArray(t.stdio)&&t.stdio.forEach(function(e){e&&e._handle&&(e._handle.onread=ge(e._handle.onread),dt(e._handle,"close",Uc))}),t._handle&&(t._handle.onexit=ge(t._handle.onexit))}td.ChildProcess?dt(td.ChildProcess.prototype,"spawn",function(t){return function(){var e=t.apply(this,arguments);return O0(this),e}}):Qr(td,["execFile","fork","spawn"],function(t){return function(){var e=t.apply(this,arguments);return O0(e),e}});process._fatalException||(process._originalNextTick=process.nextTick);var ad=[];process._nextDomainTick&&ad.push("_nextDomainTick");process._tickDomainCallback&&ad.push("_tickDomainCallback");Qr(process,ad,ar);dt(process,"nextTick",Uc);var od=["setTimeout","setInterval"];global.setImmediate&&od.push("setImmediate");var H0=require("timers"),lO=global.setTimeout===H0.setTimeout;Qr(H0,od,Uc);lO&&Qr(global,od,Uc);var id=require("dns");Qr(id,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],ar);id.resolveNaptr&&dt(id,"resolveNaptr",ar);var Fn=require("fs");Qr(Fn,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],ar);Fn.lchown&&dt(Fn,"lchown",ar);Fn.lchmod&&dt(Fn,"lchmod",ar);Fn.ftruncate&&dt(Fn,"ftruncate",ar);var ka;try{ka=require("zlib")}catch{}ka&&ka.Deflate&&ka.Deflate.prototype&&(Hn=Object.getPrototypeOf(ka.Deflate.prototype),Hn._transform?dt(Hn,"_transform",ar):Hn.write&&Hn.flush&&Hn.end&&Qr(Hn,["write","flush","end"],ar));var Hn,sd;try{sd=require("crypto")}catch{}sd&&(rd=["pbkdf2","randomBytes"],cO||rd.push("pseudoRandomBytes"),Qr(sd,rd,ar));var rd,Fc=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";Fc&&(N0=process.addAsyncListener({create:function(){Fc=!1}}),global.Promise.resolve(!0).then(function(){Fc=!1}),process.removeAsyncListener(N0));var N0;Fc&&pO();function pO(){var t=global.Promise;function e(a){if(!(this instanceof e))return t(a);if(typeof a!="function")return new t(a);var o,c,u=new t(l);u.__proto__=e.prototype;try{a.apply(o,c)}catch(p){c[1](p)}return u;function l(p,f){o=this,c=[h,v];function h(C){return n(u,!1),p(C)}function v(C){return n(u,!1),f(C)}}}if(sO.inherits(e,t),dt(t.prototype,"then",s),t.prototype.chain&&dt(t.prototype,"chain",s),aO)global.Promise=R0()(t,n);else{var r=["all","race","reject","resolve","accept","defer"];r.forEach(function(a){typeof t[a]=="function"&&(e[a]=t[a])}),global.Promise=e}function n(a,o){(!a.__asl_wrapper||o)&&(a.__asl_wrapper=ge(i))}function i(a,o,c,u){var l;try{return l=o.call(a,c),{returnVal:l,error:!1}}catch(p){return{errorVal:p,error:!0}}finally{l instanceof t?u.__asl_wrapper=function(){var f=l.__asl_wrapper||i;return f.apply(this,arguments)}:n(u,!0)}}function s(a){return function(){var c=this,u=a.apply(c,Array.prototype.map.call(arguments,l));return u.__asl_wrapper=function(f,h,v,C){return c.__asl_wrapper?(c.__asl_wrapper(f,function(){},null,u),u.__asl_wrapper(f,h,v,C)):i(f,h,v,C)},u;function l(p){return typeof p!="function"?p:ge(function(f){var h=(c.__asl_wrapper||i)(this,p,f,u);if(h.error)throw h.errorVal;return h.returnVal})}}}}function ar(t){var e=function(){var r,n=arguments.length-1;if(typeof arguments[n]=="function"){r=Array(arguments.length);for(var i=0;i<arguments.length-1;i++)r[i]=arguments[i];r[n]=ge(arguments[n])}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof n=="function"&&(n=ge(n)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof i=="function"&&(i=ge(i)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof s=="function"&&(s=ge(s)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof a=="function"&&(a=ge(a)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof o=="function"&&(o=ge(o)),t.call(this,r,n,i,s,a,o))};default:return e}}function Uc(t){var e=function(){var r;if(typeof arguments[0]=="function"){r=Array(arguments.length),r[0]=ge(arguments[0]);for(var n=1;n<arguments.length;n++)r[n]=arguments[n]}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof r=="function"&&(r=ge(r)),t.call(this,r,n,i,s,a,o))};default:return e}}function fO(t){return(t=Number(t))>=0?t:!1}function dO(t){return typeof t=="string"&&fO(t)===!1}});var B0=d((Nj,V0)=>{"use strict";var Pr=require("assert"),hO=qc(),Da="cls@contexts",cd="error@context";process.addAsyncListener||F0();function Gt(t){this.name=t,this.active=null,this._set=[],this.id=null}Gt.prototype.set=function(t,e){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[t]=e,e};Gt.prototype.get=function(t){if(!!this.active)return this.active[t]};Gt.prototype.createContext=function(){return Object.create(this.active)};Gt.prototype.run=function(t){var e=this.createContext();this.enter(e);try{return t(e),e}catch(r){throw r&&(r[cd]=e),r}finally{this.exit(e)}};Gt.prototype.runAndReturn=function(t){var e;return this.run(function(r){e=t(r)}),e};Gt.prototype.bind=function(t,e){e||(this.active?e=this.active:e=this.createContext());var r=this;return function(){r.enter(e);try{return t.apply(this,arguments)}catch(n){throw n&&(n[cd]=e),n}finally{r.exit(e)}}};Gt.prototype.enter=function(t){Pr.ok(t,"context must be provided for entering"),this._set.push(this.active),this.active=t};Gt.prototype.exit=function(t){if(Pr.ok(t,"context must be provided for exiting"),this.active===t){Pr.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var e=this._set.lastIndexOf(t);Pr.ok(e>=0,"context not currently entered; can't exit"),Pr.ok(e,"can't remove top context"),this._set.splice(e,1)};Gt.prototype.bindEmitter=function(t){Pr.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");var e=this,r="context@"+this.name;function n(s){!s||(s[Da]||(s[Da]=Object.create(null)),s[Da][r]={namespace:e,context:e.active})}function i(s){if(!(s&&s[Da]))return s;var a=s,o=s[Da];return Object.keys(o).forEach(function(c){var u=o[c];a=u.namespace.bind(a,u.context)}),a}hO(t,n,i)};Gt.prototype.fromException=function(t){return t[cd]};function j0(t){return process.namespaces[t]}function vO(t){Pr.ok(t,"namespace must be given a name!");var e=new Gt(t);return e.id=process.addAsyncListener({create:function(){return e.active},before:function(r,n){n&&e.enter(n)},after:function(r,n){n&&e.exit(n)},error:function(r){r&&e.exit(r)}}),process.namespaces[t]=e,e}function U0(t){var e=j0(t);Pr.ok(e,"can't delete nonexistent namespace!"),Pr.ok(e.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(e.id),process.namespaces[t]=null}function $0(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){U0(t)}),process.namespaces=Object.create(null)}process.namespaces||$0();V0.exports={getNamespace:j0,createNamespace:vO,destroyNamespace:U0,reset:$0}});var An=d(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});var z0=Me(),gO=bc(),Ra=ya(),ud=df(),G0=Of(),mO=function(){function t(){}return t.getCurrentContext=function(){if(!t.enabled)return null;var e=t.session.get(t.CONTEXT_NAME);return e===void 0?null:e},t.generateContextObject=function(e,r,n,i,s,a){return r=r||e,this.enabled?{operation:{name:n,id:e,parentId:r,traceparent:s,tracestate:a},customProperties:new yO(i)}:null},t.spanToContextObject=function(e,r,n){var i=new Ra;return i.traceId=e.traceId,i.spanId=e.spanId,i.traceFlag=e.traceFlags||Ra.DEFAULT_TRACE_FLAG,i.parentId=r,t.generateContextObject(i.traceId,i.parentId,n,null,i)},t.runWithContext=function(e,r){if(t.enabled)return t.session.bind(r,(n={},n[t.CONTEXT_NAME]=e,n))();return r();var n},t.wrapEmitter=function(e){t.enabled&&t.session.bindEmitter(e)},t.wrapCallback=function(e,r){if(t.enabled)return t.session.bind(e,r?(n={},n[t.CONTEXT_NAME]=r,n):void 0);return e;var n},t.enable=function(e){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}t.hasEverEnabled||(this.forceClsHooked=e,this.hasEverEnabled=!0,typeof this.cls>"u"&&(t.forceClsHooked===!0||t.forceClsHooked===void 0&&t.shouldUseClsHooked()?this.cls=S0():this.cls=B0()),t.session=this.cls.createNamespace("AI-CLS-Session"),gO.registerContextPreservation(function(r){return t.session.bind(r)})),this.enabled=!0}},t.startOperation=function(e,r){var n=e&&e.traceContext||null,i=e&&e.traceId?e:null,s=e&&e.headers;if(i){var a=new Ra("00-"+i.traceId+"-"+i.spanId+"-01"),o=new ud(i.tracestate),c=t.generateContextObject(i.traceId,"|"+i.traceId+"."+i.spanId+".",typeof r=="string"?r:"",void 0,a,o);return c}if(n){var a=new Ra(n.traceparent),o=new ud(n.tracestate),u=typeof r=="object"?new G0(r):null,c=t.generateContextObject(a.traceId,a.parentId,typeof r=="string"?r:u.getOperationName({}),u&&u.getCorrelationContextHeader()||void 0,a,o);return c}if(s){var a=new Ra(s.traceparent),o=new ud(s.tracestate),u=new G0(e),c=t.generateContextObject(a.traceId,a.parentId,u.getOperationName({}),u.getCorrelationContextHeader(),a,o);return c}return z0.warn("startOperation was called with invalid arguments",arguments),null},t.disable=function(){this.enabled=!1},t.reset=function(){t.hasEverEnabled&&(t.session=null,t.session=this.cls.createNamespace("AI-CLS-Session"))},t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>3||parseInt(e[0])>2&&parseInt(e[1])>2},t.shouldUseClsHooked=function(){var e=process.versions.node.split(".");return parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=2},t.canUseClsHooked=function(){var e=process.versions.node.split("."),r=parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=0,n=parseInt(e[0])<8||parseInt(e[0])<=8&&parseInt(e[1])<2,i=parseInt(e[0])>4||parseInt(e[0])>=4&&parseInt(e[1])>=7;return!(r&&n)&&i},t.enabled=!1,t.hasEverEnabled=!1,t.forceClsHooked=void 0,t.CONTEXT_NAME="ApplicationInsights-Context",t}();ld.CorrelationContextManager=mO;var yO=function(){function t(e){this.props=[],this.addHeaderData(e)}return t.prototype.addHeaderData=function(e){var r=e?e.split(", "):[];this.props=r.map(function(n){var i=n.split("=");return{key:i[0],value:i[1]}}).concat(this.props)},t.prototype.serializeToHeader=function(){return this.props.map(function(e){return e.key+"="+e.value}).join(", ")},t.prototype.getProperty=function(e){for(var r=0;r<this.props.length;++r){var n=this.props[r];if(n.key===e)return n.value}},t.prototype.setProperty=function(e,r){if(t.bannedCharacters.test(e)||t.bannedCharacters.test(r)){z0.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+e+" and value: "+r);return}for(var n=0;n<this.props.length;++n){var i=this.props[n];if(i.key===e){i.value=r;return}}this.props.push({key:e,value:r})},t.bannedCharacters=/[,=]/,t}()});var W0=d($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});var Q0=_t(),pd=Te(),jn=[],fd=function(t){var e=t.data.message;jn.forEach(function(r){e instanceof Error?r.trackException({exception:e}):(e.lastIndexOf(`
`)==e.length-1&&(e=e.substring(0,e.length-1)),r.trackTrace({message:e,severity:t.data.stderr?Q0.SeverityLevel.Warning:Q0.SeverityLevel.Information}))})};function _O(t,e){t?(jn.length===0&&pd.channel.subscribe("console",fd),jn.push(e)):(jn=jn.filter(function(r){return r!=e}),jn.length===0&&pd.channel.unsubscribe("console",fd))}$c.enable=_O;function CO(){pd.channel.unsubscribe("console",fd),jn=[]}$c.dispose=CO});var X0=d(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});var Bi=_t(),dd=Te(),Un=[],EO={10:Bi.SeverityLevel.Verbose,20:Bi.SeverityLevel.Verbose,30:Bi.SeverityLevel.Information,40:Bi.SeverityLevel.Warning,50:Bi.SeverityLevel.Error,60:Bi.SeverityLevel.Critical},hd=function(t){var e=t.data.result;Un.forEach(function(r){var n=EO[t.data.level];e instanceof Error?r.trackException({exception:e}):r.trackTrace({message:e,severity:n})})};function TO(t,e){t?(Un.length===0&&dd.channel.subscribe("bunyan",hd),Un.push(e)):(Un=Un.filter(function(r){return r!=e}),Un.length===0&&dd.channel.unsubscribe("bunyan",hd))}Vc.enable=TO;function bO(){dd.channel.unsubscribe("bunyan",hd),Un=[]}Vc.dispose=bO});var K0=d(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});var Ve=_t(),vd=Te(),$n=[],IO={syslog:function(t){var e={emerg:Ve.SeverityLevel.Critical,alert:Ve.SeverityLevel.Critical,crit:Ve.SeverityLevel.Critical,error:Ve.SeverityLevel.Error,warning:Ve.SeverityLevel.Warning,notice:Ve.SeverityLevel.Information,info:Ve.SeverityLevel.Information,debug:Ve.SeverityLevel.Verbose};return e[t]===void 0?Ve.SeverityLevel.Information:e[t]},npm:function(t){var e={error:Ve.SeverityLevel.Error,warn:Ve.SeverityLevel.Warning,info:Ve.SeverityLevel.Information,verbose:Ve.SeverityLevel.Verbose,debug:Ve.SeverityLevel.Verbose,silly:Ve.SeverityLevel.Verbose};return e[t]===void 0?Ve.SeverityLevel.Information:e[t]},unknown:function(t){return Ve.SeverityLevel.Information}},gd=function(t){var e=t.data.message;$n.forEach(function(r){if(e instanceof Error)r.trackException({exception:e,properties:t.data.meta});else{var n=IO[t.data.levelKind](t.data.level);r.trackTrace({message:e,severity:n,properties:t.data.meta})}})};function wO(t,e){t?($n.length===0&&vd.channel.subscribe("winston",gd),$n.push(e)):($n=$n.filter(function(r){return r!=e}),$n.length===0&&vd.channel.unsubscribe("winston",gd))}Bc.enable=wO;function xO(){vd.channel.unsubscribe("winston",gd),$n=[]}Bc.dispose=xO});var J0=d((jj,Y0)=>{"use strict";var SO=bc(),AO=function(){function t(e){if(t.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=e,t.INSTANCE=this}return t.prototype.enable=function(e,r){SO.IsInitialized&&(W0().enable(e&&r,this._client),X0().enable(e,this._client),K0().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1,!1)},t._methodNames=["debug","info","log","warn","error"],t}();Y0.exports=AO});var eT=d((Uj,Z0)=>{"use strict";var PO=function(){function t(e){if(t.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e;var r=process.versions.node.split(".");t._canUseUncaughtExceptionMonitor=parseInt(r[0])>13||parseInt(r[0])===13&&parseInt(r[1])>=7}return t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.enable=function(e){var r=this;if(e){this._isInitialized=!0;var n=this;if(!this._exceptionListenerHandle){var i=function(s,a,o){o===void 0&&(o=new Error(t._FALLBACK_ERROR_MESSAGE)),r._client.trackException({exception:o}),r._client.flush({isAppCrashing:!0}),s&&a&&process.listeners(a).length===1&&(console.error(o),process.exit(1))};t._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=i.bind(this,!0,t.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(t._canUseUncaughtExceptionMonitor?process.removeListener(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.INSTANCE=null,t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",t.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",t.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",t._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",t._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",t._canUseUncaughtExceptionMonitor=!1,t}();Z0.exports=PO});var Wr=d(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com";z.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com";z.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var Ye;(function(t){t.COMMITTED_BYTES="\\Memory\\Committed Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",t.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",t.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",t.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",t.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",t.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",t.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(Ye=z.QuickPulseCounter||(z.QuickPulseCounter={}));var Gc;(function(t){t.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",t.AVAILABLE_BYTES="\\Memory\\Available Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",t.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",t.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(Gc=z.PerformanceCounter||(z.PerformanceCounter={}));z.PerformanceToQuickPulseCounter=(zt={},zt[Gc.PROCESSOR_TIME]=Ye.PROCESSOR_TIME,zt[Gc.REQUEST_RATE]=Ye.REQUEST_RATE,zt[Gc.REQUEST_DURATION]=Ye.REQUEST_DURATION,zt[Ye.COMMITTED_BYTES]=Ye.COMMITTED_BYTES,zt[Ye.REQUEST_FAILURE_RATE]=Ye.REQUEST_FAILURE_RATE,zt[Ye.DEPENDENCY_RATE]=Ye.DEPENDENCY_RATE,zt[Ye.DEPENDENCY_FAILURE_RATE]=Ye.DEPENDENCY_FAILURE_RATE,zt[Ye.DEPENDENCY_DURATION]=Ye.DEPENDENCY_DURATION,zt[Ye.EXCEPTION_RATE]=Ye.EXCEPTION_RATE,zt);z.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"};z.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"};z.TelemetryTypeStringToQuickPulseType={EventData:z.QuickPulseType.Event,ExceptionData:z.QuickPulseType.Exception,MessageData:z.QuickPulseType.Trace,MetricData:z.QuickPulseType.Metric,RequestData:z.QuickPulseType.Request,RemoteDependencyData:z.QuickPulseType.Dependency,AvailabilityData:z.QuickPulseType.Availability,PageViewData:z.QuickPulseType.PageView};z.TelemetryTypeStringToQuickPulseDocumentType={EventData:z.QuickPulseDocumentType.Event,ExceptionData:z.QuickPulseDocumentType.Exception,MessageData:z.QuickPulseDocumentType.Trace,MetricData:z.QuickPulseDocumentType.Metric,RequestData:z.QuickPulseDocumentType.Request,RemoteDependencyData:z.QuickPulseDocumentType.Dependency,AvailabilityData:z.QuickPulseDocumentType.Availability,PageViewData:z.QuickPulseDocumentType.PageView};z.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"};z.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"};z.HeartBeatMetricName="HeartBeat";var zt});var Qc=d((Vj,tT)=>{"use strict";var zc=require("os"),Dt=Wr(),kO=function(){function t(e,r,n){r===void 0&&(r=6e4),n===void 0&&(n=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e,this._collectionInterval=r,this._enableLiveMetricsCounters=n}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._lastCpus=zc.cpus(),this._lastRequests={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:t._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},t.countRequest=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalRequestExecutionTime+=n,r===!1&&t._totalFailedRequestCount++,t._totalRequestCount++}},t.countException=function(){t._totalExceptionCount++},t.countDependency=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalDependencyExecutionTime+=n,r===!1&&t._totalFailedDependencyCount++,t._totalDependencyCount++}},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},t.prototype._trackCpu=function(){var e=zc.cpus();if(e&&e.length&&this._lastCpus&&e.length===this._lastCpus.length){for(var r=0,n=0,i=0,s=0,a=0,o=0;!!e&&o<e.length;o++){var c=e[o],u=this._lastCpus[o],l="% cpu("+o+") ",p=c.model,f=c.speed,h=c.times,v=u.times,C=h.user-v.user||0;r+=C;var I=h.sys-v.sys||0;n+=I;var w=h.nice-v.nice||0;i+=w;var m=h.idle-v.idle||0;s+=m;var x=h.irq-v.irq||0;a+=x}var V=void 0;if(typeof process.cpuUsage=="function"){var B=process.cpuUsage(),ne=process.hrtime(),Be=B.user-this._lastAppCpuUsage.user+(B.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime<"u"&&this._lastHrtime.length===2){var Et=(ne[0]-this._lastHrtime[0])*1e6+(ne[1]-this._lastHrtime[1])/1e3||0;V=100*Be/(Et*e.length)}this._lastAppCpuUsage=B,this._lastHrtime=ne}var Ze=r+n+i+s+a||1;this._client.trackMetric({name:Dt.PerformanceCounter.PROCESSOR_TIME,value:(Ze-s)/Ze*100}),this._client.trackMetric({name:Dt.PerformanceCounter.PROCESS_TIME,value:V||r/Ze*100})}this._lastCpus=e},t.prototype._trackMemory=function(){var e=zc.freemem(),r=process.memoryUsage().rss,n=zc.totalmem()-e;this._client.trackMetric({name:Dt.PerformanceCounter.PRIVATE_BYTES,value:r}),this._client.trackMetric({name:Dt.PerformanceCounter.AVAILABLE_BYTES,value:e}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:Dt.QuickPulseCounter.COMMITTED_BYTES,value:n})},t.prototype._trackNetwork=function(){var e=this._lastRequests,r={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},n=r.totalRequestCount-e.totalRequestCount||0,i=r.totalFailedRequestCount-e.totalFailedRequestCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/n||0;if(this._lastIntervalRequestExecutionTime=t._intervalRequestExecutionTime,s>0){var c=n/a,u=i/a;this._client.trackMetric({name:Dt.PerformanceCounter.REQUEST_RATE,value:c}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:Dt.PerformanceCounter.REQUEST_DURATION,value:o}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:Dt.QuickPulseCounter.REQUEST_FAILURE_RATE,value:u})}this._lastRequests=r},t.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastDependencies,r={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},n=r.totalDependencyCount-e.totalDependencyCount||0,i=r.totalFailedDependencyCount-e.totalFailedDependencyCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/n||0;if(this._lastIntervalDependencyExecutionTime=t._intervalDependencyExecutionTime,s>0){var c=n/a,u=i/a;this._client.trackMetric({name:Dt.QuickPulseCounter.DEPENDENCY_RATE,value:c}),this._client.trackMetric({name:Dt.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:u}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:Dt.QuickPulseCounter.DEPENDENCY_DURATION,value:o})}this._lastDependencies=r}},t.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastExceptions,r={totalExceptionCount:t._totalExceptionCount,time:+new Date},n=r.totalExceptionCount-e.totalExceptionCount||0,i=r.time-e.time,s=i/1e3;if(i>0){var a=n/s;this._client.trackMetric({name:Dt.QuickPulseCounter.EXCEPTION_RATE,value:a})}this._lastExceptions=r}},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t._totalRequestCount=0,t._totalFailedRequestCount=0,t._lastRequestExecutionTime=0,t._totalDependencyCount=0,t._totalFailedDependencyCount=0,t._lastDependencyExecutionTime=0,t._totalExceptionCount=0,t._intervalDependencyExecutionTime=0,t._intervalRequestExecutionTime=0,t}();tT.exports=kO});var qa=d((Bj,sT)=>{"use strict";var kr=require("os"),rT=require("fs"),nT=require("path"),DO=_t(),iT=Me(),RO=function(){function t(e){this.keys=new DO.ContextTagKeys,this.tags={},this._loadApplicationContext(e),this._loadDeviceContext(),this._loadInternalContext()}return t.prototype._loadApplicationContext=function(e){if(e=e||nT.resolve(__dirname,"../../../../package.json"),!t.appVersion[e]){t.appVersion[e]="unknown";try{var r=JSON.parse(rT.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.appVersion[e]=r.version)}catch(n){iT.info("unable to read app version: ",n)}}this.tags[this.keys.applicationVersion]=t.appVersion[e]},t.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=kr&&kr.hostname(),this.tags[this.keys.deviceOSVersion]=kr&&kr.type()+" "+kr.release(),this.tags[this.keys.cloudRole]=t.DefaultRoleName,this.tags["ai.device.osArchitecture"]=kr&&kr.arch(),this.tags["ai.device.osPlatform"]=kr&&kr.platform()},t.prototype._loadInternalContext=function(){var e=nT.resolve(__dirname,"../../package.json");if(!t.sdkVersion){t.sdkVersion="unknown";try{var r=JSON.parse(rT.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.sdkVersion=r.version)}catch(n){iT.info("unable to read app version: ",n)}}this.tags[this.keys.internalSdkVersion]="node:"+t.sdkVersion},t.DefaultRoleName="Web",t.appVersion={},t.sdkVersion=null,t}();sT.exports=RO});var oT=d((yd,aT)=>{"use strict";var qO=yd&&yd.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qt=require("url"),md=_t(),OO=yt(),NO=Hi(),LO=Df(),MO=On(),HO=function(t){qO(e,t);function e(r,n){var i=t.call(this)||this;return n&&n.method&&r&&(i.method=n.method,i.url=e._getUrlFromRequestOptions(r,n),i.startTime=+new Date),i}return e.prototype.onError=function(r){this._setStatus(void 0,r)},e.prototype.onResponse=function(r){this._setStatus(r.statusCode,void 0),this.correlationId=OO.getCorrelationContextTarget(r,NO.requestContextTargetKey)},e.prototype.getDependencyTelemetry=function(r,n){var i=Qt.parse(this.url);i.search=void 0,i.hash=void 0;var s=this.method.toUpperCase()+" "+i.pathname,a=md.RemoteDependencyDataConstants.TYPE_HTTP,o=i.hostname;i.port&&(o+=":"+i.port),this.correlationId?(a=md.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==MO.correlationIdPrefix&&(o+=" | "+this.correlationId)):a=md.RemoteDependencyDataConstants.TYPE_HTTP;var c={id:n,name:s,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:a,target:o};if(r&&r.time?c.time=r.time:this.startTime&&(c.time=new Date(this.startTime)),r){for(var u in r)c[u]||(c[u]=r[u]);if(r.properties)for(var u in r.properties)c.properties[u]=r.properties[u]}return c},e._getUrlFromRequestOptions=function(r,n){if(typeof r=="string")if(r.indexOf("http://")===0||r.indexOf("https://")===0)r=Qt.parse(r);else{var i=Qt.parse(r);i.host==="443"?r=Qt.parse("https://"+r):r=Qt.parse("http://"+r)}else{if(r&&typeof Qt.URL=="function"&&r instanceof Qt.URL)return Qt.format(r);var s=r;r={},s&&Object.keys(s).forEach(function(c){r[c]=s[c]})}if(r.path){var a=Qt.parse(r.path);r.pathname=a.pathname,r.search=a.search}if(r.host&&r.port){var o=Qt.parse("http://"+r.host);!o.port&&r.port&&(r.hostname=r.host,delete r.host)}return r.protocol=r.protocol||n.agent&&n.agent.protocol||n.protocol||void 0,r.hostname=r.hostname||"localhost",Qt.format(r)},e}(LO);aT.exports=HO});var uT=d(Oa=>{"use strict";var cT=Oa&&Oa.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Oa,"__esModule",{value:!0});var FO=ac(),ht=Wr();function _d(t){var e=cT({},t);return Object.keys(ht.SpanAttribute).forEach(function(r){delete e[r]}),e}function jO(t){var e="|"+t.context().traceId+"."+t.context().spanId+".",r=Math.round(t._duration[0]*1e3+t._duration[1]/1e6),n=t.attributes["peer.address"]?t.attributes["peer.address"].toString():"",i=t.attributes.component?t.attributes.component.toString():"",s=i.toUpperCase()===ht.DependencyTypeName.Http||!!t.attributes[ht.SpanAttribute.HttpUrl],a=i.toLowerCase()===ht.DependencyTypeName.Grpc;if(s){var o=t.attributes[ht.SpanAttribute.HttpMethod]||"GET",c=new URL(t.attributes[ht.SpanAttribute.HttpUrl].toString()),u=t.attributes[ht.SpanAttribute.HttpHost]||c.host,l=t.attributes[ht.SpanAttribute.HttpPort]||c.port||null,p=c.pathname||"/",f=o+" "+p,h=ht.DependencyTypeName.Http,v=l?(u+":"+l).toString():u.toString(),C=c.toString(),I=t.attributes[ht.SpanAttribute.HttpStatusCode]||t.status.code||0,w=I<400;return{id:e,name:f,dependencyTypeName:h,target:v,data:C,success:w,duration:r,url:C,resultCode:String(I),properties:_d(t.attributes)}}else if(a){var o=t.attributes[ht.SpanAttribute.GrpcMethod]||"rpc",m=t.attributes[ht.SpanAttribute.GrpcService],x=m?o+" "+m:t.name;return{id:e,duration:r,name:x,target:m.toString(),data:m.toString()||x,url:m.toString()||x,dependencyTypeName:ht.DependencyTypeName.Grpc,resultCode:String(t.status.code||0),success:t.status.code===0,properties:_d(t.attributes)}}else{var V=t.name,B=t.links&&t.links.map(function(ne){return{operation_Id:ne.context.traceId,id:ne.context.spanId}});return{id:e,duration:r,name:V,target:n,data:n||V,url:n||V,dependencyTypeName:t.kind===FO.SpanKind.INTERNAL?ht.DependencyTypeName.InProc:i||t.name,resultCode:String(t.status.code||0),success:t.status.code===0,properties:cT({},_d(t.attributes),{"_MS.links":B||void 0})}}}Oa.spanToTelemetryContract=jO});var pT=d(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});var lT=Te(),UO=ya(),$O=uT(),Wc=ac(),Gi=[];zi.subscriber=function(t){var e=t.data,r=$O.spanToTelemetryContract(e),n=e.context(),i=new UO;i.traceId=n.traceId,i.spanId=n.spanId,i.traceFlag=n.traceFlags.toString(),i.parentId=e.parentSpanId?"|"+n.traceId+"."+e.parentSpanId+".":null,Wc.AsyncScopeManager.with(e,function(){Gi.forEach(function(s){e.kind===Wc.SpanKind.SERVER?s.trackRequest(r):(e.kind===Wc.SpanKind.CLIENT||e.kind===Wc.SpanKind.INTERNAL)&&s.trackDependency(r)})})};function VO(t,e){t?(Gi.length===0&&lT.channel.subscribe("azure-coretracing",zi.subscriber),Gi.push(e)):(Gi=Gi.filter(function(r){return r!=e}),Gi.length===0&&lT.channel.unsubscribe("azure-coretracing",zi.subscriber))}zi.enable=VO});var dT=d(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});var fT=Te(),Qi=[];Wi.subscriber=function(t){t.data.event.commandName!=="ismaster"&&Qi.forEach(function(e){var r=t.data.startedData&&t.data.startedData.databaseName||"Unknown database";e.trackDependency({target:r,data:t.data.event.commandName,name:t.data.event.commandName,duration:t.data.event.duration,success:t.data.succeeded,resultCode:t.data.succeeded?"0":"1",time:t.data.startedData.time,dependencyTypeName:"mongodb"})})};function BO(t,e){t?(Qi.length===0&&fT.channel.subscribe("mongodb",Wi.subscriber),Qi.push(e)):(Qi=Qi.filter(function(r){return r!=e}),Qi.length===0&&fT.channel.unsubscribe("mongodb",Wi.subscriber))}Wi.enable=BO});var vT=d(Ki=>{"use strict";Object.defineProperty(Ki,"__esModule",{value:!0});var hT=Te(),Xi=[];Ki.subscriber=function(t){Xi.forEach(function(e){var r=t.data.query||{},n=r.sql||"Unknown query",i=!t.data.err,s=r._connection||{},a=s.config||{},o=a.socketPath?a.socketPath:(a.host||"localhost")+":"+a.port;e.trackDependency({target:o,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"mysql"})})};function GO(t,e){t?(Xi.length===0&&hT.channel.subscribe("mysql",Ki.subscriber),Xi.push(e)):(Xi=Xi.filter(function(r){return r!=e}),Xi.length===0&&hT.channel.unsubscribe("mysql",Ki.subscriber))}Ki.enable=GO});var mT=d(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});var gT=Te(),Yi=[];Ji.subscriber=function(t){Yi.forEach(function(e){t.data.commandObj.command!=="info"&&e.trackDependency({target:t.data.address,name:t.data.commandObj.command,data:t.data.commandObj.command,duration:t.data.duration,success:!t.data.err,resultCode:t.data.err?"1":"0",time:t.data.time,dependencyTypeName:"redis"})})};function zO(t,e){t?(Yi.length===0&&gT.channel.subscribe("redis",Ji.subscriber),Yi.push(e)):(Yi=Yi.filter(function(r){return r!=e}),Yi.length===0&&gT.channel.unsubscribe("redis",Ji.subscriber))}Ji.enable=zO});var _T=d(es=>{"use strict";Object.defineProperty(es,"__esModule",{value:!0});var yT=Te(),Zi=[];es.subscriber=function(t){Zi.forEach(function(e){var r=t.data.query,n=r.preparable&&r.preparable.text||r.plan||r.text||"unknown query",i=!t.data.error,s=t.data.database.host+":"+t.data.database.port;e.trackDependency({target:s,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"postgres"})})};function QO(t,e){t?(Zi.length===0&&yT.channel.subscribe("postgres",es.subscriber),Zi.push(e)):(Zi=Zi.filter(function(r){return r!=e}),Zi.length===0&&yT.channel.unsubscribe("postgres",es.subscriber))}es.enable=QO});var rs=d((Yj,bT)=>{"use strict";var Vn=require("http"),ts=require("https"),Cd=Me(),CT=yt(),Xr=Hi(),WO=oT(),ET=An(),TT=On(),Ed=ya(),XO=bc(),KO=function(){function t(e){if(t.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,this._isEnabled&&!this._isInitialized&&this._initialize(),XO.IsInitialized&&(pT().enable(!0,this._client),dT().enable(e,this._client),vT().enable(e,this._client),mT().enable(e,this._client),_T().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=Vn.get,n=Vn.request,i=ts.request,s=function(a,o){var c=!o[t.disableCollectionRequestOption]&&!a[t.alreadyAutoCollectedFlag];o.headers&&o.headers["user-agent"]&&o.headers["user-agent"].toString().indexOf("azsdk-js")!==-1&&(c=!1),a[t.alreadyAutoCollectedFlag]=!0,a&&o&&c&&(ET.CorrelationContextManager.wrapEmitter(a),t.trackRequest(e._client,{options:o,request:a}))};Vn.request=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=n.call.apply(n,[Vn,a].concat(o));return s(u,a),u},ts.request=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=i.call.apply(i,[ts,a].concat(o));return s(u,a),u},Vn.get=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=(l=Vn.request).call.apply(l,[Vn,a].concat(o));return u.end(),u;var l},ts.get=function(a){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];var u=(l=ts.request).call.apply(l,[ts,a].concat(o));return u.end(),u;var l}},t.trackRequest=function(e,r){if(!r.options||!r.request||!e){Cd.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!r.options,!r.request,!e);return}var n=new WO(r.options,r.request),i=ET.CorrelationContextManager.getCurrentContext(),s,a;if(i&&i.operation&&i.operation.traceparent&&Ed.isValidTraceId(i.operation.traceparent.traceId))i.operation.traceparent.updateSpanId(),s=i.operation.traceparent.getBackCompatRequestId();else if(TT.w3cEnabled){var o=new Ed;a=o.toString(),s=o.getBackCompatRequestId()}else s=i&&i.operation&&i.operation.parentId+t.requestNumber+++".";if(CT.canIncludeCorrelationHeader(e,n.getUrl())&&r.request.getHeader&&r.request.setHeader&&e.config&&e.config.correlationId){var c=r.request.getHeader(Xr.requestContextHeader);try{CT.safeIncludeCorrelationHeader(e,r.request,c)}catch(p){Cd.warn("Request-Context header could not be set. Correlation of requests may be lost",p)}if(i&&i.operation)try{if(r.request.setHeader(Xr.requestIdHeader,s),e.config.ignoreLegacyHeaders||(r.request.setHeader(Xr.parentIdHeader,i.operation.id),r.request.setHeader(Xr.rootIdHeader,s)),a||i.operation.traceparent)r.request.setHeader(Xr.traceparentHeader,a||i.operation.traceparent.toString());else if(TT.w3cEnabled){var o=new Ed().toString();r.request.setHeader(Xr.traceparentHeader,o)}if(i.operation.tracestate){var u=i.operation.tracestate.toString();u&&r.request.setHeader(Xr.traceStateHeader,u)}var l=i.customProperties.serializeToHeader();l&&r.request.setHeader(Xr.correlationContextHeader,l)}catch(p){Cd.warn("Correlation headers could not be set. Correlation of requests may be lost.",p)}}r.request.on&&(r.request.on("response",function(p){n.onResponse(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects["http.ClientResponse"]=p,e.trackDependency(f)}),r.request.on("error",function(p){n.onError(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects.Error=p,e.trackDependency(f)}))},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.disableCollectionRequestOption="disableAppInsightsAutoCollection",t.requestNumber=1,t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();bT.exports=KO});var xT=d((Jj,wT)=>{"use strict";var YO=require("os"),IT=Wr(),JO=yt(),ZO=qa(),eN=rs(),tN="http://169.254.169.254/metadata/instance/compute",rN="api-version=2017-12-01",nN="format=json",iN="ENETUNREACH",sN=function(){function t(e){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._handle=setInterval(function(){return n.trackHeartBeat(r,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackHeartBeat=function(e,r){var n=this,i=!1,s={},a=ZO.sdkVersion;s.sdk=a,s.osType=YO.type(),process.env.WEBSITE_SITE_NAME?(s.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",s.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",s.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?s.azfunction_appId=process.env.WEBSITE_HOSTNAME:e&&(this._isVM===void 0?(i=!0,this._getAzureComputeMetadata(e,function(){n._isVM&&Object.keys(n._vmData).length>0&&(s.azInst_vmId=n._vmData.vmId||"",s.azInst_subscriptionId=n._vmData.subscriptionId||"",s.azInst_osType=n._vmData.osType||"",n._azInst_vmId=n._vmData.vmId||"",n._azInst_subscriptionId=n._vmData.subscriptionId||"",n._azInst_osType=n._vmData.osType||""),n._client.trackMetric({name:IT.HeartBeatMetricName,value:0,properties:s}),r()})):this._isVM&&(s.azInst_vmId=this._azInst_vmId,s.azInst_subscriptionId=this._azInst_subscriptionId,s.azInst_osType=this._azInst_osType)),i||(this._client.trackMetric({name:IT.HeartBeatMetricName,value:0,properties:s}),r())},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.prototype._getAzureComputeMetadata=function(e,r){var n=this,i=tN+"?"+rN+"&"+nN,s=(o={method:"GET"},o[eN.disableCollectionRequestOption]=!0,o.headers={Metadata:"True"},o),a=JO.makeRequest(e,i,s,function(c){if(c.statusCode===200){n._isVM=!0;var u="";c.on("data",function(l){u+=l}),c.on("end",function(){n._vmData=n._isJSON(u)?JSON.parse(u):{},r()})}else r()});a&&(a.on("error",function(c){c&&c.message&&c.message.indexOf(iN)>-1&&(n._isVM=!1),r()}),a.end());var o},t.prototype._isJSON=function(e){try{return JSON.parse(e)&&!!e}catch{return!1}},t}();wT.exports=sN});var bd=d((Zj,DT)=>{"use strict";var ST=require("http"),AT=require("https"),PT=Me(),kT=yt(),aN=Hi(),Td=Of(),Dr=An(),oN=Qc(),cN=function(){function t(e){if(t.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,(this._isAutoCorrelating||this._isEnabled||oN.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},t.prototype.useAutoCorrelation=function(e,r){e&&!this._isAutoCorrelating?Dr.CorrelationContextManager.enable(r):!e&&this._isAutoCorrelating&&Dr.CorrelationContextManager.disable(),this._isAutoCorrelating=e},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},t.prototype._generateCorrelationContext=function(e){if(!!this._isAutoCorrelating)return Dr.CorrelationContextManager.generateContextObject(e.getOperationId(this._client.context.tags),e.getRequestId(),e.getOperationName(this._client.context.tags),e.getCorrelationContextHeader(),e.getTraceparent(),e.getTracestate())},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=function(a){if(!!a){if(typeof a!="function")throw new Error("onRequest handler must be a function");return function(o,c){Dr.CorrelationContextManager.wrapEmitter(o),Dr.CorrelationContextManager.wrapEmitter(c);var u=o&&!o[t.alreadyAutoCollectedFlag];if(o&&u){var l=new Td(o),p=e._generateCorrelationContext(l);Dr.CorrelationContextManager.runWithContext(p,function(){e._isEnabled&&(o[t.alreadyAutoCollectedFlag]=!0,t.trackRequest(e._client,{request:o,response:c},l)),typeof a=="function"&&a(o,c)})}else typeof a=="function"&&a(o,c)}}},n=function(a){var o=a.addListener.bind(a);a.addListener=function(c,u){switch(c){case"request":case"checkContinue":return o(c,r(u));default:return o(c,u)}},a.on=a.addListener},i=ST.createServer;ST.createServer=function(a,o){if(o&&typeof o=="function"){var c=i(a,r(o));return n(c),c}else{var c=i(r(a));return n(c),c}};var s=AT.createServer;AT.createServer=function(a,o){var c=s(a,r(o));return n(c),c}},t.trackRequestSync=function(e,r){if(!r.request||!r.response||!e){PT.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!r.request,!r.response,!e);return}t.addResponseCorrelationIdHeader(e,r.response);var n=Dr.CorrelationContextManager.getCurrentContext(),i=new Td(r.request,n&&n.operation.parentId);n&&(n.operation.id=i.getOperationId(e.context.tags)||n.operation.id,n.operation.name=i.getOperationName(e.context.tags)||n.operation.name,n.operation.parentId=i.getRequestId()||n.operation.parentId,n.customProperties.addHeaderData(i.getCorrelationContextHeader())),t.endRequest(e,i,r,r.duration,r.error)},t.trackRequest=function(e,r,n){if(!r.request||!r.response||!e){PT.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!r.request,!r.response,!e);return}var i=Dr.CorrelationContextManager.getCurrentContext(),s=n||new Td(r.request,i&&i.operation.parentId);kT.canIncludeCorrelationHeader(e,s.getUrl())&&t.addResponseCorrelationIdHeader(e,r.response),i&&!n&&(i.operation.id=s.getOperationId(e.context.tags)||i.operation.id,i.operation.name=s.getOperationName(e.context.tags)||i.operation.name,i.operation.parentId=s.getOperationParentId(e.context.tags)||i.operation.parentId,i.customProperties.addHeaderData(s.getCorrelationContextHeader())),r.response.once&&r.response.once("finish",function(){t.endRequest(e,s,r,null,null)}),r.request.on&&r.request.on("error",function(a){t.endRequest(e,s,r,null,a)})},t.addResponseCorrelationIdHeader=function(e,r){if(e.config&&e.config.correlationId&&r.getHeader&&r.setHeader&&!r.headersSent){var n=r.getHeader(aN.requestContextHeader);kT.safeIncludeCorrelationHeader(e,r,n)}},t.endRequest=function(e,r,n,i,s){s?r.onError(s,i):r.onResponse(n.response,i);var a=r.getRequestTelemetry(n);if(a.tagOverrides=r.getRequestTags(e.context.tags),n.tagOverrides)for(var o in n.tagOverrides)a.tagOverrides[o]=n.tagOverrides[o];var c=r.getLegacyRootId();c&&(a.properties.ai_legacyRootId=c),a.contextObjects=a.contextObjects||{},a.contextObjects["http.ServerRequest"]=n.request,a.contextObjects["http.ServerResponse"]=n.response,e.trackRequest(a)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1,Dr.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();DT.exports=cN});var OT=d((eU,qT)=>{"use strict";var RT=Wr(),uN=function(){function t(){}return t.parse=function(e){if(!e)return{};var r=e.split(t._FIELDS_SEPARATOR),n=r.reduce(function(s,a){var o=a.split(t._FIELD_KEY_VALUE_SEPARATOR);if(o.length===2){var c=o[0].toLowerCase(),u=o[1];s[c]=u}return s},{});if(Object.keys(n).length>0){if(n.endpointsuffix){var i=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+i+"dc."+n.endpointsuffix,n.liveendpoint=n.liveendpoint||"https://"+i+"live."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||RT.DEFAULT_BREEZE_ENDPOINT,n.liveendpoint=n.liveendpoint||RT.DEFAULT_LIVEMETRICS_ENDPOINT}return n},t._FIELDS_SEPARATOR=";",t._FIELD_KEY_VALUE_SEPARATOR="=",t}();qT.exports=uN});var Xc=d((tU,MT)=>{"use strict";var Id=On(),NT=OT(),lN=Me(),LT=Wr(),pN=require("url"),fN=function(){function t(e){var r=this;this.endpointBase=LT.DEFAULT_BREEZE_ENDPOINT;var n=process.env[t.ENV_connectionString],i=NT.parse(e),s=NT.parse(n),a=!i.instrumentationkey&&Object.keys(i).length>0?null:e;this.instrumentationKey=i.instrumentationkey||a||s.instrumentationkey||t._getInstrumentationKey(),t._validateInstrumentationKey(this.instrumentationKey)||lN.warn("An invalid instrumentation key was provided. There may be resulting telemetry loss",this.instrumentationKey),this.endpointUrl=(i.ingestionendpoint||s.ingestionendpoint||this.endpointBase)+"/v2/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=30*1e3,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(o){return r.correlationId=o},this.proxyHttpUrl=process.env[t.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[t.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=i.ingestionendpoint||s.ingestionendpoint||process.env[t.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=i.liveendpoint||s.liveendpoint||process.env[t.ENV_quickPulseHost]||LT.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=pN.parse(this._quickPulseHost).host)}return Object.defineProperty(t.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(e){Id.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=e,this.correlationId=Id.correlationIdPrefix,Id.queryCorrelationId(this,this.setCorrelationId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(e){this._quickPulseHost=e},enumerable:!0,configurable:!0}),t._getInstrumentationKey=function(){var e=process.env[t.ENV_iKey]||process.env[t.ENV_azurePrefix+t.ENV_iKey]||process.env[t.legacy_ENV_iKey]||process.env[t.ENV_azurePrefix+t.legacy_ENV_iKey];if(!e||e=="")throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return e},t._validateInstrumentationKey=function(e){var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(e)},t.ENV_azurePrefix="APPSETTING_",t.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",t.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",t.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",t.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",t.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",t.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",t.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",t.ENV_http_proxy="http_proxy",t.ENV_https_proxy="https_proxy",t}();MT.exports=fN});var jT=d((xd,FT)=>{"use strict";var Na=xd&&xd.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},wd=require("os"),Bn=_t(),HT=Wr(),dN=yt(),hN=Me(),vN=dN.w3cTraceId(),gN=function(){function t(){}return t.createQuickPulseEnvelope=function(e,r,n,i){var s=wd&&typeof wd.hostname=="function"&&wd.hostname()||"Unknown",a=i.tags&&i.keys&&i.keys.cloudRoleInstance&&i.tags[i.keys.cloudRoleInstance]||s,o={Documents:r.length>0?r:null,InstrumentationKey:n.instrumentationKey||"",Metrics:e.length>0?e:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:i.tags[i.keys.internalSdkVersion],StreamId:vN,MachineName:s,Instance:a};return o},t.createQuickPulseMetric=function(e){var r;return r={Name:e.name,Value:e.value,Weight:e.count||1},r},t.telemetryEnvelopeToQuickPulseDocument=function(e){switch(e.data.baseType){case Bn.TelemetryTypeString.Event:return t.createQuickPulseEventDocument(e);case Bn.TelemetryTypeString.Exception:return t.createQuickPulseExceptionDocument(e);case Bn.TelemetryTypeString.Trace:return t.createQuickPulseTraceDocument(e);case Bn.TelemetryTypeString.Dependency:return t.createQuickPulseDependencyDocument(e);case Bn.TelemetryTypeString.Request:return t.createQuickPulseRequestDocument(e)}return null},t.createQuickPulseEventDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.name,i=Na({},r,{Name:n});return i},t.createQuickPulseTraceDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.severityLevel||0,i=Na({},r,{Message:e.data.baseData.message,SeverityLevel:Bn.SeverityLevel[n]});return i},t.createQuickPulseExceptionDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.exceptions,i="",s="",a="";n&&n.length>0&&(n[0].parsedStack&&n[0].parsedStack.length>0?n[0].parsedStack.forEach(function(c){i+=c.assembly+`
`}):n[0].stack&&n[0].stack.length>0&&(i=n[0].stack),s=n[0].message,a=n[0].typeName);var o=Na({},r,{Exception:i,ExceptionMessage:s,ExceptionType:a});return o},t.createQuickPulseRequestDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=Na({},r,{Name:n.name,Success:n.success,Duration:n.duration,ResponseCode:n.responseCode,OperationName:n.name});return i},t.createQuickPulseDependencyDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=Na({},r,{Name:n.name,Target:n.target,Success:n.success,Duration:n.duration,ResultCode:n.resultCode,CommandName:n.data,OperationName:r.OperationId,DependencyTypeName:n.type});return i},t.createQuickPulseDocument=function(e){var r,n,i,s;e.data.baseType?(n=HT.TelemetryTypeStringToQuickPulseType[e.data.baseType],r=HT.TelemetryTypeStringToQuickPulseDocumentType[e.data.baseType]):hN.warn("Document type invalid; not sending live metric document",e.data.baseType),i=e.tags[t.keys.operationId],s=t.aggregateProperties(e);var a={DocumentType:r,__type:n,OperationId:i,Version:"1.0",Properties:s};return a},t.aggregateProperties=function(e){var r=[],n=e.data.baseData.measurements||{};for(var i in n)if(n.hasOwnProperty(i)){var s=n[i],a={key:i,value:s};r.push(a)}var o=e.data.baseData.properties||{};for(var i in o)if(o.hasOwnProperty(i)){var s=o[i],a={key:i,value:s};r.push(a)}return r},t.keys=new Bn.ContextTagKeys,t}();FT.exports=gN});var $T=d((rU,UT)=>{"use strict";var mN=function(){return(Date.now()+621355968e5)*1e4};UT.exports={getTransmissionTime:mN}});var GT=d((nU,BT)=>{"use strict";var yN=require("https"),_N=rs(),VT=Me(),CN=$T(),EN=yt(),Sd={method:"POST",time:"x-ms-qps-transmission-time",subscribed:"x-ms-qps-subscribed"},TN=function(){function t(e){this._config=e,this._consecutiveErrors=0}return t.prototype.ping=function(e,r){this._submitData(e,r,"ping")},t.prototype.post=function(e,r){this._submitData([e],r,"post")},t.prototype._submitData=function(e,r,n){var i=this,s=JSON.stringify(e),a=(c={},c[_N.disableCollectionRequestOption]=!0,c.host=this._config.quickPulseHost,c.method=Sd.method,c.path="/QuickPulseService.svc/"+n+"?ikey="+this._config.instrumentationKey,c.headers=(u={Expect:"100-continue"},u[Sd.time]=CN.getTransmissionTime(),u["Content-Type"]="application/json",u["Content-Length"]=Buffer.byteLength(s),u),c);this._config.httpsAgent?a.agent=this._config.httpsAgent:a.agent=EN.tlsRestrictedAgent;var o=yN.request(a,function(l){var p=l.headers[Sd.subscribed]==="true";i._consecutiveErrors=0,r(p,l)});o.on("error",function(l){i._consecutiveErrors++;var p="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";i._consecutiveErrors%t.MAX_QPS_FAILURES_BEFORE_WARN===0?(p="Live Metrics endpoint could not be reached "+i._consecutiveErrors+" consecutive times. Most recent error:",VT.warn(t.TAG,p,l)):VT.info(t.TAG,p,l),r()}),o.write(s),o.end();var c,u},t.TAG="QuickPulseSender",t.MAX_QPS_FAILURES_BEFORE_WARN=25,t}();BT.exports=TN});var QT=d((iU,zT)=>{"use strict";var bN=Me(),IN=Xc(),Ad=jT(),wN=GT(),xN=Wr(),SN=qa(),AN=function(){function t(e,r){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this.config=new IN(e),this.context=r||new SN,this._sender=new wN(this.config),this._isEnabled=!1}return t.prototype.addCollector=function(e){this._collectors.push(e)},t.prototype.trackMetric=function(e){this._addMetric(e)},t.prototype.addDocument=function(e){var r=Ad.telemetryEnvelopeToQuickPulseDocument(e);r&&this._documents.push(r)},t.prototype.enable=function(e){e&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!e&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},t.prototype.enableCollectors=function(e){this._collectors.forEach(function(r){r.enable(e)})},t.prototype._addMetric=function(e){var r=e.value,n=e.count||1,i=xN.PerformanceToQuickPulseCounter[e.name];i&&(this._metrics[i]?(this._metrics[i].Value=(this._metrics[i].Value*this._metrics[i].Weight+r*n)/(this._metrics[i].Weight+n),this._metrics[i].Weight+=n):(this._metrics[i]=Ad.createQuickPulseMetric(e),this._metrics[i].Name=i,this._metrics[i].Weight=1))},t.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},t.prototype._goQuickPulse=function(){var e=this,r=Object.keys(this._metrics).map(function(s){return e._metrics[s]}),n=Ad.createQuickPulseEnvelope(r,this._documents.slice(),this.config,this.context);this._resetQuickPulseBuffer(),this._isCollectingData?this._post(n):this._ping(n);var i=this._isCollectingData?t.POST_INTERVAL:t.PING_INTERVAL;this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,i=t.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(i=t.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),i),this._handle.unref()},t.prototype._ping=function(e){this._sender.ping(e,this._quickPulseDone.bind(this))},t.prototype._post=function(e){this._sender.post(e,this._quickPulseDone.bind(this))},t.prototype._quickPulseDone=function(e,r){e!=null?(this._isCollectingData!==e&&(bN.info("Live Metrics sending data",e),this.enableCollectors(e)),this._isCollectingData=e,r&&r.statusCode<300&&r.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},t.MAX_POST_WAIT_TIME=2e4,t.MAX_PING_WAIT_TIME=6e4,t.FALLBACK_INTERVAL=6e4,t.PING_INTERVAL=5e3,t.POST_INTERVAL=1e3,t}();zT.exports=AN});var XT=d(Ma=>{"use strict";var PN=Ma&&Ma.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Ma,"__esModule",{value:!0});var WT=Xc(),La=qa(),kN=Me(),DN=function(){function t(e){this._disabledMetrics={},t.INSTANCE&&t.INSTANCE.dispose(),t.INSTANCE=this,this._client=e}return t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>=6},t.prototype.enable=function(e,r,n){var i=this;if(r===void 0&&(r={}),n===void 0&&(n=6e4),!!t.isNodeVersionCompatible()){if(t._metricsAvailable==null&&e&&!this._isInitialized)try{var s=require("applicationinsights-native-metrics");t._emitter=new s,t._metricsAvailable=!0,kN.info("Native metrics module successfully loaded!")}catch{t._metricsAvailable=!1;return}this._isEnabled=e,this._disabledMetrics=r,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&t._emitter?(t._emitter.enable(!0,n),this._handle=setInterval(function(){return i._trackNativeMetrics()},n),this._handle.unref()):t._emitter&&(t._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},t.prototype.dispose=function(){this.enable(!1)},t.parseEnabled=function(e){var r=process.env[WT.ENV_nativeMetricsDisableAll],n=process.env[WT.ENV_nativeMetricsDisablers];if(r)return{isEnabled:!1,disabledMetrics:{}};if(n){var i=n.split(","),s={};if(i.length>0)for(var a=0,o=i;a<o.length;a++){var c=o[a];s[c]=!0}return typeof e=="object"?{isEnabled:!0,disabledMetrics:PN({},e,s)}:{isEnabled:e,disabledMetrics:s}}return typeof e=="boolean"?{isEnabled:e,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:e}},t.prototype._trackNativeMetrics=function(){var e=!0;typeof this._isEnabled!="object"&&(e=this._isEnabled),e&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},t.prototype._trackGarbageCollection=function(){if(!this._disabledMetrics.gc){var e=t._emitter.getGCData();for(var r in e){var n=e[r].metrics,i=r+" Garbage Collection Duration",s=Math.sqrt(n.sumSquares/n.count-Math.pow(n.total/n.count,2))||0;this._client.trackMetric({name:i,value:n.total,count:n.count,max:n.max,min:n.min,stdDev:s,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+La.sdkVersion,a)})}var a}},t.prototype._trackEventLoop=function(){if(!this._disabledMetrics.loop){var e=t._emitter.getLoopData(),r=e.loopUsage;if(r.count!=0){var n="Event Loop CPU Time",i=Math.sqrt(r.sumSquares/r.count-Math.pow(r.total/r.count,2))||0;this._client.trackMetric({name:n,value:r.total,count:r.count,min:r.min,max:r.max,stdDev:i,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+La.sdkVersion,s)});var s}}},t.prototype._trackHeapUsage=function(){if(!this._disabledMetrics.heap){var e=process.memoryUsage(),r=e.heapUsed,n=e.heapTotal,i=e.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:r,count:1,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+La.sdkVersion,s)}),this._client.trackMetric({name:"Memory Total (Heap)",value:n,count:1,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+La.sdkVersion,a)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:i-n,count:1,tagOverrides:(o={},o[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+La.sdkVersion,o)});var s,a,o}},t}();Ma.AutoCollectNativePerformance=DN});var JT=d((aU,YT)=>{"use strict";var KT=Me(),RN=function(){function t(e,r,n,i){this._buffer=[],this._lastSend=0,this._isDisabled=e,this._getBatchSize=r,this._getBatchIntervalMs=n,this._sender=i}return t.prototype.setUseDiskRetryCaching=function(e,r,n){this._sender.setDiskRetryMode(e,r,n)},t.prototype.send=function(e){var r=this;if(!this._isDisabled()){if(!e){KT.warn("Cannot send null/undefined telemetry");return}var n=this._stringify(e);if(typeof n=="string"){if(this._buffer.push(n),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){r._timeoutHandle=null,r.triggerSend(!1)},this._getBatchIntervalMs()))}}},t.prototype.triggerSend=function(e,r){var n=this._buffer.length<1;if(!n){var i=this._buffer.join(`
`);e?(this._sender.saveOnCrash(i),typeof r=="function"&&r("data saved on crash")):this._sender.send(Buffer.from?Buffer.from(i):new Buffer(i),r)}this._lastSend=+new Date,this._buffer.length=0,clearTimeout(this._timeoutHandle),this._timeoutHandle=null,n&&typeof r=="function"&&r("no data to send")},t.prototype._stringify=function(e){try{return JSON.stringify(e)}catch(r){KT.warn("Failed to serialize payload",r,e)}},t}();YT.exports=RN});var ZT=d(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});function qN(t,e){process.env.WEBSITE_SITE_NAME&&(t.tags[e.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}Pd.azureRoleEnvironmentTelemetryProcessor=qN});var rb=d(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});var eb=_t();function ON(t,e){var r=t.sampleRate,n=!1;return r==null||r>=100||t.data&&eb.TelemetryType.Metric===eb.baseTypeToTelemetryType(t.data.baseType)?!0:(e.correlationContext&&e.correlationContext.operation?n=tb(e.correlationContext.operation.id)<r:n=Math.random()*100<r,n)}Kc.samplingTelemetryProcessor=ON;function tb(t){var e=-2147483648,r=2147483647,n=5381;if(!t)return 0;for(;t.length<8;)t=t+t;for(var i=0;i<t.length;i++)n=((n<<5)+n|0)+t.charCodeAt(i)|0;return n=n<=e?r:Math.abs(n),n/r*100}Kc.getSamplingHashCode=tb});var nb=d(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});var kd=Qc(),Dd=_t();function NN(t,e){switch(e&&e.addDocument(t),t.data.baseType){case Dd.TelemetryTypeString.Exception:kd.countException();break;case Dd.TelemetryTypeString.Request:var r=t.data.baseData;kd.countRequest(r.duration,r.success);break;case Dd.TelemetryTypeString.Dependency:var n=t.data.baseData;kd.countDependency(n.duration,n.success);break}return!0}Rd.performanceMetricsTelemetryProcessor=NN});var ib=d(Yc=>{"use strict";function qd(t){for(var e in t)Yc.hasOwnProperty(e)||(Yc[e]=t[e])}Object.defineProperty(Yc,"__esModule",{value:!0});qd(ZT());qd(rb());qd(nb())});var ab=d((pU,sb)=>{"use strict";var at=require("fs"),Jc=require("os"),Rr=require("path"),LN=require("zlib"),ns=require("child_process"),Je=Me(),MN=rs(),HN=yt(),FN=function(){function t(e,r,n){if(this._config=e,this._onSuccess=r,this._onError=n,this._enableDiskRetryMode=!1,this._resendInterval=t.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=t.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._resendTimer=null,!t.OS_PROVIDES_FILE_PROTECTION)if(t.USE_ICACLS){try{t.OS_PROVIDES_FILE_PROTECTION=at.existsSync(t.ICACLS_PATH)}catch{}t.OS_PROVIDES_FILE_PROTECTION||Je.warn(t.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else t.OS_PROVIDES_FILE_PROTECTION=!0}return t.prototype.setDiskRetryMode=function(e,r,n){this._enableDiskRetryMode=t.OS_PROVIDES_FILE_PROTECTION&&e,typeof r=="number"&&r>=0&&(this._resendInterval=Math.floor(r)),typeof n=="number"&&n>=0&&(this._maxBytesOnDisk=Math.floor(n)),e&&!t.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,Je.warn(t.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected."))},t.prototype.send=function(e,r){var n=this,i=this._config.endpointUrl,s={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}};LN.gzip(e,function(a,o){var c=o;a?(Je.warn(a),c=e,s.headers["Content-Length"]=e.length.toString()):(s.headers["Content-Encoding"]="gzip",s.headers["Content-Length"]=o.length),Je.info(t.TAG,s),s[MN.disableCollectionRequestOption]=!0;var u=function(p){p.setEncoding("utf-8");var f="";p.on("data",function(h){f+=h}),p.on("end",function(){n._numConsecutiveFailures=0,Je.info(t.TAG,f),typeof n._onSuccess=="function"&&n._onSuccess(f),typeof r=="function"&&r(f),n._enableDiskRetryMode&&(p.statusCode===200?n._resendTimer||(n._resendTimer=setTimeout(function(){n._resendTimer=null,n._sendFirstFileOnDisk()},n._resendInterval),n._resendTimer.unref()):(p.statusCode===408||p.statusCode===429||p.statusCode===439||p.statusCode===500||p.statusCode===503)&&n._storeToDisk(e))})},l=HN.makeRequest(n._config,i,s,u);l.on("error",function(p){if(n._numConsecutiveFailures++,!n._enableDiskRetryMode||n._numConsecutiveFailures>0&&n._numConsecutiveFailures%t.MAX_CONNECTION_FAILURES_BEFORE_WARN===0){var f="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";n._enableDiskRetryMode&&(f="Ingestion endpoint could not be reached "+n._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),Je.warn(t.TAG,f,p)}else{var f="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";Je.info(t.TAG,f,p)}if(n._onErrorHelper(p),typeof r=="function"){var h="error sending telemetry";p&&typeof p.toString=="function"&&(h=p.toString()),r(h)}n._enableDiskRetryMode&&n._storeToDisk(e)}),l.write(c),l.end()})},t.prototype.saveOnCrash=function(e){this._enableDiskRetryMode&&this._storeToDiskSync(e)},t.prototype._runICACLS=function(e,r){var n=ns.spawn(t.ICACLS_PATH,e,{windowsHide:!0});n.on("error",function(i){return r(i)}),n.on("close",function(i,s){return r(i===0?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+i+")"))})},t.prototype._runICACLSSync=function(e){if(ns.spawnSync){var r=ns.spawnSync(t.ICACLS_PATH,e,{windowsHide:!0});if(r.error)throw r.error;if(r.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+r.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},t.prototype._getACLIdentity=function(e){if(t.ACL_IDENTITY)return e(null,t.ACL_IDENTITY);var r=ns.spawn(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),n="";r.stdout.on("data",function(i){return n+=i}),r.on("error",function(i){return e(i,null)}),r.on("close",function(i,s){return t.ACL_IDENTITY=n&&n.trim(),e(i===0?null:new Error("Getting ACL identity did not succeed (PS returned code "+i+")"),t.ACL_IDENTITY)})},t.prototype._getACLIdentitySync=function(){if(t.ACL_IDENTITY)return t.ACL_IDENTITY;if(ns.spawnSync){var e=ns.spawnSync(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(e.error)throw e.error;if(e.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+e.status+")");return t.ACL_IDENTITY=e.stdout&&e.stdout.toString().trim(),t.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},t.prototype._getACLArguments=function(e,r){return[e,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",r+":(OI)(CI)F","/inheritance:r"]},t.prototype._applyACLRules=function(e,r){var n=this;if(!t.USE_ICACLS)return r(null);if(t.ACLED_DIRECTORIES[e]===void 0)t.ACLED_DIRECTORIES[e]=!1,this._getACLIdentity(function(i,s){if(i)return t.ACLED_DIRECTORIES[e]=!1,r(i);n._runICACLS(n._getACLArguments(e,s),function(a){return t.ACLED_DIRECTORIES[e]=!a,r(a)})});else return r(t.ACLED_DIRECTORIES[e]?null:new Error("Setting ACL restrictions did not succeed (cached result)"))},t.prototype._applyACLRulesSync=function(e){if(t.USE_ICACLS){if(t.ACLED_DIRECTORIES[e]===void 0){this._runICACLSSync(this._getACLArguments(e,this._getACLIdentitySync())),t.ACLED_DIRECTORIES[e]=!0;return}else if(!t.ACLED_DIRECTORIES[e])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},t.prototype._confirmDirExists=function(e,r){var n=this;at.lstat(e,function(i,s){i&&i.code==="ENOENT"?at.mkdir(e,function(a){a&&a.code!=="EEXIST"?r(a):n._applyACLRules(e,r)}):!i&&s.isDirectory()?n._applyACLRules(e,r):r(i||new Error("Path existed but was not a directory"))})},t.prototype._getShallowDirectorySize=function(e,r){at.readdir(e,function(n,i){if(n)return r(n,-1);var s=null,a=0,o=0;if(i.length===0){r(null,0);return}for(var c=0;c<i.length;c++)at.stat(Rr.join(e,i[c]),function(u,l){o++,u?s=u:l.isFile()&&(a+=l.size),o===i.length&&(s?r(s,-1):r(s,a))})})},t.prototype._getShallowDirectorySizeSync=function(e){for(var r=at.readdirSync(e),n=0,i=0;i<r.length;i++)n+=at.statSync(Rr.join(e,r[i])).size;return n},t.prototype._storeToDisk=function(e){var r=this,n=Rr.join(Jc.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);Je.info(t.TAG,"Checking existence of data storage directory: "+n),this._confirmDirExists(n,function(i){if(i){Je.warn(t.TAG,"Error while checking/creating directory: "+(i&&i.message)),r._onErrorHelper(i);return}r._getShallowDirectorySize(n,function(s,a){if(s||a<0){Je.warn(t.TAG,"Error while checking directory size: "+(s&&s.message)),r._onErrorHelper(s);return}else if(a>r._maxBytesOnDisk){Je.warn(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+a);return}var o=new Date().getTime()+".ai.json",c=Rr.join(n,o);Je.info(t.TAG,"saving data to disk at: "+c),at.writeFile(c,e,{mode:384},function(u){return r._onErrorHelper(u)})})})},t.prototype._storeToDiskSync=function(e){var r=Rr.join(Jc.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);try{Je.info(t.TAG,"Checking existence of data storage directory: "+r),at.existsSync(r)||at.mkdirSync(r),this._applyACLRulesSync(r);var n=this._getShallowDirectorySizeSync(r);if(n>this._maxBytesOnDisk){Je.info(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+n);return}var i=new Date().getTime()+".ai.json",s=Rr.join(r,i);Je.info(t.TAG,"saving data before crash to disk at: "+s),at.writeFileSync(s,e,{mode:384})}catch(a){Je.warn(t.TAG,"Error while saving data to disk: "+(a&&a.message)),this._onErrorHelper(a)}},t.prototype._sendFirstFileOnDisk=function(){var e=this,r=Rr.join(Jc.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);at.exists(r,function(n){n&&at.readdir(r,function(i,s){if(i)e._onErrorHelper(i);else if(s=s.filter(function(c){return Rr.basename(c).indexOf(".ai.json")>-1}),s.length>0){var a=s[0],o=Rr.join(r,a);at.readFile(o,function(c,u){c?e._onErrorHelper(c):at.unlink(o,function(l){l?e._onErrorHelper(l):e.send(u)})})}})})},t.prototype._onErrorHelper=function(e){typeof this._onError=="function"&&this._onError(e)},t.TAG="Sender",t.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",t.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",t.ACLED_DIRECTORIES={},t.ACL_IDENTITY=null,t.WAIT_BETWEEN_RESEND=60*1e3,t.MAX_BYTES_ON_DISK=50*1e3*1e3,t.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,t.TEMPDIR_PREFIX="appInsights-node",t.OS_PROVIDES_FILE_PROTECTION=!1,t.USE_ICACLS=Jc.type()==="Windows_NT",t}();sb.exports=FN});var ub=d((fU,cb)=>{"use strict";var D=_t(),Rt=yt(),jN=An(),UN=function(){function t(){}return t.createEnvelope=function(e,r,n,i,s){var a=null;switch(r){case D.TelemetryType.Trace:a=t.createTraceData(e);break;case D.TelemetryType.Dependency:a=t.createDependencyData(e);break;case D.TelemetryType.Event:a=t.createEventData(e);break;case D.TelemetryType.Exception:a=t.createExceptionData(e);break;case D.TelemetryType.Request:a=t.createRequestData(e);break;case D.TelemetryType.Metric:a=t.createMetricData(e);break;case D.TelemetryType.Availability:a=t.createAvailabilityData(e);break;case D.TelemetryType.PageView:a=t.createPageViewData(e);break}if(n&&D.domainSupportsProperties(a.baseData)){if(a&&a.baseData)if(!a.baseData.properties)a.baseData.properties=n;else for(var o in n)a.baseData.properties[o]||(a.baseData.properties[o]=n[o]);a.baseData.properties=Rt.validateStringMap(a.baseData.properties)}var c=s&&s.instrumentationKey||"",u=new D.Envelope;return u.data=a,u.iKey=c,u.name="Microsoft.ApplicationInsights."+c.replace(/-/g,"")+"."+a.baseType.substr(0,a.baseType.length-4),u.tags=this.getTags(i,e.tagOverrides),u.time=new Date().toISOString(),u.ver=1,u.sampleRate=s?s.samplingPercentage:100,r===D.TelemetryType.Metric&&(u.sampleRate=100),u},t.createTraceData=function(e){var r=new D.MessageData;r.message=e.message,r.properties=e.properties,isNaN(e.severity)?r.severityLevel=D.SeverityLevel.Information:r.severityLevel=e.severity;var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Trace),n.baseData=r,n},t.createDependencyData=function(e){var r=new D.RemoteDependencyData;typeof e.name=="string"&&(r.name=e.name.length>1024?e.name.slice(0,1021)+"...":e.name),r.data=e.data,r.target=e.target,r.duration=Rt.msToTimeSpan(e.duration),r.success=e.success,r.type=e.dependencyTypeName,r.properties=e.properties,r.resultCode=e.resultCode?e.resultCode+"":"",e.id?r.id=e.id:r.id=Rt.w3cTraceId();var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Dependency),n.baseData=r,n},t.createEventData=function(e){var r=new D.EventData;r.name=e.name,r.properties=e.properties,r.measurements=e.measurements;var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Event),n.baseData=r,n},t.createExceptionData=function(e){var r=new D.ExceptionData;r.properties=e.properties,isNaN(e.severity)?r.severityLevel=D.SeverityLevel.Error:r.severityLevel=e.severity,r.measurements=e.measurements,r.exceptions=[];var n=e.exception.stack,i=new D.ExceptionDetails;i.message=e.exception.message,i.typeName=e.exception.name,i.parsedStack=this.parseStack(n),i.hasFullStack=Rt.isArray(i.parsedStack)&&i.parsedStack.length>0,r.exceptions.push(i);var s=new D.Data;return s.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Exception),s.baseData=r,s},t.createRequestData=function(e){var r=new D.RequestData;e.id?r.id=e.id:r.id=Rt.w3cTraceId(),r.name=e.name,r.url=e.url,r.source=e.source,r.duration=Rt.msToTimeSpan(e.duration),r.responseCode=e.resultCode?e.resultCode+"":"",r.success=e.success,r.properties=e.properties;var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Request),n.baseData=r,n},t.createMetricData=function(e){var r=new D.MetricData;r.metrics=[];var n=new D.DataPoint;n.count=isNaN(e.count)?1:e.count,n.kind=D.DataPointType.Aggregation,n.max=isNaN(e.max)?e.value:e.max,n.min=isNaN(e.min)?e.value:e.min,n.name=e.name,n.stdDev=isNaN(e.stdDev)?0:e.stdDev,n.value=e.value,r.metrics.push(n),r.properties=e.properties;var i=new D.Data;return i.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Metric),i.baseData=r,i},t.createAvailabilityData=function(e){var r=new D.AvailabilityData;e.id?r.id=e.id:r.id=Rt.w3cTraceId(),r.name=e.name,r.duration=Rt.msToTimeSpan(e.duration),r.success=e.success,r.runLocation=e.runLocation,r.message=e.message,r.measurements=e.measurements,r.properties=e.properties;var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.Availability),n.baseData=r,n},t.createPageViewData=function(e){var r=new D.PageViewData;r.name=e.name,r.duration=Rt.msToTimeSpan(e.duration),r.url=e.url,r.measurements=e.measurements,r.properties=e.properties;var n=new D.Data;return n.baseType=D.telemetryTypeToBaseType(D.TelemetryType.PageView),n.baseData=r,n},t.getTags=function(e,r){var n=jN.CorrelationContextManager.getCurrentContext(),i={};if(e&&e.tags)for(var s in e.tags)i[s]=e.tags[s];if(r)for(var s in r)i[s]=r[s];return n&&(i[e.keys.operationId]=i[e.keys.operationId]||n.operation.id,i[e.keys.operationName]=i[e.keys.operationName]||n.operation.name,i[e.keys.operationParentId]=i[e.keys.operationParentId]||n.operation.parentId),i},t.parseStack=function(e){var r=void 0;if(typeof e=="string"){var n=e.split(`
`);r=[];for(var i=0,s=0,a=0;a<=n.length;a++){var o=n[a];if(ob.regex.test(o)){var c=new ob(n[a],i++);s+=c.sizeInBytes,r.push(c)}}var u=32*1024;if(s>u)for(var l=0,p=r.length-1,f=0,h=l,v=p;l<p;){var C=r[l].sizeInBytes,I=r[p].sizeInBytes;if(f+=C+I,f>u){var w=v-h+1;r.splice(h,w);break}h=l,v=p,l++,p--}}return r},t}(),ob=function(){function t(e,r){this.sizeInBytes=0,this.level=r,this.method="<no_method>",this.assembly=Rt.trim(e);var n=e.match(t.regex);n&&n.length>=5&&(this.method=Rt.trim(n[2])||this.method,this.fileName=Rt.trim(n[4])||"<no_filename>",this.line=parseInt(n[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=t.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return t.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,t.baseSize=58,t}();cb.exports=UN});var db=d((dU,fb)=>{"use strict";var $N=require("url"),VN=Xc(),BN=qa(),qr=_t(),GN=JT(),Od=ib(),lb=An(),zN=ab(),QN=yt(),pb=Me(),WN=ub(),XN=function(){function t(e){this._telemetryProcessors=[],this._enableAzureProperties=!1;var r=new VN(e);this.config=r,this.context=new BN,this.commonProperties={};var n=new zN(this.config);this.channel=new GN(function(){return r.disableAppInsights},function(){return r.maxBatchSize},function(){return r.maxBatchIntervalMs},n)}return t.prototype.trackAvailability=function(e){this.track(e,qr.TelemetryType.Availability)},t.prototype.trackPageView=function(e){this.track(e,qr.TelemetryType.PageView)},t.prototype.trackTrace=function(e){this.track(e,qr.TelemetryType.Trace)},t.prototype.trackMetric=function(e){this.track(e,qr.TelemetryType.Metric)},t.prototype.trackException=function(e){e&&e.exception&&!QN.isError(e.exception)&&(e.exception=new Error(e.exception.toString())),this.track(e,qr.TelemetryType.Exception)},t.prototype.trackEvent=function(e){this.track(e,qr.TelemetryType.Event)},t.prototype.trackRequest=function(e){this.track(e,qr.TelemetryType.Request)},t.prototype.trackDependency=function(e){e&&!e.target&&e.data&&(e.target=$N.parse(e.data).host),this.track(e,qr.TelemetryType.Dependency)},t.prototype.flush=function(e){this.channel.triggerSend(e?!!e.isAppCrashing:!1,e?e.callback:void 0)},t.prototype.track=function(e,r){if(e&&qr.telemetryTypeToBaseType(r)){var n=WN.createEnvelope(e,r,this.commonProperties,this.context,this.config);e.time&&(n.time=e.time.toISOString()),this._enableAzureProperties&&Od.azureRoleEnvironmentTelemetryProcessor(n,this.context);var i=this.runTelemetryProcessors(n,e.contextObjects);i=i&&Od.samplingTelemetryProcessor(n,{correlationContext:lb.CorrelationContextManager.getCurrentContext()}),i&&(Od.performanceMetricsTelemetryProcessor(n,this.quickPulseClient),this.channel.send(n))}else pb.warn("track() requires telemetry object and telemetryType to be specified.")},t.prototype.setAutoPopulateAzureProperties=function(e){this._enableAzureProperties=e},t.prototype.addTelemetryProcessor=function(e){this._telemetryProcessors.push(e)},t.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},t.prototype.runTelemetryProcessors=function(e,r){var n=!0,i=this._telemetryProcessors.length;if(i===0)return n;r=r||{},r.correlationContext=lb.CorrelationContextManager.getCurrentContext();for(var s=0;s<i;++s)try{var a=this._telemetryProcessors[s];if(a&&a.apply(null,[e,r])===!1){n=!1;break}}catch(o){n=!0,pb.warn("One of telemetry processors failed, telemetry item will be sent.",o,e)}return n},t}();fb.exports=XN});var gb=d((Nd,vb)=>{"use strict";var KN=Nd&&Nd.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),YN=db(),hb=bd(),JN=rs(),Zc=Me(),ZN=function(t){KN(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.trackNodeHttpRequestSync=function(r){r&&r.request&&r.response&&r.duration?hb.trackRequestSync(this,r):Zc.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},e.prototype.trackNodeHttpRequest=function(r){(r.duration||r.error)&&Zc.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),r&&r.request&&r.response?hb.trackRequest(this,r):Zc.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},e.prototype.trackNodeHttpDependency=function(r){r&&r.request?JN.trackRequest(this,r):Zc.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},e}(YN);vb.exports=ZN});var yb=d(mb=>{"use strict";Object.defineProperty(mb,"__esModule",{value:!0})});var Hb=d(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});var Ld=An(),e1=J0(),t1=eT(),Cb=Qc(),r1=xT(),n1=rs(),i1=bd(),Eb=On(),Ha=Me(),s1=QT(),Tb=XT();P.TelemetryClient=gb();P.Contracts=_t();P.azureFunctionsTypes=yb();var bb;(function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C"})(bb=P.DistributedTracingModes||(P.DistributedTracingModes={}));var Ib=!0,wb=!1,xb=!0,Sb=!0,Ab=!1,Pb=!0,kb=!0,Db=!0,Md=!0,Rb,eu=!1,qb=!0,Ob,Nb=void 0,Lb=void 0,Fa,ja,Ua,$a,is,Gn,Va,Or=!1,_b;function a1(t){return P.defaultClient?Ha.info("The default client is already setup"):(P.defaultClient=new P.TelemetryClient(t),Fa=new e1(P.defaultClient),ja=new t1(P.defaultClient),Ua=new Cb(P.defaultClient),$a=new r1(P.defaultClient),Gn=new i1(P.defaultClient),Va=new n1(P.defaultClient),is||(is=new Tb.AutoCollectNativePerformance(P.defaultClient))),P.defaultClient&&P.defaultClient.channel&&P.defaultClient.channel.setUseDiskRetryCaching(Db,Nb,Lb),Hd}P.setup=a1;function Mb(){return P.defaultClient?(Or=!0,Fa.enable(Ib,wb),ja.enable(xb),Ua.enable(Sb),$a.enable(Ab,P.defaultClient.config),is.enable(qb,Ob),Gn.useAutoCorrelation(Md,Rb),Gn.enable(Pb),Va.enable(kb),P.liveMetricsClient&&eu&&P.liveMetricsClient.enable(eu)):Ha.warn("Start cannot be called before setup"),Hd}P.start=Mb;function o1(){return Md?Ld.CorrelationContextManager.getCurrentContext():null}P.getCorrelationContext=o1;function c1(t,e){return Ld.CorrelationContextManager.startOperation(t,e)}P.startOperation=c1;function u1(t,e){return Ld.CorrelationContextManager.wrapCallback(t,e)}P.wrapWithCorrelationContext=u1;var Hd=function(){function t(){}return t.setDistributedTracingMode=function(e){return Eb.w3cEnabled=e===bb.AI_AND_W3C,t},t.setAutoCollectConsole=function(e,r){return r===void 0&&(r=!1),Ib=e,wb=r,Or&&Fa.enable(e,r),t},t.setAutoCollectExceptions=function(e){return xb=e,Or&&ja.enable(e),t},t.setAutoCollectPerformance=function(e,r){r===void 0&&(r=!0),Sb=e;var n=Tb.AutoCollectNativePerformance.parseEnabled(r);return qb=n.isEnabled,Ob=n.disabledMetrics,Or&&(Ua.enable(e),is.enable(n.isEnabled,n.disabledMetrics)),t},t.setAutoCollectHeartbeat=function(e){return Ab=e,Or&&$a.enable(e,P.defaultClient.config),t},t.setAutoCollectRequests=function(e){return Pb=e,Or&&Gn.enable(e),t},t.setAutoCollectDependencies=function(e){return kb=e,Or&&Va.enable(e),t},t.setAutoDependencyCorrelation=function(e,r){return Md=e,Rb=r,Or&&Gn.useAutoCorrelation(e,r),t},t.setUseDiskRetryCaching=function(e,r,n){return Db=e,Nb=r,Lb=n,P.defaultClient&&P.defaultClient.channel&&P.defaultClient.channel.setUseDiskRetryCaching(e,r,n),t},t.setInternalLogging=function(e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),Ha.enableDebug=e,Ha.disableWarnings=!r,t},t.setSendLiveMetrics=function(e){return e===void 0&&(e=!1),P.defaultClient?(!P.liveMetricsClient&&e?(P.liveMetricsClient=new s1(P.defaultClient.config.instrumentationKey),_b=new Cb(P.liveMetricsClient,1e3,!0),P.liveMetricsClient.addCollector(_b),P.defaultClient.quickPulseClient=P.liveMetricsClient):P.liveMetricsClient&&P.liveMetricsClient.enable(e),eu=e,t):(Ha.warn("Live metrics client cannot be setup without the default client"),t)},t.start=Mb,t}();P.Configuration=Hd;function l1(){Eb.w3cEnabled=!0,P.defaultClient=null,Or=!1,Fa&&Fa.dispose(),ja&&ja.dispose(),Ua&&Ua.dispose(),$a&&$a.dispose(),is&&is.dispose(),Gn&&Gn.dispose(),Va&&Va.dispose(),P.liveMetricsClient&&(P.liveMetricsClient.enable(!1),eu=!1,P.liveMetricsClient=void 0)}P.dispose=l1});var m1={};iI(m1,{activate:()=>v1,deactivate:()=>g1});module.exports=sI(m1);var $b=require("vscode");var U=require("vscode");var za=require("fs"),en=require("vscode");var zd=require("os"),oI=require("vscode"),cI=lr(ou());function cu(t){return t.map(e=>String.fromCharCode(e)).join("")}function uu(t=""){var e;try{return(e=(0,zd.userInfo)().username)!=null?e:t}catch(r){return t}}var Wd=require("vscode"),uI=lr(ou());var Xd=require("fs");var lu=class{constructor(){this.dictionary={};this.locale="en";try{if(process&&process.env){let e=JSON.parse(process.env.VSCODE_NLS_CONFIG);e&&typeof e.locale=="string"&&(this.locale=e.locale)}}catch(e){}}read_i18n(e){try{let r=Buffer.from((0,Xd.readFileSync)(e)).toString("utf-8");return JSON.parse(r)}catch(r){return{}}}localize(e){let r=this.dictionary[e];if(typeof r=="string")return r}load(e){try{this.dictionary=Object.assign({},this.read_i18n(e.asAbsolutePath("package.nls.json")),this.read_i18n(e.asAbsolutePath("package.nls.en.json")),this.read_i18n(e.asAbsolutePath(`package.nls.${this.locale}.json`)))}catch(r){}}},Kd=new lu;function Yd(t){return b(this,null,function*(){yield Kd.load(t)})}function Y(t,e){return lI(t,e)}function lI(t,e){var r,n;return(n=(r=Kd.localize(t))!=null?r:e)!=null?n:t}var Kt=require("vscode");function Xt(t,e,r){return{range:t,kind:e,value:r}}var De=class{constructor(){}clearCache(){this._cache=void 0}parse(e){let r;return this._cache&&this._cache.uri==e.uri&&this._cache.version==e.version?r=this._cache.value:(r=De.parseValue(this.tokenize(e)),this._cache={uri:e.uri,version:e.version,value:r}),r}static next(e){if(e){let r=e.next();if(r&&!r.done)return r.value}}static parseValue(e){let r=De.next(e);if(r){let n=r.range.end;switch(r.kind){case 8:case 9:case 10:case 6:return{range:r.range,value:r.value};case 2:let i=[],s=[];for(;;){let c=De.parseValue(e);if(c)i.push(c),s.push(c.value);else break;let u=De.next(e);if(u==null||(n=u.range.end,u.kind==3))break;if(u.kind==4)continue;break}return{range:new Kt.Range(r.range.start,n),value:s,items:i};case 0:let a=[],o={};for(;;){let c=!1,u=De.next(e);if(u==null)break;for(n=u.range.end;;){let f=De.next(e);if(f==null||f.kind!=5){if(a.push({name:u,value:void 0}),o[u.value]=void 0,f&&f.kind==6){u=f;continue}c=!0;break}break}if(c)break;let l=De.parseValue(e);if(a.push({name:u,value:l}),o[u.value]=l==null?void 0:l.value,l==null)break;n=l.range.end;let p=De.next(e);if(p==null||(n=p.range.end,p.kind==1))break;if(p.kind!=4)break}return{properties:a,range:new Kt.Range(r.range.start,n),value:o};default:break}}}traverse(e,r,n,i){return b(this,null,function*(){if(e==null)return;let s=yield Promise.resolve(r(e,i));if(typeof s!="undefined")return s;let a=e;if(Array.isArray(a.items)){let o=0;for(let c of a.items)if(s=yield this.traverse(c,r,n,`${i}[${o++}]`),typeof s!="undefined")return s}else if(a.properties)for(let o of a.properties){if(s=yield Promise.resolve(n(o.name,o.value,i)),typeof s!="undefined")return s;let c=i?`${i}.${o.name.value}`:o.name.value;if(s=yield this.traverse(o.value,r,n,c),typeof s!="undefined")return s}})}*tokenize(e){let r=e.getText();for(let n=0;n<r.length;){let i=r[n],s=e.positionAt(n),a=new Kt.Range(s,new Kt.Position(s.line,s.character+1));switch(i){case"{":yield Xt(a,0);break;case"}":yield Xt(a,1);break;case"[":yield Xt(a,2);break;case"]":yield Xt(a,3);break;case",":yield Xt(a,4);break;case":":yield Xt(a,5);break;case'"':let o=De.parseString(r,n);yield Xt(new Kt.Range(s,e.positionAt(o.end)),6,o.value),n=o.end;continue;default:if(i>="0"&&i<="9"||i=="-"){let u=De.parseNumber(r,n);if(u){yield Xt(new Kt.Range(s,e.positionAt(n+u.length)),7,u.value),n+=u.length;continue}}let c=De.tryParseLiteral(r,n);if(c){yield Xt(new Kt.Range(s,e.positionAt(n+c.length)),c.token,c.value),n+=c.length;continue}if(De.isIdentifierChar(i)){let u=De.parseIdentifier(r,n);if(u&&u.length>0){yield Xt(new Kt.Range(s,e.positionAt(n+u.length)),6,u.value),n+=u.length;continue}}break}n++}}static isIdentifierChar(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="\\"||e=="/"||e=="_"}static parseIdentifier(e,r){let n=r;for(;r<e.length&&De.isIdentifierChar(e[r]);r++);return{start:n,end:r,length:r-n,value:e.substring(n,r)}}static tryParseLiteral(e,r){let n={null:[null,8],true:[!0,9],false:[!1,10]},i=e[r];for(let s in n)if(i==s[0]&&e.substring(r).match(`/^${s}/i`))return{length:s.length,value:n[s][0],token:n[s][1]}}static parseNumber(e,r){let n=e.substring(r).match(/^-?[0-9]*(\.[0-9]*)?([eE][+\-]?[0-9]+)?/i);if(n){let i=n[0],s;return i.includes(".")||i.includes("e")||i.includes("E")?s=parseFloat(i):s=parseInt(i),{value:s,length:i.length}}}static parseString(e,r){let n=r,i=!1,s="",a=!1;for(r++;r<e.length&&!a;r++){let o=e[r];if(i){switch(o){case"b":s+="\b";break;case"f":s+="\f";break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"u":let c=e.substring(r+1).match(/^[0-9a-z]{1,4}/i);c?s+=String.fromCodePoint(parseInt(c[0],16)):s+="u";break;default:s+=o;break}i=!1}else switch(o){case"\\":i=!0;break;case'"':a=!0;break;default:s+=o;break}}return{value:s,start:n,end:r}}};var vt=class extends De{constructor(){super()}static parseComposerJson(e){return b(this,null,function*(){if(e&&(0,za.existsSync)(e.fsPath))try{let r=yield en.workspace.fs.readFile(e);if(r&&r.length!=0)return JSON.parse(Buffer.from(r).toString("utf-8"))}catch(r){}})}static parseComposerLock(e){return b(this,null,function*(){let r=en.Uri.joinPath(e,"..","composer.lock");if((0,za.existsSync)(r.fsPath))try{let n=yield en.workspace.fs.readFile(r);if(n&&n.length!=0)return JSON.parse(Buffer.from(n).toString("utf-8"))}catch(n){}})}static parseComposerInstalledJson(e){return b(this,null,function*(){let r=en.Uri.joinPath(e,"..","vendor/composer/installed.json");if((0,za.existsSync)(r.fsPath))try{let n=yield en.workspace.fs.readFile(r);if(n&&n.length!=0)return JSON.parse(Buffer.from(n).toString("utf-8"))}catch(n){}})}static parsePackagesMeta(e){let r={};if(e)for(let n of["packages","packages-dev"]){let i=e[n];Array.isArray(i)&&i.forEach(s=>{s.name&&(r[s.name]=s)})}return r}resolvePackagesMeta(e){return b(this,null,function*(){let r={};return r=Object.assign(r,vt.parsePackagesMeta(yield vt.parseComposerLock(e))),r=Object.assign(r,vt.parsePackagesMeta(yield vt.parseComposerInstalledJson(e))),r})}},Yn=new vt;var Qo=lr(qy()),tr=require("vscode");var Wo=require("fs");var s_=lr(r_()),a_=require("path"),zo=lr(ut());var sk=[101,56,52,97,53,57,53,55,45,100,54,56,48,45,52,99,99,53,45,57,50,54,55,45,53,101,53,101,51,100,48,97,56,100,53,55],_p=class{constructor(e){this.client=e;Qo.Configuration.setAutoCollectExceptions(!0).setUseDiskRetryCaching(!0).setAutoCollectConsole(!0,!0).setInternalLogging(!0,!0)}init(e,r){let n=ok(e),i=uu();this.client.context.tags["ai.device.model"]=`Visual Studio Code ${tr.version}`,this.client.context.tags["ai.user.id"]=i,this.client.context.tags["ai.user.accountId"]=i_()(i).toString(),this.client.context.tags["ai.session.id"]=s_.v1(),this.client.context.tags["ai.application.ver"]=n.version,this.client.commonProperties=Object.bind(this.client.commonProperties,r,{"process.platform":process.platform,"process.arch":process.arch,"extension.id":e.extension.id});for(let s in n)this.client.commonProperties["server."+s]=n[s];this.track("extension loaded",{"copilot.enabled":yp("github.copilot"),"phptools.enabled":yp("devsense.phptools-vscode"),"intelephense.enabled":yp("bmewburn.vscode-intelephense-client")})}track(e,r,n){if(!tr.env.isTelemetryEnabled||!this.client)return;let i={name:e,properties:Object.bind({},r)};n&&(i.measurements=n),this.client.trackEvent(i)}metric(e,r,n,i,s,a){this.client.trackMetric({name:e,value:r,count:n,min:i,max:s,stdDev:a})}error(e,r,n){if(n=Object.bind({},n),!tr.env.isTelemetryEnabled){var i=tr.workspace.getConfiguration().get("telemetry.telemetryLevel");if(i!="error"&&(i!="crash"||r!="critical"))return}this.client.trackException({exception:e,severity:r=="critical"?zo.SeverityLevel.Critical:r=="error"?zo.SeverityLevel.Error:zo.SeverityLevel.Warning,properties:n})}},o_=new _p(new Qo.TelemetryClient(cu(sk)));function ak(t){let e="out/server/version.json";return t?t.asAbsolutePath(e):(0,a_.join)(__filename,"../../..",e)}function ok(t){let e=ak(t);try{if((0,Wo.existsSync)(e))return JSON.parse((0,Wo.readFileSync)(e,"utf8"))||{}}catch(n){}let r=t.extension.packageJSON.version;return{target:`${process.platform}-${process.arch}`,version:r}}function yp(t){return tr.extensions.getExtension(t)!==void 0}var se=class{static get composer_diagnosticsEnabled_description(){return Y("composer.diagnosticsEnabled.description")}static get codelens_update(){return Y("codelens.update")}static get action_remove(){return Y("action.remove")}static get action_update(){return Y("action.update")}static get commands_download_title(){return Y("commands.download.title")}static get capabilities_virtualWorkspaces_description(){return Y("capabilities.virtualWorkspaces.description")}static get action_open_folder(){return Y("action.open-folder")}static get capabilities_untrustedWorkspaces_description(){return Y("capabilities.untrustedWorkspaces.description")}static get action_dontshowagain(){return Y("action.dontshowagain")}static get task_composer_args_description(){return Y("task.composer.args.description")}static get action_choose_folder(){return Y("action.choose-folder")}static get installed_version(){return Y("installed_version")}static get abandoned(){return Y("abandoned")}static get error_couldntGetComposer(){return Y("error.couldntGetComposer")}static get codelens_check(){return Y("codelens.check")}static get authors(){return Y("authors")}static get title(){return Y("title")}static get error_missingComposerLock(){return Y("error.missingComposerLock")}static get task_composer_command_description(){return Y("task.composer.command.description")}static get commands_search_title(){return Y("commands.search.title")}static get composer_inlayVersionEnabled_description(){return Y("composer.inlayVersionEnabled.description")}static get codelens_install(){return Y("codelens.install")}static get description(){return Y("description")}static get action_dismiss(){return Y("action.dismiss")}static get action_install(){return Y("action.install")}static get composer_bin_description(){return Y("composer.bin.description")}static get error_nonEmptyFolder(){return Y("error.nonEmptyFolder")}static get composer_workingPath_description(){return Y("composer.workingPath.description")}static get open_folder_title(){return Y("open-folder.title")}};var c_=require("fs");function u_(t,e){return b(this,null,function*(){let r=yield new Promise(n=>{(0,c_.writeFile)(t,e,i=>{n(i)})});if(r)throw r})}var Oe=class{constructor(){this.disposables=[]}push(e){this.disposables.push(e)}onDispose(){}dispose(){try{this.onDispose()}catch(e){}for(let e of this.disposables)e.dispose();this.disposables=[]}};var l_=require("fs");function p_(t){return new Promise((e,r)=>{(0,l_.readdir)(t,(n,i)=>{n?e(!0):i&&i.length!=0?e(!1):e(!0)})})}var Cp=require("vscode");function f_(t){return t==null?!1:Cp.tasks.taskExecutions.includes(t)==!1?!0:new Promise(e=>{let r=Cp.tasks.onDidEndTask(n=>{n.execution==t&&(r.dispose(),e(!0))})})}var Ys=require("vscode");function Js(t){var e=Ys.workspace.getConfiguration(null,t).get("composer.workingPath","");return e&&e!=""&&e!="."?Ys.Uri.joinPath(t,e):t}function d_(){var t=Ys.workspace.getConfiguration(null).get("composer.bin","");if(typeof t=="string"&&t!="")return t}var Ep=class extends Oe{constructor(r,n){super();this.taskProvider=r;this.packagist=n;this.parser=Yn}registerCommand(r,n,i){this.push(U.commands.registerCommand(r,(...s)=>b(this,null,function*(){let a;if(n&&(n.requiresCwd||n.requiresComposerJson)&&(a=yield this.pickCwd(s,n&&n.requiresComposerJson,n&&n.enableOpenFolder),typeof a=="undefined"))return!1;s&&s.length!=0&&typeof s[0]=="string"&&s[0].endsWith("composer.json")&&s.shift(),i(a,...s)})))}QuickPickPackage(r,n,i){return new Promise(s=>{let a=U.window.createQuickPick(),o="require",c="packagist.org";a.canSelectMany=!1,a.title=r!=null?r:"Search package to install ...",a.placeholder=n!=null?n:"package name",a.items=[],a.onDidAccept(u=>b(this,null,function*(){let l=a.selectedItems&&a.selectedItems.length!=0?a.selectedItems[0].label:a.value.trim();s(l),a.hide()})),a.onDidHide(u=>s(void 0)),a.onDidChangeValue(u=>b(this,null,function*(){let l=i?[{tooltip:o,iconPath:new U.ThemeIcon("cloud-download")},{tooltip:c,iconPath:new U.ThemeIcon("link-external")}]:void 0,p=yield this.packagist.search(u.trim());if(a.value==u&&p&&Array.isArray(p.results)){let f=[];p.results.forEach(h=>{var I,w;let v=(I=h.downloads)!=null?I:0,C=(w=h.favers)!=null?w:0;f.push({label:h.name,description:`    $(extensions-install-count) ${v.toLocaleString("en-US",{maximumFractionDigits:0})}  $(star-full) ${C.toLocaleString("en-US",{maximumFractionDigits:0})}`,detail:h.description,buttons:l})}),a.items=f}})),a.onDidTriggerItemButton(u=>b(this,null,function*(){switch(u.button.tooltip){case o:yield this.taskProvider.executeComposerTask("require",[u.item.label],void 0);break;case c:let l=`https://packagist.org/packages/${u.item.label}`;yield U.env.openExternal(U.Uri.parse(l));break}})),a.show()})}pickCwd(r,n,i){return b(this,null,function*(){if(r&&r.length>=1&&typeof r[0]=="string"&&r[0].endsWith("composer.json"))return U.Uri.joinPath(U.Uri.parse(r[0]),"..").fsPath;let s=U.workspace.workspaceFolders;if(s){if(s.length==1)return Js(s[0].uri).fsPath;if(s.length>1){let a=yield U.window.showWorkspaceFolderPick({placeHolder:"Select the command's working directory ..."});if(a)return Js(a.uri).fsPath}return}if(i){let a=yield U.window.showOpenDialog({canSelectMany:!1,canSelectFiles:!1,canSelectFolders:!0,openLabel:se.action_choose_folder});return a&&a.length==1?a[0].fsPath:void 0}if(U.window.activeTextEditor){let a=U.Uri.joinPath(U.window.activeTextEditor.document.uri,"..");if(a.scheme=="file")return a.fsPath}})}pickInstalledPackage(r,n,i){return b(this,null,function*(){var p,f;let s=U.Uri.joinPath(U.Uri.file(r),"composer.json"),a=yield vt.parseComposerJson(s),o=[],c="(dev) ";if(a){let h=(v,C,I)=>{v!="php"&&!v.startsWith("ext-")&&o.push({label:v,description:`${I?c:""}${C}`})};for(let v in(p=a.require)!=null?p:{})h(v,a.require[v],!1);for(let v in(f=a["require-dev"])!=null?f:{})h(v,a["require-dev"][v],!0)}let u=h=>({pkgname:h.label,dev:h.description.startsWith(c)}),l=yield U.window.showQuickPick(o,{canPickMany:i!=null?i:!1,title:n!=null?n:"",placeHolder:"Package name"});return l?Array.isArray(l)?l.map(h=>u(h)):[u(l)]:[]})}},Xo=class extends Ep{constructor(e,r,n){super(r,n),this.registerCommand("composer.install",{requiresComposerJson:!0},(i,...s)=>b(this,null,function*(){return yield r.executeComposerTask("install",s,i)})),this.registerCommand("composer.update",{requiresComposerJson:!0},(i,...s)=>b(this,null,function*(){return yield r.executeComposerTask("update",s,i)})),this.registerCommand("composer.remove",{requiresComposerJson:!0},(i,...s)=>b(this,null,function*(){if(s.length==0){let a=yield this.pickInstalledPackage(i,"Select package to remove",!0),o=a.filter(u=>u.dev).map(u=>u.pkgname),c=a.filter(u=>!u.dev).map(u=>u.pkgname);o.length!=0&&(yield r.executeComposerTask("remove",[...o,"--dev"],i)),c.length!=0&&(yield r.executeComposerTask("remove",c,i))}else return yield r.executeComposerTask("remove",s,i)})),this.registerCommand("composer.create-project",{requiresCwd:!0,enableOpenFolder:!0},(i,...s)=>b(this,null,function*(){if(e.appendLine(`Project will be created in '${i}' ...`),!(yield p_(i)))throw e.appendLine(se.error_nonEmptyFolder),U.window.showErrorMessage(se.error_nonEmptyFolder),new Error(se.error_nonEmptyFolder);let a=s.length?s[0]:yield this.QuickPickPackage();if(a){e.appendLine(`About to create project from package '${a}' ...`);let o=yield this.taskProvider.executeComposerTask("create-project",[a,"."],i);U.workspace.workspaceFolders||(yield f_(o),(yield U.window.showInformationMessage(`${se.open_folder_title} (${i})`,se.action_open_folder,se.action_dismiss))==se.action_open_folder&&(yield U.commands.executeCommand("vscode.openFolder",U.Uri.file(i))))}})),this.registerCommand("composer.require",{requiresCwd:!0},(i,...s)=>b(this,null,function*(){let a=s.length?s[0]:yield this.QuickPickPackage();a&&(yield this.taskProvider.executeComposerTask("require",[a],i))})),this.registerCommand("composer.require-dev",{requiresCwd:!0},(i,...s)=>b(this,null,function*(){let a=s.length?s[0]:yield this.QuickPickPackage();a&&(yield this.taskProvider.executeComposerTask("require",[a,"--dev"],i))})),this.registerCommand("composer.run-script",{requiresComposerJson:!0},(i,...s)=>b(this,null,function*(){let a;if(s&&s.length>0)a=s[0];else{let o=U.Uri.joinPath(U.Uri.file(i),"composer.json"),c=yield vt.parseComposerJson(o);if(c&&typeof c.scripts=="object"){let u=[];for(let l in c.scripts)u.push(l);a=yield U.window.showQuickPick(u,{title:"Select script to run ...",placeHolder:"script name"})}else{U.window.showErrorMessage(`'${"composer.json"}' could not be parsed`);return}}a&&(yield this.taskProvider.executeComposerTask("run-script",[a],i))})),this.registerCommand("composer.search",{},(i,...s)=>b(this,null,function*(){let a=yield this.QuickPickPackage("Search packages ...","filter",!0);if(a){let o=`https://packagist.org/packages/${a}`;yield U.env.openExternal(U.Uri.parse(o))}})),this.registerCommand("composer.about",{},()=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("about")})),this.registerCommand("composer.archive",{requiresCwd:!0},i=>b(this,null,function*(){let s=yield U.window.showInputBox({placeHolder:"[package] [version] --format=tar",title:"Create package archive.",prompt:'"composer archive" options'});typeof s!="undefined"&&(yield this.taskProvider.executeComposerTask("archive",s?s.split(" "):[],i))})),this.registerCommand("composer.clear-cache",{},()=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("clear-cache")})),this.registerCommand("composer.fund",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("fund",[],i)})),this.registerCommand("composer.check-platform-reqs",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("check-platform-reqs",[],i)})),this.registerCommand("composer.licenses",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("licenses",[],i)})),this.registerCommand("composer.outdated",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("outdated",[],i)})),this.registerCommand("composer.reinstall",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("reinstall",[],i)})),this.registerCommand("composer.show-tree",{requiresComposerJson:!0},i=>b(this,null,function*(){return yield this.taskProvider.executeComposerTask("show",["--tree"],i)}))}};var ee=require("vscode");function h_(t){return t&&(t.path.endsWith("composer.json")||t.path.endsWith("composer.lock"))}var ck=-99999;function uk(t,e){let r=[...e.matchAll(/\r?\n/g)];return{uri:t,version:ck++,getText:()=>e,positionAt:n=>{let i=new ee.Position(0,n);if(r){let s=0;for(let a of r){let o=a.index+a.length;if(o<=n)i=new ee.Position(++s,n-o);else break}}return i}}}var Ko=class extends Oe{constructor(){super();this.parser=Yn;this.documents=new Map;this.timeouts=new Map;this.push(this.collection=ee.languages.createDiagnosticCollection("Composer"));let r;this.push(r=ee.workspace.createFileSystemWatcher("**/composer.*")),this.push(ee.workspace.onDidOpenTextDocument(n=>this.updateFromDocument(n))),this.push(ee.workspace.onDidChangeTextDocument(n=>this.updateFromDocument(n.document))),this.push(ee.workspace.onDidCloseTextDocument(n=>this.updateFromFs(n.uri))),this.push(ee.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("composer.diagnosticsEnabled")})),r.onDidChange(n=>this.updateFromFs(n)),r.onDidDelete(n=>this.updateFromFs(n)),r.onDidCreate(n=>this.updateFromFs(n)),ee.workspace.workspaceFolders&&ee.workspace.workspaceFolders.forEach(n=>b(this,null,function*(){yield this.updateFromFs(ee.Uri.joinPath(n.uri,"composer.json")),yield this.updateFromFs(ee.Uri.joinPath(n.uri,"composer.lock")),yield this.update(n.uri)}))}updateFromFs(r){return b(this,null,function*(){if(h_(r)){this.documents.delete(r.toString(!0));try{let n=yield ee.workspace.fs.readFile(r);n&&n.length&&this.documents.set(r.toString(!0),uk(r,Buffer.from(n).toString("utf-8")))}catch(n){}yield this.setDirty(ee.Uri.joinPath(r,".."))}})}updateFromDocument(r){return b(this,null,function*(){h_(r.uri)&&(this.documents.set(r.uri.toString(!0),r),yield this.setDirty(ee.Uri.joinPath(r.uri,"..")))})}setDirty(r){return b(this,null,function*(){let n=r.toString(!0),i=this.timeouts.get(n);i?i.refresh():this.timeouts.set(n,setTimeout(()=>b(this,null,function*(){this.timeouts.delete(n),yield this.update(r)}),500))})}update(r){return b(this,null,function*(){let n=ee.Uri.joinPath(r,"composer.json"),i=ee.Uri.joinPath(r,"composer.lock"),s=this.documents.get(n.toString(!0)),a=this.documents.get(i.toString(!0)),o=[];if(s&&a&&ee.workspace.getConfiguration().get("composer.diagnosticsEnabled",!0)!=!1){let c=vt.parsePackagesMeta(JSON.parse(a.getText())),u=this.parser.parse(s);yield this.parser.traverse(u,(l,p)=>{},(l,p,f)=>{if(typeof l.value=="string"&&(f=="require"||f=="require-dev")){let h=c[l.value];if(h&&h.abandoned){let v=new ee.Diagnostic(l.range,`'${l.value}' has been abandoned.`,ee.DiagnosticSeverity.Warning);v.source="Composer",v.code="abandoned",v.tags=[ee.DiagnosticTag.Deprecated],o.push(v)}}})}o.length?this.collection.set(n,o):this.collection.delete(n)})}};var O=require("vscode");var Zs={scheme:"file",language:"json",pattern:"**/composer.json"},Tn=class extends Oe{constructor(r,n){super();this.taskProvider=r;this.packagist=n;this.parser=Yn;this.push(this.onDidChangeCodeLensesEmitter=new O.EventEmitter),this.onDidChangeCodeLenses=this.onDidChangeCodeLensesEmitter.event,this.push(this.onDidChangeInlayHintsEmitter=new O.EventEmitter),this.onDidChangeInlayHints=this.onDidChangeInlayHintsEmitter.event,this.push(O.languages.registerHoverProvider(Zs,this)),this.push(O.languages.registerInlayHintsProvider(Zs,this)),this.push(O.languages.registerCodeLensProvider(Zs,this)),this.push(O.languages.registerCompletionItemProvider(Zs,this,":",'"')),this.push(O.languages.registerCodeActionsProvider(Zs,this,{})),this.push(O.workspace.onDidChangeConfiguration(s=>{s.affectsConfiguration("composer.inlayVersionEnabled")&&this.onDidChangeInlayHintsEmitter.fire()}));let i;this.push(i=O.workspace.createFileSystemWatcher("**/composer.lock")),i.onDidDelete(s=>this.onDidChangeInlayHintsEmitter.fire()),i.onDidCreate(s=>this.onDidChangeInlayHintsEmitter.fire()),i.onDidChange(s=>this.onDidChangeInlayHintsEmitter.fire())}provideCodeActions(r,n,i,s){return b(this,null,function*(){let a=[],o=this.parser.parse(r);return yield this.parser.traverse(o,c=>{},(c,u,l)=>b(this,null,function*(){if((l=="require"||l=="require-dev")&&(n.intersection(c.range)||u&&u.range.intersection(n))){if(c.value=="php"||c.value.startsWith("ext-"))return;let p=l=="require-dev";(yield this.parser.resolvePackagesMeta(r.uri))[c.value]==null&&a.push({command:p?"composer.require-dev":"composer.require",title:`require "${c.value}"${p?" --dev":""}`,tooltip:"",arguments:[r.uri.toString(!0),c.value]}),a.push({command:"composer.update",title:`${se.action_update} "${c.value}"`,tooltip:"",arguments:[r.uri.toString(!0),c.value]}),a.push({command:"composer.remove",title:`${se.action_remove} "${c.value}"`,tooltip:"",arguments:[r.uri.toString(!0),c.value,p?"--dev":""]})}})),a})}provideCompletionForVersions(r,n){return b(this,null,function*(){let i=yield this.packagist.packageData(n),s=i!=null&&i.packages?i.packages[n]:void 0,a=[];if(Array.isArray(s)&&s.length){let o=new Set;a=s.filter(c=>c.version_normalized).map((c,u)=>{let l=c.version_normalized.split("."),p=l&&l.length>=2?new O.CompletionItem(`"^${l[0]}.${l[1]}"`):new O.CompletionItem(`"${c.version}"`);return p.range=r,p.filterText=` ${p.label}`,p.sortText=u.toString().padStart(8,"0"),p}).filter(c=>typeof c.label=="string"&&!o.has(c.label)&&o.add(c.label))}return{items:a,isIncomplete:!1}})}provideCompletionItems(r,n,i,s){return b(this,null,function*(){let a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,c,u)=>b(this,null,function*(){var l;if(u=="require"||u=="require-dev"){if(o.range.contains(n)&&typeof o.value=="string"){let p=o.value.trim();if(p.length==0)return;let f=[],h=(l=r.getWordRangeAtPosition(n))!=null?l:new O.Range(n,n),v=yield this.packagist.search(p);return v&&v.results&&v.results.forEach(C=>{let I=new O.CompletionItem(C.name,O.CompletionItemKind.Reference);I.detail=C.description,I.documentation=Tn.descriptionForPackage(C,!1,!0,!0),I.insertText=`"${C.name}"`,C.abandoned&&(I.tags=[O.CompletionItemTag.Deprecated]),I.commitCharacters=[":",'"'," "],I.additionalTextEdits=[O.TextEdit.delete(o.range.with({end:h.start})),O.TextEdit.delete(o.range.with({start:h.end}))],f.push(I)}),{items:f,isIncomplete:!0}}if(c&&c.range.contains(n))return yield this.provideCompletionForVersions(c.range,o.value);if(o.range.end.line==n.line&&o.range.end.character<n.character&&r.getText(new O.Range(o.range.end,n)).trim()==":")return yield this.provideCompletionForVersions(new O.Range(n,n),o.value)}}))})}provideCodeLenses(r,n){return b(this,null,function*(){let i=[],s=new O.Range(0,0,0,0);i.push(new O.CodeLens(s,{title:`$(desktop-download) ${se.codelens_install}`,tooltip:"composer install",command:"composer.install",arguments:[r.uri.toString(!1)]}),new O.CodeLens(s,{title:`$(refresh) ${se.codelens_update}`,tooltip:"composer update",command:"composer.update",arguments:[r.uri.toString(!1)]}),new O.CodeLens(s,{title:`$(check) ${se.codelens_check}`,tooltip:"composer check-platform-reqs",command:"composer.check-platform-reqs",arguments:[r.uri.toString(!1)]}));let a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,c,u)=>{u=="scripts"&&typeof o.value=="string"&&i.push(new O.CodeLens(o.range,{title:"$(run) Run",tooltip:`Run the script '${o.value}'`,command:"composer.run-script",arguments:[r.uri.toString(!1),o.value]}))}),i})}provideInlayHints(r,n,i){return b(this,null,function*(){let s=[];if(O.workspace.getConfiguration().get("composer.inlayVersionEnabled",!0)==!1)return s;let a=yield this.parser.resolvePackagesMeta(r.uri),o=this.parser.parse(r);return yield this.parser.traverse(o,c=>{},(c,u,l)=>{if((l=="require"||l=="require-dev")&&n.contains(c.range)&&u){let p=a[c.value];if(p&&p.version){let f=new O.InlayHintLabelPart(`(${p.version})`);f.tooltip=`${se.installed_version}`;let h=new O.InlayHint(u.range.end,[f],O.InlayHintKind.Type);h.paddingLeft=!0,h.textEdits=[],s.push(h)}}}),s})}static descriptionForPackage(r,n,i,s){var a,o;if(r&&r.name){let c=new O.MarkdownString("",!0);c.supportHtml=!0;let u=[],l="";if(r.version&&(l=`_(${r.version})_`),c.appendMarkdown(`**${r.name}** ${l}

`),r.authors&&Array.isArray(r.authors)){let p=r.authors.map(f=>`$(person) ${f.name}`).filter(f=>f).join(", ");p&&c.appendMarkdown(`**${se.authors}:** ${p}<br/>`)}if(r.abandoned&&c.appendMarkdown(`$(stop) **${se.abandoned}** ${r.abandoned}<br/>`),i&&typeof r.downloads=="number"&&c.appendMarkdown(`$(extensions-install-count) ${r.downloads.toLocaleString("en-US",{maximumFractionDigits:0})}<br/>`),s&&typeof r.favers=="number"&&c.appendMarkdown(`$(star-full) ${r.favers.toLocaleString("en-US",{maximumFractionDigits:0})}<br/>`),c.appendMarkdown(`

`),(typeof n=="undefined"||n)&&c.appendMarkdown(`${(a=r.description)!=null?a:""}

`),u.push(`[Packagist](https://packagist.org/packages/${r.name})`),(o=r.source)!=null&&o.url){let p=r.source.url,f="Source",h=p.replace(/\.git$/,"");u.push(`[${f}](${h})`)}return r.homepage&&u.push(`[Homepage](${r.homepage})`),c.appendMarkdown(u.join(" | ")),c}}provideHover(r,n,i){return b(this,null,function*(){let s=yield this.parser.resolvePackagesMeta(r.uri),a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,c,u)=>{if((u=="require"||u=="require-dev")&&o.range.contains(n)){let l=s[o.value];if(l&&l.name)return new O.Hover(Tn.descriptionForPackage(l),o.range)}})})}};var bp=require("fs"),rr=require("vscode");var v_="composer.lock.check",Yo=class extends Oe{constructor(r,n){super();this.context=r;this.taskprovider=n;if(this.enabled){let i;this.push(rr.workspace.onDidChangeWorkspaceFolders(s=>this.updateFolders(s.added))),this.push(i=rr.workspace.createFileSystemWatcher("**/composer.lock",!0,!0,!1)),i.onDidDelete(s=>b(this,null,function*(){s.fsPath.endsWith("composer.lock")&&(yield this.updateFolder(rr.workspace.getWorkspaceFolder(s)))})),this.updateFolders(rr.workspace.workspaceFolders)}}updateFolders(r){r&&r.length!=0&&r.forEach(n=>this.updateFolder(n))}updateFolder(r){return b(this,null,function*(){if(!r||!r.uri||r.uri.scheme!="file")return;let n=rr.Uri.joinPath(r.uri,"composer.json"),i=rr.Uri.joinPath(r.uri,"composer.lock");try{(0,bp.existsSync)(n.fsPath)&&!(0,bp.existsSync)(i.fsPath)&&(yield this.popup(r))}catch(s){}})}get enabled(){return this.context.globalState.get(v_,!0)!=!1}set enabled(r){this.context.globalState.update(v_,r)}popup(r){return b(this,null,function*(){if(!r&&r.uri.scheme!="file"||!this.enabled)return;let n=se.action_install,i=se.action_dontshowagain,s=yield rr.window.showWarningMessage(se.error_missingComposerLock,n,i);s==n?yield this.taskprovider.executeComposerTask("install",[],Js(r.uri).fsPath):s==i&&(this.enabled=!1)})}};var Ut=require("fs"),$r=require("process"),xn=require("vscode");var K_=lr(require("https")),Y_=require("url");var W_=require("url"),Wk=$_(),Xk=Q_();function Kk(t){return t.protocol==="http:"?process.env.HTTP_PROXY||process.env.http_proxy||null:t.protocol==="https:"&&(process.env.HTTPS_PROXY||process.env.https_proxy||process.env.HTTP_PROXY||process.env.http_proxy)||null}function X_(t,e,r){let n=e||Kk(t);if(!n)return null;let i=(0,W_.parse)(n);if(!/^https?:$/.test(i.protocol))return null;let s={host:i.hostname,port:Number(i.port),auth:i.auth,rejectUnauthorized:Yk(r)?r:!0};return t.protocol==="http:"?new Wk(s):new Xk(s)}function Yk(t){return t===!0||t===!1}function J_(t,e,r,n,i){return b(this,null,function*(){e.appendLine("Downloading "+t+" ..."),e.appendLine("  URL: "+n);try{return Op(t,n,e,r).then(s=>(e.appendLine("OK."),s))}catch(s){if(i){e.appendLine(`
  Alternative URL: `+i);try{let a=yield Op(t,i,e,r);return e.appendLine("OK."),a}catch(a){throw s}}else throw s}})}function Op(t,e,r,n){return b(this,null,function*(){let i=(0,Y_.parse)(e),s=n(),a=s.proxy,o=s.strictSSL,c={host:i.hostname,path:i.path,agent:X_(i,a,o),port:i.port,timeout:15*60*1e3,rejectUnauthorized:Jk(o)?o:!0},u=[];return new Promise((l,p)=>{let f=K_.request(c,h=>{if(h.statusCode===301||h.statusCode===302)return r.appendLine(`
  Redirect: ${h.headers.location}`),l(Op(t,h.headers.location,r,n));if(h.statusCode!=200)return r.appendLine(`
  Download failure: status code '${h.statusCode}'`),p(new Error(h.statusCode.toString()));let v=parseInt(h.headers["content-length"]),C=0,I=0,w=`  Downloading (${Math.floor(v/1024)}kB):`;r.append(w),h.on("data",m=>{C+=m.length,u.push(m);let x=Math.ceil(w.length*(C/v));for(;I<x;)r.append("."),I++}),h.on("end",()=>{l(Buffer.concat(u))}),h.on("error",m=>{p(new Error(`Failed to download from ${e}. Error Message: ${m.message} || 'NONE'}`))})});f.on("error",h=>{r.appendLine(`
  Error: ${h.message}`),p(new Error(`Request error: ${h.message||"NONE"}`))}),f.end()})})}function Jk(t){return t===!0||t===!1}var Z_=require("vscode"),rc=class{constructor(e,r){this.proxy=e;this.strictSSL=r}};function eC(){return()=>{let t=Z_.workspace.getConfiguration(),e=t.get("http.proxy"),r=t.get("http.proxyStrictSSL",!0);return new rc(e,r)}}var Zk=["/usr/bin/composer","/usr/local/bin/composer"],tC="latest.phar.timestamp",eD=30*24*60*60;function rC(){return Date.now()/1e3}var nc=class extends Oe{constructor(r,n){super();this.context=r;this.log=n;xn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("composer.bin")&&this.updatePath()}),xn.commands.registerCommand("composer.download",()=>b(this,null,function*(){return yield this.getOrDownloadComposerPhar(!0)})),this.updatePath().then(i=>{i.userbin!=!0&&this.tryUpdate()})}getUserDir(){let r=$r.platform=="win32"?"APPDATA":"HOME",n=$r.env[r];if(n)return n.replace("\\","/").trim()}getHomeDir(){var s,a;let r=$r.env["COMPOSER_HOME"];if(r)return r.trim();let n=this.getUserDir();if(n==null)return;if($r.platform=="win32")return`${n}/Composer`;let i=[];if((0,Ut.existsSync)("/etc/xdg")){let o=(s=$r.env.XDG_CONFIG_HOME)!=null?s:`${n}/.config`;i.push(`${o}/composer`)}return i.push(`${n}/.composer`),(a=i.find(o=>(0,Ut.existsSync)(o)))!=null?a:i[0]}getComposerHome(){let r=this.getHomeDir();if(r==null||!r){this.log.appendLine(`Cannot determine composer home directory. Please set '${"COMPOSER_HOME"}' environment variable.`);return}if(r=r.replaceAll("\\","/").trim(),(0,Ut.existsSync)(r))try{(0,Ut.chmodSync)(r,511)}catch(n){}else{this.log.appendLine(`Creating folder '${r}' for '${"composer.phar"}' installation.`),this.log.appendLine(`This can be customized using the '${"COMPOSER_HOME"}' environment variable.`);try{(0,Ut.mkdirSync)(r,511)}catch(n){}}return r}resolveComposerPharPath(){return b(this,null,function*(){var r=d_();if(r)return{path:r,userbin:!0};var n=yield xn.workspace.findFiles("composer.phar",void 0,1);if(n&&n.length&&n[0].scheme=="file")return{path:n[0].fsPath,userbin:!0};for(let a of Zk)if((0,Ut.existsSync)(a))return{path:a,userbin:!0};let i=this.getComposerHome(),s=`${i}/composer.phar`;return(0,Ut.existsSync)(s)?{path:s,userbin:!0}:{path:`${i}/latest.phar`}})}updatePath(){return b(this,null,function*(){let r=yield this.resolveComposerPharPath();return this.path=r.path,$r.platform=="win32"&&(this.path=this.path.replaceAll("/","\\")),console.log(`composer bin: '${this.path}'`),r})}tryUpdate(){return b(this,null,function*(){var r=this.context.globalState.get(tC,void 0);r===void 0?yield xn.commands.executeCommand("composer.download"):r&&typeof r=="number"&&rC()-r>eD&&(this.log.appendLine("  Updating composer.phar since the local version is more than 30 days old ..."),yield xn.commands.executeCommand("composer.download"))})}getOrDownloadComposerPhar(r){return b(this,null,function*(){for(let n=0;n<3;n++){if(r||!(0,Ut.existsSync)(this.path)){let i;try{i=yield J_("composer.phar",this.log,eC(),"https://getcomposer.org/composer.phar")}catch(s){}if(i&&i.byteLength>1024*1024)try{yield u_(this.path,i),this.context.globalState.update(tC,rC()),this.log.appendLine(`  composer.phar downloaded to '${this.path}'.`)}catch(s){this.log.appendLine(`  Error writing file '${this.path}': ${s.message}`);continue}else{i&&i.byteLength>0&&this.log.appendLine(`  Error: only ${i.byteLength} bytes downloaded.`);continue}}return this.path}})}};var Le=require("vscode");var ic=class extends Oe{constructor(r){super();this.composerphar=r;this.push(Le.tasks.registerTaskProvider("composer",{provideTasks:()=>[],resolveTask:(n,i)=>b(this,null,function*(){let s;return typeof n.scope=="object"&&n.scope.uri&&(s=n.scope.uri.fsPath),yield this.createTask(n.definition,s)})}))}getPhpToolsApi(){return b(this,null,function*(){var n,i;let r={phpBin:void 0,authentication:void 0};if(this.phptools==null){let s=Le.extensions.getExtension("devsense.phptools-vscode");s?this.phptools=(n=yield s.activate())!=null?n:r:this.phptools=r}return(i=this.phptools)!=null?i:r})}getPhpCommand(){return b(this,null,function*(){let r=yield this.getPhpToolsApi();if(r&&r.phpBin){let i=yield r.phpBin();if(i)return i}let n=Le.workspace.getConfiguration().get("php.executablePath");return n!==void 0&&n&&typeof n=="string"&&n!="php"?n:"php"})}executeComposerTask(r,n,i){return b(this,null,function*(){return yield Le.tasks.executeTask(yield this.createComposerTask(r,n,i))})}createComposerTask(r,n,i){return b(this,null,function*(){return yield this.createTask({type:"composer",command:r,args:n},i)})}createTask(r,n){return b(this,null,function*(){var o,c;let i=yield this.composerphar.getOrDownloadComposerPhar();if(i===void 0){Le.window.showErrorMessage(se.error_couldntGetComposer);return}let s=yield this.getPhpCommand();s[0]=='"'&&s[s.length-1]=='"'&&(s=s.substring(1,s.length-2));let a=[{value:i,quoting:Le.ShellQuoting.Strong},r.command];return r.args&&r.args.forEach(u=>{a.push({value:u!=null?u:"",quoting:Le.ShellQuoting.Strong})}),new Le.Task(r,(o=r.scope)!=null?o:Le.TaskScope.Workspace,(c=r.name)!=null?c:`composer ${r.command}`,"composer",new Le.ShellExecution(s,a,{cwd:n}))})}};var nC=lr(require("https"));var tD=5*60*1e3,sc=class extends Oe{constructor(){super();this.cache={}}request(r){let n=this.cache[r];return n&&n.json&&n.timestamp+tD>Date.now()?n.json:new Promise((i,s)=>{let a=[];nC.get(r,o=>{o.on("data",c=>{a.push(c)}),o.on("end",()=>{let c=JSON.parse(Buffer.concat(a).toString("utf-8"));this.cache[r]={json:c,timestamp:Date.now()},i(c)}),o.on("error",c=>{s(c)})})})}searchByTag(r){return b(this,null,function*(){return yield this.request(`https://packagist.org/search.json?tags=${r}`)})}search(r){return b(this,null,function*(){return yield this.request(`https://packagist.org/search.json?query=${r}`)})}packageData(r){return b(this,null,function*(){return yield this.request(`https://repo.packagist.org/p2/${r}.json`)})}};var jb=lr(Hb());var p1=require("vscode");var f1=lr(Af()),d1;var Fb={};function Ub(t,e){e==null&&(e={});for(let r in Fb)e[r]=Fb[r];d1.trackEvent({name:t,properties:e})}var h1;function v1(t){return b(this,null,function*(){return o_.init(t),Yd(t),t.subscriptions.push(h1=new Fd(t)),{}})}function g1(){return b(this,null,function*(){Ub("extension unloaded (composer)")})}var Fd=class extends Oe{constructor(r){super();this.push(this.log=$b.window.createOutputChannel("Composer")),this.push(this.packagist=new sc),this.push(this.composerphar=new nc(r,this.log)),this.push(this.taskprovider=new ic(this.composerphar)),this.push(new Xo(this.log,this.taskprovider,this.packagist)),this.push(new Tn(this.taskprovider,this.packagist)),this.push(new Yo(r,this.taskprovider)),this.push(new Ko)}};0&&(module.exports={activate,deactivate});
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */
